const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PeopleManager-CEqb72Vn.js","assets/vendor-Ciqy50a3.js","assets/db-DRjSyi5O.js","assets/maps-TAZ545fs.js","assets/AdminScreen-BJ2Jrs4z.js"])))=>i.map(i=>d[i]);
import{r as a,a as Vt,R as qe,H as ia,L as at,U as Ke,M as At,S as Mt,b as ca,P as xa,d as ha,e as Et,f as ma,h as ba,i as it,A as Tt,j as Xe,k as je,l as pt,m as ke,F as $t,X as Pe,n as Pt,C as $e,o as mt,p as ua,q as Wt,s as ht,B as pa,t as Lt,u as ga,E as kt,v as Nt,w as fa,x as ot,y as _t,z as wa,D as st,G as Se,Z as et,I as Re,J as Ue,K as Ge,N as Jt,O as va,Q as Yt,T as tt,V as ja,W as ka,Y as Na,_ as bt,$ as ya,a0 as Rt,a1 as Ca,a2 as ut,a3 as Kt,a4 as Sa,a5 as Qt,a6 as Da,a7 as zt,a8 as Ea,a9 as Ia,aa as Aa,ab as Ta,ac as $a,ad as Zt,ae as Pa,af as La,ag as _a,ah as Oa,ai as Ma,aj as Ra,ak as za,al as Xt,am as Fa,an as Ua,ao as Ga,ap as yt,aq as Ba}from"./vendor-Ciqy50a3.js";import{c as Ha}from"./db-DRjSyi5O.js";import{l as ze,M as ea,T as ta,u as gt,C as aa,P as sa,a as ra}from"./maps-TAZ545fs.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))d(b);new MutationObserver(b=>{for(const r of b)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&d(i)}).observe(document,{childList:!0,subtree:!0});function n(b){const r={};return b.integrity&&(r.integrity=b.integrity),b.referrerPolicy&&(r.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?r.credentials="include":b.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(b){if(b.ep)return;b.ep=!0;const r=n(b);fetch(b.href,r)}})();var la={exports:{}},ft={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qa=a,Va=Symbol.for("react.element"),Wa=Symbol.for("react.fragment"),Ja=Object.prototype.hasOwnProperty,Ya=qa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ka={key:!0,ref:!0,__self:!0,__source:!0};function na(t,s,n){var d,b={},r=null,i=null;n!==void 0&&(r=""+n),s.key!==void 0&&(r=""+s.key),s.ref!==void 0&&(i=s.ref);for(d in s)Ja.call(s,d)&&!Ka.hasOwnProperty(d)&&(b[d]=s[d]);if(t&&t.defaultProps)for(d in s=t.defaultProps,s)b[d]===void 0&&(b[d]=s[d]);return{$$typeof:Va,type:t,key:r,ref:i,props:b,_owner:Ya.current}}ft.Fragment=Wa;ft.jsx=na;ft.jsxs=na;la.exports=ft;var e=la.exports,It={},Ft=Vt;It.createRoot=Ft.createRoot,It.hydrateRoot=Ft.hydrateRoot;const Qa="modulepreload",Za=function(t){return"/Gabinete-Digital/"+t},Ut={},oa=function(s,n,d){let b=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),w=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));b=Promise.allSettled(n.map(S=>{if(S=Za(S),S in Ut)return;Ut[S]=!0;const y=S.endsWith(".css"),N=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${N}`))return;const M=document.createElement("link");if(M.rel=y?"stylesheet":Qa,y||(M.as="script"),M.crossOrigin="",M.href=S,w&&M.setAttribute("nonce",w),document.head.appendChild(M),y)return new Promise((u,x)=>{M.addEventListener("load",u),M.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${S}`)))})}))}function r(i){const w=new Event("vite:preloadError",{cancelable:!0});if(w.payload=i,window.dispatchEvent(w),!w.defaultPrevented)throw i}return b.then(i=>{for(const w of i||[])w.status==="rejected"&&r(w.reason);return s().catch(r)})},Xa=qe.memo(({currentView:t,setView:s,user:n,onLogout:d,toggleTheme:b,isDarkMode:r,systemConfig:i,showMobileDock:w=!0})=>{const[S,y]=a.useState(!0),[N,M]=a.useState(!1),u=S||N,x=n&&i[n.role]?i[n.role]:{allowedViews:[]},H=[{id:"dashboard",label:"Home",icon:ia},{id:"demands",label:"Demandas",icon:at},{id:"people",label:"Cidadãos",icon:Ke},{id:"map",label:"Mapa",icon:At}].filter(k=>x.allowedViews.includes(k.id)),Y=k=>k.split("_").map(G=>G.charAt(0).toUpperCase()+G.slice(1)).join(" "),j=k=>{s(k)},I=e.jsx("nav",{className:`
            lg:hidden fixed bottom-0 left-0 right-0 z-[9999] 
            bg-white/95 dark:bg-[#0f172a]/95 backdrop-blur-xl 
            border-t border-slate-200 dark:border-white/10 
            pb-[calc(env(safe-area-inset-bottom)+0.5rem)] shadow-[0_-4px_20px_rgba(0,0,0,0.05)]
            transition-transform duration-300 ease-in-out
            ${w?"translate-y-0":"translate-y-full"}
        `,children:e.jsxs("div",{className:"flex items-center justify-around h-[64px] px-2 pt-1",children:[H.map(k=>{const G=t===k.id,z=k.icon;return e.jsxs("button",{onClick:()=>j(k.id),className:`
                    flex flex-col items-center justify-center gap-1 w-full h-full transition-all duration-200 active:scale-95
                    ${G?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`
                    relative p-1.5 rounded-2xl transition-all duration-300
                    ${G?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}
                `,children:e.jsx(z,{className:`w-6 h-6 transition-all ${G?"stroke-[2.5px] scale-110":"stroke-2"}`})}),e.jsx("span",{className:`text-[9px] font-bold tracking-wide transition-opacity ${G?"opacity-100":"opacity-60"}`,children:k.label})]},k.id)}),e.jsxs("button",{onClick:()=>j("admin_panel"),className:`
                flex flex-col items-center justify-center gap-1 w-full h-full transition-all duration-200 active:scale-95
                ${t==="admin_panel"?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`relative p-1.5 rounded-2xl transition-all duration-300 ${t==="admin_panel"?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}`,children:e.jsx(Mt,{className:`w-6 h-6 ${t==="admin_panel"?"stroke-[2.5px]":"stroke-2"}`})}),e.jsx("span",{className:`text-[9px] font-bold tracking-wide ${t==="admin_panel"?"opacity-100":"opacity-60"}`,children:"Config"})]})]})});return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`
          hidden lg:flex
          transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]
          flex-col will-change-transform group z-40 overflow-hidden
          static h-auto
          my-4 ml-4 mr-0
          rounded-[2.5rem] border border-white/60 dark:border-white/5
          bg-white/80 dark:bg-[#020617]/80 backdrop-blur-2xl
          shadow-xl shadow-slate-200/50 dark:shadow-black/20
          ${u?"w-72":"w-24"}
        `,onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),children:[e.jsxs("div",{className:`p-6 flex items-center ${u?"justify-between":"justify-center"} border-b border-slate-100 dark:border-white/5 h-28 shrink-0 relative`,children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden whitespace-nowrap",children:[e.jsx("div",{className:`w-12 h-12 min-w-[3rem] bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30 ring-1 ring-white/20 transition-transform duration-300 ${!u&&!S?"scale-110":""}`,children:e.jsx(ca,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:`transition-all duration-300 origin-left ${u?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight text-slate-900 dark:text-white leading-none",children:"Gabinete"}),e.jsx("span",{className:"text-[10px] text-brand-600 dark:text-brand-400 font-bold tracking-[0.2em] uppercase",children:"Digital"})]})]}),e.jsx("button",{onClick:()=>y(!S),className:`
                flex absolute right-6 top-1/2 -translate-y-1/2 text-slate-400 dark:text-white/30 hover:text-brand-600 dark:hover:text-white transition-all duration-300
                ${u?"opacity-0 group-hover:opacity-100 delay-100":"opacity-0 pointer-events-none"}
            `,title:S?"Desafixar menu":"Fixar menu",children:S?e.jsx(xa,{className:"w-4 h-4"}):e.jsx(ha,{className:"w-4 h-4"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-x-hidden overflow-y-auto custom-scrollbar flex flex-col",children:H.map(k=>{const G=k.icon,z=t===k.id;return e.jsxs("button",{onClick:()=>j(k.id),disabled:!n,className:`
                  w-full flex items-center gap-4 px-4 py-3.5 rounded-2xl text-sm font-bold transition-all duration-300 relative group/item
                  ${n?"":"opacity-30 cursor-not-allowed"}
                  ${z?"bg-brand-500/10 dark:bg-white/10 text-brand-700 dark:text-white shadow-sm ring-1 ring-brand-500/20 dark:ring-white/10":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white"}
                  ${u?"":"justify-center"}
                `,children:[e.jsx(G,{className:`w-6 h-6 min-w-[1.5rem] transition-transform duration-300 ${z?"scale-110":"group-hover/item:scale-110"}`}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${u?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:k.label}),z&&u&&e.jsx("div",{className:"absolute right-4 w-1.5 h-1.5 rounded-full bg-brand-500 shadow-[0_0_8px_currentColor]"})]},k.id)})}),e.jsxs("div",{className:"p-4 border-t border-slate-100 dark:border-white/5 shrink-0 space-y-2",children:[e.jsxs("button",{onClick:b,className:`
                  lg:hidden w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5
                  ${u?"":"justify-center"}
                `,children:[r?e.jsx(Et,{className:"w-5 h-5 min-w-[1.25rem] text-amber-400"}):e.jsx(ma,{className:"w-5 h-5 min-w-[1.25rem] text-slate-600"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${u?"opacity-100":"opacity-0 w-0 hidden"}`,children:r?"Modo Claro":"Modo Escuro"})]}),n&&e.jsxs("button",{onClick:()=>j("admin_panel"),className:`
                  w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  ${t==="admin_panel"?"bg-slate-100 dark:bg-white/10 text-brand-700 dark:text-brand-300":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5"}
                  ${u?"":"justify-center"}
                `,children:[e.jsx(Mt,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${u?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Configurações"})]}),e.jsxs("button",{onClick:d,disabled:!n,className:`
                w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors
                ${u?"":"justify-center"}
                `,children:[e.jsx(ba,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${u?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Sair"})]}),e.jsxs("div",{className:`mt-2 flex items-center gap-3 p-2 rounded-2xl border transition-all duration-300 
                ${u?"bg-slate-50/50 dark:bg-white/5 border-slate-100 dark:border-white/5":"bg-transparent border-transparent justify-center"}
            `,children:[e.jsx("div",{className:"w-9 h-9 min-w-[2.25rem] rounded-full bg-slate-200 dark:bg-slate-800 flex items-center justify-center overflow-hidden border border-white dark:border-white/10 shadow-sm",children:n!=null&&n.avatar?e.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(it,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"})}),e.jsxs("div",{className:`flex-1 min-w-0 overflow-hidden transition-all duration-300 ${u?"opacity-100":"opacity-0 w-0 hidden"}`,children:[e.jsx("p",{className:"text-xs font-bold truncate text-slate-800 dark:text-white",children:n?n.name.split(" ")[0]:"..."}),e.jsx("p",{className:"text-[9px] text-brand-600 dark:text-brand-400 font-bold uppercase truncate tracking-wider",children:n?Y(n.role):""})]})]})]})]}),Vt.createPortal(I,document.body)]})});var Qe=(t=>(t.MUNICIPAL="Municipal",t.ESTADUAL="Estadual",t.FEDERAL="Federal",t))(Qe||{}),U=(t=>(t.PENDING="Pendente",t.IN_PROGRESS="Em Andamento",t.COMPLETED="Concluído",t))(U||{}),Z=(t=>(t.LOW="Baixa",t.MEDIUM="Média",t.HIGH="Alta",t))(Z||{}),dt=(t=>(t.SOLICITACAO="Solicitação",t.RECLAMACAO="Reclamação",t.ELOGIO="Elogio",t.DENUNCIA="Denúncia",t.SUGESTAO="Sugestão",t))(dt||{});const es="yioefhebxsohutdypxqd",Gt=`https://${es}.supabase.co`,Bt="sb_publishable_ltKmfB3EreWKb757l0c6mw__0FBPSeR",F=Gt&&Bt?Ha(Gt,Bt):null,ce=()=>!!F,Be=t=>{const s=t.replace(/\D/g,"");return s.length>11?t.slice(0,15):s.length>10?s.replace(/^(\d\d)(\d{5})(\d{4}).*/,"($1) $2-$3"):s.length>5?s.replace(/^(\d\d)(\d{4})(\d{0,4}).*/,"($1) $2-$3"):s.length>2?s.replace(/^(\d\d)(\d{0,5})/,"($1) $2"):s},Ht=t=>{const s=t.replace(/\D/g,"");return s.length>5?s.replace(/^(\d{5})(\d{1,3})/,"$1-$2"):s},Ye=t=>t.replace(/\D/g,""),ts=t=>{if(!t)return new Date;if(t.length===10&&t.includes("-")){const[s,n,d]=t.split("-").map(Number);return new Date(s,n-1,d)}return new Date(t)},nt=t=>t?ts(t).toLocaleDateString("pt-BR"):"",as=async t=>{try{if(!t||t.length<5)return null;const s=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}&limit=1`,n=await fetch(s,{headers:{"User-Agent":"GabineteDigitalApp/1.0"}});if(!n.ok)return null;const d=await n.json();return d&&d.length>0?{lat:parseFloat(d[0].lat),lon:parseFloat(d[0].lon)}:null}catch(s){return console.error("Geocoding error:",s),null}},ss=({initialSearchTerm:t,onSuccess:s,onCancel:n,onNotification:d})=>{const[b,r]=a.useState(""),[i,w]=a.useState([]),[S,y]=a.useState(!1),[N,M]=a.useState(!1),[u,x]=a.useState(null),[D,H]=a.useState(!1),Y=a.useRef(null),[j,I]=a.useState(""),[k,G]=a.useState(""),[z,$]=a.useState(""),[v,A]=a.useState(""),[_,l]=a.useState(""),[f,P]=a.useState(!1),[C,h]=a.useState(""),[B,K]=a.useState(""),[T,E]=a.useState(""),[V,X]=a.useState(""),[le,te]=a.useState(""),[p,ae]=a.useState(""),[re,de]=a.useState(""),[De,Ne]=a.useState(Qe.MUNICIPAL),[we,he]=a.useState(U.PENDING),[Le,q]=a.useState(Z.MEDIUM),[R,ue]=a.useState(dt.SOLICITACAO),[Ee,pe]=a.useState(""),[ye,Ie]=a.useState([]),[Ae,_e]=a.useState(""),[Ve,m]=a.useState(!1),[O,W]=a.useState(!1);a.useEffect(()=>{const o=new Date;o.setDate(o.getDate()+7),pe(o.toISOString().split("T")[0]),t&&(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)?me(t):(r(t),be(t)))},[]),a.useEffect(()=>{const o=L=>{Y.current&&!Y.current.contains(L.target)&&y(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const ne=o=>({id:o.id||"temp-id",cpf:o.cpf,name:`${o.nome} ${o.sobrenome}`,email:o.email||"",phone:o.telefone||"",logradouro:o.logradouro,numero:o.numero,complemento:o.complemento||void 0,bairro:o.bairro,cep:o.cep,cidade:o.cidade,estado:o.estado,lat:o.lat,lon:o.lon}),oe=o=>{o.cep&&l(Ht(o.cep)),o.logradouro&&h(o.logradouro),o.numero&&K(o.numero),o.bairro&&E(o.bairro),o.cidade&&X(o.cidade),o.estado&&te(o.estado)},me=async o=>{if(ce()&&F){const{data:L}=await F.from("citizens").select("*").eq("id",o).maybeSingle();if(L){const xe=ne(L);x(xe),r(xe.name),oe(xe),H(!1)}}},be=async o=>{if(!(!o||o.length<2)){M(!0),y(!0),w([]);try{if(ce()&&F){const L=Ye(o);let xe=F.from("citizens").select("*").limit(10);L.length>3?xe=xe.or(`telefone.ilike.%${L}%,nome.ilike.%${o}%,sobrenome.ilike.%${o}%`):xe=xe.or(`nome.ilike.%${o}%,sobrenome.ilike.%${o}%`);const{data:ve}=await xe;ve&&w(ve.map(We=>ne(We)))}}catch(L){console.error(L)}finally{M(!1)}}},Te=o=>{x(o),r(o.name),y(!1),H(!1),oe(o)},Ce=()=>{x(null),H(!0),y(!1);const o=Ye(b);if(o.length>=8)$(o);else{const L=b.split(" ");L.length>0&&I(L[0]),L.length>1&&G(L.slice(1).join(" "))}},wt=async()=>{const o=_.replace(/\D/g,"");if(o.length===8){P(!0);try{const xe=await(await fetch(`https://viacep.com.br/ws/${o}/json/`)).json();xe.erro||(h(xe.logradouro),E(xe.bairro),X(xe.localidade),te(xe.uf))}catch(L){console.error(L)}finally{P(!1)}}},rt=async o=>{if(o.preventDefault(),!p||!re){d&&d("error","Preencha título e descrição.");return}if(D&&!u){if(!j){d&&d("error","Nome é obrigatório.");return}if(!z){d&&d("error","Telefone é obrigatório.");return}}W(!0);try{let L=u==null?void 0:u.id;const xe=`${C}, ${B} - ${T}, ${V} - ${le}`;let ve={lat:0,lon:0};if(u&&u.lat&&u.lon)ve={lat:u.lat,lon:u.lon};else{const fe=await as(xe);fe&&(ve=fe)}if(D&&!L){const fe=Ye(z),Je=_?Ye(_):null;if(!navigator.onLine)L=crypto.randomUUID();else if(ce()&&F){const{data:ct}=await F.from("citizens").select("id").eq("telefone",fe).maybeSingle();if(ct)L=ct.id;else{const{data:vt,error:c}=await F.from("citizens").insert({nome:j,sobrenome:k||".",telefone:fe,email:v||null,cep:Je,logradouro:C||null,numero:B||null,bairro:T||null,cidade:V||null,estado:le||null,lat:ve.lat||null,lon:ve.lon||null}).select().single();if(c)throw c;L=vt.id}}}const We=crypto.randomUUID(),lt={id:We,title:p,description:re,level:De,status:we,priority:Le,type:R,deadline:Ee||null,citizen_id:L,tags:ye,created_at:new Date().toISOString(),lat:ve.lat||null,lon:ve.lon||null};if(navigator.onLine){if(ce()&&F){const{error:fe}=await F.from("demands").insert(lt);if(fe)throw fe;d&&d("success","Demanda criada com sucesso!")}}else{const fe=localStorage.getItem("offline_demands_queue"),Je=fe?JSON.parse(fe):[];Je.push(lt),localStorage.setItem("offline_demands_queue",JSON.stringify(Je)),d&&d("success","Salvo Offline! Será sincronizado quando online.")}setTimeout(()=>s(We),1e3)}catch(L){d&&d("error",`Erro: ${L.message}`),W(!1)}},ge=()=>{Ae.trim()&&!ye.includes(Ae.trim())&&(Ie([...ye,Ae.trim()]),_e(""),m(!1))};return e.jsxs("div",{className:"h-full flex flex-col relative animate-in fade-in slide-in-from-right duration-500 pb-20",children:[e.jsx("div",{className:"shrink-0 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:n,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:e.jsx(Tt,{className:"w-6 h-6"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-2",children:"Nova Demanda"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar pb-6 -mr-2 pr-2",children:e.jsx("div",{className:"max-w-none mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 items-start",children:[e.jsxs("div",{className:"lg:col-span-7 space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-visible z-20",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[e.jsx(it,{className:"w-4 h-4"})," Solicitante"]})}),e.jsxs("div",{className:"relative",ref:Y,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:b,onChange:o=>r(o.target.value),onKeyDown:o=>o.key==="Enter"&&be(b),placeholder:"Buscar por Nome ou Telefone (Enter)",className:`w-full pl-10 pr-10 py-3 glass-input border rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium transition-all ${D?"border-blue-300 dark:border-blue-500/50":"border-slate-300 dark:border-white/10"}`,autoComplete:"off"}),e.jsx(Xe,{className:"w-5 h-5 text-slate-400 absolute left-3 top-3.5"}),N&&e.jsx(je,{className:"absolute right-3 top-3.5 w-5 h-5 text-brand-500 animate-spin"})]}),S&&!u&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden max-h-60 overflow-y-auto z-50",children:i.length>0?i.map(o=>e.jsxs("button",{onClick:()=>Te(o),className:"w-full text-left p-3 hover:bg-slate-50 dark:hover:bg-white/5 border-b border-slate-100 dark:border-white/5 flex flex-col",children:[e.jsx("span",{className:"font-bold text-slate-800 dark:text-white text-sm",children:o.name}),e.jsxs("div",{className:"flex gap-2 text-xs text-slate-500",children:[o.phone&&e.jsx("span",{children:Be(o.phone)}),o.bairro&&e.jsxs("span",{children:["• ",o.bairro]})]})]},o.id)):!N&&b.length>2&&e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Nenhum resultado."}),e.jsx("button",{onClick:Ce,className:"text-sm font-bold text-brand-600 hover:underline",children:"Cadastrar Novo"})]})})]}),u&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-slate-50 dark:bg-white/5 p-4 rounded-2xl border border-slate-100 dark:border-white/5 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white dark:bg-slate-800 rounded-full border border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 font-bold text-brand-600",children:u.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-slate-900 dark:text-white",children:u.name}),e.jsx("p",{className:"text-xs text-slate-500",children:Be(u.phone)})]})]}),e.jsx("button",{onClick:()=>{x(null),r("")},className:"text-xs text-red-500 hover:underline",children:"Trocar"})]}),D&&!u&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl border border-blue-100 dark:border-blue-500/20 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300 text-xs font-bold uppercase",children:[e.jsx(pt,{className:"w-4 h-4"})," Novo Cadastro"]}),e.jsx("button",{onClick:()=>H(!1),className:"text-xs text-slate-400 hover:text-slate-600",children:"Cancelar"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Nome",value:j,onChange:o=>I(o.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"text",placeholder:"Sobrenome",value:k,onChange:o=>G(o.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"}),e.jsx("input",{type:"tel",placeholder:"Telefone (Só números)",value:z,onChange:o=>$(Ye(o.target.value)),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"email",placeholder:"Email (Opcional)",value:v,onChange:o=>A(o.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx(ke,{className:"w-4 h-4"})," Endereço da Ocorrência"]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"CEP"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:_,onChange:o=>l(Ht(o.target.value)),onBlur:wt,className:"w-full pl-9 pr-8 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm",placeholder:"00000-000"}),e.jsx(Xe,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400"}),f&&e.jsx(je,{className:"absolute right-3 top-3 w-4 h-4 text-brand-500 animate-spin"})]})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Cidade"}),e.jsx("input",{type:"text",value:V,onChange:o=>X(o.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-9",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Logradouro"}),e.jsx("input",{type:"text",value:C,onChange:o=>h(o.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-3",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Número"}),e.jsx("input",{type:"text",value:B,onChange:o=>K(o.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Bairro"}),e.jsx("input",{type:"text",value:T,onChange:o=>E(o.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"UF"}),e.jsx("input",{type:"text",value:le,onChange:o=>te(o.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm uppercase",maxLength:2})]})]})]})]}),e.jsx("div",{className:"lg:col-span-5 space-y-6",children:e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx($t,{className:"w-4 h-4"})," Detalhes da Solicitação"]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:R,onChange:o=>ue(o.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(dt).map(o=>e.jsx("option",{value:o,children:o},o))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título"}),e.jsx("input",{type:"text",value:p,onChange:o=>ae(o.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base font-bold text-slate-900 dark:text-white",placeholder:"Ex: Buraco na via"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição"}),e.jsx("textarea",{value:re,onChange:o=>de(o.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none",placeholder:"Descreva a situação em detalhes..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Etiquetas (Tags)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:ye.map(o=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1",children:[o,e.jsx(Pe,{onClick:()=>Ie(ye.filter(L=>L!==o)),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500"})]},o))}),Ve?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text",value:Ae,onChange:o=>_e(o.target.value),className:"flex-1 px-3 py-2 rounded-xl border border-slate-300 dark:border-white/10 glass-input text-sm",placeholder:"Nova tag...",onKeyDown:o=>{o.key==="Enter"&&ge()}}),e.jsx("button",{type:"button",onClick:ge,className:"px-3 py-2 bg-brand-600 text-white rounded-xl text-xs font-bold",children:"Add"})]}):e.jsxs("button",{type:"button",onClick:()=>m(!0),className:"text-xs text-brand-600 font-bold flex items-center gap-1 hover:underline",children:[e.jsx(Pt,{className:"w-3 h-3"})," Adicionar Tag"]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Inicial"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:we,onChange:o=>he(o.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(U).map(o=>e.jsx("option",{value:o,children:o},o))})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:De,onChange:o=>Ne(o.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(Qe).map(o=>e.jsx("option",{value:o,children:o},o))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:Ee,onChange:o=>pe(o.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"}),e.jsx($e,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.values(Z).map(o=>e.jsxs("label",{className:`flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition-all ${Le===o?o==="Alta"?"text-red-600 bg-red-100":o==="Média"?"text-amber-600 bg-amber-100":"text-green-600 bg-green-100":"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[e.jsx("input",{type:"radio",name:"priority",value:o,checked:Le===o,onChange:()=>q(o),className:"hidden"}),e.jsx("span",{className:"font-bold text-sm uppercase",children:o})]},o))})]})]})]})]})})]})})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-[60] flex gap-3 md:hidden",children:[e.jsx("button",{onClick:n,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:rt,disabled:O,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[O?e.jsx(je,{className:"w-5 h-5 animate-spin"}):navigator.onLine?e.jsx(mt,{className:"w-5 h-5"}):e.jsx(ua,{className:"w-5 h-5"}),O?"Salvando...":navigator.onLine?"Criar":"Salvar Offline"]})]}),e.jsxs("div",{className:"hidden md:flex fixed bottom-6 right-6 z-50 gap-3",children:[e.jsx("button",{onClick:n,className:"px-6 py-3 rounded-xl font-bold text-slate-500 bg-white shadow-lg border border-slate-200 hover:bg-slate-50 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:rt,disabled:O,className:"px-8 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-xl flex items-center gap-2 disabled:opacity-70 transition-all",children:[O?e.jsx(je,{className:"w-5 h-5 animate-spin"}):e.jsx(mt,{className:"w-5 h-5"}),O?"Salvando...":"Criar Demanda"]})]})]})},rs=({demand:t,onSuccess:s,onCancel:n,onNotification:d})=>{const[b,r]=a.useState(t.title),[i,w]=a.useState(t.description),[S,y]=a.useState(t.level),[N,M]=a.useState(t.status),[u,x]=a.useState(t.priority),[D,H]=a.useState(t.type||dt.SOLICITACAO),[Y,j]=a.useState(t.deadline?t.deadline.split("T")[0]:""),[I,k]=a.useState(null),[G,z]=a.useState(!1),[$,v]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!(!t.citizenId||!ce()||!F)){z(!0);try{const{data:f,error:P}=await F.from("citizens").select("*").eq("id",t.citizenId).maybeSingle();if(f)k(f);else{const{data:C}=await F.from("citizens").select("*").eq("cpf",t.citizenId).maybeSingle();C&&k(C)}}catch(f){console.error("Error fetching citizen details:",f.message||f)}finally{z(!1)}}})()},[t.citizenId]);const A=async l=>{l.preventDefault(),v(!0);try{if(!ce()||!F)throw new Error("Supabase não configurado.");const{error:f}=await F.from("demands").update({title:b,description:i,level:S,status:N,priority:u,type:D,deadline:Y||null}).eq("id",t.id);if(f)throw f;d&&d("success","Alterações salvas com sucesso!"),setTimeout(()=>s(t.id),1e3)}catch(f){d&&d("error",f.message||"Erro ao atualizar demanda."),v(!1)}},_=l=>{switch(l){case Z.HIGH:return"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-500/10 border-red-200 dark:border-red-500/20";case Z.MEDIUM:return"text-amber-600 dark:text-amber-400 bg-amber-100 dark:bg-amber-500/10 border-amber-200 dark:border-amber-500/20";case Z.LOW:return"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-500/10 border-green-200 dark:border-green-500/20"}};return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 md:pb-0 animate-in fade-in slide-in-from-right duration-500 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-slate-50/95 dark:bg-[#020617]/95 backdrop-blur-sm z-20 py-2 md:static md:bg-transparent md:py-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:n,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:[" ",e.jsx(Tt,{className:"w-6 h-6"})," "]}),e.jsxs("div",{children:[" ",e.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white tracking-tight flex flex-col md:flex-row md:items-center gap-1 md:gap-2",children:[" Edição de Demanda ",e.jsxs("span",{className:"text-xs md:text-sm font-normal text-slate-400 dark:text-white/40 border border-slate-200 dark:border-white/10 px-2 py-0.5 rounded-md font-mono w-fit",children:["#",t.id.slice(0,8)]})," "]})," "]})]}),e.jsxs("div",{className:"hidden md:flex gap-3",children:[e.jsx("button",{onClick:n,className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 dark:text-white/60 hover:bg-slate-100 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white transition-colors border border-transparent",children:" Cancelar "}),e.jsxs("button",{onClick:A,disabled:$,className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-[0_0_20px_rgba(14,165,233,0.3)] transition-all flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[" ",$?e.jsx(je,{className:"w-5 h-5 animate-spin"}):e.jsx(mt,{className:"w-5 h-5"})," ",$?"Salvando...":"Salvar Alterações"," "]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-500 via-blue-500 to-brand-500"}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[" ",e.jsx(it,{className:"w-4 h-4"})," Solicitante Vinculado "]}),G?e.jsxs("div",{className:"flex items-center gap-4 animate-pulse",children:[" ",e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-200 dark:bg-white/10 rounded-full"})," ",e.jsxs("div",{className:"space-y-2 flex-1",children:[" ",e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-white/10 rounded w-1/3"})," ",e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-white/10 rounded w-1/4"})," "]})," "]}):I?e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 md:gap-6",children:[" ",e.jsxs("div",{className:"flex items-center gap-4 md:gap-5",children:[" ",e.jsxs("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-100 dark:bg-slate-900 rounded-full border-2 border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 shadow-inner",children:[" ",e.jsx("span",{className:"text-xl md:text-2xl font-bold text-brand-600 dark:text-brand-400",children:I.nome.charAt(0)})," "]})," ",e.jsxs("div",{children:[" ",e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-slate-900 dark:text-white",children:[I.nome," ",I.sobrenome]})," ",I.telefone&&e.jsxs("p",{className:"text-slate-500 dark:text-white/50 font-mono text-xs md:text-sm mt-1 flex items-center gap-2",children:[" ",e.jsx(Wt,{className:"w-3 h-3"})," ",Be(I.telefone)," "]})," "]})," "]})," ",e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 text-xs md:text-sm",children:[" ",e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-white/80 bg-slate-50 dark:bg-white/5 px-3 py-1.5 rounded-lg border border-slate-200 dark:border-white/5",children:[" ",e.jsx(ke,{className:"w-4 h-4 text-brand-500"})," ",I.cidade," - ",I.estado," "]})," "]})," "]}):e.jsx("div",{className:"text-slate-500 dark:text-white/50 italic text-sm",children:"Cidadão não encontrado."})]}),e.jsxs("div",{className:"glass-panel p-4 md:p-8 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx($t,{className:"w-4 h-4"})," Detalhes da Solicitação "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:D,onChange:l=>H(l.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(dt).map(l=>e.jsx("option",{value:l,children:l},l))," "]})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título da Ocorrência"})," ",e.jsx("input",{type:"text",value:b,onChange:l=>r(l.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base md:text-lg font-bold text-slate-900 dark:text-white"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição Detalhada"})," ",e.jsx("textarea",{value:i,onChange:l=>w(l.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none"})," "]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/5",children:[" ",e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/40 uppercase mb-2",children:"Localização Registrada"})," ",e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-white",children:[" ",e.jsx(ke,{className:"w-5 h-5 text-red-500 shrink-0"})," ",e.jsxs("span",{className:"font-medium text-sm",children:[" ",I==null?void 0:I.logradouro,", ",I==null?void 0:I.numero," - ",I==null?void 0:I.bairro,", ",I==null?void 0:I.cidade,"/",I==null?void 0:I.estado," "]})," "]})," "]})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 lg:sticky lg:top-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx(ht,{className:"w-4 h-4"})," Controle de Gestão "]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Atual"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:N,onChange:l=>M(l.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(U).map(l=>e.jsx("option",{value:l,children:l},l))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"})," ",e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[" ",Object.values(Z).map(l=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${u===l?_(l):"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[" ",e.jsx("input",{type:"radio",name:"priority",value:l,checked:u===l,onChange:()=>x(l),className:"accent-current"})," ",e.jsx("span",{className:"font-bold text-sm uppercase",children:l})," "]},l))," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível de Governo"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:S,onChange:l=>y(l.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(Qe).map(l=>e.jsx("option",{value:l,children:l},l))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo Limite"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsx("input",{type:"date",value:Y,onChange:l=>j(l.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"})," ",e.jsx($e,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})," "]})," "]})]})]})})]}),e.jsxs("div",{className:"md:hidden fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-30 flex gap-3 pb-6",children:[e.jsx("button",{onClick:n,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:" Cancelar "}),e.jsxs("button",{onClick:A,disabled:$,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[" ",$?e.jsx(je,{className:"w-5 h-5 animate-spin"}):e.jsx(mt,{className:"w-5 h-5"})," ",$?"Salvando...":"Salvar"," "]})]})]})},ls=()=>e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none select-none p-4 lg:p-8 flex gap-6 bg-slate-100 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"hidden lg:flex w-72 h-full flex-col gap-8 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-8 opacity-40 blur-[2px] shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-5 w-32 bg-slate-200 dark:bg-white/10 rounded-lg"})]}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-12 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"},t))}),e.jsx("div",{className:"mt-auto h-14 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6 opacity-30 lg:opacity-50 blur-[3px] lg:blur-[1px]",children:[e.jsxs("div",{className:"h-24 w-full bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 flex items-center justify-between px-10 shadow-sm",children:[e.jsx("div",{className:"h-8 w-64 bg-slate-200 dark:bg-white/10 rounded-xl"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"})]})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"h-40 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-6 flex flex-col justify-between shadow-sm",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-100 dark:bg-white/5"}),e.jsx("div",{className:"h-5 w-24 bg-slate-200 dark:bg-white/10 rounded-lg"})]},t))}),e.jsx("div",{className:"flex-1 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-10 flex items-end justify-between gap-6 shadow-sm",children:[40,70,50,90,60,80,50,75,45,65,85,55,70,40,60].map((t,s)=>e.jsx("div",{className:"w-full bg-slate-200 dark:bg-white/5 rounded-t-xl",style:{height:`${t}%`}},s))})]})]}),ns=({onLogin:t})=>{const[s,n]=a.useState("login"),[d,b]=a.useState(!1),[r,i]=a.useState(!1),[w,S]=a.useState(""),[y,N]=a.useState(""),[M,u]=a.useState(!1),[x,D]=a.useState(""),[H,Y]=a.useState(""),[j,I]=a.useState(!1),[k,G]=a.useState(!1),[z,$]=a.useState(null),[v,A]=a.useState(!1),[_,l]=a.useState(null);a.useEffect(()=>{i(!0)},[]);const f=a.useMemo(()=>async E=>{const V=new TextEncoder().encode(E),X=await crypto.subtle.digest("SHA-256",V);return Array.from(new Uint8Array(X)).map(te=>te.toString(16).padStart(2,"0")).join("")},[]),P=a.useMemo(()=>{const E=x;return{length:E.length>=8&&E.length<=12,hasUpper:/[A-Z]/.test(E),isAlphanumeric:/[a-zA-Z]/.test(E)&&/[0-9]/.test(E),match:E===H&&E.length>0}},[x,H]),C=Object.values(P).every(Boolean),h=async E=>{E.preventDefault(),A(!0),l(null);try{if(ce()&&F){const V=await f(y),{data:X,error:le}=await F.from("system_users").select("*").eq("email",w).maybeSingle();if(le)throw le;if(!X||X.senha_hash!==V){l("Credenciais inválidas."),A(!1);return}if(!X.ativo){l("Conta desativada."),A(!1);return}if(!X.last_login){$(X),n("new_password"),A(!1);return}await K(X,!1,!1)}else await new Promise(V=>setTimeout(V,800)),w==="admin@admin"&&y==="admin"?await K({id:"demo-admin",email:"admin@admin",name:"Administrador Demo",role:"administrador",avatar:"https://ui-avatars.com/api/?name=Admin&background=0284c7&color=fff",firstLogin:!0},!0,!0):(l("Credenciais inválidas."),A(!1))}catch{l("Erro ao processar login."),A(!1)}},B=async E=>{if(E.preventDefault(),!(!C||!z)){if(A(!0),l(null),x==="Senha4321"){l("A nova senha não pode ser igual à senha padrão."),A(!1);return}try{if(ce()&&F){const V=await f(x),{error:X}=await F.from("system_users").update({senha_hash:V,last_login:new Date().toISOString()}).eq("id",z.id);if(X)throw X;const le={...z,last_login:new Date().toISOString()};await K(le,!1,!0)}}catch(V){l("Erro ao salvar nova senha: "+V.message),A(!1)}}},K=async(E,V=!1,X=!1)=>{!V&&ce()&&F&&s==="login"&&await F.from("system_users").update({last_login:new Date().toISOString()}).eq("id",E.id);const le=V?E:{id:E.id,email:E.email,name:E.nome,role:E.perfil,avatar:`https://ui-avatars.com/api/?name=${E.nome}&background=0284c7&color=fff`,firstLogin:X};b(!0),setTimeout(()=>{localStorage.setItem("geo_user",JSON.stringify(le)),t(le)},400)},T=({fulfilled:E,label:V})=>e.jsxs("div",{className:`flex items-center gap-2 text-xs transition-colors duration-200 ${E?"text-emerald-600 font-bold":"text-slate-400"}`,children:[e.jsx("div",{className:`w-3.5 h-3.5 rounded-full flex items-center justify-center border ${E?"bg-emerald-500 border-emerald-500 text-white":"border-slate-300 bg-transparent"}`,children:E&&e.jsx(st,{className:"w-2.5 h-2.5"})}),e.jsx("span",{children:V})]});return e.jsxs("div",{className:`fixed inset-0 z-[100] bg-slate-50 dark:bg-[#020617] transition-all duration-700 overflow-hidden ${d?"opacity-0 scale-105 pointer-events-none":"opacity-100"}`,children:[e.jsx(ls,{}),e.jsx("div",{className:"absolute inset-0 bg-white/40 dark:bg-black/60 backdrop-blur-[4px] z-10 transition-colors duration-700"}),e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col lg:flex-row w-full h-full",children:[e.jsx("div",{className:"w-full lg:w-1/2 h-full flex items-center justify-center p-6 relative",children:e.jsxs("div",{className:`
                  w-full max-w-[440px]
                  bg-white/80 dark:bg-[#0f172a]/70 backdrop-blur-2xl 
                  border border-white/50 dark:border-white/10 
                  shadow-[0_8px_40px_-12px_rgba(0,0,0,0.1)] dark:shadow-black/50
                  rounded-[2.5rem] p-8 md:p-12
                  transform transition-all duration-700 ease-out flex flex-col
                  ${r?"translate-y-0 opacity-100 scale-100":"translate-y-12 opacity-0 scale-95"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-4 mb-10",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-600 to-brand-700 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-600/20 text-white ring-4 ring-white/50 dark:ring-white/5",children:e.jsx(pa,{className:"w-7 h-7"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-extrabold text-slate-900 dark:text-white tracking-tight leading-none",children:["Gabinete",e.jsx("br",{}),"Digital"]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:s==="login"?"Acesso ao Painel":"Configuração Inicial"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1 font-medium",children:s==="login"?"Gerencie seu mandato com eficiência.":"Defina sua senha de segurança."})]}),_&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-500/20 text-red-600 dark:text-red-300 text-sm font-bold rounded-2xl flex items-center gap-3 animate-in slide-in-from-left-2 shadow-sm",children:[e.jsx(pt,{className:"w-5 h-5 flex-shrink-0"}),_]}),s==="login"?e.jsxs("form",{onSubmit:h,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(Lt,{className:"w-5 h-5"})}),e.jsx("input",{type:"email",value:w,onChange:E=>S(E.target.value),className:"block w-full pl-11 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Email",required:!0,autoComplete:"email"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(ga,{className:"w-5 h-5"})}),e.jsx("input",{type:M?"text":"password",value:y,onChange:E=>N(E.target.value),className:"block w-full pl-11 pr-12 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Senha",required:!0,autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>u(!M),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors cursor-pointer",children:M?e.jsx(kt,{className:"w-5 h-5"}):e.jsx(Nt,{className:"w-5 h-5"})})]})]}),e.jsxs("button",{type:"submit",disabled:v,className:"w-full py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-base transition-all transform active:scale-[0.98] shadow-lg shadow-brand-600/20 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed group relative overflow-hidden",children:[v?e.jsx(je,{className:"w-5 h-5 animate-spin"}):e.jsx(fa,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"}),v?"Conectando...":"Entrar"]})]}):e.jsxs("form",{onSubmit:B,className:"space-y-6 animate-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:j?"text":"password",value:x,onChange:E=>D(E.target.value),className:"block w-full pl-5 pr-12 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Nova Senha",maxLength:12,autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>I(!j),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors cursor-pointer",children:j?e.jsx(kt,{className:"w-5 h-5"}):e.jsx(Nt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:k?"text":"password",value:H,onChange:E=>Y(E.target.value),className:"block w-full pl-5 pr-12 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Confirmar Senha",maxLength:12,autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>G(!k),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors cursor-pointer",children:k?e.jsx(kt,{className:"w-5 h-5"}):e.jsx(Nt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-2xl border border-slate-100 dark:border-white/5 grid grid-cols-2 gap-3",children:[e.jsx(T,{fulfilled:P.length,label:"8-12 dígitos"}),e.jsx(T,{fulfilled:P.isAlphanumeric,label:"Letras/Números"}),e.jsx(T,{fulfilled:P.hasUpper,label:"Maiúscula"}),e.jsx(T,{fulfilled:P.match,label:"Senhas Iguais"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{n("login"),D(""),Y(""),$(null)},className:"flex-1 py-4 bg-white dark:bg-white/5 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-white/10 rounded-2xl font-bold text-sm border border-slate-200 dark:border-white/10 transition-colors",children:"Voltar"}),e.jsxs("button",{type:"submit",disabled:v||!C,className:"flex-[2] py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 disabled:opacity-50 transition-all",children:[v?e.jsx(je,{className:"w-5 h-5 animate-spin"}):e.jsx(ot,{className:"w-5 h-5"})," Confirmar"]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-200/50 dark:border-white/5 text-center",children:e.jsxs("p",{className:"text-[10px] uppercase font-bold text-slate-400 dark:text-slate-500 tracking-widest",children:["Desenvolvido por ",e.jsx("a",{href:"mailto:leowaltrick@gmail.com?subject=App Gabinete Digital",title:"Entrar em contato",className:"text-brand-600 dark:text-brand-400 hover:opacity-80 transition-opacity",children:"LW Consulting"})]})})]})}),e.jsx("div",{className:"hidden lg:flex w-1/2 h-full items-center justify-center p-12 xl:p-20 relative pointer-events-none",children:e.jsxs("div",{className:`
                  w-full max-w-xl pointer-events-auto
                  transform transition-all duration-1000 delay-200 flex flex-col gap-10
                  ${r?"translate-x-0 opacity-100":"translate-x-20 opacity-0"}
              `,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-extrabold text-slate-900 dark:text-white leading-tight mb-4 drop-shadow-sm",children:["Gestão inteligente",e.jsx("br",{}),"para mandatos modernos."]}),e.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-300 font-medium leading-relaxed",children:"Centralize demandas, acompanhe solicitações e tome decisões estratégicas baseadas em dados."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{title:"Gestão de Demandas",icon:at,desc:"Controle via Lista, Kanban e Calendário."},{title:"Base de Cidadãos",icon:Ke,desc:"Cadastro completo com histórico e mapa."},{title:"Mapa Interativo",icon:At,desc:"Visualização geoespacial de ocorrências."},{title:"Agenda e Prazos",icon:$e,desc:"Monitoramento de tarefas e vencimentos."},{title:"Dashboard e KPIs",icon:_t,desc:"Métricas de desempenho em tempo real."},{title:"Segurança e Acesso",icon:wa,desc:"Controle granular de permissões."}].map((E,V)=>e.jsxs("div",{className:"bg-white/60 dark:bg-black/40 backdrop-blur-md border border-white/40 dark:border-white/10 p-4 rounded-2xl shadow-sm hover:bg-white/80 dark:hover:bg-white/10 transition-colors duration-300",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 mb-3",children:e.jsx(E.icon,{className:"w-5 h-5"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white text-sm mb-1",children:E.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-snug",children:E.desc})]},V))})]})})]})]})},He=({options:t,value:s,onChange:n,size:d="md"})=>{const b=t.findIndex(r=>r.value===s);return e.jsxs("div",{className:`bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex relative border border-slate-200 dark:border-white/5 shadow-inner min-w-max ${d==="sm"?"h-9":"h-11"}`,children:[e.jsx("div",{className:"absolute top-1 bottom-1 rounded-lg bg-white dark:bg-slate-600 shadow-sm transition-all duration-300 ease-out z-0",style:{width:`calc(${100/t.length}% - 0.35rem)`,left:`calc(${b*(100/t.length)}% + 0.18rem)`}}),t.map(r=>{const i=s===r.value,w=r.icon;return e.jsxs("button",{onClick:()=>n(r.value),className:`
                flex-1 px-3 text-xs font-bold rounded-lg transition-all duration-300 relative z-10 flex items-center justify-center gap-1.5 whitespace-nowrap
                ${i?"text-brand-600 dark:text-white":"text-slate-500 dark:text-white/40 hover:text-slate-700"}
            `,children:[w&&e.jsx(w,{className:d==="sm"?"w-3 h-3":"w-4 h-4"}),r.label]},r.value)})]})},os=({demands:t,citizens:s,onViewDemand:n,onUpdateStatus:d})=>{const[b,r]=a.useState(null),[i,w]=a.useState(U.PENDING),S=[{id:U.PENDING,label:"Pendente",icon:Se,color:"text-slate-500",bg:"bg-slate-100 dark:bg-slate-900/50",border:"border-slate-300 dark:border-slate-700"},{id:U.IN_PROGRESS,label:"Em Andamento",icon:et,color:"text-amber-500",bg:"bg-amber-50 dark:bg-amber-900/10",border:"border-amber-300 dark:border-amber-700"},{id:U.COMPLETED,label:"Concluído",icon:Re,color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/10",border:"border-green-300 dark:border-green-700"}],y=(u,x)=>{r(x),u.dataTransfer.setData("demandId",x),u.dataTransfer.effectAllowed="move"},N=u=>{u.preventDefault(),u.dataTransfer.dropEffect="move"},M=(u,x)=>{u.preventDefault();const D=u.dataTransfer.getData("demandId");D&&d(D,x),r(null)};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500",children:[e.jsx("div",{className:"md:hidden landscape:hidden px-1 pb-3 shrink-0",children:e.jsx(He,{value:i,onChange:u=>w(u),options:[{value:U.PENDING,label:"Pendente",icon:Se},{value:U.IN_PROGRESS,label:"Andamento",icon:et},{value:U.COMPLETED,label:"Concluído",icon:Re}]})}),e.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-auto md:overflow-visible custom-scrollbar",children:e.jsx("div",{className:"flex flex-col landscape:flex-row md:flex-row h-full landscape:gap-4 md:gap-6 pb-4",children:S.map(u=>{const x=t.filter(j=>j.status===u.id),D=u.icon,Y=i===u.id?"flex":"hidden landscape:flex md:flex";return e.jsxs("div",{className:`${Y} flex-1 flex-col min-w-0 md:min-w-[320px] md:max-w-md h-full transition-all duration-300`,onDragOver:N,onDrop:j=>M(j,u.id),children:[e.jsxs("div",{className:`p-3 md:p-4 rounded-t-3xl border-x border-t border-slate-200 dark:border-white/10 ${u.bg} backdrop-blur-sm flex justify-between items-center relative md:sticky top-0 z-10 shrink-0`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:`w-5 h-5 ${u.color}`}),e.jsx("h3",{className:"font-bold text-slate-700 dark:text-white text-sm md:text-base",children:u.label})]}),e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-white dark:bg-white/10 text-xs font-bold text-slate-600 dark:text-white shadow-sm border border-slate-100 dark:border-white/5",children:x.length})]}),e.jsx("div",{className:`flex-1 overflow-y-auto p-2 landscape:p-2 md:p-3 space-y-3 border-x border-b border-slate-200 dark:border-white/10 rounded-b-3xl bg-white/30 dark:bg-white/5 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/10 transition-colors ${b?"bg-slate-50/50 dark:bg-white/10":""}`,children:x.length===0?e.jsx("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 dark:text-white/20 border-2 border-dashed border-slate-300 dark:border-white/10 rounded-xl m-2",children:e.jsx("p",{className:"text-sm",children:"Vazio"})}):x.map(j=>{const I=s.find(k=>k.id===j.citizenId);return e.jsxs("div",{draggable:!0,onDragStart:k=>y(k,j.id),onClick:()=>n(j),className:`
                                                    bg-white dark:bg-[#1e293b] rounded-xl border border-slate-200 dark:border-white/5 shadow-sm 
                                                    hover:shadow-md hover:border-brand-500/50 dark:hover:border-brand-500/50 
                                                    transition-all cursor-pointer group relative overflow-hidden active:cursor-grabbing
                                                    p-4 landscape:p-2.5 
                                                `,children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${j.priority===Z.HIGH?"bg-red-500":j.priority===Z.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-2 landscape:mb-1",children:[e.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-white/40 font-mono",children:["#",j.id.slice(0,6)]}),e.jsxs("div",{className:"flex gap-1",children:[j.level===Qe.FEDERAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500",title:"Federal"}),j.level===Qe.ESTADUAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500",title:"Estadual"})]})]}),e.jsx("h4",{className:"font-bold text-slate-800 dark:text-white text-sm leading-snug mb-2 pl-2 group-hover:text-brand-600 dark:group-hover:text-brand-400 transition-colors landscape:mb-1 landscape:line-clamp-2",children:j.title}),e.jsxs("div",{className:"flex items-center gap-2 pl-2 mb-3 landscape:mb-1",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-[10px] font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:(I==null?void 0:I.name.charAt(0))||"?"}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 truncate max-w-[120px] landscape:hidden",children:(I==null?void 0:I.name)||"Não identificado"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100 dark:border-white/5 pl-2 landscape:hidden",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 dark:text-white/40",children:[e.jsx($e,{className:"w-3 h-3"})," ",new Date(j.createdAt).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"})]}),j.deadline&&e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${new Date(j.deadline)<new Date?"bg-red-100 text-red-600":"bg-slate-100 text-slate-500"} dark:bg-white/10 dark:text-white/60`,children:nt(j.deadline)})]})]},j.id)})})]},u.id)})})})]})},ds=({demands:t,interactions:s=[],notices:n=[],onEditDemand:d})=>{const[b,r]=a.useState(new Date),[i,w]=a.useState(null),[S,y]=a.useState(!0),[N,M]=a.useState(!0),[u,x]=a.useState(!0),D=b.getFullYear(),H=b.getMonth(),Y=new Date(D,H+1,0).getDate(),j=new Date(D,H,1).getDay(),I=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],k=()=>{r(new Date(D,H-1,1)),w(null)},G=()=>{r(new Date(D,H+1,1)),w(null)},z=()=>{const h=new Date;r(h),w(h.getDate())},$=(h,B)=>{const K=h.split("T")[0].split("-").map(Number);return K[2]===B&&K[1]-1===H&&K[0]===D},v=h=>{const B=S?t.filter(E=>E.deadline&&$(E.deadline,h)):[],K=N?s.filter(E=>E.type==="checklist"&&E.deadline&&!E.isCompleted&&$(E.deadline,h)):[],T=u?n.filter(E=>$(E.date,h)):[];return{demands:B,checklists:K,notices:T}},A=new Date(D,H,1),_=[...S?t.filter(h=>h.deadline&&h.status!==U.COMPLETED).map(h=>({type:"demand",data:h,date:new Date(h.deadline)})):[],...N?s.filter(h=>h.type==="checklist"&&h.deadline&&!h.isCompleted).map(h=>({type:"checklist",data:h,date:new Date(h.deadline)})):[],...u?n.filter(h=>new Date(h.date)).map(h=>({type:"notice",data:h,date:new Date(h.date)})):[]].filter(h=>h.date>=A).sort((h,B)=>h.date.getTime()-B.date.getTime()).slice(0,15),l=i?v(i):{demands:[],checklists:[],notices:[]},f=h=>{switch(h){case Z.HIGH:return"bg-red-100 text-red-700 dark:bg-red-500/20 dark:text-red-300 border-l-2 border-red-500";case Z.MEDIUM:return"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300 border-l-2 border-amber-500";case Z.LOW:return"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300 border-l-2 border-green-500"}},P=h=>{switch(h){case"alert":return e.jsx(Yt,{className:"w-3 h-3 text-red-500"});case"event":return e.jsx($e,{className:"w-3 h-3 text-blue-500"});default:return e.jsx(va,{className:"w-3 h-3 text-slate-500"})}},C=()=>{const h=[];for(let B=0;B<j;B++)h.push(e.jsx("div",{className:"min-h-[80px] bg-slate-50/30 dark:bg-slate-900/20 border-r border-b border-slate-200 dark:border-white/5"},`empty-${B}`));for(let B=1;B<=Y;B++){const{demands:K,checklists:T,notices:E}=v(B),V=K.length+T.length+E.length,X=B===new Date().getDate()&&H===new Date().getMonth()&&D===new Date().getFullYear(),le=B===i;h.push(e.jsxs("div",{onClick:()=>w(B),className:`
                min-h-[80px] md:min-h-[120px] h-auto flex flex-col
                border-r border-b border-slate-200 dark:border-white/5 p-1 md:p-2 relative group hover:bg-slate-50 dark:hover:bg-white/5 transition-colors cursor-pointer
                ${le?"bg-brand-50 dark:bg-brand-900/10 shadow-[inset_0_0_0_2px_rgba(14,165,233,0.5)]":X?"bg-brand-500/5":"bg-transparent"}
            `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`text-xs md:text-sm font-bold w-6 h-6 md:w-7 md:h-7 flex items-center justify-center rounded-full transition-all
                ${X?"bg-brand-500 text-white shadow-lg shadow-brand-500/30":le?"bg-slate-900 dark:bg-white text-white dark:text-slate-900":"text-slate-500 dark:text-white/50"}
            `,children:B}),V>0&&e.jsx("span",{className:"text-[9px] bg-slate-200 dark:bg-white/10 text-slate-600 dark:text-white/70 px-1.5 py-0.5 rounded-full font-bold",children:V})]}),e.jsxs("div",{className:"space-y-1 overflow-y-hidden flex-1",children:[e.jsxs("div",{className:"hidden md:block space-y-1",children:[E.map(te=>e.jsxs("div",{className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 ${te.type==="alert"?"border-red-400 bg-red-50 dark:bg-red-500/10":"border-blue-400 bg-blue-50 dark:bg-blue-500/10"}`,children:[P(te.type)," ",te.title]},te.id)),K.slice(0,3-E.length).map(te=>e.jsx("div",{onClick:p=>{p.stopPropagation(),d(te)},className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 cursor-pointer hover:brightness-95 active:scale-95 transition-all ${f(te.priority)}`,children:te.title},te.id)),T.slice(0,Math.max(0,3-(K.length+E.length))).map(te=>e.jsxs("div",{className:"w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 border-l-slate-400 bg-slate-100 dark:bg-white/5 text-slate-600 dark:text-white/60",children:[e.jsx(Jt,{className:"w-2 h-2"})," ",te.text]},te.id)),K.length+T.length+E.length>3&&e.jsxs("div",{className:"text-[9px] text-slate-400 pl-1",children:["+ ",V-3," mais"]})]}),e.jsxs("div",{className:"md:hidden flex flex-wrap justify-center content-end h-full pb-1 gap-1",children:[E.map((te,p)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"},`n-${p}`)),K.map((te,p)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-500"},`d-${p}`)),T.map((te,p)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"},`c-${p}`))]})]})]},B))}return h};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 shrink-0",children:[e.jsxs("button",{onClick:()=>y(!S),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${S?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-500/20 dark:border-brand-500/30 dark:text-brand-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${S?"bg-brand-500":"bg-slate-300"}`})," Demandas"]}),e.jsxs("button",{onClick:()=>M(!N),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${N?"bg-slate-100 border-slate-300 text-slate-700 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${N?"bg-slate-500":"bg-slate-300"}`})," Checklists"]}),e.jsxs("button",{onClick:()=>x(!u),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${u?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-500/20 dark:border-blue-500/30 dark:text-blue-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${u?"bg-blue-500":"bg-slate-300"}`})," Avisos"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-6 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 glass-panel rounded-3xl shadow-sm border border-slate-200 dark:border-white/10 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 md:p-6 border-b border-slate-200 dark:border-white/10 flex items-center justify-between bg-white/50 dark:bg-white/5 backdrop-blur-sm shrink-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white capitalize flex items-center gap-2",children:[e.jsx($e,{className:"w-6 h-6 text-brand-600 dark:text-brand-400"}),I[H]," ",e.jsx("span",{className:"text-slate-400 dark:text-white/40 font-normal",children:D})]}),e.jsxs("div",{className:"flex bg-white dark:bg-white/10 rounded-xl border border-slate-200 dark:border-white/10 shadow-sm",children:[e.jsx("button",{onClick:k,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-l-xl border-r border-slate-200 dark:border-white/10",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsx("button",{onClick:z,className:"px-4 text-xs font-bold text-slate-600 dark:text-white/70 hover:bg-slate-50 dark:hover:bg-white/10",children:"Hoje"}),e.jsx("button",{onClick:G,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-r-xl border-l border-slate-200 dark:border-white/10",children:e.jsx(Ge,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"grid grid-cols-7 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(h=>e.jsx("div",{className:"py-2 text-center text-[10px] md:text-xs font-bold text-slate-500 dark:text-white/30 uppercase tracking-wider",children:h},h))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"grid grid-cols-7 bg-transparent min-h-full",children:C()})})]}),e.jsx("div",{className:"w-full lg:w-80 glass-panel rounded-3xl border border-slate-200 dark:border-white/10 flex flex-col shrink-0 overflow-hidden h-[300px] lg:h-auto",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:[i," de ",I[H]]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-white/50",children:[l.demands.length+l.checklists.length+l.notices.length," eventos"]})]}),e.jsx("button",{onClick:()=>w(null),className:"text-xs text-brand-600 hover:underline",children:"Ver Geral"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar",children:[[...l.notices,...l.demands,...l.checklists].map((h,B)=>e.jsxs("div",{onClick:()=>h.type==="demand"&&d(h),className:`p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10 ${h.type==="demand"?"cursor-pointer hover:border-brand-200 hover:shadow-sm transition-all":""}`,children:[e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white line-clamp-2",children:h.title||h.text}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 capitalize",children:h.type==="checklist"?"Tarefa":h.type||"Demanda"})]},B)),l.demands.length===0&&l.notices.length===0&&l.checklists.length===0&&e.jsx("p",{className:"text-center text-xs text-slate-400 mt-4",children:"Nada para este dia."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-brand-600 dark:text-brand-400"}),"Próximos Prazos"]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-white/50",children:["A partir de ",I[H]]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:_.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-slate-400 dark:text-white/30 text-center",children:[e.jsx(Se,{className:"w-10 h-10 mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Nenhum evento futuro."})]}):_.map((h,B)=>{const K=h.date.getDate()===new Date().getDate()&&h.date.getMonth()===new Date().getMonth(),T=h.type==="notice"?"bg-blue-50 text-blue-600 border-blue-100 dark:bg-blue-500/10 dark:text-blue-400":h.type==="demand"?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400":"bg-slate-50 text-slate-600 border-slate-100 dark:bg-white/5 dark:text-slate-400";return e.jsxs("div",{onClick:()=>h.type==="demand"&&d(h.data),className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:`w-10 h-10 rounded-lg flex flex-col items-center justify-center font-bold shrink-0 border ${T}`,children:[e.jsx("span",{className:"text-xs",children:h.date.getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:h.date.toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:h.type==="notice"||h.type==="demand"?h.data.title:h.data.text}),h.type==="demand"&&e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${K?"bg-red-100 text-red-600":"bg-slate-100 text-slate-600"} dark:bg-white/10`,children:K?"HOJE":h.data.status})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:h.type==="notice"?"Aviso Mural":h.type==="demand"?h.data.description:"Tarefa Checklist"})]})]},`${h.type}-${h.data.id}-${B}`)})})]})})]})]})},is=({currentPage:t,totalPages:s,onPageChange:n,totalItems:d,itemsPerPage:b})=>{if(s<=1)return null;const r=(t-1)*b+1,i=Math.min(t*b,d);return e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 py-4 px-2 border-t border-slate-200 dark:border-white/10 mt-auto",children:[e.jsxs("div",{className:"text-xs text-slate-500 dark:text-white/50 font-medium order-2 sm:order-1",children:["Mostrando ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:r})," a ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:i})," de ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:d})," registros"]}),e.jsxs("div",{className:"flex items-center gap-2 order-1 sm:order-2",children:[e.jsx("button",{onClick:()=>n(t-1),disabled:t===1,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Página anterior",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-1 px-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700 dark:text-white",children:t}),e.jsx("span",{className:"text-sm text-slate-400 dark:text-white/40",children:"/"}),e.jsx("span",{className:"text-sm text-slate-500 dark:text-white/50 font-medium",children:s})]}),e.jsx("button",{onClick:()=>n(t+1),disabled:t===s,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Próxima página",children:e.jsx(Ge,{className:"w-4 h-4"})})]})]})},cs=qe.memo(({demand:t,onUpdateStatus:s})=>{const n=r=>{s(t.id,r.target.value)},d=r=>r.stopPropagation(),b=r=>{switch(r){case U.COMPLETED:return"bg-green-50 text-green-700 border-green-200 dark:bg-green-500/10 dark:text-green-400 dark:border-green-500/20";case U.IN_PROGRESS:return"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";default:return"bg-slate-100 text-slate-600 border-slate-200 dark:bg-white/5 dark:text-slate-400 dark:border-white/10"}};return e.jsxs("div",{className:"relative inline-block group/status",onClick:d,children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg border transition-colors shadow-sm ${b(t.status)}`,children:[t.status===U.COMPLETED&&e.jsx(Re,{className:"w-3.5 h-3.5"}),t.status===U.IN_PROGRESS&&e.jsx(et,{className:"w-3.5 h-3.5"}),t.status===U.PENDING&&e.jsx(Se,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:t.status}),e.jsx("div",{className:"ml-1 pl-1 border-l border-current/20 opacity-50",children:e.jsx(tt,{className:"w-3 h-3"})})]}),e.jsx("select",{value:t.status,onChange:n,onClick:d,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer font-bold text-sm appearance-none",children:Object.values(U).map(r=>e.jsx("option",{value:r,children:r},r))})]})}),xs=({demands:t,citizens:s,onUpdateStatus:n,onEdit:d,onViewDemand:b,initialSelectionId:r,clearSelection:i,onInteractionUpdate:w,onNotification:S,onViewCitizen:y})=>{const[N,M]=a.useState("createdAt"),[u,x]=a.useState("desc"),[D,H]=a.useState(1),Y=10,j=v=>{N===v?x(A=>A==="asc"?"desc":"asc"):(M(v),x("desc"))},I=v=>N!==v?e.jsx(ja,{className:"w-3 h-3 text-slate-300"}):u==="asc"?e.jsx(ka,{className:"w-3 h-3 text-brand-600"}):e.jsx(Na,{className:"w-3 h-3 text-brand-600"}),k=a.useMemo(()=>[...t].sort((v,A)=>{let _=0;switch(N){case"createdAt":_=new Date(v.createdAt).getTime()-new Date(A.createdAt).getTime();break;case"deadline":const l=v.deadline?new Date(v.deadline).getTime():0,f=A.deadline?new Date(A.deadline).getTime():0;_=l-f;break;case"priority":const P={[Z.LOW]:1,[Z.MEDIUM]:2,[Z.HIGH]:3};_=P[v.priority]-P[A.priority];break;case"status":const C={[U.PENDING]:1,[U.IN_PROGRESS]:2,[U.COMPLETED]:3};_=C[v.status]-C[A.status];break;default:_=0}return u==="asc"?_:-_}),[t,N,u]);a.useEffect(()=>{H(1)},[t]);const G=Math.ceil(k.length/Y),z=k.slice((D-1)*Y,D*Y),$=v=>{switch(v){case Z.HIGH:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-red-100 text-red-600 dark:bg-red-500/10 dark:text-red-300 border border-red-200 dark:border-red-500/20",children:"Alta"});case Z.MEDIUM:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-amber-100 text-amber-600 dark:bg-amber-500/10 dark:text-amber-300 border border-amber-200 dark:border-amber-500/20",children:"Média"});case Z.LOW:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-green-100 text-green-600 dark:bg-green-500/10 dark:text-green-300 border border-green-200 dark:border-green-500/20",children:"Baixa"})}};return e.jsx("div",{className:"flex flex-col w-full gap-2 relative",children:e.jsx("div",{className:"glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-slate-900/50 shadow-sm relative w-full flex flex-col min-h-0",children:k.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 dark:text-white/30 text-sm py-20",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-4",children:e.jsx(Xe,{className:"w-6 h-6 opacity-30"})}),e.jsx("p",{children:"Nenhuma demanda encontrada."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full relative",children:[e.jsxs("table",{className:"w-full text-left border-collapse hidden md:table",children:[e.jsx("thead",{className:"bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-sm border-b border-slate-200 dark:border-white/10",children:e.jsxs("tr",{className:"text-xs font-bold text-slate-500 dark:text-blue-200/50 uppercase tracking-wider",children:[e.jsx("th",{className:"p-4 first:pl-6 w-[35%] min-w-[200px]",children:"Título"}),e.jsx("th",{className:"p-4 w-[20%] min-w-[150px]",children:"Solicitante"}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>j("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",I("status")]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>j("priority"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prioridade ",I("priority")]})}),e.jsx("th",{className:"p-4 hidden lg:table-cell cursor-pointer",onClick:()=>j("createdAt"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Criação ",I("createdAt")]})}),e.jsx("th",{className:"p-4 hidden xl:table-cell cursor-pointer",onClick:()=>j("deadline"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prazo ",I("deadline")]})}),e.jsx("th",{className:"p-4 text-right last:pr-6 w-[80px]",children:"Ação"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-white/5 text-sm",children:z.map(v=>{const A=s.find(_=>_.id===v.citizenId);return e.jsxs("tr",{onClick:()=>b(v),className:"hover:bg-white/60 dark:hover:bg-white/5 transition-colors cursor-pointer group",children:[e.jsxs("td",{className:"p-4 first:pl-6",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white truncate max-w-[250px]",title:v.title,children:v.title}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-white/50 truncate mt-0.5 max-w-[250px]",children:v.description})]}),e.jsx("td",{className:"p-4",children:A?e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group/citizen p-1 -ml-1 rounded-lg hover:bg-brand-50 dark:hover:bg-white/10 transition-colors",onClick:_=>{_.stopPropagation(),y&&y(A.id)},children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs border border-slate-200 dark:border-white/10 shrink-0",children:A.name.charAt(0)}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"font-medium text-slate-900 dark:text-white truncate max-w-[150px] group-hover/citizen:text-brand-600 transition-colors",children:A.name})})]}):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"Não vinculado"})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:e.jsx(cs,{demand:v,onUpdateStatus:n})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:$(v.priority)}),e.jsx("td",{className:"p-4 hidden lg:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:new Date(v.createdAt).toLocaleDateString()}),e.jsx("td",{className:"p-4 hidden xl:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:v.deadline?nt(v.deadline):"-"}),e.jsx("td",{className:"p-4 text-right last:pr-6",children:e.jsx("div",{className:"p-2 text-slate-400 group-hover:text-brand-600 transition-colors inline-flex bg-slate-100 dark:bg-white/5 rounded-lg group-hover:bg-brand-50 dark:group-hover:bg-brand-500/10",children:e.jsx(ot,{className:"w-4 h-4"})})})]},v.id)})})]}),e.jsx("div",{className:"md:hidden space-y-3 p-3",children:z.map(v=>{const A=s.find(_=>_.id===v.citizenId);return e.jsxs("div",{onClick:()=>b(v),className:"glass-panel p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm active:scale-[0.98] transition-all cursor-pointer relative overflow-hidden group",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${v.priority===Z.HIGH?"bg-red-500":v.priority===Z.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-xs font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:A?A.name.charAt(0):"?"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-bold text-slate-900 dark:text-white truncate",children:A?A.name.split(" ")[0]:"S/ Solicitante"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-white/50",children:new Date(v.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase border ${v.status===U.COMPLETED?"bg-green-50 text-green-700 border-green-200":"bg-slate-50 text-slate-600 border-slate-200"}`,children:v.status})]}),e.jsxs("div",{className:"pl-3",children:[e.jsx("h4",{className:"font-bold text-sm text-slate-800 dark:text-white mb-1 leading-snug",children:v.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/60 line-clamp-2 mb-3",children:v.description}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-100 dark:border-white/5 pt-2",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 font-bold uppercase",children:[e.jsx(ke,{className:"w-3 h-3"})," ",v.level]}),e.jsxs("div",{className:"flex items-center gap-1 text-brand-600 text-xs font-bold",children:["Detalhes ",e.jsx(ot,{className:"w-3 h-3"})]})]})]})]},v.id)})})]}),e.jsx("div",{className:"bg-slate-50/50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-white/5 rounded-b-3xl",children:e.jsx(is,{currentPage:D,totalPages:G,onPageChange:H,totalItems:k.length,itemsPerPage:Y})})]})})})};ze.Icon&&ze.Icon.Default&&(delete ze.Icon.Default.prototype._getIconUrl,ze.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}));const Ct={},hs=(t,s,n)=>t==="citizen"?"blue":s===U.COMPLETED?"green":n===Z.HIGH?"red":s===U.IN_PROGRESS?"orange":n===Z.MEDIUM?"gold":"blue",ms=(t,s,n)=>{const d=hs(t,s,n),b=`${t}-${d}`;if(Ct[b])return Ct[b];const r=new ze.Icon({iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${d}.png`,shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:t==="citizen"?"custom-citizen-icon":""});return Ct[b]=r,r},bs=({markers:t})=>{const s=gt();return a.useEffect(()=>{const n=setTimeout(()=>{s.invalidateSize()},100);return()=>clearTimeout(n)},[s]),null},us=({markers:t})=>{const s=gt(),[n,d]=a.useState([]),b=a.useCallback(()=>{s&&s.whenReady(()=>{const i=s.getBounds().pad(.1),w=t.filter(S=>i.contains(ze.latLng(S.lat,S.lon)));d(w.slice(0,1e3))})},[s,t]);return a.useEffect(()=>{b();const r=()=>{requestAnimationFrame(b)};return s.on("moveend",r),s.on("zoomend",r),()=>{s.off("moveend",r),s.off("zoomend",r)}},[s,b,t]),e.jsx(e.Fragment,{children:n.map(r=>e.jsx(aa,{center:[r.lat,r.lon],radius:5,pathOptions:{fillColor:"#0ea5e9",fillOpacity:.6,color:"#0284c7",weight:1,opacity:.5},eventHandlers:{click:()=>{const i=new CustomEvent("navigate-to-map",{detail:{citizenId:r.id}});window.dispatchEvent(i)}},children:e.jsx(sa,{children:e.jsxs("div",{className:"p-1 min-w-[150px]",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-900",children:r.name}),e.jsx("p",{className:"text-xs text-slate-500",children:r.bairro||"Sem Bairro"})]})})},`dot-${r.id}`))})},ps=({markers:t,onViewDemand:s})=>{const n=gt(),[d,b]=a.useState([]),r=a.useCallback(()=>{n&&n.whenReady(()=>{const w=n.getBounds().pad(.2),S=t.filter(y=>w.contains(ze.latLng(y.lat,y.lon)));b(S.slice(0,200))})},[n,t]);return a.useEffect(()=>{r();const i=()=>{requestAnimationFrame(r)};return n.on("moveend",i),n.on("zoomend",i),()=>{n.off("moveend",i),n.off("zoomend",i)}},[n,r,t]),e.jsx(e.Fragment,{children:d.map(i=>e.jsx(ra,{position:[i.lat,i.lon],icon:ms(i.type,i.status,i.priority),eventHandlers:{click:()=>{window.innerWidth<768&&n.flyTo([i.lat,i.lon],16,{duration:.5})}},children:e.jsx(sa,{children:e.jsx("div",{className:"p-1 min-w-[200px]",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-800 leading-tight",children:i.title}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full ${i.status==="Concluído"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:i.status}),i.priority===Z.HIGH&&e.jsx("span",{className:"text-red-600 font-bold",children:"ALTA"})]}),e.jsx("button",{onClick:w=>{w.stopPropagation(),s&&s(i.id)},className:"mt-1 w-full bg-brand-600 text-white text-xs font-bold py-1.5 rounded hover:bg-brand-700 transition-colors",children:"Ver Detalhes"})]})})})},`m-${i.type}-${i.id}`))})},gs=({zoomIn:t,zoomOut:s})=>e.jsxs("div",{className:"flex flex-col gap-2 pointer-events-auto shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-white/10",children:[e.jsx("button",{onClick:t,className:"w-12 h-12 md:w-10 md:h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors border-b border-slate-100 dark:border-white/10 active:bg-slate-100",children:e.jsx(bt,{className:"w-6 h-6 md:w-5 md:h-5"})}),e.jsx("button",{onClick:s,className:"w-12 h-12 md:w-10 md:h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors active:bg-slate-100",children:e.jsx(ya,{className:"w-6 h-6 md:w-5 md:h-5"})})]}),fs=({focus:t,markers:s})=>{const n=gt();return a.useEffect(()=>{t&&n.flyTo([t.lat,t.lon],18,{duration:1.5})},[t,n]),a.useEffect(()=>{if(s.length===1){const d=s[0];n.flyTo([d.lat,d.lon],18,{duration:1.5})}},[s,n]),null},ws=({defaultCenter:t,onViewDemand:s,preloadedMarkers:n,currentViewMode:d,onChangeViewMode:b,mapFocus:r})=>{const i=a.useRef(null),[w,S]=a.useState(!1),y=t?[t.lat,t.lon]:[-23.5505,-46.6333],N=a.useMemo(()=>n?n.filter(x=>x.type===(d==="demands"?"demand":"citizen")):[],[d,n]);a.useEffect(()=>{S(!0);const x=setTimeout(()=>{S(!1)},500);return()=>clearTimeout(x)},[N,d,n]);const M=()=>{var x;return(x=i.current)==null?void 0:x.zoomIn()},u=()=>{var x;return(x=i.current)==null?void 0:x.zoomOut()};return e.jsxs("div",{className:"transition-all duration-300 ease-in-out border-slate-200 dark:border-white/10 shadow-sm bg-slate-100 dark:bg-slate-900 overflow-hidden h-full w-full relative",children:[w&&e.jsx("div",{className:"absolute top-20 md:top-4 left-1/2 -translate-x-1/2 z-[1000] animate-in fade-in zoom-in-95 duration-200 pointer-events-none",children:e.jsxs("div",{className:"bg-white/90 dark:bg-slate-800/90 backdrop-blur-md px-4 py-2 rounded-full shadow-xl border border-brand-100 dark:border-white/10 flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 animate-spin text-brand-600"}),e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-white",children:"Atualizando mapa..."})]})}),e.jsx("div",{className:"absolute right-4 bottom-24 md:bottom-8 z-[400] flex flex-col gap-3 pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",children:e.jsx(gs,{zoomIn:M,zoomOut:u})})}),e.jsxs(ea,{ref:i,center:y,zoom:13,style:{width:"100%",height:"100%"},zoomControl:!1,scrollWheelZoom:!0,dragging:!0,preferCanvas:!0,children:[e.jsx(bs,{markers:N}),e.jsx(ta,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'© <a href="https://carto.com/attributions">CARTO</a>'}),d==="citizens"?e.jsx(us,{markers:N}):e.jsx(ps,{markers:N,onViewDemand:s}),e.jsx(fs,{focus:r||null,markers:N})]})]})},xt=({options:t,selectedValues:s,onChange:n,placeholder:d,label:b})=>{const[r,i]=a.useState(!1),[w,S]=a.useState(""),y=a.useRef(null);a.useEffect(()=>{const x=D=>{y.current&&!y.current.contains(D.target)&&(i(!1),S(""))};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const N=a.useMemo(()=>t.filter(x=>x.label.toLowerCase().includes(w.toLowerCase())),[t,w]),M=x=>{s.includes(x)?n(s.filter(D=>D!==x)):n([...s,x])},u=(x,D)=>{D.stopPropagation(),n(s.filter(H=>H!==x))};return e.jsxs("div",{className:"relative min-w-[200px]",ref:y,children:[b&&e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:b}),e.jsxs("div",{onClick:()=>i(!r),className:`
            w-full min-h-[46px] px-3 py-2 glass-input border border-slate-300 dark:border-white/10 rounded-2xl 
            focus:border-brand-500 outline-none font-bold text-slate-700 dark:text-white cursor-pointer shadow-sm
            flex items-center justify-between transition-all hover:bg-slate-50 dark:hover:bg-white/5
            ${r?"ring-2 ring-brand-500/20 border-brand-500":""}
        `,children:[e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.length===0?e.jsx("span",{className:"text-slate-400 dark:text-white/40 text-sm font-medium py-1",children:d}):s.map(x=>{const D=t.find(H=>H.value===x);return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 text-xs font-bold border border-brand-200 dark:border-brand-500/30",children:[(D==null?void 0:D.label)||x,e.jsx("div",{onClick:H=>u(x,H),className:"hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-full p-0.5 cursor-pointer",children:e.jsx(Pe,{className:"w-3 h-3"})})]},x)})}),e.jsx(tt,{className:`w-4 h-4 text-slate-400 transition-transform duration-300 ${r?"rotate-180":""}`})]}),r&&e.jsxs("div",{className:"absolute top-full left-0 w-full mt-2 glass-panel bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden z-50 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"p-2 border-b border-slate-100 dark:border-white/5",children:e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"w-4 h-4 text-slate-400 absolute left-3 top-2.5"}),e.jsx("input",{type:"text",value:w,onChange:x=>S(x.target.value),placeholder:"Filtrar opções...",className:"w-full pl-9 pr-3 py-2 text-sm bg-slate-50 dark:bg-white/5 rounded-lg border-none outline-none text-slate-900 dark:text-white placeholder:text-slate-400",autoFocus:!0,onClick:x=>x.stopPropagation()})]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/20",children:N.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-slate-400 dark:text-white/40 italic",children:"Nenhuma opção encontrada."}):N.map(x=>{const D=s.includes(x.value);return e.jsxs("div",{onClick:()=>M(x.value),className:`
                                    flex items-center justify-between px-3 py-2.5 rounded-lg cursor-pointer text-sm font-medium transition-colors
                                    ${D?"bg-brand-50 dark:bg-brand-500/10 text-brand-700 dark:text-brand-300":"text-slate-700 dark:text-white hover:bg-slate-50 dark:hover:bg-white/5"}
                                `,children:[e.jsx("span",{children:x.label}),D&&e.jsx(st,{className:"w-4 h-4 text-brand-500"})]},x.value)})}),e.jsxs("div",{className:"p-2 border-t border-slate-100 dark:border-white/5 bg-slate-50/50 dark:bg-white/5 flex justify-between",children:[e.jsx("button",{onClick:()=>n([]),className:"text-xs text-slate-500 hover:text-red-500 px-2 py-1 transition-colors",children:"Limpar"}),e.jsx("button",{onClick:()=>i(!1),className:"text-xs font-bold text-brand-600 dark:text-brand-400 px-2 py-1 hover:bg-brand-50 dark:hover:bg-white/5 rounded transition-colors",children:"Pronto"})]})]})]})},Ze=({label:t,onRemove:s})=>e.jsxs("div",{className:"flex items-center gap-1 pl-3 pr-1 py-1 bg-brand-50 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 border border-brand-100 dark:border-brand-500/30 rounded-lg text-xs font-bold animate-in zoom-in-95 shadow-sm whitespace-nowrap",children:[e.jsx("span",{children:t}),e.jsx("button",{onClick:n=>{n.stopPropagation(),s()},className:"p-0.5 hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-md transition-colors text-brand-600 dark:text-brand-400",children:e.jsx(Pe,{className:"w-3 h-3"})})]}),vs=({filters:t,setFilters:s,onExport:n,users:d=[],availableTags:b=[],isMapMode:r=!1,mapViewMode:i,onMapViewModeChange:w,hideAdvanced:S=!1})=>{var le,te;const[y,N]=a.useState(!1),[M,u]=a.useState(!1),[x,D]=a.useState(new Date),H=a.useRef(null),Y=a.useRef(null),j=(p,ae)=>{s(re=>({...re,[p]:ae}))},I=()=>{s({search:t.search,level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",responsibleId:void 0,tags:[]})},k=(p,ae)=>{Array.isArray(t[p])&&ae?s(re=>({...re,[p]:re[p].filter(de=>de!==ae)})):s(p==="startDate"||p==="endDate"?re=>({...re,startDate:"",endDate:""}):re=>({...re,[p]:void 0}))},G=p=>{const ae=d.find(re=>re.id===p);return ae?ae.nome:"Usuário"},z=p=>p?p.split("_").map(ae=>ae.charAt(0).toUpperCase()+ae.slice(1)).join(" "):"",$=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],v=(p,ae)=>new Date(p,ae+1,0).getDate(),A=(p,ae)=>new Date(p,ae,1).getDay(),_=p=>{const re=new Date(x.getFullYear(),x.getMonth(),p).toLocaleDateString("en-CA");!t.startDate||t.startDate&&t.endDate?s(de=>({...de,startDate:re,endDate:""})):re<t.startDate?s(de=>({...de,startDate:re,endDate:t.startDate})):(s(de=>({...de,endDate:re})),setTimeout(()=>u(!1),300))},l=t.startDate?new Date(t.startDate+"T00:00:00").getTime():null,f=t.endDate?new Date(t.endDate+"T00:00:00").getTime():null,P=p=>{if(!l)return!1;const ae=new Date(x.getFullYear(),x.getMonth(),p).getTime();return ae===l?"start":f&&ae===f?"end":f&&ae>l&&ae<f?"range":!1};a.useEffect(()=>{const p=ae=>{H.current&&!H.current.contains(ae.target)&&u(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const C=t.level.length+t.status.length+t.priority.length+(((le=t.tags)==null?void 0:le.length)||0)+(t.startDate?1:0)+(t.responsibleId?1:0),h=t.startDate?`${new Date(t.startDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})} ${t.endDate?" - "+new Date(t.endDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}):""}`:"Selecionar Período",B={createdAt:"Criação",updatedAt:"Atualização",deadline:"Prazo"},K=Object.values(Qe).map(p=>({value:p,label:p})),T=Object.values(U).map(p=>({value:p,label:p})),E=Object.values(Z).map(p=>({value:p,label:p})),V=b.map(p=>({value:p,label:p})),X=!r||i==="demands";return e.jsxs("div",{className:"flex flex-col relative z-30 space-y-3",children:[e.jsxs("div",{className:`
          flex flex-col md:flex-row gap-3 items-center relative z-20 
          ${r?"bg-transparent":"glass-panel p-2 md:p-3 rounded-2xl shadow-sm border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md"}
      `,children:[e.jsxs("div",{className:`flex-1 w-full relative group ${r?"shadow-lg rounded-2xl":""}`,children:[e.jsx("input",{type:"text",value:t.search,onChange:p=>j("search",p.target.value),placeholder:r?"Buscar locais ou demandas...":"Buscar por título, nome ou celular...",className:`
                    w-full pl-11 pr-4 py-3 outline-none transition-all font-medium text-slate-700 dark:text-white placeholder:text-slate-400
                    ${r?"bg-white/95 dark:bg-[#1e293b]/95 border-0 rounded-2xl shadow-md focus:ring-2 ring-brand-500/50":"bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl focus:border-brand-500 focus:bg-white dark:focus:bg-black/20"}
                `}),e.jsx(Xe,{className:"w-5 h-5 text-slate-400 absolute left-3.5 top-3.5 group-focus-within:text-brand-500 transition-colors"}),t.search&&e.jsx("button",{onClick:()=>j("search",""),className:"absolute right-3 top-3.5 text-slate-400 hover:text-slate-600 dark:hover:text-white",children:e.jsx(Pe,{className:"w-5 h-5"})})]}),r&&w&&i&&e.jsx("div",{className:"w-full md:w-auto min-w-[200px] shadow-lg rounded-xl",children:e.jsx(He,{value:i,onChange:p=>w(p),options:[{value:"demands",label:"Demandas",icon:at},{value:"citizens",label:"Cidadãos",icon:Ke}]})}),!r&&e.jsxs("div",{className:"flex w-full md:w-auto gap-2",children:[e.jsxs("button",{onClick:()=>N(!y),className:`flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-3 rounded-xl font-bold transition-all border ${y||C>0?"bg-brand-500 text-white border-brand-500 shadow-lg shadow-brand-500/20":"bg-white dark:bg-white/5 text-slate-600 dark:text-white/70 border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}`,children:[e.jsx(Rt,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Filtros"}),C>0&&e.jsx("span",{className:"bg-white text-brand-600 text-[10px] w-5 h-5 flex items-center justify-center rounded-full ml-1 shadow-sm",children:C})]}),n&&e.jsx("button",{onClick:n,className:"w-[46px] h-[46px] bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 rounded-xl flex items-center justify-center shrink-0 transition-all",title:"Exportar Dados",children:e.jsx(Ca,{className:"w-5 h-5"})})]}),r&&!S&&e.jsx("div",{className:"hidden md:flex",children:e.jsx("button",{onClick:()=>N(!y),className:"w-12 h-12 bg-white dark:bg-slate-800 text-slate-600 dark:text-white rounded-2xl shadow-lg flex items-center justify-center hover:bg-slate-50 transition-transform active:scale-95",children:e.jsx(Rt,{className:"w-5 h-5"})})})]}),(!r||r&&window.innerWidth>=768)&&C>0&&!S&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center px-1",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase text-slate-400 dark:text-white/40 mr-1 flex items-center gap-1",children:[e.jsx(ut,{className:"w-3 h-3"})," Ativos:"]}),X&&t.status.map(p=>e.jsx(Ze,{label:`Status: ${p}`,onRemove:()=>k("status",p)},`status-${p}`)),X&&t.priority.map(p=>e.jsx(Ze,{label:`Prioridade: ${p}`,onRemove:()=>k("priority",p)},`prio-${p}`)),X&&t.level.map(p=>e.jsx(Ze,{label:`Esfera: ${p}`,onRemove:()=>k("level",p)},`lvl-${p}`)),X&&((te=t.tags)==null?void 0:te.map(p=>e.jsx(Ze,{label:`Tag: ${p}`,onRemove:()=>k("tags",p)},`tag-${p}`))),X&&t.responsibleId&&e.jsx(Ze,{label:`Resp: ${G(t.responsibleId)}`,onRemove:()=>k("responsibleId")}),t.startDate&&e.jsx(Ze,{label:`${B[t.dateType]}: ${h}`,onRemove:()=>k("startDate")}),e.jsxs("button",{onClick:I,className:"text-[10px] font-bold text-red-500 hover:text-red-600 ml-auto hover:bg-red-50 dark:hover:bg-red-900/20 px-2 py-1 rounded transition-colors flex items-center gap-1",children:[e.jsx(Kt,{className:"w-3 h-3"})," Limpar"]})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10 bg-slate-900/30 backdrop-blur-sm transition-opacity",onClick:()=>N(!1)}),e.jsxs("div",{ref:Y,className:`
                    absolute z-[60] glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white dark:bg-[#0f172a] shadow-2xl animate-in slide-in-from-top-2 duration-200 overflow-hidden
                    w-full md:w-[800px] md:right-0 md:left-auto
                    ${r?"top-[70px]":"top-[calc(100%+12px)]"}
                `,children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2 text-sm",children:[e.jsx(ut,{className:"w-4 h-4 text-brand-500"})," Filtros Avançados"]}),e.jsx("button",{onClick:()=>N(!1),className:"p-1.5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Pe,{className:"w-4 h-4 text-slate-500 dark:text-white/60"})})]}),e.jsxs("div",{className:`p-6 grid gap-8 max-h-[70vh] overflow-y-auto custom-scrollbar ${X?"grid-cols-1 md:grid-cols-3":"grid-cols-1"}`,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Período"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(He,{options:["createdAt","updatedAt","deadline"].map(p=>({value:p,label:B[p]})),value:t.dateType,onChange:p=>j("dateType",p),size:"sm"}),e.jsxs("div",{className:"relative",ref:H,children:[e.jsx("button",{onClick:()=>u(!M),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl text-sm font-bold transition-all border ${t.startDate?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-900/20 dark:border-brand-500/30 dark:text-brand-300":"bg-slate-50 dark:bg-white/5 border-slate-200 dark:border-white/10 text-slate-600 dark:text-white/70 hover:bg-slate-100"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 opacity-70"})," ",h]})}),M&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-72 bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 p-4 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>D(new Date(x.getFullYear(),x.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-bold text-sm",children:[$[x.getMonth()]," ",x.getFullYear()]}),e.jsx("button",{onClick:()=>D(new Date(x.getFullYear(),x.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Ge,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["D","S","T","Q","Q","S","S"].map(p=>e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:p},p))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:A(x.getFullYear(),x.getMonth())}).map((p,ae)=>e.jsx("div",{},`empty-${ae}`)),Array.from({length:v(x.getFullYear(),x.getMonth())}).map((p,ae)=>{const re=ae+1,de=P(re);return e.jsx("button",{onClick:()=>_(re),className:`h-8 w-8 rounded-full text-xs font-medium transition-all ${de==="start"||de==="end"?"bg-brand-500 text-white shadow-lg":de==="range"?"bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 rounded-none":"hover:bg-slate-100 dark:hover:bg-white/10"}`,children:re},re)})]})]})]})]})]}),X&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Classificação"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(xt,{options:T,selectedValues:t.status,onChange:p=>j("status",p),placeholder:"Todos Status",label:"Status"}),e.jsx(xt,{options:E,selectedValues:t.priority,onChange:p=>j("priority",p),placeholder:"Todas Prioridades",label:"Prioridade"}),e.jsx(xt,{options:K,selectedValues:t.level,onChange:p=>j("level",p),placeholder:"Todas Esferas",label:"Esfera"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Contexto"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:"Responsável"}),e.jsxs("div",{className:"relative",children:[e.jsx(it,{className:"w-4 h-4 text-slate-400 absolute left-3 top-3 pointer-events-none"}),e.jsxs("select",{value:t.responsibleId||"",onChange:p=>j("responsibleId",p.target.value||void 0),className:"w-full pl-9 pr-8 py-2.5 bg-slate-50 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-xl text-sm outline-none focus:border-brand-500 font-bold text-slate-700 dark:text-white appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"Todos os Responsáveis"}),d.map(p=>e.jsxs("option",{value:p.id,children:[p.nome," (",z(p.perfil),")"]},p.id))]}),e.jsx("div",{className:"absolute right-3 top-3 pointer-events-none text-slate-400 text-xs",children:"▼"})]})]}),e.jsx(xt,{options:V,selectedValues:t.tags||[],onChange:p=>j("tags",p),placeholder:"Filtrar por Tags",label:"Etiquetas (Tags)"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5 flex justify-end gap-3",children:[e.jsx("button",{onClick:I,className:"px-4 py-2 text-xs font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-xl transition-colors",children:"Limpar Tudo"}),e.jsx("button",{onClick:()=>N(!1),className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold text-sm shadow-lg shadow-brand-500/20 transition-all active:scale-95",children:"Aplicar Filtros"})]})]})]})]})},Fe=qe.memo(({title:t,value:s,icon:n,colorClass:d,textClass:b,trend:r,subValue:i,isLoading:w=!1})=>e.jsx("div",{className:"glass-panel p-3 md:p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex flex-col justify-between hover:bg-white/60 dark:hover:bg-white/5 transition-colors group min-h-[100px] will-change-transform relative overflow-hidden",children:w?e.jsxs("div",{className:"animate-pulse flex flex-col justify-between h-full w-full",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx("div",{className:"w-8 h-8 rounded-xl bg-slate-200 dark:bg-white/10"})}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-6 w-16 bg-slate-200 dark:bg-white/10 rounded"}),e.jsx("div",{className:"h-3 w-24 bg-slate-200 dark:bg-white/10 rounded"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:`p-2 rounded-xl ${d} bg-opacity-10 shrink-0`,children:e.jsx(n,{className:`w-4 h-4 ${b}`})}),r&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-bold text-emerald-600 bg-emerald-100 dark:bg-emerald-500/20 px-1.5 py-0.5 rounded-full border border-emerald-200 dark:border-emerald-500/10",children:[e.jsx(Sa,{className:"w-3 h-3"})," ",r]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-800 dark:text-white tracking-tight block",children:i||s}),e.jsx("span",{className:`block text-[10px] font-bold uppercase tracking-wider opacity-70 ${b} mt-1`,children:t})]})]})})),da=({lat:t,lon:s,tableName:n="demands",status:d,priority:b})=>{const r=t!==void 0&&s!==void 0&&t!==null&&s!==null&&t!==0&&s!==0,i=()=>d===U.COMPLETED?"green":b===Z.HIGH?"red":d===U.IN_PROGRESS?"orange":b===Z.MEDIUM?"gold":"blue",w=new ze.Icon({iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${i()}.png`,shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});return r?e.jsx("div",{className:"relative w-full h-48 rounded-xl overflow-hidden border border-slate-200 dark:border-white/10 group bg-slate-50 dark:bg-white/5",children:e.jsx("div",{className:"h-full w-full z-0 pointer-events-none select-none",children:e.jsxs(ea,{center:[t,s],zoom:15,scrollWheelZoom:!1,zoomControl:!1,dragging:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1,attributionControl:!1,style:{width:"100%",height:"100%"},children:[e.jsx(ta,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"}),n==="citizens"?e.jsx(aa,{center:[t,s],radius:8,pathOptions:{fillColor:"#3b82f6",fillOpacity:1,color:"#ffffff",weight:2}}):e.jsx(ra,{position:[t,s],icon:w})]},`${t}-${s}-${n}`)})}):e.jsxs("div",{className:"w-full h-48 rounded-xl bg-slate-100 dark:bg-white/5 flex flex-col items-center justify-center text-slate-400 border border-slate-200 dark:border-white/10",children:[e.jsx(ke,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("span",{className:"text-xs font-bold",children:"Localização não definida"})]})},js=({demand:t,citizen:s,onClose:n,onEdit:d,onUpdateStatus:b,onInteractionUpdate:r,onNavigate:i,canNavigatePrev:w,canNavigateNext:S,onNotification:y,onViewCitizen:N,onMapFocus:M})=>{const[u,x]=a.useState([]),[D,H]=a.useState(!1),[Y,j]=a.useState([]),[I,k]=a.useState(""),[G,z]=a.useState(""),[$,v]=a.useState(""),[A,_]=a.useState(!1),[l,f]=a.useState(t.tags||[]),[P,C]=a.useState(""),[h,B]=a.useState(!1),K=a.useRef(null),[T,E]=a.useState(!1),[V,X]=a.useState(new Date),le=a.useRef(null),te=a.useMemo(()=>{const m=localStorage.getItem("geo_user");return m?JSON.parse(m):{name:"Usuário"}},[]);a.useEffect(()=>{p(),j([]),f(t.tags||[])},[t.id,t.status]),a.useEffect(()=>{const m=O=>{le.current&&!le.current.contains(O.target)&&E(!1),h&&K.current&&!K.current.contains(O.target)&&O.target.tagName!=="BUTTON"&&B(!1)};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[h]);const p=async()=>{H(!0);try{if(ce()&&F){const{data:m,error:O}=await F.from("demand_interactions").select("*").eq("demanda_id",t.id).order("created_at",{ascending:!1});if(O)throw O;m&&x(m.map(W=>({id:W.id,demandId:W.demanda_id,type:W.tipo,text:W.texto,isCompleted:W.concluido,deadline:W.prazo,user:W.usuario,createdAt:W.created_at})))}}catch(m){console.error("Erro ao carregar interações",m)}finally{H(!1)}},ae=async m=>{const O=m==="comentario"?I:G;if(!O.trim())return;const W=crypto.randomUUID(),ne={id:W,demandId:t.id,type:m,text:O,isCompleted:!1,deadline:m==="checklist"&&$?$:void 0,user:te.name,createdAt:new Date().toISOString()};x(oe=>[ne,...oe]),j(oe=>[...oe,W]),m==="comentario"&&k(""),m==="checklist"&&(z(""),v(""),_(!1));try{if(ce()&&F){const oe={demanda_id:t.id,tipo:m,texto:O,usuario:te.name};m==="checklist"&&(oe.concluido=!1,oe.prazo=$||null);const{data:me,error:be}=await F.from("demand_interactions").insert(oe).select().single();if(be)throw be;me&&(x(Te=>Te.map(Ce=>Ce.id===W?{...Ce,id:me.id,createdAt:me.created_at}:Ce)),j(Te=>[...Te.filter(Ce=>Ce!==W),me.id]),setTimeout(()=>{j(Te=>Te.filter(Ce=>Ce!==me.id))},3e3),r&&r())}}catch(oe){console.error("Erro ao salvar interação",oe),y&&y("error","Erro ao salvar interação"),x(me=>me.filter(be=>be.id!==W)),j(me=>me.filter(be=>be!==W))}},re=async(m,O)=>{x(W=>W.map(ne=>ne.id===m?{...ne,isCompleted:!O}:ne));try{ce()&&F&&(await F.from("demand_interactions").update({concluido:!O}).eq("id",m),r&&r())}catch(W){console.error("Erro ao atualizar checklist",W),y&&y("error","Erro ao atualizar checklist"),x(ne=>ne.map(oe=>oe.id===m?{...oe,isCompleted:O}:oe))}},de=async m=>{x(O=>O.filter(W=>W.id!==m));try{ce()&&F&&(await F.from("demand_interactions").delete().eq("id",m),r&&r())}catch(O){console.error(O)}},De=async()=>{if(!P.trim())return;const m=[...l,P.trim()];f(m),C(""),B(!1);try{ce()&&F&&(await F.from("demands").update({tags:m}).eq("id",t.id),r&&r())}catch(O){console.error(O)}},Ne=async m=>{const O=l.filter(W=>W!==m);f(O);try{ce()&&F&&(await F.from("demands").update({tags:O}).eq("id",t.id),r&&r())}catch(W){console.error(W)}},we=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],he=(m,O)=>new Date(m,O+1,0).getDate(),Le=(m,O)=>new Date(m,O,1).getDay(),q=m=>{const O=new Date(V.getFullYear(),V.getMonth(),m),W=O.getFullYear(),ne=String(O.getMonth()+1).padStart(2,"0"),oe=String(O.getDate()).padStart(2,"0");v(`${W}-${ne}-${oe}`),E(!1)},R=u.filter(m=>m.type==="checklist"),ue=u.filter(m=>m.type==="comentario"||m.type==="status_change"),Ee=a.useMemo(()=>{if(R.length===0)return 0;const m=R.filter(O=>O.isCompleted).length;return Math.round(m/R.length*100)},[R]),pe=[{value:U.PENDING,label:"Pendente",icon:Se},{value:U.IN_PROGRESS,label:"Em Andamento",icon:et},{value:U.COMPLETED,label:"Concluído",icon:Re}],ye=m=>{switch(m){case U.PENDING:return 1;case U.IN_PROGRESS:return 2;case U.COMPLETED:return 3;default:return 1}},Ie=m=>{if(m===U.PENDING)return new Date(t.createdAt);const O=u.find(W=>W.type==="status_change"&&(W.text.includes(`para "${m}"`)||W.text.includes(`para ${m}`)));return O?new Date(O.createdAt):null},Ae=m=>{const O=m.replace(/\D/g,"");window.open(`https://wa.me/55${O}`,"_blank")},_e=m=>{window.open(`mailto:${m}`,"_blank")},Ve=s?`${s.logradouro}, ${s.numero} - ${s.bairro}, ${s.cidade} - ${s.estado}`:void 0;return e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-end md:items-center justify-center sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity duration-300",onClick:n}),e.jsxs("div",{className:"relative w-full h-full md:h-[90vh] md:max-w-6xl bg-white dark:bg-[#0b1121] md:rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in slide-in-from-bottom-10 md:zoom-in-95 duration-300 md:border border-slate-200 dark:border-white/10",children:[e.jsxs("div",{className:"px-4 py-3 md:px-8 md:py-5 border-b border-slate-200 dark:border-white/10 flex items-start justify-between bg-white/90 dark:bg-[#0b1121]/90 backdrop-blur-md z-20 shrink-0 sticky top-0 rounded-t-3xl",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 flex-wrap",children:[e.jsx("button",{onClick:n,className:"mr-2 p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors md:hidden",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-white/40 font-mono",children:["#",t.id.slice(0,8)]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold uppercase border ${t.priority===Z.HIGH?"bg-red-50 text-red-600 border-red-100 dark:bg-red-500/10 dark:text-red-300":t.priority===Z.MEDIUM?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-300":"bg-green-50 text-green-600 border-green-100 dark:bg-green-500/10 dark:text-green-300"}`,children:t.priority})]}),e.jsx("h2",{className:"text-lg md:text-2xl font-bold text-slate-900 dark:text-white leading-tight line-clamp-1",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsxs("div",{className:"hidden md:flex items-center bg-slate-100 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10 mr-2",children:[e.jsx("button",{onClick:()=>i("prev"),disabled:!w,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors border-r border-slate-200 dark:border-white/10",title:"Demanda Anterior",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>i("next"),disabled:!S,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors",title:"Próxima Demanda",children:e.jsx(Ge,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>{d(t),n()},className:"p-2 md:p-2.5 text-slate-500 hover:text-brand-600 hover:bg-slate-100 rounded-xl transition-colors dark:text-white/50 dark:hover:text-white dark:hover:bg-white/10",title:"Editar",children:e.jsx(Qt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:n,className:"p-2 md:p-2.5 text-slate-400 hover:text-slate-800 hover:bg-slate-100 rounded-full transition-colors dark:text-white/40 dark:hover:text-white dark:hover:bg-white/10",children:e.jsx(Pe,{className:"w-6 h-6"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50/30 dark:bg-black/20 custom-scrollbar overscroll-contain flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 p-4 md:p-8 space-y-6 md:space-y-8 min-w-0",children:[e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex justify-between items-start relative px-4 md:px-12 mb-8 mt-2",children:[e.jsx("div",{className:"absolute top-3 left-4 right-4 md:left-12 md:right-12 h-0.5 bg-slate-200 dark:bg-white/10 -z-10"}),pe.map((m,O)=>{const W=ye(t.status),ne=O+1,oe=ne<=W,me=ne===W,be=Ie(m.value);return e.jsxs("div",{className:"flex flex-col items-center gap-2 group bg-transparent",children:[e.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center border-4 transition-all duration-500 z-10 bg-white dark:bg-slate-900 ${oe?"border-brand-500":"border-slate-300 dark:border-white/20"} ${me?"ring-4 ring-brand-100 dark:ring-brand-500/20 scale-110":""}`,children:e.jsx("div",{className:`w-2.5 h-2.5 rounded-full transition-colors duration-500 ${oe?"bg-brand-500":"bg-slate-300 dark:bg-white/20"}`})}),e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${me?"text-brand-600 dark:text-brand-400":"text-slate-500 dark:text-white/40"}`,children:m.label}),be&&e.jsxs("span",{className:"text-[9px] text-slate-400 dark:text-white/30 font-medium h-3 mt-0.5",children:[be.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})," ",be.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]})]},m.value)})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx($t,{className:"w-4 h-4"})," Descrição"]})}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 md:p-6 shadow-sm",children:[e.jsx("p",{className:"text-sm md:text-base text-slate-700 dark:text-slate-200 leading-relaxed whitespace-pre-line",children:t.description}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-white/5 flex flex-wrap gap-2 items-center",children:[e.jsx(Da,{className:"w-4 h-4 text-slate-400"}),l.map(m=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1 group",children:[m,e.jsx(Pe,{onClick:()=>Ne(m),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500 hidden group-hover:block"})]},m)),h?e.jsxs("div",{className:"flex items-center gap-2",ref:le,children:[e.jsx("input",{ref:K,autoFocus:!0,type:"text",value:P,onChange:m=>C(m.target.value),className:"w-24 px-2 py-1 text-xs border rounded-lg outline-none",placeholder:"Nova tag...",onKeyDown:m=>{m.key==="Enter"&&De(),m.key==="Escape"&&B(!1)}}),e.jsx("button",{onClick:De,className:"text-xs font-bold text-brand-600",children:"OK"})]}):e.jsxs("button",{onClick:()=>B(!0),className:"text-xs text-slate-400 hover:text-brand-600 flex items-center gap-1 px-2 py-1 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(bt,{className:"w-3 h-3"})," Adicionar"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(ke,{className:"w-4 h-4"})," Localização"]}),e.jsx(da,{demandId:t.id,lat:t.lat,lon:t.lon,address:Ve,onLocationUpdate:r,status:t.status,priority:t.priority})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Jt,{className:"w-4 h-4"})," Checklist"]}),R.length>0&&e.jsxs("span",{className:"text-xs font-mono text-slate-400 dark:text-white/40",children:[Math.round(Ee),"%"]})]}),R.length>0&&e.jsx("div",{className:"h-1.5 w-full bg-slate-200 dark:bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-500",style:{width:`${Ee}%`}})}),e.jsxs("div",{className:"space-y-2",children:[R.map(m=>e.jsxs("div",{className:"flex items-start gap-3 group bg-white dark:bg-white/5 p-3 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 dark:hover:border-white/10 transition-colors",children:[e.jsx("button",{onClick:()=>re(m.id,m.isCompleted||!1),className:`mt-0.5 w-5 h-5 rounded-lg border flex items-center justify-center transition-all ${m.isCompleted?"bg-green-500 border-green-500 text-white":"bg-white dark:bg-transparent border-slate-300 dark:border-white/20 hover:border-brand-500 text-transparent hover:text-brand-500/20"}`,children:e.jsx(st,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm transition-all font-medium ${m.isCompleted?"text-slate-400 line-through dark:text-white/30":"text-slate-800 dark:text-white"}`,children:m.text}),(m.deadline||m.isCompleted)&&e.jsx("div",{className:"flex items-center gap-2 mt-1.5",children:m.deadline&&e.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold uppercase flex items-center gap-1 ${m.isCompleted?"bg-slate-100 text-slate-400 dark:bg-white/5":new Date(m.deadline)<new Date?"bg-red-100 text-red-600 dark:bg-red-500/20 dark:text-red-300":"bg-slate-100 text-slate-500 dark:bg-white/10 dark:text-white/60"}`,children:[e.jsx($e,{className:"w-3 h-3"})," ",nt(m.deadline)]})})]}),e.jsx("button",{onClick:()=>de(m.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",children:e.jsx(zt,{className:"w-4 h-4"})})]},m.id)),A?e.jsxs("div",{className:"bg-white dark:bg-white/5 p-4 rounded-xl border border-brand-500/30 shadow-lg ring-1 ring-brand-500/10 animate-in fade-in zoom-in-95",children:[e.jsx("input",{type:"text",autoFocus:!0,value:G,onChange:m=>z(m.target.value),placeholder:"Descreva a tarefa...",className:"w-full bg-transparent border-none outline-none text-sm text-slate-900 dark:text-white placeholder:text-slate-400 mb-4 font-medium",onKeyDown:m=>m.key==="Enter"&&ae("checklist")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 border-t border-slate-100 dark:border-white/5 pt-3",children:[e.jsxs("div",{className:"relative w-full sm:w-auto",ref:le,children:[e.jsxs("button",{onClick:()=>E(!T),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all border ${$?"bg-brand-50 text-brand-700 border-brand-200 dark:bg-brand-500/20 dark:text-brand-300 dark:border-brand-500/30":"bg-slate-50 text-slate-500 border-slate-200 dark:bg-white/5 dark:text-white/50 dark:border-white/10 hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx($e,{className:"w-3.5 h-3.5"}),$?nt($):"Definir Prazo"]}),T&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-64 glass-panel bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 p-3 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:()=>X(new Date(V.getFullYear(),V.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Ue,{className:"w-4 h-4 text-slate-600 dark:text-white"})}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white text-xs",children:[we[V.getMonth()]," ",V.getFullYear()]}),e.jsx("button",{onClick:()=>X(new Date(V.getFullYear(),V.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Ge,{className:"w-4 h-4 text-slate-600 dark:text-white"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-1",children:["D","S","T","Q","Q","S","S"].map(m=>e.jsx("span",{className:"text-[9px] font-bold text-slate-400 dark:text-white/40",children:m},m))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:Le(V.getFullYear(),V.getMonth())}).map((m,O)=>e.jsx("div",{},`empty-${O}`)),Array.from({length:he(V.getFullYear(),V.getMonth())}).map((m,O)=>{const W=O+1,ne=$&&new Date($).getDate()===W&&new Date($).getMonth()===V.getMonth();return e.jsx("button",{onClick:()=>q(W),className:`h-6 w-6 rounded-full text-[10px] font-medium flex items-center justify-center transition-all ${ne?"bg-brand-500 text-white":"text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:W},W)})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-end",children:[e.jsx("button",{onClick:()=>_(!1),className:"px-3 py-1.5 text-xs font-bold text-slate-500 hover:text-slate-700 dark:text-white/60 dark:hover:text-white",children:"Cancelar"}),e.jsx("button",{onClick:()=>ae("checklist"),className:"px-4 py-1.5 bg-brand-600 text-white text-xs font-bold rounded-lg hover:bg-brand-500 shadow-sm",children:"Salvar Item"})]})]})]}):e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center justify-center gap-2 text-sm text-slate-500 dark:text-white/50 hover:text-brand-600 dark:hover:text-brand-400 transition-colors px-4 py-3 rounded-xl border border-dashed border-slate-300 dark:border-white/10 hover:border-brand-300 dark:hover:border-brand-500/30 hover:bg-slate-50 dark:hover:bg-white/5 w-full group",children:[e.jsx(bt,{className:"w-4 h-4 group-hover:scale-110 transition-transform"})," Adicionar item ao checklist"]})]})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Ea,{className:"w-4 h-4"})," Comentários e Histórico"]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-3 md:p-4 bg-slate-50 dark:bg-white/5 border-b border-slate-200 dark:border-white/10 flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold text-xs shrink-0",children:te.name.charAt(0)}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:I,onChange:m=>k(m.target.value),placeholder:"Escreva um comentário...",className:"w-full bg-white dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl pl-4 pr-10 py-2.5 text-sm outline-none focus:border-brand-500 transition-all text-slate-900 dark:text-white shadow-sm",onKeyDown:m=>m.key==="Enter"&&ae("comentario")}),e.jsx("button",{onClick:()=>ae("comentario"),disabled:!I.trim(),className:"absolute right-2 top-2 p-1 text-slate-400 hover:text-brand-600 disabled:opacity-30 transition-colors",children:e.jsx(Ia,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-white/5 max-h-[300px] overflow-y-auto custom-scrollbar",children:ue.length===0?e.jsx("div",{className:"p-6 text-center text-slate-400 dark:text-white/30 text-sm italic",children:"Nenhum comentário ou registro de atividade."}):ue.map(m=>e.jsxs("div",{className:`p-4 flex gap-3 hover:bg-slate-50 dark:hover:bg-white/5 transition-colors group ${Y.includes(m.id)?"bg-amber-50 dark:bg-amber-500/10 animate-pulse duration-1000":""}`,children:[m.type==="status_change"?e.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-100 dark:bg-amber-500/20 flex items-center justify-center text-amber-600 dark:text-amber-400 font-bold text-xs shrink-0 border border-amber-200 dark:border-amber-500/20",children:e.jsx(Se,{className:"w-4 h-4"})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs shrink-0 border border-slate-300 dark:border-white/10",children:m.user.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-slate-900 dark:text-white",children:m.user}),e.jsx("span",{className:"text-[10px] text-slate-400",children:new Date(m.createdAt).toLocaleString()})]}),e.jsx("p",{className:`text-sm leading-relaxed break-words p-3 rounded-tr-xl rounded-br-xl rounded-bl-xl border ${m.type==="status_change"?"bg-amber-50/50 dark:bg-amber-900/10 text-slate-600 dark:text-slate-300 border-amber-100 dark:border-amber-500/10 italic":"bg-slate-50 dark:bg-white/5 text-slate-600 dark:text-slate-300 border-slate-100 dark:border-white/5"}`,children:m.text})]}),m.type==="comentario"&&e.jsx("button",{onClick:()=>de(m.id),className:"opacity-0 group-hover:opacity-100 self-start p-2 text-slate-300 hover:text-red-500 transition-all",children:e.jsx(zt,{className:"w-4 h-4"})})]},m.id))})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white/50 dark:bg-black/20 border-t md:border-t-0 md:border-l border-slate-200 dark:border-white/10 p-4 md:p-6 space-y-6 md:h-auto overflow-y-auto",children:[e.jsxs("div",{className:"hidden md:block",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 mb-3 block",children:"Status"}),e.jsx("div",{className:"bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex flex-col relative border border-slate-200 dark:border-white/5 gap-1",children:pe.map(m=>{const O=t.status===m.value;return e.jsxs("button",{onClick:()=>b(t.id,m.value),className:`w-full py-2.5 px-3 text-sm font-bold rounded-lg transition-all duration-300 flex items-center gap-3 ${O?"bg-white dark:bg-white/10 text-brand-600 dark:text-white shadow-sm ring-1 ring-slate-200 dark:ring-white/10":"text-slate-500 dark:text-white/40 hover:bg-slate-200 dark:hover:bg-white/5"}`,children:[e.jsx(m.icon,{className:`w-4 h-4 ${O?"text-brand-500 dark:text-brand-400":"opacity-50"}`}),m.label]},m.value)})})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4 space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40 mb-2",children:"Datas"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-500 dark:text-white/50",children:e.jsx($e,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Criado em"}),e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white",children:new Date(t.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${t.deadline?"bg-brand-100 dark:bg-brand-500/20 text-brand-600 dark:text-brand-400":"bg-slate-100 dark:bg-white/10 text-slate-500"}`,children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Prazo Demanda"}),e.jsx("p",{className:`text-sm font-bold ${t.deadline?"text-slate-800 dark:text-white":"text-slate-400 italic"}`,children:nt(t.deadline)||"Sem prazo"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40",children:"Solicitante"})}),s?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-white/5 p-2 -ml-2 rounded-xl transition-colors group",onClick:()=>N&&N(s.id),title:"Ver perfil do cidadão",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-sm shadow-inner shrink-0",children:s.name.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-bold text-slate-900 dark:text-white truncate group-hover:text-brand-600 transition-colors flex items-center gap-1",children:[s.name,e.jsx(Aa,{className:"w-3 h-3 opacity-0 group-hover:opacity-100"})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:Be(s.phone)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.phone&&e.jsxs("button",{onClick:()=>Ae(s.phone),className:"flex-1 py-1.5 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Conversar no WhatsApp",children:[e.jsx(Ta,{className:"w-3.5 h-3.5"})," WhatsApp"]}),s.email&&e.jsxs("button",{onClick:()=>_e(s.email),className:"flex-1 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Enviar Email",children:[e.jsx(Lt,{className:"w-3.5 h-3.5"})," Email"]})]})]}):e.jsx("div",{className:"text-center py-4 text-slate-400 text-xs italic",children:"Nenhum solicitante vinculado."})]})]})]})]})]})},ks=({citizen:t,onClose:s,onEdit:n,onCreateDemand:d,onNotification:b,onSelectDemand:r,onMapFocus:i})=>{const[w,S]=a.useState([]),[y,N]=a.useState(!1);a.useEffect(()=>{(async()=>{N(!0);try{if(ce()&&F){const{data:D,error:H}=await F.from("demands").select("*").eq("citizen_id",t.id).order("created_at",{ascending:!1});if(D){const Y=D.map(j=>({id:j.id,title:j.title,description:j.description,level:j.level,status:j.status,priority:j.priority,type:j.type,deadline:j.deadline,citizenId:j.citizen_id,createdAt:j.created_at,tags:j.tags}));S(Y)}}}catch(D){console.error(D)}finally{N(!1)}})()},[t.id]);const M=x=>{const D=x.replace(/\D/g,"");window.open(`https://wa.me/55${D}`,"_blank")},u=()=>[t.logradouro,t.numero?`Nº ${t.numero}`:null,t.bairro,t.cidade&&t.estado?`${t.cidade} - ${t.estado}`:t.cidade].filter(Boolean).join(", ")||"Endereço não informado";return e.jsxs("div",{className:"fixed inset-0 z-[80] flex items-end md:items-center justify-center sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity duration-300",onClick:s}),e.jsxs("div",{className:"relative w-full h-full md:h-[90vh] md:max-w-5xl bg-white dark:bg-[#0b1121] md:rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in slide-in-from-bottom-10 md:zoom-in-95 duration-300 md:border border-slate-200 dark:border-white/10",children:[e.jsxs("div",{className:"px-4 py-3 md:px-8 md:py-5 border-b border-slate-200 dark:border-white/10 flex items-center justify-between bg-white/90 dark:bg-[#0b1121]/90 backdrop-blur-md z-20 shrink-0 sticky top-0 rounded-t-3xl",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4 flex items-center gap-3",children:[e.jsx("button",{onClick:s,className:"p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors md:hidden",children:e.jsx(Ue,{className:"w-6 h-6"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 dark:bg-brand-500/20 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold text-lg border border-brand-200 dark:border-brand-500/30",children:t.name.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-bold text-slate-900 dark:text-white leading-tight truncate",children:t.name}),t.bairro&&e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50 truncate",children:t.bairro})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{n()},className:"p-2 md:p-2.5 text-slate-500 hover:text-brand-600 hover:bg-slate-100 rounded-xl transition-colors dark:text-white/50 dark:hover:text-white dark:hover:bg-white/10",title:"Editar",children:e.jsx(Qt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:s,className:"hidden md:block p-2 md:p-2.5 text-slate-400 hover:text-slate-800 hover:bg-slate-100 rounded-full transition-colors dark:text-white/40 dark:hover:text-white dark:hover:bg-white/10",children:e.jsx(Pe,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-slate-50/30 dark:bg-black/20 custom-scrollbar p-4 md:p-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-5xl mx-auto",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 shadow-sm space-y-4",children:[e.jsxs("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4"})," Contato"]}),e.jsxs("div",{className:"space-y-3",children:[t.phone?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-white/5 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-500/20 text-green-600 dark:text-green-400 rounded-lg",children:e.jsx(Wt,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-mono text-sm font-bold text-slate-700 dark:text-white",children:Be(t.phone)})]}),e.jsx("button",{onClick:()=>M(t.phone),className:"text-xs font-bold text-green-600 hover:underline",children:"WhatsApp"})]}):e.jsx("p",{className:"text-sm text-slate-400 italic",children:"Sem telefone cadastrado."}),t.email&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 dark:bg-white/5 rounded-xl",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400 rounded-lg",children:e.jsx(Lt,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-white truncate",children:t.email})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 shadow-sm space-y-3",children:[e.jsxs("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 flex items-center gap-2",children:[e.jsx($a,{className:"w-4 h-4"})," Observações"]}),e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-xl min-h-[80px]",children:t.observacoes?e.jsx("p",{className:"text-sm text-slate-700 dark:text-white leading-relaxed whitespace-pre-wrap",children:t.observacoes}):e.jsx("p",{className:"text-sm text-slate-400 italic",children:"Nenhuma observação registrada."})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"})," Endereço & Mapa"]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-1 shadow-sm",children:[e.jsx("div",{className:"p-4 pb-2",children:e.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-white leading-relaxed",children:u()})}),e.jsx("div",{className:"p-1",children:e.jsx(da,{entityId:t.id,tableName:"citizens",lat:t.lat,lon:t.lon,address:u()})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:d,className:"w-full py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold shadow-lg shadow-brand-500/20 flex items-center justify-center gap-2 active:scale-95 transition-all",children:[e.jsx(Pt,{className:"w-5 h-5"})," Nova Demanda"]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 shadow-sm flex flex-col h-[400px]",children:[e.jsxs("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 flex items-center gap-2 mb-4",children:[e.jsx(_t,{className:"w-4 h-4"})," Histórico (",w.length,")"]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-3 pr-2",children:w.length>0?w.map(x=>e.jsxs("div",{onClick:()=>r&&r(x),className:"p-3 rounded-xl bg-slate-50 dark:bg-white/5 border border-slate-100 dark:border-white/5 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/10 hover:border-brand-200 transition-all group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("span",{className:"text-[10px] font-bold text-slate-400 group-hover:text-brand-500 transition-colors",children:["#",x.id.slice(0,6)]}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold uppercase ${x.status==="Concluído"?"bg-green-100 text-green-700":"bg-slate-200 text-slate-600"}`,children:x.status})]}),e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white line-clamp-1 group-hover:text-brand-600 transition-colors",children:x.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50 mt-1",children:new Date(x.createdAt).toLocaleDateString()})]},x.id)):e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:e.jsx("p",{className:"text-sm italic",children:"Nenhuma demanda registrada."})})})]})]})]})})]})]})},qt=({items:t,type:s,onSelect:n,onFilterNeighborhood:d,selectedNeighborhood:b,filters:r,setFilters:i})=>{var A,_;const[w,S]=a.useState(""),[y,N]=a.useState({}),[M,u]=a.useState(!0),x=a.useMemo(()=>{const l={};return t.forEach(f=>{const P=f.bairro||"Sem Bairro";if(w){const C=w.toLowerCase(),h=f.title&&f.title.toLowerCase().includes(C),B=f.name&&f.name.toLowerCase().includes(C),K=P.toLowerCase().includes(C);if(!h&&!B&&!K)return}l[P]||(l[P]=[]),l[P].push(f)}),Object.keys(l).sort().reduce((f,P)=>(f[P]=l[P],f),{})},[t,w]),D=t.length,H=Object.values(x).reduce((l,f)=>l+f.length,0),Y=l=>{N(f=>({...f,[l]:!f[l]}))},j=(l,f)=>{f.stopPropagation(),b===l?d(null):(d(l),N(P=>({...P,[l]:!0})))},I=l=>{if(!i||!r)return;const f=r.status||[],P=f.includes(l)?f.filter(C=>C!==l):[...f,l];i(C=>({...C,status:P}))},k=l=>{if(!i||!r)return;const f=r.priority||[],P=f.includes(l)?f.filter(C=>C!==l):[...f,l];i(C=>({...C,priority:P}))},G=l=>{if(!(!i||!r))if(l==="all")i(f=>({...f,startDate:"",endDate:""}));else{const f=new Date,P=new Date;P.setDate(f.getDate()-l),i(C=>({...C,startDate:P.toLocaleDateString("en-CA"),endDate:f.toLocaleDateString("en-CA")}))}},z=()=>{i&&i(l=>({...l,status:[],priority:[],startDate:"",endDate:""}))},$=({active:l,onClick:f,icon:P,label:C,colorClass:h})=>e.jsxs("button",{onClick:f,className:`
            flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-[10px] font-bold border transition-all
            ${l?`${h} shadow-sm scale-[1.02]`:"bg-white dark:bg-white/5 border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/60 hover:bg-slate-50 dark:hover:bg-white/10"}
        `,children:[P&&e.jsx(P,{className:"w-3 h-3"}),C,l&&e.jsx(st,{className:"w-3 h-3 ml-0.5"})]}),v=r?(((A=r.status)==null?void 0:A.length)||0)+(((_=r.priority)==null?void 0:_.length)||0)+(r.startDate?1:0):0;return e.jsxs("div",{className:"flex flex-col h-full bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-r border-slate-200 dark:border-white/10 w-full md:w-80 shadow-xl z-30",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-white/10 shrink-0 space-y-3",children:[e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-brand-500"})," Bairros e Locais"]}),e.jsxs("div",{className:"relative group",children:[e.jsx(Xe,{className:"w-4 h-4 text-slate-400 absolute left-3 top-3 group-focus-within:text-brand-500 transition-colors"}),e.jsx("input",{type:"text",value:w,onChange:l=>S(l.target.value),placeholder:s==="demands"?"Buscar demandas...":"Buscar cidadãos...",className:"w-full pl-9 pr-4 py-2.5 bg-slate-100 dark:bg-white/5 border border-transparent focus:border-brand-500 dark:focus:border-brand-500/50 rounded-xl outline-none text-sm font-medium transition-all text-slate-900 dark:text-white placeholder:text-slate-400"})]})]}),s==="demands"&&r&&i&&e.jsxs("div",{className:"border-b border-slate-200 dark:border-white/10 shrink-0 bg-slate-50/50 dark:bg-black/20",children:[e.jsxs("button",{onClick:()=>u(!M),className:"w-full flex items-center justify-between px-4 py-3 text-xs font-bold text-slate-500 dark:text-white/60 hover:text-slate-800 dark:hover:text-white transition-colors",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-3.5 h-3.5"}),"Filtros Ativos",v>0&&e.jsx("span",{className:"bg-brand-500 text-white px-1.5 rounded-full text-[9px]",children:v})]}),M?e.jsx(tt,{className:"w-3.5 h-3.5"}):e.jsx(Ge,{className:"w-3.5 h-3.5"})]}),M&&e.jsxs("div",{className:"px-4 pb-4 space-y-3 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide ml-1",children:"Status"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx($,{label:"Pend",icon:Se,active:r.status.includes(U.PENDING),onClick:()=>I(U.PENDING),colorClass:"bg-slate-100 border-slate-300 text-slate-700 dark:bg-white/10 dark:text-white"}),e.jsx($,{label:"Andamento",icon:et,active:r.status.includes(U.IN_PROGRESS),onClick:()=>I(U.IN_PROGRESS),colorClass:"bg-amber-100 border-amber-300 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300 dark:border-amber-500/30"}),e.jsx($,{label:"Fim",icon:Re,active:r.status.includes(U.COMPLETED),onClick:()=>I(U.COMPLETED),colorClass:"bg-green-100 border-green-300 text-green-700 dark:bg-green-500/20 dark:text-green-300 dark:border-green-500/30"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide ml-1",children:"Prioridade"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx($,{label:"Alta",icon:pt,active:r.priority.includes(Z.HIGH),onClick:()=>k(Z.HIGH),colorClass:"bg-red-100 border-red-300 text-red-700 dark:bg-red-500/20 dark:text-red-300 dark:border-red-500/30"}),e.jsx($,{label:"Média",active:r.priority.includes(Z.MEDIUM),onClick:()=>k(Z.MEDIUM),colorClass:"bg-amber-100 border-amber-300 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300 dark:border-amber-500/30"}),e.jsx($,{label:"Baixa",active:r.priority.includes(Z.LOW),onClick:()=>k(Z.LOW),colorClass:"bg-green-100 border-green-300 text-green-700 dark:bg-green-500/20 dark:text-green-300 dark:border-green-500/30"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide ml-1",children:"Período"}),v>0&&e.jsxs("button",{onClick:z,className:"text-[9px] text-red-500 hover:text-red-600 font-bold flex items-center gap-1",children:[e.jsx(Kt,{className:"w-2.5 h-2.5"})," Limpar"]})]}),e.jsx("div",{className:"flex bg-white dark:bg-white/5 rounded-lg border border-slate-200 dark:border-white/10 p-0.5",children:[{label:"7d",val:7},{label:"30d",val:30},{label:"90d",val:90},{label:"Tudo",val:"all"}].map(l=>{const f=l.val==="all"?!r.startDate:r.startDate&&new Date(r.startDate).getDate()===new Date(new Date().setDate(new Date().getDate()-l.val)).getDate();return e.jsx("button",{onClick:()=>G(l.val),className:`flex-1 py-1 text-[10px] font-bold rounded-md transition-all ${f?"bg-brand-100 text-brand-700 dark:bg-brand-500/20 dark:text-brand-300":"text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:l.label},l.label)})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1",children:Object.keys(x).length===0?e.jsx("div",{className:"p-8 text-center text-slate-400 dark:text-white/30 text-sm italic",children:"Nenhum registro encontrado nesta região com os filtros atuais."}):Object.entries(x).map(([l,f])=>{const P=b===l,C=y[l];return e.jsxs("div",{className:"rounded-xl overflow-hidden transition-all duration-300 border border-transparent",children:[e.jsxs("div",{onClick:h=>j(l,h),className:`
                                    flex items-center justify-between p-3 cursor-pointer transition-colors
                                    ${P?"bg-brand-50 dark:bg-brand-900/20 border-brand-200 dark:border-brand-500/20":"hover:bg-slate-50 dark:hover:bg-white/5"}
                                `,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{onClick:h=>{h.stopPropagation(),Y(l)},className:"p-1 hover:bg-slate-200 dark:hover:bg-white/10 rounded transition-colors",children:C?e.jsx(tt,{className:"w-4 h-4 text-slate-400"}):e.jsx(Ge,{className:"w-4 h-4 text-slate-400"})}),e.jsx("span",{className:`text-sm font-bold truncate ${P?"text-brand-700 dark:text-brand-300":"text-slate-700 dark:text-white"}`,children:l})]}),e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full ${P?"bg-brand-200 text-brand-800 dark:bg-brand-500/40 dark:text-white":"bg-slate-100 text-slate-500 dark:bg-white/10 dark:text-white/50"}`,children:f.length})]}),C&&e.jsx("div",{className:"bg-slate-50/50 dark:bg-black/20 border-t border-slate-100 dark:border-white/5",children:f.map(h=>e.jsxs("div",{onClick:()=>n(h),className:"p-3 pl-10 hover:bg-white dark:hover:bg-white/5 cursor-pointer transition-colors border-b border-slate-100 dark:border-white/5 last:border-0 group",children:[e.jsx("p",{className:"text-xs font-bold text-slate-700 dark:text-white truncate group-hover:text-brand-600 transition-colors",children:s==="demands"?h.title:h.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s==="demands"&&e.jsx("span",{className:`w-2 h-2 rounded-full ${h.priority==="Alta"?"bg-red-500":h.priority==="Média"?"bg-amber-500":"bg-green-500"}`}),e.jsx("span",{className:"text-[10px] text-slate-400 dark:text-white/40 truncate",children:s==="demands"?h.status:h.phone||"Sem telefone"})]})]},h.id))})]},l)})}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-white/5 shrink-0 flex justify-between items-center text-xs font-medium text-slate-500 dark:text-white/50",children:[e.jsxs("span",{children:["Total Visível: ",e.jsx("strong",{className:"text-slate-900 dark:text-white",children:H})]}),e.jsxs("span",{children:["Total Geral: ",e.jsx("strong",{children:D})]})]})]})},Ns=({demands:t,citizens:s,interactions:n=[],onViewDemand:d,onEditDemand:b,onCreateDemand:r,onUpdateStatus:i,onInteractionUpdate:w,initialSelectionId:S,clearSelection:y,initialViewMode:N="list",filters:M,setFilters:u,users:x=[],onNotification:D,defaultLocation:H,onViewCitizen:Y,mapMarkers:j,mapFocus:I,initialMapViewMode:k="demands",onMapFocus:G})=>{const[z,$]=a.useState(N),[v,A]=a.useState("demands"),[_,l]=a.useState([]),[f,P]=a.useState("all"),[C,h]=a.useState(null),[B,K]=a.useState(null),[T,E]=a.useState(null),[V,X]=a.useState(!1),le=a.useMemo(()=>{const q=t.length;let R=0,ue=0,Ee=0;for(const pe of t)pe.status===U.PENDING?R++:pe.status===U.COMPLETED&&ue++,pe.priority===Z.HIGH&&Ee++;return{total:q,pending:R,completed:ue,highPriority:Ee}},[t]),te=a.useMemo(()=>s.find(q=>q.id===B),[s,B]);a.useEffect(()=>{S&&h(S)},[S]),a.useEffect(()=>{N&&$(N)},[N]),a.useEffect(()=>{k&&A(k)},[k]),a.useEffect(()=>{(async()=>{if(ce()&&F){const{data:R}=await F.from("app_config").select("value").eq("key","dashboard_notices").maybeSingle();R&&l(R.value)}else{const R=localStorage.getItem("geo_notices");R&&l(JSON.parse(R))}})()},[]);const p=q=>{if(P(q),!!u){u(R=>({...R,startDate:"",endDate:""}));return}};a.useEffect(()=>{z==="map"&&u&&p("all")},[z]);const ae=q=>{if(!C)return;const R=t.findIndex(ue=>ue.id===C);R!==-1&&(q==="prev"&&R>0?h(t[R-1].id):q==="next"&&R<t.length-1&&h(t[R+1].id))},re=q=>{K(q)},de=C?t.findIndex(q=>q.id===C):-1,De=de>0,Ne=de!==-1&&de<t.length-1,we=a.useMemo(()=>z!=="map"?[]:v==="citizens"?s:t.map(q=>{const R=s.find(ue=>ue.id===q.citizenId);return{...q,bairro:R==null?void 0:R.bairro,citizenName:R==null?void 0:R.name}}),[z,v,t,s]),he=a.useMemo(()=>{if(!j)return[];if(!T)return j;if(v==="citizens"){const q=s.filter(R=>R.bairro===T).map(R=>R.id);return j.filter(R=>R.type==="citizen"&&q.includes(R.id))}else{const q=we.filter(R=>R.bairro===T).map(R=>R.id);return j.filter(R=>R.type==="demand"&&q.includes(R.id))}},[j,T,v,we,s]),Le=()=>z==="map"?null:e.jsx("div",{className:"shrink-0 flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-3",children:[e.jsx(at,{className:"w-8 h-8 text-brand-600 dark:text-brand-400"}),"Gestão de Demandas"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsx("div",{className:"w-full md:w-[280px]",children:e.jsx(He,{value:z,onChange:q=>$(q),options:[{value:"list",label:"Lista",icon:La},{value:"board",label:"Quadro",icon:_a},{value:"calendar",label:"Calendário",icon:Oa}]})}),e.jsxs("button",{onClick:r,className:"w-full sm:w-auto px-5 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 transition-all flex items-center justify-center gap-2 active:scale-95 h-11 shrink-0",children:[e.jsx(Pt,{className:"w-5 h-5"}),e.jsx("span",{className:"whitespace-nowrap",children:"Nova Demanda"})]})]})]})});return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500 relative",children:[e.jsxs("div",{className:`flex flex-col gap-4 h-full mx-auto w-full ${z==="map"?"":"max-w-[1600px]"}`,children:[Le(),M&&u&&e.jsx("div",{className:"shrink-0",children:e.jsx(vs,{filters:M,setFilters:u,users:x,isMapMode:z==="map",mapViewMode:v,onMapViewModeChange:q=>{A(q),E(null)},hideAdvanced:z==="map"})}),e.jsxs("div",{className:"flex flex-col min-h-0 w-full relative h-full",children:[z!=="calendar"&&z!=="map"&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-4 shrink-0",children:[e.jsx(Fe,{title:"Total",value:le.total,icon:Zt,colorClass:"bg-blue-500",textClass:"text-blue-600 dark:text-blue-400"}),e.jsx(Fe,{title:"Pendentes",value:le.pending,icon:Se,colorClass:"bg-slate-500",textClass:"text-slate-600 dark:text-slate-400"}),e.jsx(Fe,{title:"Concluídas",value:le.completed,icon:Re,colorClass:"bg-green-500",textClass:"text-green-600 dark:text-green-400"}),e.jsx(Fe,{title:"Alta Prioridade",value:le.highPriority,icon:et,colorClass:"bg-red-500",textClass:"text-red-600 dark:text-red-400"})]}),e.jsxs("div",{className:"flex-1 min-h-0 w-full relative",children:[z==="list"&&e.jsx(xs,{demands:t,citizens:s,onUpdateStatus:i||(()=>{}),onEdit:b,onViewDemand:q=>h(q.id),initialSelectionId:S,clearSelection:y,onInteractionUpdate:w,onNotification:D,onViewCitizen:re}),z==="board"&&e.jsx(os,{demands:t,citizens:s,onViewDemand:q=>h(q.id),onUpdateStatus:i||(()=>{})}),z==="calendar"&&e.jsx(ds,{demands:t,interactions:n,notices:_,onEditDemand:q=>h(q.id)}),z==="map"&&e.jsxs("div",{className:"h-full w-full rounded-3xl overflow-hidden border border-slate-200 dark:border-white/10 shadow-sm relative flex",children:[e.jsx("div",{className:"hidden md:flex flex-col h-full shrink-0",children:e.jsx(qt,{items:we,type:v,selectedNeighborhood:T,onFilterNeighborhood:E,onSelect:q=>v==="demands"?h(q.id):re(q.id),filters:M,setFilters:u})}),e.jsxs("div",{className:`fixed inset-0 z-[60] md:hidden transition-opacity duration-300 ${V?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>X(!1)}),e.jsx("div",{className:`absolute top-0 bottom-0 left-0 w-80 bg-white dark:bg-slate-900 shadow-2xl transform transition-transform duration-300 ${V?"translate-x-0":"-translate-x-full"}`,children:e.jsx(qt,{items:we,type:v,selectedNeighborhood:T,onFilterNeighborhood:q=>{E(q),X(!1)},onSelect:q=>{v==="demands"?h(q.id):re(q.id),X(!1)},filters:M,setFilters:u})})]}),e.jsxs("div",{className:"flex-1 relative h-full w-full",children:[e.jsx(ws,{defaultCenter:H,onViewDemand:q=>h(q),preloadedMarkers:he,currentViewMode:v,onChangeViewMode:A,mapFocus:I}),e.jsx("button",{onClick:()=>X(!0),className:"md:hidden absolute top-4 left-4 z-[400] p-3 bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-white/10 text-brand-600 dark:text-brand-400",children:e.jsx(Pa,{className:"w-6 h-6"})})]})]})]})]})]}),C&&e.jsx(js,{demand:t.find(q=>q.id===C),citizen:s.find(q=>{var R;return q.id===((R=t.find(ue=>ue.id===C))==null?void 0:R.citizenId)})||null,onClose:()=>{h(null),y&&y()},onEdit:b,onUpdateStatus:i||(()=>{}),onInteractionUpdate:w,onNavigate:ae,canNavigatePrev:De,canNavigateNext:Ne,onNotification:D,onViewCitizen:re,onMapFocus:G}),te&&e.jsx(ks,{citizen:te,onClose:()=>K(null),onEdit:()=>{K(null),Y&&Y(te.id)},onCreateDemand:()=>{K(null),r()},onNotification:D,onSelectDemand:q=>{K(null),h(q.id)}})]})},ys=({locations:t})=>{const[s,n]=a.useState(null),[d,b]=a.useState(!1),r=t.length>0?t[0]:null;a.useEffect(()=>{(async()=>{if(!r){b(!1);return}const N=`weather_cache_${r.lat}_${r.lon}`,M=localStorage.getItem(N),u=new Date().toISOString().slice(0,13);if(M){const x=JSON.parse(M);if(x.hour===u){n(x.data);return}}b(!0);try{const D=await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${r.lat}&longitude=${r.lon}&current=temperature_2m,weather_code&timezone=auto`)).json();n(D),localStorage.setItem(N,JSON.stringify({hour:u,data:D}))}catch(x){console.error("Failed to fetch weather",x)}finally{b(!1)}})()},[r]);const i=y=>y===0?e.jsx(Et,{className:"w-6 h-6 text-amber-500"}):y>=1&&y<=3?e.jsx(Ma,{className:"w-6 h-6 text-slate-400"}):y>=51&&y<=67?e.jsx(Ra,{className:"w-6 h-6 text-blue-400"}):y>=71&&y<=77?e.jsx(za,{className:"w-6 h-6 text-cyan-300"}):e.jsx(Et,{className:"w-6 h-6 text-amber-500"});if(d&&r)return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-slate-200/50 dark:bg-white/5 animate-pulse min-w-[140px] h-[46px]",children:[e.jsx(je,{className:"w-4 h-4 animate-spin text-slate-400"}),e.jsx("div",{className:"h-3 w-16 bg-slate-300 dark:bg-white/10 rounded"})]});if(!r||!s)return null;const w=Math.round(s.current.temperature_2m),S=s.current.weather_code;return e.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 rounded-xl bg-white/60 dark:bg-white/5 backdrop-blur-md border border-slate-200 dark:border-white/10 shadow-sm transition-all hover:bg-white/80 dark:hover:bg-white/10 cursor-default",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i(S),e.jsxs("span",{className:"text-xl font-bold text-slate-900 dark:text-white",children:[w,"°"]})]}),e.jsxs("div",{className:"flex flex-col border-l border-slate-300 dark:border-white/10 pl-4 h-8 justify-center",children:[e.jsxs("span",{className:"text-xs font-bold text-slate-700 dark:text-white uppercase tracking-wide flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3 text-brand-600 dark:text-brand-400"}),r.name]}),e.jsx("span",{className:"text-[10px] text-slate-500 dark:text-white/50",children:"Tempo Agora"})]})]})},Cs=({onBack:t,onSuccess:s})=>{const[n,d]=a.useState(""),[b,r]=a.useState("search"),[i,w]=a.useState([]),[S,y]=a.useState(!1),[N,M]=a.useState(""),[u,x]=a.useState(""),[D,H]=a.useState(""),[Y,j]=a.useState(!1);a.useEffect(()=>{const k=setTimeout(()=>M(n),500);return()=>clearTimeout(k)},[n]),a.useEffect(()=>{if(!N||N.length<3){w([]);return}(async()=>{if(y(!0),ce()&&F){const G=Ye(N),{data:z}=await F.from("citizens").select("*").or(`telefone.ilike.%${G}%,nome.ilike.%${N}%`).limit(5);z&&w(z.map($=>({id:$.id,name:`${$.nome} ${$.sobrenome}`,phone:$.telefone,bairro:$.bairro,email:$.email||"",createdAt:$.created_at})))}y(!1)})()},[N]);const I=async()=>{if(!u||!n)return;j(!0);const k=Ye(n),G=u.trim().split(" "),z=G[0],$=G.slice(1).join(" ")||".";try{if(ce()&&F){const{data:v,error:A}=await F.from("citizens").insert({nome:z,sobrenome:$,telefone:k,bairro:D,origem:"fast_track_mobile"}).select().single();if(A)throw A;v&&s(v.id)}}catch(v){console.error(v),alert("Erro ao criar cidadão rápido.")}finally{j(!1)}};return e.jsxs("div",{className:"fixed inset-0 bg-slate-50 dark:bg-[#020617] z-[100] flex flex-col animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"p-4 flex items-center gap-4 border-b border-slate-200 dark:border-white/10 bg-white dark:bg-[#0b1121]",children:[e.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-white/10",children:e.jsx(Tt,{className:"w-6 h-6 text-slate-600 dark:text-white"})}),e.jsx("h1",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Nova Solicitação"})]}),b==="search"&&e.jsxs("div",{className:"flex-1 p-6 flex flex-col",children:[e.jsx("label",{className:"text-sm font-bold text-slate-500 dark:text-white/50 mb-2 uppercase",children:"Quem está solicitando?"}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("input",{autoFocus:!0,type:"text",value:n,onChange:k=>d(k.target.value),placeholder:"Telefone ou Nome...",className:"w-full text-2xl font-bold bg-transparent border-b-2 border-slate-300 dark:border-white/20 py-2 outline-none focus:border-brand-500 text-slate-900 dark:text-white placeholder:text-slate-300"}),S&&e.jsx(je,{className:"absolute right-0 top-3 w-6 h-6 animate-spin text-brand-500"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3",children:[i.map(k=>e.jsxs("button",{onClick:()=>s(k.id),className:"w-full text-left p-4 bg-white dark:bg-white/5 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex items-center justify-between active:scale-95 transition-transform",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 dark:bg-brand-500/20 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold",children:k.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:k.name}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:Be(k.phone)})]})]}),e.jsx("div",{className:"bg-brand-600 text-white p-2 rounded-xl",children:e.jsx(bt,{className:"w-5 h-5"})})]},k.id)),N.length>3&&e.jsxs("button",{onClick:()=>r("create-citizen"),className:"w-full p-4 mt-4 bg-slate-100 dark:bg-white/5 rounded-2xl border-2 border-dashed border-slate-300 dark:border-white/10 flex items-center justify-center gap-2 text-slate-500 dark:text-white/60 font-bold active:scale-95 transition-transform",children:[e.jsx(Xt,{className:"w-5 h-5"}),'Cadastrar "',n,'"']})]})]}),b==="create-citizen"&&e.jsx("div",{className:"flex-1 p-6 flex flex-col",children:e.jsxs("div",{className:"bg-white dark:bg-white/5 p-6 rounded-3xl border border-slate-200 dark:border-white/10 shadow-lg space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Telefone"}),e.jsx("p",{className:"text-xl font-mono font-bold text-slate-900 dark:text-white border-b border-slate-100 pb-2",children:Be(n)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Nome Completo"}),e.jsx("input",{autoFocus:!0,type:"text",value:u,onChange:k=>x(k.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: João da Silva"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Bairro (Opcional)"}),e.jsx("input",{type:"text",value:D,onChange:k=>H(k.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: Centro"})]}),e.jsxs("button",{onClick:I,disabled:Y||!u,className:"w-full py-4 bg-brand-600 text-white rounded-xl font-bold text-lg shadow-xl shadow-brand-500/20 flex items-center justify-center gap-2 active:scale-95 transition-transform disabled:opacity-50",children:[Y?e.jsx(je,{className:"w-6 h-6 animate-spin"}):e.jsx(st,{className:"w-6 h-6"}),"Salvar e Criar Demanda"]})]})})]})},Me=[{title:"Bem-vindo ao Gabinete Digital",description:"Sua plataforma completa para gestão de mandato. Centralize demandas, cidadãos e inteligência geográfica em um só lugar.",icon:Fa,color:"bg-blue-500"},{title:"Gestão de Demandas",description:"Acompanhe solicitações em tempo real. Visualize por Lista, Kanban ou Calendário e nunca perca um prazo.",icon:at,color:"bg-brand-500"},{title:"Base de Cidadãos",description:"Conheça seu eleitorado. Mantenha um histórico completo de interações e localização de cada cidadão.",icon:Ke,color:"bg-green-500"},{title:"Mapa Interativo",description:"Inteligência espacial. Identifique problemas por região e tome decisões estratégicas baseadas em dados.",icon:At,color:"bg-purple-500"}],Ss=({onFinish:t})=>{const[s,n]=a.useState(0),[d,b]=a.useState("next"),r=()=>{s<Me.length-1?(b("next"),n(y=>y+1)):w()},i=()=>{s>0&&(b("prev"),n(y=>y-1))},w=()=>{localStorage.setItem("geo_onboarding_completed","true"),t()},S=Me[s].icon;return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-[#0f172a] rounded-3xl shadow-2xl overflow-hidden border border-white/20 relative flex flex-col",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1.5 bg-slate-100 dark:bg-white/10 z-10",children:e.jsx("div",{className:"h-full bg-brand-500 transition-all duration-500 ease-out",style:{width:`${(s+1)/Me.length*100}%`}})}),e.jsxs("button",{onClick:w,className:"absolute top-4 right-4 p-2 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors z-20 hover:bg-slate-100 dark:hover:bg-white/10 rounded-full",title:"Pular Tutorial",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider mr-1",children:"Pular"}),e.jsx(Pe,{className:"w-4 h-4 inline-block"})]}),e.jsxs("div",{className:"p-8 flex flex-col items-center text-center flex-1",children:[e.jsxs("div",{className:`flex flex-col items-center animate-in ${d==="next"?"slide-in-from-right-8":"slide-in-from-left-8"} fade-in duration-300 fill-mode-both`,children:[e.jsx("div",{className:`w-24 h-24 rounded-3xl ${Me[s].color} flex items-center justify-center shadow-xl shadow-brand-500/10 mb-8 transform transition-transform duration-500 hover:scale-105`,children:e.jsx(S,{className:"w-12 h-12 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-4 leading-tight",children:Me[s].title}),e.jsx("p",{className:"text-slate-500 dark:text-white/60 mb-8 leading-relaxed text-sm md:text-base min-h-[80px]",children:Me[s].description})]},s),e.jsxs("div",{className:"mt-auto w-full",children:[e.jsx("div",{className:"flex justify-center gap-2 mb-8",children:Me.map((y,N)=>e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${N===s?"bg-brand-600 w-8":"bg-slate-200 dark:bg-white/10 w-2"}`},N))}),e.jsxs("div",{className:"flex gap-3 items-center",children:[s>0&&e.jsx("button",{onClick:i,className:"p-3.5 rounded-xl border border-slate-200 dark:border-white/10 text-slate-500 dark:text-white hover:bg-slate-50 dark:hover:bg-white/5 transition-colors active:scale-95",children:e.jsx(Ue,{className:"w-6 h-6"})}),e.jsxs("button",{onClick:r,className:"flex-1 py-3.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 flex items-center justify-center gap-2 transition-all active:scale-[0.98] group",children:[s===Me.length-1?"Começar Agora":"Próximo",s===Me.length-1?e.jsx(st,{className:"w-5 h-5"}):e.jsx(Ge,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})]})]})]})})},Ds=t=>{const[s,n]=a.useState(navigator.onLine),[d,b]=a.useState(!0),[r,i]=a.useState([]),[w,S]=a.useState([]),[y,N]=a.useState([]),[M,u]=a.useState([]),[x,D]=a.useState([]),[H,Y]=a.useState(null),[j,I]=a.useState(null),[k,G]=a.useState(0),z=a.useCallback((A,_)=>{try{const l=localStorage.getItem("geo_map_cache"),f=l?JSON.parse(l):{};let P=!1;_.forEach(C=>{C.lat&&C.lon&&!f[C.id]&&(f[C.id]={lat:C.lat,lon:C.lon},P=!0)}),A.forEach(C=>{C.lat&&C.lon&&!f[C.id]&&(f[C.id]={lat:C.lat,lon:C.lon},P=!0)}),P&&localStorage.setItem("geo_map_cache",JSON.stringify(f))}catch(l){console.error("Error preloading map cache",l)}},[]),$=a.useCallback(async()=>{if(b(!0),!navigator.onLine){console.log("Offline mode: Loading from cache");const A=localStorage.getItem("cache_demands"),_=localStorage.getItem("cache_citizens"),l=localStorage.getItem("offline_demands_queue");let f=A?JSON.parse(A):[];const P=_?JSON.parse(_):[];l&&(f=[...JSON.parse(l),...f]),i(f),S(P),b(!1);return}if(ce()&&F)try{const[{data:A},{data:_},{data:l},{data:f},{data:P},{data:C},{data:h}]=await Promise.all([F.from("demands").select("*").order("created_at",{ascending:!1}).limit(2e3),F.from("citizens").select("*").limit(3e3),F.from("system_users").select("*"),F.from("demand_interactions").select("*").order("created_at",{ascending:!1}).limit(1e3),F.from("app_config").select("*").eq("key","weather_locations").maybeSingle(),F.from("app_config").select("*").eq("key","global_theme_mode").maybeSingle(),F.from("dashboard_stats").select("*").maybeSingle()]),B=A?A.map(T=>({...T,citizenId:T.citizen_id,createdAt:T.created_at})):[],K=_?_.map(T=>({id:T.id,cpf:T.cpf,name:`${T.nome} ${T.sobrenome}`,email:T.email,phone:T.telefone,createdAt:T.created_at,logradouro:T.logradouro,numero:T.numero,bairro:T.bairro,cidade:T.cidade,estado:T.estado,cep:T.cep,lat:T.lat,lon:T.lon})):[];localStorage.setItem("cache_demands",JSON.stringify(B)),localStorage.setItem("cache_citizens",JSON.stringify(K)),A&&i(B),_&&S(K),l&&N(l),f&&u(f.map(T=>({id:T.id,demandId:T.demanda_id,type:T.tipo,text:T.texto,isCompleted:T.concluido,deadline:T.prazo,user:T.usuario,createdAt:T.created_at}))),P&&D(P.value),h&&Y(h),C&&C.value&&I(C.value),z(B,K)}catch(A){console.error("Error fetching data, trying cache...",A);const _=localStorage.getItem("cache_demands"),l=localStorage.getItem("cache_citizens");_&&i(JSON.parse(_)),l&&S(JSON.parse(l))}finally{b(!1)}else i([]),b(!1)},[z]),v=a.useCallback(async()=>{const A=localStorage.getItem("offline_demands_queue");if(!A)return 0;const _=JSON.parse(A);if(_.length===0)return 0;if(ce()&&F){console.log(`Syncing ${_.length} offline demands...`);let l=0;for(const f of _)try{const{error:P}=await F.from("demands").insert({id:f.id,title:f.title,description:f.description,level:f.level,status:f.status,priority:f.priority,type:f.type,deadline:f.deadline,citizen_id:f.citizenId,tags:f.tags});P?console.error("Failed to sync item",f.id,P):l++}catch(P){console.error("Error syncing item",P)}return localStorage.removeItem("offline_demands_queue"),G(l),$(),l}return 0},[$]);return a.useEffect(()=>{const A=()=>{n(!0),v(),$()},_=()=>{n(!1)};return window.addEventListener("online",A),window.addEventListener("offline",_),()=>{window.removeEventListener("online",A),window.removeEventListener("offline",_)}},[$,v]),a.useEffect(()=>{t?($(),setTimeout(()=>{navigator.onLine&&v()},2e3)):i([])},[t,$,v]),{isOnline:s,isLoading:d,demands:r,setDemands:i,citizens:w,setCitizens:S,users:y,interactions:M,weatherLocations:x,setWeatherLocations:D,dbStats:H,themePreference:j,fetchData:$,processOfflineQueue:v,syncCount:k,setSyncCount:G}},Es=({status:t,setStatus:s,priority:n,setPriority:d,timeRange:b,setTimeRange:r,scope:i,setScope:w,showScope:S=!0,className:y=""})=>e.jsxs("div",{className:`glass-panel p-3 rounded-3xl flex flex-col md:flex-row gap-4 items-center border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md shadow-sm ${y}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-white/50 text-xs font-bold uppercase tracking-wider shrink-0",children:[e.jsx(ut,{className:"w-4 h-4 text-brand-500"})," Filtros"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto overflow-x-auto scrollbar-none items-start sm:items-center flex-1",children:[S&&i&&w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-w-[200px]",children:e.jsx(He,{value:i,onChange:w,options:[{value:"demands",label:"Demandas",icon:at},{value:"citizens",label:"Cidadãos",icon:Ke}]})}),e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"})]}),e.jsx("div",{className:"min-w-[280px]",children:e.jsx(He,{value:b,onChange:r,options:[{value:"7",label:"7d"},{value:"30",label:"30d"},{value:"90",label:"90d"},{value:"365",label:"Ano"},{value:"all",label:"Tudo"}]})}),(!S||i==="demands")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:t,onChange:N=>s(N.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Status: Todos"}),e.jsx("option",{value:U.PENDING,children:"Pendentes"}),e.jsx("option",{value:U.IN_PROGRESS,children:"Em Andamento"}),e.jsx("option",{value:U.COMPLETED,children:"Concluídos"})]}),e.jsx(tt,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]}),e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:n,onChange:N=>d(N.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Prioridade: Todas"}),e.jsx("option",{value:Z.HIGH,children:"Alta"}),e.jsx("option",{value:Z.MEDIUM,children:"Média"}),e.jsx("option",{value:Z.LOW,children:"Baixa"})]}),e.jsx(tt,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]})]})]})]}),(t!=="all"||n!=="all"||b!=="30")&&e.jsxs("button",{onClick:()=>{s("all"),d("all"),r("30")},className:"ml-auto p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-slate-400 hover:text-red-500 rounded-xl transition-colors flex items-center gap-1 text-[10px] font-bold uppercase",title:"Limpar Filtros",children:[e.jsx(Pe,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden md:inline",children:"Limpar"})]})]}),Is=qe.lazy(()=>oa(()=>import("./PeopleManager-CEqb72Vn.js"),__vite__mapDeps([0,1,2,3]))),As=qe.lazy(()=>oa(()=>import("./AdminScreen-BJ2Jrs4z.js"),__vite__mapDeps([4,1,2,3]))),St={administrador:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","admin_panel","map"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!0,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},chefe_de_gabinete:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},assessor:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!1,showPending:!0,showInProgress:!0,showCompleted:!1,showHighPriority:!0,showAnalytics:!1,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0}},Ts=qe.memo(({data:t,title:s})=>{const n=t.reduce((b,r)=>b+r.value,0);let d=0;return n===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados"}):e.jsxs("div",{className:"flex items-center gap-6 h-full justify-center",children:[e.jsxs("div",{className:"relative w-32 h-32 shrink-0",children:[e.jsx("svg",{viewBox:"0 0 100 100",className:"transform -rotate-90 w-full h-full",children:t.map((b,r)=>{const i=b.value/n,w=40,S=2*Math.PI*w,y=`${i*S} ${S}`;return d+=i*100,e.jsx("circle",{cx:"50",cy:"50",r:w,fill:"transparent",stroke:b.color,strokeWidth:"12",strokeDasharray:y,strokeDashoffset:-(d-i*100)/100*S,className:"transition-all duration-1000 ease-out"},r)})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-xl font-bold text-slate-800 dark:text-white",children:n}),e.jsx("span",{className:"text-[9px] uppercase font-bold text-slate-400",children:"Total"})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:t.map((b,r)=>e.jsxs("div",{className:"flex items-center justify-between text-xs gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:b.color}}),e.jsx("span",{className:"font-medium text-slate-600 dark:text-white/80",children:b.label})]}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white",children:[Math.round(b.value/n*100),"%"]})]},r))})]})}),$s=qe.memo(({data:t,unit:s=""})=>{const n=Math.max(...t.map(d=>d.value),1);return t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados geográficos"}):e.jsx("div",{className:"h-full w-full flex items-end justify-between gap-2 px-2 pb-2 pt-4",children:t.slice(0,7).map((d,b)=>{const r=d.value/n*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1 group h-full justify-end",children:[e.jsxs("div",{className:"text-[10px] font-bold text-slate-600 dark:text-slate-300 mb-0.5",children:[d.value,s]}),e.jsx("div",{style:{height:`${r}%`},className:"w-full bg-brand-200 dark:bg-brand-500/30 rounded-t-sm group-hover:bg-brand-50 dark:group-hover:bg-brand-500 transition-colors min-h-[4px]"}),e.jsx("div",{className:"text-[9px] text-slate-400 truncate w-full text-center",title:d.label,children:d.label.slice(0,6)})]},b)})})}),Ps=()=>{const[t,s]=a.useState(()=>{if(typeof window<"u"){const c=localStorage.getItem("geo_user");return c?JSON.parse(c):null}return null}),[n,d]=a.useState("dashboard"),[b,r]=a.useState(!0),i=a.useRef(0),w=a.useRef(null),[S,y]=a.useState("list"),[N,M]=a.useState(()=>typeof window<"u"&&localStorage.getItem("geo_theme_pref")||"auto"),[u,x]=a.useState(!1),[D,H]=a.useState("all"),[Y,j]=a.useState("all"),[I,k]=a.useState("30"),[G,z]=a.useState("demands"),[$,v]=a.useState("activity"),[A,_]=a.useState(St),[l,f]=a.useState({search:"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[],responsibleId:void 0}),[P,C]=a.useState(null),[h,B]=a.useState(null),[K,T]=a.useState(null),[E,V]=a.useState(null),[X,le]=a.useState("demands"),[te,p]=a.useState(null),[ae,re]=a.useState("list"),[de,De]=a.useState(!1),{demands:Ne,setDemands:we,citizens:he,users:Le,interactions:q,weatherLocations:R,setWeatherLocations:ue,isOnline:Ee,isLoading:pe,themePreference:ye,fetchData:Ie,syncCount:Ae}=Ds(t);a.useEffect(()=>{t&&t.firstLogin&&(localStorage.getItem("geo_onboarding_completed")||De(!0))},[t]),a.useEffect(()=>{ye&&M(ye)},[ye]);const _e=a.useMemo(()=>{let c=null,g=null;l.startDate&&(c=new Date(l.startDate+"T00:00:00").getTime(),l.endDate?g=new Date(l.endDate+"T23:59:59.999").getTime():g=new Date(l.startDate+"T23:59:59.999").getTime());const J=l.search.toLowerCase();return Ne.filter(ee=>{if(l.search){const Q=ee.id.toLowerCase().includes(J),se=ee.title.toLowerCase().includes(J),ie=ee.description.toLowerCase().includes(J);if(!Q&&!se&&!ie)return!1}if(l.status.length>0&&!l.status.includes(ee.status)||l.priority.length>0&&!l.priority.includes(ee.priority)||l.level.length>0&&!l.level.includes(ee.level)||l.responsibleId&&ee.responsibleId!==l.responsibleId||l.tags&&l.tags.length>0&&(!ee.tags||!l.tags.some(Q=>ee.tags.includes(Q))))return!1;if(c!==null&&g!==null){let Q;if(l.dateType==="deadline"?Q=ee.deadline:l.dateType==="updatedAt"?Q=ee.updatedAt:Q=ee.createdAt,!Q)return!1;let se;if(/^\d{4}-\d{2}-\d{2}$/.test(Q)){const[ie,Oe,jt]=Q.split("-").map(Number);se=new Date(ie,Oe-1,jt,12,0,0).getTime()}else se=new Date(Q).getTime();if(se<c||se>g)return!1}return!0})},[Ne,l]),Ve=a.useMemo(()=>{const c=l.search.toLowerCase();return l.search?he.filter(g=>{var ie,Oe;const J=g.id.toLowerCase()===c,ee=g.name.toLowerCase().includes(c),Q=(ie=g.email)==null?void 0:ie.toLowerCase().includes(c),se=(Oe=g.phone)==null?void 0:Oe.includes(c);return J||ee||Q||se}):he},[he,l.search]),m=a.useMemo(()=>{const c=[];return _e.length>0&&_e.forEach(g=>{g.lat&&g.lon&&c.push({id:g.id,type:"demand",lat:g.lat,lon:g.lon,title:g.title,status:g.status,priority:g.priority})}),Ve.length>0&&Ve.forEach(g=>{g.lat&&g.lon&&c.push({id:g.id,type:"citizen",lat:g.lat,lon:g.lon,name:g.name,bairro:g.bairro})}),c},[_e,Ve]),O=a.useCallback((c,g,J,ee)=>{T(null),B(null),C(null),r(!0),f({search:ee||"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[],responsibleId:void 0}),k("all"),V({lat:c,lon:g}),le(J),d("map")},[]);a.useEffect(()=>{Ae>0&&ne("success",`${Ae} itens sincronizados.`)},[Ae]),a.useEffect(()=>{r(!0),w.current&&w.current.scrollTo(0,0)},[n]);const W=c=>{const g=c.currentTarget.scrollTop;Math.abs(g-i.current)>5&&(g>i.current&&g>50?r(!1):r(!0),i.current=g)};a.useEffect(()=>{const c=()=>{let J=!1;if(N==="dark")J=!0;else if(N==="light")J=!1;else{const ee=new Date().getHours();J=ee<6||ee>=18}x(J),J?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};c();const g=setInterval(c,6e4);return()=>clearInterval(g)},[N]);const ne=a.useCallback((c,g)=>{p({type:c,message:g}),setTimeout(()=>p(null),4e3)},[]),oe=c=>{s(c),d("dashboard")},me=()=>{s(null),localStorage.removeItem("geo_user"),we([]),d("dashboard")},be=()=>{const c=u?"light":"dark";M(c),localStorage.setItem("geo_theme_pref",c)},Te=c=>{B(c),d("people")},Ce=c=>{B(null),C(null),T(null),V(null),le("demands"),f({search:"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[],responsibleId:void 0}),d(c)},wt=async(c,g)=>{const J=Ne.find(Q=>Q.id===c),ee=J==null?void 0:J.status;if(!(!J||ee===g)&&(we(Q=>Q.map(se=>se.id===c?{...se,status:g}:se)),ce()&&F))try{const{error:Q}=await F.from("demands").update({status:g}).eq("id",c);if(Q)throw Q;const se=JSON.parse(localStorage.getItem("geo_user")||"{}"),{error:ie}=await F.from("demand_interactions").insert({demanda_id:c,tipo:"status_change",texto:`Status alterado de "${ee}" para "${g}"`,usuario:se.name||"Sistema",created_at:new Date().toISOString()});if(ie)throw ie;Ie(),ne("success","Status atualizado com sucesso!")}catch(Q){console.error("Error updating status:",Q),ne("error","Erro ao atualizar status: "+Q.message),we(se=>se.map(ie=>ie.id===c?{...ie,status:ee}:ie))}},rt=()=>{const c=new Date,g=new Date;if(I!=="all"){const J=parseInt(I);J===365?(g.setMonth(0,1),g.setHours(0,0,0,0)):g.setDate(c.getDate()-J)}else g.setFullYear(1970);return g},ge=a.useMemo(()=>{const c=rt();return Ne.filter(g=>{const ee=new Date(g.createdAt)>=c,Q=D==="all"||g.status===D,se=Y==="all"||g.priority===Y;return ee&&Q&&se})},[Ne,D,Y,I]),o=a.useMemo(()=>{const c=rt();return he.filter(g=>g.createdAt?new Date(g.createdAt)>=c:!0)},[he,I]),L=a.useMemo(()=>{if(G==="demands"){const c=ge.length;let g=0,J=0,ee=0;for(const Q of ge)Q.status===U.PENDING?g++:Q.status===U.COMPLETED&&J++,Q.priority===Z.HIGH&&ee++;return{stat1:{label:"Filtradas",value:c,icon:Zt,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Pendentes",value:g,icon:Se,color:"bg-slate-500",text:"text-slate-600 dark:text-slate-400"},stat3:{label:"Concluídos",value:J,icon:Re,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat4:{label:"Alta Prioridade",value:ee,icon:pt,color:"bg-red-500",text:"text-red-600 dark:text-red-400"}}}else{const c=he.length,g=new Date().toDateString(),J=he.filter(se=>se.createdAt&&new Date(se.createdAt).toDateString()===g).length,ee={};for(const se of he)se.bairro&&(ee[se.bairro]=(ee[se.bairro]||0)+1);const Q=Object.entries(ee).sort((se,ie)=>ie[1]-se[1])[0];return{stat1:{label:"Total Cidadãos",value:c,icon:Ke,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Novos Hoje",value:J,icon:Xt,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat3:{label:"Top Bairro",value:Q?Q[0]:"N/A",icon:ke,color:"bg-brand-500",text:"text-brand-600 dark:text-brand-400"},stat4:{label:"Cadastros (Bairro)",value:Q?Q[1]:0,icon:_t,color:"bg-purple-500",text:"text-purple-600 dark:text-purple-400"}}}},[ge,o,he,G]),xe=a.useMemo(()=>{if(G==="demands"){const c={[U.PENDING]:0,[U.IN_PROGRESS]:0,[U.COMPLETED]:0};return ge.forEach(g=>{c[g.status]!==void 0&&c[g.status]++}),[{label:"Pendente",value:c[U.PENDING],color:"#64748b"},{label:"Em Andamento",value:c[U.IN_PROGRESS],color:"#f59e0b"},{label:"Concluído",value:c[U.COMPLETED],color:"#10b981"}].filter(g=>g.value>0)}else{const c={};o.forEach(se=>{const ie=se.createdAt?new Date(se.createdAt):new Date,Oe=`${ie.getFullYear()}-${String(ie.getMonth()+1).padStart(2,"0")}`;c[Oe]=(c[Oe]||0)+1});const g=Object.keys(c).sort().reverse(),J=["#0ea5e9","#6366f1","#8b5cf6","#ec4899","#64748b"],ee=g.slice(0,4).map((se,ie)=>{const[Oe,jt]=se.split("-"),Ot=new Date(parseInt(Oe),parseInt(jt)-1).toLocaleString("pt-BR",{month:"short",year:"2-digit"});return{label:Ot.charAt(0).toUpperCase()+Ot.slice(1),value:c[se],color:J[ie%J.length]}}),Q=g.slice(4).reduce((se,ie)=>se+c[ie],0);return Q>0&&ee.push({label:"Antigos",value:Q,color:"#94a3b8"}),ee}},[ge,o,G]),ve=a.useMemo(()=>{const c={};return G==="demands"?ge.forEach(g=>{const J=he.find(ee=>ee.id===g.citizenId);J&&J.bairro&&(c[J.bairro]=(c[J.bairro]||0)+1)}):o.forEach(g=>{g.bairro&&(c[g.bairro]=(c[g.bairro]||0)+1)}),Object.entries(c).sort((g,J)=>J[1]-g[1]).slice(0,7).map(([g,J])=>({label:g,value:J}))},[ge,o,he,G]),We=a.useMemo(()=>[...ge].sort((c,g)=>new Date(g.createdAt).getTime()-new Date(c.createdAt).getTime()).slice(0,5),[ge]),lt=a.useMemo(()=>[...o].sort((c,g)=>new Date(g.createdAt||0).getTime()-new Date(c.createdAt||0).getTime()).slice(0,5),[o]),fe=a.useMemo(()=>{const c=new Date;return c.setHours(0,0,0,0),ge.filter(g=>g.deadline&&g.status!==U.COMPLETED).map(g=>({...g,date:new Date(g.deadline)})).filter(g=>g.date>=c).sort((g,J)=>g.date.getTime()-J.date.getTime()).slice(0,5)},[ge]),Je=t?A[t.role]||St.assessor:St.administrador,ct=()=>e.jsxs("div",{className:"space-y-2",children:[" ",G==="demands"?We.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Ba,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):We.map(c=>e.jsxs("div",{onClick:()=>{t&&(T(c.id),d("demands"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[" ",e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-brand-50 dark:bg-brand-500/10 flex flex-col items-center justify-center text-brand-600 dark:text-brand-400 font-bold shrink-0 border border-brand-100 dark:border-brand-500/20",children:[" ",e.jsx("span",{className:"text-xs",children:new Date(c.createdAt).getDate()})," ",e.jsx("span",{className:"text-[8px] uppercase",children:new Date(c.createdAt).toLocaleString("default",{month:"short"}).slice(0,3)})," "]})," ",e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsxs("div",{className:"flex justify-between items-start",children:[" ",e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:c.title})," ",e.jsxs("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${c.status==="Concluído"?"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300":c.status==="Em Andamento"?"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300":"bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300"}`,children:[" ",c.status," "]})," "]})," ",e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:c.description})," "]})," "]},c.id)):lt.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Ke,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):lt.map(c=>e.jsxs("div",{onClick:()=>{Te(c.id)},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[" ",e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-blue-50 dark:bg-blue-500/10 flex flex-col items-center justify-center text-blue-600 dark:text-blue-400 font-bold shrink-0 border border-blue-100 dark:border-blue-500/20",children:[" ",e.jsx("span",{className:"text-xs",children:new Date(c.createdAt||Date.now()).getDate()})," ",e.jsx("span",{className:"text-[8px] uppercase",children:new Date(c.createdAt||Date.now()).toLocaleString("default",{month:"short"}).slice(0,3)})," "]})," ",e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsxs("div",{className:"flex justify-between items-start",children:[" ",e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:c.name})," ",e.jsxs("span",{className:"shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300",children:[" ",c.phone?Be(c.phone):"Sem Tel"," "]})," "]})," ",e.jsxs("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1 flex items-center gap-1",children:[" ",c.bairro&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-2.5 h-2.5"})," ",c.bairro]})," "]})," "]})," "]},c.id))," "]}),vt=()=>e.jsxs("div",{className:"space-y-2",children:[" ",G==="demands"?fe.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Re,{className:"w-6 h-6 mb-2 opacity-20"}),"Tudo em dia!"]}):fe.map(c=>{const g=Math.ceil((c.date.getTime()-new Date().getTime())/864e5);return e.jsxs("div",{onClick:()=>{t&&(T(c.id),d("demands"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[" ",e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-amber-50 dark:bg-amber-500/10 flex flex-col items-center justify-center text-amber-600 dark:text-amber-400 font-bold shrink-0 border border-amber-100 dark:border-amber-500/20",children:[" ",e.jsx("span",{className:"text-xs",children:c.date.getDate()})," ",e.jsx("span",{className:"text-[8px] uppercase",children:c.date.toLocaleString("default",{month:"short"}).slice(0,3)})," "]})," ",e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsxs("div",{className:"flex justify-between items-start",children:[" ",e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:c.title})," ",e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${g<=2?"bg-red-100 text-red-600 dark:bg-red-500/20":"bg-slate-100 text-slate-600 dark:bg-white/10"}`,children:g<0?"Exp.":`${g}d`})," "]})," ",e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:c.description})," "]})," "]},c.id)}):ve.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(ke,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):ve.slice(0,5).map((c,g)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5",children:[" ",e.jsxs("div",{className:"flex items-center gap-3",children:[" ",e.jsx("span",{className:"text-xs font-bold text-slate-400 w-4",children:g+1})," ",e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-white",children:c.label})," "]})," ",e.jsx("span",{className:"text-[10px] font-bold bg-purple-100 text-purple-600 dark:bg-purple-500/20 dark:text-purple-300 px-2 py-1 rounded-full",children:c.value})," "]},g))," "]});return e.jsxs("div",{className:`flex h-screen bg-slate-50 dark:bg-[#020617] transition-colors duration-500 overflow-hidden ${u?"dark":""}`,children:[!t&&e.jsx("div",{className:"absolute inset-0 z-[100]",children:e.jsx(ns,{onLogin:oe})}),de&&t&&e.jsx(Ss,{onFinish:()=>De(!1)}),e.jsxs("div",{className:`dashboard-root flex h-full w-full transition-all duration-700 ease-in-out ${t?"filter-none opacity-100":"blur-[5px] scale-[1.02] pointer-events-none grayscale-[0.2]"}`,children:[e.jsx(Xa,{currentView:n==="fast-track"?"demands":n,setView:Ce,user:t,onLogout:me,toggleTheme:be,isDarkMode:u,systemConfig:A,showMobileDock:b}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 transition-all duration-300 relative lg:my-4 lg:mr-4 lg:ml-4",children:[!Ee&&e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-[1000] bg-amber-500/90 backdrop-blur-sm text-white text-xs font-bold text-center py-1.5 flex items-center justify-center gap-2 lg:rounded-t-[2.5rem]",children:[e.jsx(Ua,{className:"w-3 h-3"})," Modo Offline. As alterações serão salvas localmente."]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden flex flex-col glass-container rounded-[2.5rem]",children:[te&&e.jsxs("div",{className:`fixed top-6 right-6 z-[1000] px-4 py-3 rounded-xl shadow-2xl border flex items-center gap-3 animate-in slide-in-from-right duration-300 ${te.type==="success"?"bg-green-500 text-white border-green-600":"bg-red-500 text-white border-red-600"}`,children:[te.type==="success"?e.jsx(Re,{className:"w-5 h-5"}):e.jsx(Yt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-sm",children:te.message})]}),e.jsxs(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(je,{className:"w-8 h-8 animate-spin text-brand-500"})}),children:[["dashboard","new-demand","edit-demand","admin_panel","demands","people","map"].includes(n)&&e.jsxs("div",{className:"absolute inset-0 overflow-y-auto custom-scrollbar p-4 lg:p-6 pb-32 lg:pb-6",onScroll:W,ref:w,children:[e.jsx("div",{className:"lg:hidden h-2 w-full"}),n==="dashboard"&&e.jsxs("div",{className:"flex flex-col gap-6 max-w-[1600px] mx-auto w-full",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 shrink-0",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold tracking-tight text-slate-900 dark:text-white",children:["Olá, ",t?t.name.split(" ")[0]:"Bem-vindo"]})}),e.jsx(ys,{locations:R})]}),e.jsx(Es,{status:D,setStatus:H,priority:Y,setPriority:j,timeRange:I,setTimeRange:k,scope:G,setScope:z,className:"sticky top-0 z-30"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 shrink-0",children:[e.jsx(Fe,{isLoading:pe,title:L.stat1.label,value:typeof L.stat1.value=="string"?0:L.stat1.value,subValue:typeof L.stat1.value=="string"?L.stat1.value:void 0,icon:L.stat1.icon,colorClass:L.stat1.color,textClass:L.stat1.text}),e.jsx(Fe,{isLoading:pe,title:L.stat2.label,value:typeof L.stat2.value=="string"?0:L.stat2.value,subValue:typeof L.stat2.value=="string"?L.stat2.value:void 0,icon:L.stat2.icon,colorClass:L.stat2.color,textClass:L.stat2.text}),e.jsx(Fe,{isLoading:pe,title:L.stat3.label,value:typeof L.stat3.value=="string"?0:L.stat3.value,subValue:typeof L.stat3.value=="string"?L.stat3.value:void 0,icon:L.stat3.icon,colorClass:L.stat3.color,textClass:L.stat3.text}),e.jsx(Fe,{isLoading:pe,title:L.stat4.label,value:typeof L.stat4.value=="string"?0:L.stat4.value,subValue:typeof L.stat4.value=="string"?L.stat4.value:void 0,icon:L.stat4.icon,colorClass:L.stat4.color,textClass:L.stat4.text})]}),Je.dashboardWidgets.showAnalytics&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-auto shrink-0",children:[e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(Ga,{className:"w-3 h-3"})," ",G==="demands"?"Distribuição por Status":"Cadastros por Mês"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Ts,{data:xe,title:G==="demands"?"Demandas":"Cidadãos"})})]}),e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(ke,{className:"w-3 h-3"})," ",G==="demands"?"Top Bairros (Demandas)":"Top Bairros (Residentes)"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx($s,{data:ve})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 min-h-0",children:[e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${$!=="activity"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(He,{value:$,onChange:c=>v(c),options:[{value:"activity",label:"Atividade Recente",icon:ht},{value:"upcoming",label:"Próx. Prazos",icon:yt}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(ht,{className:"w-4 h-4"})," Atividades Recentes"]}),e.jsxs("button",{onClick:()=>d(G==="demands"?"demands":"people"),className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(ot,{className:"w-3 h-3"})]})]}),ct()]}),e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${$!=="upcoming"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(He,{value:$,onChange:c=>v(c),options:[{value:"activity",label:"Atividade Recente",icon:ht},{value:"upcoming",label:"Próx. Prazos",icon:yt}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(yt,{className:"w-4 h-4"})," ",G==="demands"?"Próximos Prazos":"Top Bairros"]}),e.jsxs("button",{onClick:()=>{G==="demands"?(re("calendar"),d("demands")):d("map")},className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(ot,{className:"w-3 h-3"})]})]}),vt()]})]})]}),n==="new-demand"&&e.jsx("div",{className:"max-w-[1600px] mx-auto w-full h-full",children:e.jsx(ss,{initialSearchTerm:h||void 0,onSuccess:c=>{Ie(),d("demands"),B(null)},onCancel:()=>{d("demands"),B(null)},onNotification:ne})}),n==="edit-demand"&&P&&e.jsx("div",{className:"max-w-[1600px] mx-auto w-full h-full",children:e.jsx(rs,{demand:P,onSuccess:c=>{Ie(),d("demands"),C(null)},onCancel:()=>{d("demands"),C(null)},onNotification:ne})}),n==="admin_panel"&&t&&e.jsx(As,{currentUser:t,systemConfig:A,onUpdateConfig:_,onUpdateLocation:ue,onNotification:ne,onLogout:me,toggleTheme:be,isDarkMode:u}),(n==="demands"||n==="map")&&e.jsx(Ns,{demands:_e,citizens:he,interactions:q,users:Le,onViewDemand:()=>{},onEditDemand:c=>{C(c),d("edit-demand")},onCreateDemand:()=>d("new-demand"),onUpdateStatus:wt,onInteractionUpdate:Ie,filters:l,setFilters:f,onNotification:ne,defaultLocation:R.length>0?R[0]:null,onViewCitizen:Te,initialViewMode:n==="map"?"map":ae,mapMarkers:m,initialSelectionId:K,clearSelection:()=>T(null),mapFocus:E,initialMapViewMode:X,onMapFocus:O}),n==="people"&&e.jsx(Is,{initialSearchTerm:h||void 0,onCreateDemand:c=>{B(c),d("new-demand")},onEditDemand:c=>{C(c),d("edit-demand")},onNotification:ne,onPersonUpdate:Ie,permissions:Je,onModeChange:y,demands:Ne,onMapFocus:O})]}),n==="fast-track"&&e.jsx(Cs,{onBack:()=>d("demands"),onSuccess:c=>{B(c),d("new-demand")}})]})]})]})]})]})};console.log("Iniciando Gabinete Digital (Main)...");const Dt=document.getElementById("root");if(!Dt)console.error("ERRO CRÍTICO: Elemento 'root' não encontrado no HTML.");else try{It.createRoot(Dt).render(e.jsx(qe.StrictMode,{children:e.jsx(Ps,{})})),console.log("React montado com sucesso via src/main.tsx")}catch(t){console.error("Erro ao montar React:",t),Dt.innerHTML='<div style="color:red; padding: 20px;">Erro ao carregar a aplicação. Verifique o console.</div>'}export{ks as C,is as P,Fe as S,Ht as a,Ye as b,He as c,Be as f,as as g,ce as i,e as j,F as s};
