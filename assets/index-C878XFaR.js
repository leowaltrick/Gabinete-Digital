const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PeopleManager-Cb8FxCNb.js","assets/vendor-DXGv6lL1.js","assets/db-CGtpfmbJ.js","assets/maps-DpZc8L4w.js","assets/AdminScreen-D0q-hpT1.js"])))=>i.map(i=>d[i]);
import{r as a,a as ra,R as $e,H as la,L as et,U as Ve,M as At,b as na,P as oa,d as da,S as It,e as ia,f as _t,h as ca,i as pt,A as Pt,j as st,k as ue,l as gt,m as je,F as $t,X as Pe,n as Ht,C as ke,o as ht,p as xa,q as ha,s as xt,B as ma,t as Bt,u as ba,E as kt,v as Nt,w as ua,x as rt,y as qt,z as pa,D as nt,G as Ne,Z as Ze,I as ze,J as qe,K as Xe,N as Vt,O as ga,Q as Jt,T as mt,V as fa,W as wa,Y as va,_ as bt,$ as ja,a0 as Ot,a1 as ka,a2 as Tt,a3 as Na,a4 as ya,a5 as Ca,a6 as Sa,a7 as Da,a8 as Mt,a9 as Ea,aa as Ia,ab as Ta,ac as Aa,ad as Wt,ae as Pa,af as $a,ag as La,ah as _a,ai as Oa,aj as Ma,ak as Yt,al as za,am as Ra,an as Fa,ao as yt,ap as Ua}from"./vendor-DXGv6lL1.js";import{c as Ga}from"./db-CGtpfmbJ.js";import{l as Oe,M as Kt,T as Qt,u as ft,C as Ha,P as Zt,a as Xt}from"./maps-DpZc8L4w.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))o(h);new MutationObserver(h=>{for(const l of h)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(h){const l={};return h.integrity&&(l.integrity=h.integrity),h.referrerPolicy&&(l.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?l.credentials="include":h.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(h){if(h.ep)return;h.ep=!0;const l=n(h);fetch(h.href,l)}})();var ea={exports:{}},wt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ba=a,qa=Symbol.for("react.element"),Va=Symbol.for("react.fragment"),Ja=Object.prototype.hasOwnProperty,Wa=Ba.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ya={key:!0,ref:!0,__self:!0,__source:!0};function ta(t,s,n){var o,h={},l=null,i=null;n!==void 0&&(l=""+n),s.key!==void 0&&(l=""+s.key),s.ref!==void 0&&(i=s.ref);for(o in s)Ja.call(s,o)&&!Ya.hasOwnProperty(o)&&(h[o]=s[o]);if(t&&t.defaultProps)for(o in s=t.defaultProps,s)h[o]===void 0&&(h[o]=s[o]);return{$$typeof:qa,type:t,key:l,ref:i,props:h,_owner:Wa.current}}wt.Fragment=Va;wt.jsx=ta;wt.jsxs=ta;ea.exports=wt;var e=ea.exports,ut={},zt=ra;ut.createRoot=zt.createRoot,ut.hydrateRoot=zt.hydrateRoot;const Ka="modulepreload",Qa=function(t){return"/Gabinete-Digital/"+t},Rt={},aa=function(s,n,o){let h=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),v=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));h=Promise.allSettled(n.map(N=>{if(N=Qa(N),N in Rt)return;Rt[N]=!0;const k=N.endsWith(".css"),y=k?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${N}"]${y}`))return;const M=document.createElement("link");if(M.rel=k?"stylesheet":Ka,k||(M.as="script"),M.crossOrigin="",M.href=N,v&&M.setAttribute("nonce",v),document.head.appendChild(M),k)return new Promise((c,f)=>{M.addEventListener("load",c),M.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${N}`)))})}))}function l(i){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=i,window.dispatchEvent(v),!v.defaultPrevented)throw i}return h.then(i=>{for(const v of i||[])v.status==="rejected"&&l(v.reason);return s().catch(l)})},Za=$e.memo(({currentView:t,setView:s,user:n,onLogout:o,toggleTheme:h,isDarkMode:l,systemConfig:i,showMobileDock:v=!0})=>{const[N,k]=a.useState(!0),[y,M]=a.useState(!1),c=N||y,f=n&&i[n.role]?i[n.role]:{allowedViews:[]},G=[{id:"dashboard",label:"Home",icon:la},{id:"demands",label:"Demandas",icon:et},{id:"people",label:"Cidadãos",icon:Ve},{id:"map",label:"Mapa",icon:At}].filter(g=>f.allowedViews.includes(g.id)),A=g=>g.split("_").map(D=>D.charAt(0).toUpperCase()+D.slice(1)).join(" "),T=g=>{s(g)};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`
          hidden lg:flex
          transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]
          flex-col will-change-transform group z-40 overflow-hidden
          static h-auto
          my-4 ml-4 mr-0
          rounded-[2.5rem] border border-white/60 dark:border-white/5
          bg-white/80 dark:bg-[#020617]/80 backdrop-blur-2xl
          shadow-xl shadow-slate-200/50 dark:shadow-black/20
          ${c?"w-72":"w-24"}
        `,onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),children:[e.jsxs("div",{className:`p-6 flex items-center ${c?"justify-between":"justify-center"} border-b border-slate-100 dark:border-white/5 h-28 shrink-0 relative`,children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden whitespace-nowrap",children:[e.jsx("div",{className:`w-12 h-12 min-w-[3rem] bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30 ring-1 ring-white/20 transition-transform duration-300 ${!c&&!N?"scale-110":""}`,children:e.jsx(na,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:`transition-all duration-300 origin-left ${c?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight text-slate-900 dark:text-white leading-none",children:"Gabinete"}),e.jsx("span",{className:"text-[10px] text-brand-600 dark:text-brand-400 font-bold tracking-[0.2em] uppercase",children:"Digital"})]})]}),e.jsx("button",{onClick:()=>k(!N),className:`
                flex absolute right-6 top-1/2 -translate-y-1/2 text-slate-400 dark:text-white/30 hover:text-brand-600 dark:hover:text-white transition-all duration-300
                ${c?"opacity-0 group-hover:opacity-100 delay-100":"opacity-0 pointer-events-none"}
            `,title:N?"Desafixar menu":"Fixar menu",children:N?e.jsx(oa,{className:"w-4 h-4"}):e.jsx(da,{className:"w-4 h-4"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-x-hidden overflow-y-auto custom-scrollbar flex flex-col",children:G.map(g=>{const D=g.icon,I=t===g.id;return e.jsxs("button",{onClick:()=>T(g.id),disabled:!n,className:`
                  w-full flex items-center gap-4 px-4 py-3.5 rounded-2xl text-sm font-bold transition-all duration-300 relative group/item
                  ${n?"":"opacity-30 cursor-not-allowed"}
                  ${I?"bg-brand-500/10 dark:bg-white/10 text-brand-700 dark:text-white shadow-sm ring-1 ring-brand-500/20 dark:ring-white/10":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white"}
                  ${c?"":"justify-center"}
                `,children:[e.jsx(D,{className:`w-6 h-6 min-w-[1.5rem] transition-transform duration-300 ${I?"scale-110":"group-hover/item:scale-110"}`}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${c?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:g.label}),I&&c&&e.jsx("div",{className:"absolute right-4 w-1.5 h-1.5 rounded-full bg-brand-500 shadow-[0_0_8px_currentColor]"})]},g.id)})}),e.jsxs("div",{className:"p-4 border-t border-slate-100 dark:border-white/5 shrink-0 space-y-2",children:[e.jsxs("button",{onClick:h,className:`
                  lg:hidden w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5
                  ${c?"":"justify-center"}
                `,children:[l?e.jsx(It,{className:"w-5 h-5 min-w-[1.25rem] text-amber-400"}):e.jsx(ia,{className:"w-5 h-5 min-w-[1.25rem] text-slate-600"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${c?"opacity-100":"opacity-0 w-0 hidden"}`,children:l?"Modo Claro":"Modo Escuro"})]}),n&&e.jsxs("button",{onClick:()=>T("admin_panel"),className:`
                  w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  ${t==="admin_panel"?"bg-slate-100 dark:bg-white/10 text-brand-700 dark:text-brand-300":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5"}
                  ${c?"":"justify-center"}
                `,children:[e.jsx(_t,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${c?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Configurações"})]}),e.jsxs("button",{onClick:o,disabled:!n,className:`
                w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors
                ${c?"":"justify-center"}
                `,children:[e.jsx(ca,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${c?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Sair"})]}),e.jsxs("div",{className:`mt-2 flex items-center gap-3 p-2 rounded-2xl border transition-all duration-300 
                ${c?"bg-slate-50/50 dark:bg-white/5 border-slate-100 dark:border-white/5":"bg-transparent border-transparent justify-center"}
            `,children:[e.jsx("div",{className:"w-9 h-9 min-w-[2.25rem] rounded-full bg-slate-200 dark:bg-slate-800 flex items-center justify-center overflow-hidden border border-white dark:border-white/10 shadow-sm",children:n!=null&&n.avatar?e.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(pt,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"})}),e.jsxs("div",{className:`flex-1 min-w-0 overflow-hidden transition-all duration-300 ${c?"opacity-100":"opacity-0 w-0 hidden"}`,children:[e.jsx("p",{className:"text-xs font-bold truncate text-slate-800 dark:text-white",children:n?n.name.split(" ")[0]:"..."}),e.jsx("p",{className:"text-[9px] text-brand-600 dark:text-brand-400 font-bold uppercase truncate tracking-wider",children:n?A(n.role):""})]})]})]})]}),e.jsx("nav",{className:`
            lg:hidden fixed bottom-0 left-0 right-0 z-[3000] 
            bg-white/95 dark:bg-[#0f172a]/95 backdrop-blur-xl 
            border-t border-slate-200 dark:border-white/10 
            pb-safe-area shadow-[0_-4px_20px_rgba(0,0,0,0.05)]
            transition-transform duration-300 ease-in-out
            ${v?"translate-y-0":"translate-y-full"}
        `,children:e.jsxs("div",{className:"flex items-center justify-around h-[76px] px-2 pb-2",children:[G.map(g=>{const D=t===g.id,I=g.icon;return e.jsxs("button",{onClick:()=>T(g.id),className:`
                    flex flex-col items-center justify-center gap-1.5 w-full h-full transition-all duration-200 active:scale-95
                    ${D?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`
                    relative p-2 rounded-2xl transition-all duration-300
                    ${D?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}
                `,children:e.jsx(I,{className:`w-6 h-6 transition-all ${D?"stroke-[2.5px] scale-110":"stroke-2"}`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide transition-opacity ${D?"opacity-100":"opacity-60"}`,children:g.label})]},g.id)}),e.jsxs("button",{onClick:()=>T("admin_panel"),className:`
                flex flex-col items-center justify-center gap-1.5 w-full h-full transition-all duration-200 active:scale-95
                ${t==="admin_panel"?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`relative p-2 rounded-2xl transition-all duration-300 ${t==="admin_panel"?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}`,children:e.jsx(_t,{className:`w-6 h-6 ${t==="admin_panel"?"stroke-[2.5px]":"stroke-2"}`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide ${t==="admin_panel"?"opacity-100":"opacity-60"}`,children:"Configurações"})]})]})})]})});var Je=(t=>(t.MUNICIPAL="Municipal",t.ESTADUAL="Estadual",t.FEDERAL="Federal",t))(Je||{}),F=(t=>(t.PENDING="Pendente",t.IN_PROGRESS="Em Andamento",t.COMPLETED="Concluído",t))(F||{}),ee=(t=>(t.LOW="Baixa",t.MEDIUM="Média",t.HIGH="Alta",t))(ee||{}),lt=(t=>(t.SOLICITACAO="Solicitação",t.RECLAMACAO="Reclamação",t.ELOGIO="Elogio",t.DENUNCIA="Denúncia",t.SUGESTAO="Sugestão",t))(lt||{});const Xa="yioefhebxsohutdypxqd",Ft=`https://${Xa}.supabase.co`,Ut="sb_publishable_ltKmfB3EreWKb757l0c6mw__0FBPSeR",R=Ft&&Ut?Ga(Ft,Ut):null,ie=()=>!!R,We=t=>{const s=t.replace(/\D/g,"");return s.length>11?t.slice(0,15):s.length>10?s.replace(/^(\d\d)(\d{5})(\d{4}).*/,"($1) $2-$3"):s.length>5?s.replace(/^(\d\d)(\d{4})(\d{0,4}).*/,"($1) $2-$3"):s.length>2?s.replace(/^(\d\d)(\d{0,5})/,"($1) $2"):s},Gt=t=>{const s=t.replace(/\D/g,"");return s.length>5?s.replace(/^(\d{5})(\d{1,3})/,"$1-$2"):s},Be=t=>t.replace(/\D/g,""),es=t=>{if(!t)return new Date;if(t.length===10&&t.includes("-")){const[s,n,o]=t.split("-").map(Number);return new Date(s,n-1,o)}return new Date(t)},at=t=>t?es(t).toLocaleDateString("pt-BR"):"",ts=({initialSearchTerm:t,onSuccess:s,onCancel:n,onNotification:o})=>{const[h,l]=a.useState(""),[i,v]=a.useState([]),[N,k]=a.useState(!1),[y,M]=a.useState(!1),[c,f]=a.useState(null),[C,G]=a.useState(!1),A=a.useRef(null),[T,g]=a.useState(""),[D,I]=a.useState(""),[V,z]=a.useState(""),[j,S]=a.useState(""),[P,m]=a.useState(""),[L,q]=a.useState(!1),[$,p]=a.useState(""),[H,X]=a.useState(""),[E,w]=a.useState(""),[Q,ae]=a.useState(""),[B,_]=a.useState(""),[re,ge]=a.useState(""),[u,W]=a.useState(""),[te,ne]=a.useState(Je.MUNICIPAL),[Le,he]=a.useState(F.PENDING),[Fe,fe]=a.useState(ee.MEDIUM),[De,Ye]=a.useState(lt.SOLICITACAO),[Ue,Ee]=a.useState(""),[we,ye]=a.useState([]),[Ce,Ie]=a.useState(""),[Ge,x]=a.useState(!1),[O,U]=a.useState(!1);a.useEffect(()=>{const r=new Date;r.setDate(r.getDate()+7),Ee(r.toISOString().split("T")[0]),t&&(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)?xe(t):(l(t),me(t)))},[]),a.useEffect(()=>{const r=se=>{A.current&&!A.current.contains(se.target)&&k(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const ce=r=>({id:r.id||"temp-id",cpf:r.cpf,name:`${r.nome} ${r.sobrenome}`,email:r.email||"",phone:r.telefone||"",logradouro:r.logradouro,numero:r.numero,complemento:r.complemento||void 0,bairro:r.bairro,cep:r.cep,cidade:r.cidade,estado:r.estado}),le=r=>{r.cep&&m(Gt(r.cep)),r.logradouro&&p(r.logradouro),r.numero&&X(r.numero),r.bairro&&w(r.bairro),r.cidade&&ae(r.cidade),r.estado&&_(r.estado)},xe=async r=>{if(ie()&&R){const{data:se}=await R.from("citizens").select("*").eq("id",r).maybeSingle();if(se){const oe=ce(se);f(oe),l(oe.name),le(oe),G(!1)}}},me=async r=>{if(!(!r||r.length<2)){M(!0),k(!0),v([]);try{if(ie()&&R){const se=Be(r);let oe=R.from("citizens").select("*").limit(10);se.length>3?oe=oe.or(`telefone.ilike.%${se}%,nome.ilike.%${r}%,sobrenome.ilike.%${r}%`):oe=oe.or(`nome.ilike.%${r}%,sobrenome.ilike.%${r}%`);const{data:_e}=await oe;_e&&v(_e.map(pe=>ce(pe)))}}catch(se){console.error(se)}finally{M(!1)}}},Te=r=>{f(r),l(r.name),k(!1),G(!1),le(r)},ve=()=>{f(null),G(!0),k(!1);const r=Be(h);if(r.length>=8)z(r);else{const se=h.split(" ");se.length>0&&g(se[0]),se.length>1&&I(se.slice(1).join(" "))}},ot=async()=>{const r=P.replace(/\D/g,"");if(r.length===8){q(!0);try{const oe=await(await fetch(`https://viacep.com.br/ws/${r}/json/`)).json();oe.erro||(p(oe.logradouro),w(oe.bairro),ae(oe.localidade),_(oe.uf))}catch(se){console.error(se)}finally{q(!1)}}},be=async r=>{if(r.preventDefault(),!re||!u){o&&o("error","Preencha título e descrição.");return}if(C&&!c){if(!T){o&&o("error","Nome é obrigatório.");return}if(!V){o&&o("error","Telefone é obrigatório.");return}}U(!0);try{let se=c==null?void 0:c.id;if(C&&!se){const pe=Be(V),He=P?Be(P):null;if(!navigator.onLine)se=crypto.randomUUID();else if(ie()&&R){const{data:tt}=await R.from("citizens").select("id").eq("telefone",pe).maybeSingle();if(tt)se=tt.id;else{const{data:vt,error:dt}=await R.from("citizens").insert({nome:T,sobrenome:D||".",telefone:pe,email:j||null,cep:He,logradouro:$||null,numero:H||null,bairro:E||null,cidade:Q||null,estado:B||null}).select().single();if(dt)throw dt;se=vt.id}}}const oe=crypto.randomUUID(),_e={id:oe,title:re,description:u,level:te,status:Le,priority:Fe,type:De,deadline:Ue||null,citizen_id:se,tags:we,created_at:new Date().toISOString()};if(navigator.onLine){if(ie()&&R){const{error:pe}=await R.from("demands").insert(_e);if(pe)throw pe;o&&o("success","Demanda criada com sucesso!")}}else{const pe=localStorage.getItem("offline_demands_queue"),He=pe?JSON.parse(pe):[];He.push(_e),localStorage.setItem("offline_demands_queue",JSON.stringify(He)),o&&o("success","Salvo Offline! Será sincronizado quando online.")}setTimeout(()=>s(oe),1e3)}catch(se){o&&o("error",`Erro: ${se.message}`),U(!1)}},Se=()=>{Ce.trim()&&!we.includes(Ce.trim())&&(ye([...we,Ce.trim()]),Ie(""),x(!1))};return e.jsxs("div",{className:"h-full flex flex-col relative animate-in fade-in slide-in-from-right duration-500 pb-20",children:[e.jsx("div",{className:"shrink-0 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:n,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:e.jsx(Pt,{className:"w-6 h-6"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-2",children:"Nova Demanda"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar pb-6 -mr-2 pr-2",children:e.jsx("div",{className:"max-w-none mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 items-start",children:[e.jsxs("div",{className:"lg:col-span-7 space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-visible z-20",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[e.jsx(pt,{className:"w-4 h-4"})," Solicitante"]})}),e.jsxs("div",{className:"relative",ref:A,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:h,onChange:r=>l(r.target.value),onKeyDown:r=>r.key==="Enter"&&me(h),placeholder:"Buscar por Nome ou Telefone (Enter)",className:`w-full pl-10 pr-10 py-3 glass-input border rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium transition-all ${C?"border-blue-300 dark:border-blue-500/50":"border-slate-300 dark:border-white/10"}`,autoComplete:"off"}),e.jsx(st,{className:"w-5 h-5 text-slate-400 absolute left-3 top-3.5"}),y&&e.jsx(ue,{className:"absolute right-3 top-3.5 w-5 h-5 text-brand-500 animate-spin"})]}),N&&!c&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden max-h-60 overflow-y-auto z-50",children:i.length>0?i.map(r=>e.jsxs("button",{onClick:()=>Te(r),className:"w-full text-left p-3 hover:bg-slate-50 dark:hover:bg-white/5 border-b border-slate-100 dark:border-white/5 flex flex-col",children:[e.jsx("span",{className:"font-bold text-slate-800 dark:text-white text-sm",children:r.name}),e.jsxs("div",{className:"flex gap-2 text-xs text-slate-500",children:[r.phone&&e.jsx("span",{children:We(r.phone)}),r.bairro&&e.jsxs("span",{children:["• ",r.bairro]})]})]},r.id)):!y&&h.length>2&&e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Nenhum resultado."}),e.jsx("button",{onClick:ve,className:"text-sm font-bold text-brand-600 hover:underline",children:"Cadastrar Novo"})]})})]}),c&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-slate-50 dark:bg-white/5 p-4 rounded-2xl border border-slate-100 dark:border-white/5 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white dark:bg-slate-800 rounded-full border border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 font-bold text-brand-600",children:c.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-slate-900 dark:text-white",children:c.name}),e.jsx("p",{className:"text-xs text-slate-500",children:We(c.phone)})]})]}),e.jsx("button",{onClick:()=>{f(null),l("")},className:"text-xs text-red-500 hover:underline",children:"Trocar"})]}),C&&!c&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl border border-blue-100 dark:border-blue-500/20 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300 text-xs font-bold uppercase",children:[e.jsx(gt,{className:"w-4 h-4"})," Novo Cadastro"]}),e.jsx("button",{onClick:()=>G(!1),className:"text-xs text-slate-400 hover:text-slate-600",children:"Cancelar"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Nome",value:T,onChange:r=>g(r.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"text",placeholder:"Sobrenome",value:D,onChange:r=>I(r.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"}),e.jsx("input",{type:"tel",placeholder:"Telefone (Só números)",value:V,onChange:r=>z(Be(r.target.value)),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"email",placeholder:"Email (Opcional)",value:j,onChange:r=>S(r.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx(je,{className:"w-4 h-4"})," Endereço da Ocorrência"]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"CEP"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:P,onChange:r=>m(Gt(r.target.value)),onBlur:ot,className:"w-full pl-9 pr-8 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm",placeholder:"00000-000"}),e.jsx(st,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400"}),L&&e.jsx(ue,{className:"absolute right-3 top-3 w-4 h-4 text-brand-500 animate-spin"})]})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Cidade"}),e.jsx("input",{type:"text",value:Q,onChange:r=>ae(r.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-9",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Logradouro"}),e.jsx("input",{type:"text",value:$,onChange:r=>p(r.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-3",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Número"}),e.jsx("input",{type:"text",value:H,onChange:r=>X(r.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Bairro"}),e.jsx("input",{type:"text",value:E,onChange:r=>w(r.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"UF"}),e.jsx("input",{type:"text",value:B,onChange:r=>_(r.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm uppercase",maxLength:2})]})]})]})]}),e.jsx("div",{className:"lg:col-span-5 space-y-6",children:e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx($t,{className:"w-4 h-4"})," Detalhes da Solicitação"]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:De,onChange:r=>Ye(r.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(lt).map(r=>e.jsx("option",{value:r,children:r},r))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título"}),e.jsx("input",{type:"text",value:re,onChange:r=>ge(r.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base font-bold text-slate-900 dark:text-white",placeholder:"Ex: Buraco na via"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição"}),e.jsx("textarea",{value:u,onChange:r=>W(r.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none",placeholder:"Descreva a situação em detalhes..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Etiquetas (Tags)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:we.map(r=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1",children:[r,e.jsx(Pe,{onClick:()=>ye(we.filter(se=>se!==r)),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500"})]},r))}),Ge?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text",value:Ce,onChange:r=>Ie(r.target.value),className:"flex-1 px-3 py-2 rounded-xl border border-slate-300 dark:border-white/10 glass-input text-sm",placeholder:"Nova tag...",onKeyDown:r=>{r.key==="Enter"&&Se()}}),e.jsx("button",{type:"button",onClick:Se,className:"px-3 py-2 bg-brand-600 text-white rounded-xl text-xs font-bold",children:"Add"})]}):e.jsxs("button",{type:"button",onClick:()=>x(!0),className:"text-xs text-brand-600 font-bold flex items-center gap-1 hover:underline",children:[e.jsx(Ht,{className:"w-3 h-3"})," Adicionar Tag"]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Inicial"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:Le,onChange:r=>he(r.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(F).map(r=>e.jsx("option",{value:r,children:r},r))})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:te,onChange:r=>ne(r.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(Je).map(r=>e.jsx("option",{value:r,children:r},r))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:Ue,onChange:r=>Ee(r.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"}),e.jsx(ke,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.values(ee).map(r=>e.jsxs("label",{className:`flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition-all ${Fe===r?r==="Alta"?"text-red-600 bg-red-100":r==="Média"?"text-amber-600 bg-amber-100":"text-green-600 bg-green-100":"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[e.jsx("input",{type:"radio",name:"priority",value:r,checked:Fe===r,onChange:()=>fe(r),className:"hidden"}),e.jsx("span",{className:"font-bold text-sm uppercase",children:r})]},r))})]})]})]})]})})]})})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-[60] flex gap-3 md:hidden",children:[e.jsx("button",{onClick:n,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:be,disabled:O,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[O?e.jsx(ue,{className:"w-5 h-5 animate-spin"}):navigator.onLine?e.jsx(ht,{className:"w-5 h-5"}):e.jsx(xa,{className:"w-5 h-5"}),O?"Salvando...":navigator.onLine?"Criar":"Salvar Offline"]})]}),e.jsxs("div",{className:"hidden md:flex fixed bottom-6 right-6 z-50 gap-3",children:[e.jsx("button",{onClick:n,className:"px-6 py-3 rounded-xl font-bold text-slate-500 bg-white shadow-lg border border-slate-200 hover:bg-slate-50 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:be,disabled:O,className:"px-8 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-xl flex items-center gap-2 disabled:opacity-70 transition-all",children:[O?e.jsx(ue,{className:"w-5 h-5 animate-spin"}):e.jsx(ht,{className:"w-5 h-5"}),O?"Salvando...":"Criar Demanda"]})]})]})},as=({demand:t,onSuccess:s,onCancel:n,onNotification:o})=>{const[h,l]=a.useState(t.title),[i,v]=a.useState(t.description),[N,k]=a.useState(t.level),[y,M]=a.useState(t.status),[c,f]=a.useState(t.priority),[C,G]=a.useState(t.type||lt.SOLICITACAO),[A,T]=a.useState(t.deadline?t.deadline.split("T")[0]:""),[g,D]=a.useState(null),[I,V]=a.useState(!1),[z,j]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!(!t.citizenId||!ie()||!R)){V(!0);try{const{data:L,error:q}=await R.from("citizens").select("*").eq("id",t.citizenId).maybeSingle();if(L)D(L);else{const{data:$}=await R.from("citizens").select("*").eq("cpf",t.citizenId).maybeSingle();$&&D($)}}catch(L){console.error("Error fetching citizen details:",L.message||L)}finally{V(!1)}}})()},[t.citizenId]);const S=async m=>{m.preventDefault(),j(!0);try{if(!ie()||!R)throw new Error("Supabase não configurado.");const{error:L}=await R.from("demands").update({title:h,description:i,level:N,status:y,priority:c,type:C,deadline:A||null}).eq("id",t.id);if(L)throw L;o&&o("success","Alterações salvas com sucesso!"),setTimeout(()=>s(t.id),1e3)}catch(L){o&&o("error",L.message||"Erro ao atualizar demanda."),j(!1)}},P=m=>{switch(m){case ee.HIGH:return"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-500/10 border-red-200 dark:border-red-500/20";case ee.MEDIUM:return"text-amber-600 dark:text-amber-400 bg-amber-100 dark:bg-amber-500/10 border-amber-200 dark:border-amber-500/20";case ee.LOW:return"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-500/10 border-green-200 dark:border-green-500/20"}};return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 md:pb-0 animate-in fade-in slide-in-from-right duration-500 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-slate-50/95 dark:bg-[#020617]/95 backdrop-blur-sm z-20 py-2 md:static md:bg-transparent md:py-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:n,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:[" ",e.jsx(Pt,{className:"w-6 h-6"})," "]}),e.jsxs("div",{children:[" ",e.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white tracking-tight flex flex-col md:flex-row md:items-center gap-1 md:gap-2",children:[" Edição de Demanda ",e.jsxs("span",{className:"text-xs md:text-sm font-normal text-slate-400 dark:text-white/40 border border-slate-200 dark:border-white/10 px-2 py-0.5 rounded-md font-mono w-fit",children:["#",t.id.slice(0,8)]})," "]})," "]})]}),e.jsxs("div",{className:"hidden md:flex gap-3",children:[e.jsx("button",{onClick:n,className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 dark:text-white/60 hover:bg-slate-100 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white transition-colors border border-transparent",children:" Cancelar "}),e.jsxs("button",{onClick:S,disabled:z,className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-[0_0_20px_rgba(14,165,233,0.3)] transition-all flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[" ",z?e.jsx(ue,{className:"w-5 h-5 animate-spin"}):e.jsx(ht,{className:"w-5 h-5"})," ",z?"Salvando...":"Salvar Alterações"," "]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-500 via-blue-500 to-brand-500"}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[" ",e.jsx(pt,{className:"w-4 h-4"})," Solicitante Vinculado "]}),I?e.jsxs("div",{className:"flex items-center gap-4 animate-pulse",children:[" ",e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-200 dark:bg-white/10 rounded-full"})," ",e.jsxs("div",{className:"space-y-2 flex-1",children:[" ",e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-white/10 rounded w-1/3"})," ",e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-white/10 rounded w-1/4"})," "]})," "]}):g?e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 md:gap-6",children:[" ",e.jsxs("div",{className:"flex items-center gap-4 md:gap-5",children:[" ",e.jsxs("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-100 dark:bg-slate-900 rounded-full border-2 border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 shadow-inner",children:[" ",e.jsx("span",{className:"text-xl md:text-2xl font-bold text-brand-600 dark:text-brand-400",children:g.nome.charAt(0)})," "]})," ",e.jsxs("div",{children:[" ",e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-slate-900 dark:text-white",children:[g.nome," ",g.sobrenome]})," ",g.telefone&&e.jsxs("p",{className:"text-slate-500 dark:text-white/50 font-mono text-xs md:text-sm mt-1 flex items-center gap-2",children:[" ",e.jsx(ha,{className:"w-3 h-3"})," ",We(g.telefone)," "]})," "]})," "]})," ",e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 text-xs md:text-sm",children:[" ",e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-white/80 bg-slate-50 dark:bg-white/5 px-3 py-1.5 rounded-lg border border-slate-200 dark:border-white/5",children:[" ",e.jsx(je,{className:"w-4 h-4 text-brand-500"})," ",g.cidade," - ",g.estado," "]})," "]})," "]}):e.jsx("div",{className:"text-slate-500 dark:text-white/50 italic text-sm",children:"Cidadão não encontrado."})]}),e.jsxs("div",{className:"glass-panel p-4 md:p-8 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx($t,{className:"w-4 h-4"})," Detalhes da Solicitação "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:C,onChange:m=>G(m.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(lt).map(m=>e.jsx("option",{value:m,children:m},m))," "]})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título da Ocorrência"})," ",e.jsx("input",{type:"text",value:h,onChange:m=>l(m.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base md:text-lg font-bold text-slate-900 dark:text-white"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição Detalhada"})," ",e.jsx("textarea",{value:i,onChange:m=>v(m.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none"})," "]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/5",children:[" ",e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/40 uppercase mb-2",children:"Localização Registrada"})," ",e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-white",children:[" ",e.jsx(je,{className:"w-5 h-5 text-red-500 shrink-0"})," ",e.jsxs("span",{className:"font-medium text-sm",children:[" ",g==null?void 0:g.logradouro,", ",g==null?void 0:g.numero," - ",g==null?void 0:g.bairro,", ",g==null?void 0:g.cidade,"/",g==null?void 0:g.estado," "]})," "]})," "]})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 lg:sticky lg:top-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx(xt,{className:"w-4 h-4"})," Controle de Gestão "]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Atual"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:y,onChange:m=>M(m.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(F).map(m=>e.jsx("option",{value:m,children:m},m))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"})," ",e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[" ",Object.values(ee).map(m=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${c===m?P(m):"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[" ",e.jsx("input",{type:"radio",name:"priority",value:m,checked:c===m,onChange:()=>f(m),className:"accent-current"})," ",e.jsx("span",{className:"font-bold text-sm uppercase",children:m})," "]},m))," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível de Governo"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:N,onChange:m=>k(m.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(Je).map(m=>e.jsx("option",{value:m,children:m},m))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo Limite"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsx("input",{type:"date",value:A,onChange:m=>T(m.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"})," ",e.jsx(ke,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})," "]})," "]})]})]})})]}),e.jsxs("div",{className:"md:hidden fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-30 flex gap-3 pb-6",children:[e.jsx("button",{onClick:n,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:" Cancelar "}),e.jsxs("button",{onClick:S,disabled:z,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[" ",z?e.jsx(ue,{className:"w-5 h-5 animate-spin"}):e.jsx(ht,{className:"w-5 h-5"})," ",z?"Salvando...":"Salvar"," "]})]})]})},ss=()=>e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none select-none p-4 lg:p-8 flex gap-6 bg-slate-100 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"hidden lg:flex w-72 h-full flex-col gap-8 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-8 opacity-40 blur-[2px] shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-5 w-32 bg-slate-200 dark:bg-white/10 rounded-lg"})]}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-12 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"},t))}),e.jsx("div",{className:"mt-auto h-14 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6 opacity-30 lg:opacity-50 blur-[3px] lg:blur-[1px]",children:[e.jsxs("div",{className:"h-24 w-full bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 flex items-center justify-between px-10 shadow-sm",children:[e.jsx("div",{className:"h-8 w-64 bg-slate-200 dark:bg-white/10 rounded-xl"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"})]})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"h-40 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-6 flex flex-col justify-between shadow-sm",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-100 dark:bg-white/5"}),e.jsx("div",{className:"h-5 w-24 bg-slate-200 dark:bg-white/10 rounded-lg"})]},t))}),e.jsx("div",{className:"flex-1 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-10 flex items-end justify-between gap-6 shadow-sm",children:[40,70,50,90,60,80,50,75,45,65,85,55,70,40,60].map((t,s)=>e.jsx("div",{className:"w-full bg-slate-200 dark:bg-white/5 rounded-t-xl",style:{height:`${t}%`}},s))})]})]}),rs=({onLogin:t})=>{const[s,n]=a.useState("login"),[o,h]=a.useState(!1),[l,i]=a.useState(!1),[v,N]=a.useState(""),[k,y]=a.useState(""),[M,c]=a.useState(!1),[f,C]=a.useState(""),[G,A]=a.useState(""),[T,g]=a.useState(!1),[D,I]=a.useState(!1),[V,z]=a.useState(null),[j,S]=a.useState(!1),[P,m]=a.useState(null);a.useEffect(()=>{i(!0)},[]);const L=a.useMemo(()=>async w=>{const Q=new TextEncoder().encode(w),ae=await crypto.subtle.digest("SHA-256",Q);return Array.from(new Uint8Array(ae)).map(_=>_.toString(16).padStart(2,"0")).join("")},[]),q=a.useMemo(()=>{const w=f;return{length:w.length>=8&&w.length<=12,hasUpper:/[A-Z]/.test(w),isAlphanumeric:/[a-zA-Z]/.test(w)&&/[0-9]/.test(w),match:w===G&&w.length>0}},[f,G]),$=Object.values(q).every(Boolean),p=async w=>{w.preventDefault(),S(!0),m(null);try{if(ie()&&R){const Q=await L(k),{data:ae,error:B}=await R.from("system_users").select("*").eq("email",v).maybeSingle();if(B)throw B;if(!ae||ae.senha_hash!==Q){m("Credenciais inválidas."),S(!1);return}if(!ae.ativo){m("Conta desativada."),S(!1);return}if(!ae.last_login){z(ae),n("new_password"),S(!1);return}await X(ae,!1,!1)}else await new Promise(Q=>setTimeout(Q,800)),v==="admin@admin"&&k==="admin"?await X({id:"demo-admin",email:"admin@admin",name:"Administrador Demo",role:"administrador",avatar:"https://ui-avatars.com/api/?name=Admin&background=0284c7&color=fff",firstLogin:!0},!0,!0):(m("Credenciais inválidas."),S(!1))}catch{m("Erro ao processar login."),S(!1)}},H=async w=>{if(w.preventDefault(),!(!$||!V)){if(S(!0),m(null),f==="Senha4321"){m("A nova senha não pode ser igual à senha padrão."),S(!1);return}try{if(ie()&&R){const Q=await L(f),{error:ae}=await R.from("system_users").update({senha_hash:Q,last_login:new Date().toISOString()}).eq("id",V.id);if(ae)throw ae;const B={...V,last_login:new Date().toISOString()};await X(B,!1,!0)}}catch(Q){m("Erro ao salvar nova senha: "+Q.message),S(!1)}}},X=async(w,Q=!1,ae=!1)=>{!Q&&ie()&&R&&s==="login"&&await R.from("system_users").update({last_login:new Date().toISOString()}).eq("id",w.id);const B=Q?w:{id:w.id,email:w.email,name:w.nome,role:w.perfil,avatar:`https://ui-avatars.com/api/?name=${w.nome}&background=0284c7&color=fff`,firstLogin:ae};h(!0),setTimeout(()=>{localStorage.setItem("geo_user",JSON.stringify(B)),t(B)},400)},E=({fulfilled:w,label:Q})=>e.jsxs("div",{className:`flex items-center gap-2 text-xs transition-colors duration-200 ${w?"text-emerald-600 font-bold":"text-slate-400"}`,children:[e.jsx("div",{className:`w-3.5 h-3.5 rounded-full flex items-center justify-center border ${w?"bg-emerald-500 border-emerald-500 text-white":"border-slate-300 bg-transparent"}`,children:w&&e.jsx(nt,{className:"w-2.5 h-2.5"})}),e.jsx("span",{children:Q})]});return e.jsxs("div",{className:`fixed inset-0 z-[100] bg-slate-50 dark:bg-[#020617] transition-all duration-700 overflow-hidden ${o?"opacity-0 scale-105 pointer-events-none":"opacity-100"}`,children:[e.jsx(ss,{}),e.jsx("div",{className:"absolute inset-0 bg-white/40 dark:bg-black/60 backdrop-blur-[4px] z-10 transition-colors duration-700"}),e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col lg:flex-row w-full h-full",children:[e.jsx("div",{className:"w-full lg:w-1/2 h-full flex items-center justify-center p-6 relative",children:e.jsxs("div",{className:`
                  w-full max-w-[440px]
                  bg-white/80 dark:bg-[#0f172a]/70 backdrop-blur-2xl 
                  border border-white/50 dark:border-white/10 
                  shadow-[0_8px_40px_-12px_rgba(0,0,0,0.1)] dark:shadow-black/50
                  rounded-[2.5rem] p-8 md:p-12
                  transform transition-all duration-700 ease-out flex flex-col
                  ${l?"translate-y-0 opacity-100 scale-100":"translate-y-12 opacity-0 scale-95"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-4 mb-10",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-600 to-brand-700 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-600/20 text-white ring-4 ring-white/50 dark:ring-white/5",children:e.jsx(ma,{className:"w-7 h-7"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-extrabold text-slate-900 dark:text-white tracking-tight leading-none",children:["Gabinete",e.jsx("br",{}),"Digital"]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:s==="login"?"Acesso ao Painel":"Configuração Inicial"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1 font-medium",children:s==="login"?"Gerencie seu mandato com eficiência.":"Defina sua senha de segurança."})]}),P&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-500/20 text-red-600 dark:text-red-300 text-sm font-bold rounded-2xl flex items-center gap-3 animate-in slide-in-from-left-2 shadow-sm",children:[e.jsx(gt,{className:"w-5 h-5 flex-shrink-0"}),P]}),s==="login"?e.jsxs("form",{onSubmit:p,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(Bt,{className:"w-5 h-5"})}),e.jsx("input",{type:"email",value:v,onChange:w=>N(w.target.value),className:"block w-full pl-11 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Email",required:!0,autoComplete:"email"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(ba,{className:"w-5 h-5"})}),e.jsx("input",{type:M?"text":"password",value:k,onChange:w=>y(w.target.value),className:"block w-full pl-11 pr-12 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Senha",required:!0,autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>c(!M),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors cursor-pointer",children:M?e.jsx(kt,{className:"w-5 h-5"}):e.jsx(Nt,{className:"w-5 h-5"})})]})]}),e.jsxs("button",{type:"submit",disabled:j,className:"w-full py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-base transition-all transform active:scale-[0.98] shadow-lg shadow-brand-600/20 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed group relative overflow-hidden",children:[j?e.jsx(ue,{className:"w-5 h-5 animate-spin"}):e.jsx(ua,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"}),j?"Conectando...":"Entrar"]})]}):e.jsxs("form",{onSubmit:H,className:"space-y-6 animate-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:T?"text":"password",value:f,onChange:w=>C(w.target.value),className:"block w-full pl-5 pr-12 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Nova Senha",maxLength:12,autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>g(!T),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors cursor-pointer",children:T?e.jsx(kt,{className:"w-5 h-5"}):e.jsx(Nt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:D?"text":"password",value:G,onChange:w=>A(w.target.value),className:"block w-full pl-5 pr-12 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Confirmar Senha",maxLength:12,autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>I(!D),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors cursor-pointer",children:D?e.jsx(kt,{className:"w-5 h-5"}):e.jsx(Nt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-2xl border border-slate-100 dark:border-white/5 grid grid-cols-2 gap-3",children:[e.jsx(E,{fulfilled:q.length,label:"8-12 dígitos"}),e.jsx(E,{fulfilled:q.isAlphanumeric,label:"Letras/Números"}),e.jsx(E,{fulfilled:q.hasUpper,label:"Maiúscula"}),e.jsx(E,{fulfilled:q.match,label:"Senhas Iguais"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{n("login"),C(""),A(""),z(null)},className:"flex-1 py-4 bg-white dark:bg-white/5 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-white/10 rounded-2xl font-bold text-sm border border-slate-200 dark:border-white/10 transition-colors",children:"Voltar"}),e.jsxs("button",{type:"submit",disabled:j||!$,className:"flex-[2] py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 disabled:opacity-50 transition-all",children:[j?e.jsx(ue,{className:"w-5 h-5 animate-spin"}):e.jsx(rt,{className:"w-5 h-5"})," Confirmar"]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-200/50 dark:border-white/5 text-center",children:e.jsxs("p",{className:"text-[10px] uppercase font-bold text-slate-400 dark:text-slate-500 tracking-widest",children:["Desenvolvido por ",e.jsx("a",{href:"mailto:leowaltrick@gmail.com?subject=App Gabinete Digital",title:"Entrar em contato",className:"text-brand-600 dark:text-brand-400 hover:opacity-80 transition-opacity",children:"LW Consulting"})]})})]})}),e.jsx("div",{className:"hidden lg:flex w-1/2 h-full items-center justify-center p-12 xl:p-20 relative pointer-events-none",children:e.jsxs("div",{className:`
                  w-full max-w-xl pointer-events-auto
                  transform transition-all duration-1000 delay-200 flex flex-col gap-10
                  ${l?"translate-x-0 opacity-100":"translate-x-20 opacity-0"}
              `,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-extrabold text-slate-900 dark:text-white leading-tight mb-4 drop-shadow-sm",children:["Gestão inteligente",e.jsx("br",{}),"para mandatos modernos."]}),e.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-300 font-medium leading-relaxed",children:"Centralize demandas, acompanhe solicitações e tome decisões estratégicas baseadas em dados."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{title:"Gestão de Demandas",icon:et,desc:"Controle via Lista, Kanban e Calendário."},{title:"Base de Cidadãos",icon:Ve,desc:"Cadastro completo com histórico e mapa."},{title:"Mapa Interativo",icon:At,desc:"Visualização geoespacial de ocorrências."},{title:"Agenda e Prazos",icon:ke,desc:"Monitoramento de tarefas e vencimentos."},{title:"Dashboard e KPIs",icon:qt,desc:"Métricas de desempenho em tempo real."},{title:"Segurança e Acesso",icon:pa,desc:"Controle granular de permissões."}].map((w,Q)=>e.jsxs("div",{className:"bg-white/60 dark:bg-black/40 backdrop-blur-md border border-white/40 dark:border-white/10 p-4 rounded-2xl shadow-sm hover:bg-white/80 dark:hover:bg-white/10 transition-colors duration-300",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 mb-3",children:e.jsx(w.icon,{className:"w-5 h-5"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white text-sm mb-1",children:w.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-snug",children:w.desc})]},Q))})]})})]})]})},Re=({options:t,value:s,onChange:n,size:o="md"})=>{const h=t.findIndex(l=>l.value===s);return e.jsxs("div",{className:`bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex relative border border-slate-200 dark:border-white/5 shadow-inner min-w-max ${o==="sm"?"h-9":"h-11"}`,children:[e.jsx("div",{className:"absolute top-1 bottom-1 rounded-lg bg-white dark:bg-slate-600 shadow-sm transition-all duration-300 ease-out z-0",style:{width:`calc(${100/t.length}% - 0.35rem)`,left:`calc(${h*(100/t.length)}% + 0.18rem)`}}),t.map(l=>{const i=s===l.value,v=l.icon;return e.jsxs("button",{onClick:()=>n(l.value),className:`
                flex-1 px-3 text-xs font-bold rounded-lg transition-all duration-300 relative z-10 flex items-center justify-center gap-1.5 whitespace-nowrap
                ${i?"text-brand-600 dark:text-white":"text-slate-500 dark:text-white/40 hover:text-slate-700"}
            `,children:[v&&e.jsx(v,{className:o==="sm"?"w-3 h-3":"w-4 h-4"}),l.label]},l.value)})]})},ls=({demands:t,citizens:s,onViewDemand:n,onUpdateStatus:o})=>{const[h,l]=a.useState(null),[i,v]=a.useState(F.PENDING),N=[{id:F.PENDING,label:"Pendente",icon:Ne,color:"text-slate-500",bg:"bg-slate-100 dark:bg-slate-900/50",border:"border-slate-300 dark:border-slate-700"},{id:F.IN_PROGRESS,label:"Em Andamento",icon:Ze,color:"text-amber-500",bg:"bg-amber-50 dark:bg-amber-900/10",border:"border-amber-300 dark:border-amber-700"},{id:F.COMPLETED,label:"Concluído",icon:ze,color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/10",border:"border-green-300 dark:border-green-700"}],k=(c,f)=>{l(f),c.dataTransfer.setData("demandId",f),c.dataTransfer.effectAllowed="move"},y=c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},M=(c,f)=>{c.preventDefault();const C=c.dataTransfer.getData("demandId");C&&o(C,f),l(null)};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500",children:[e.jsx("div",{className:"md:hidden landscape:hidden px-1 pb-3 shrink-0",children:e.jsx(Re,{value:i,onChange:c=>v(c),options:[{value:F.PENDING,label:"Pendente",icon:Ne},{value:F.IN_PROGRESS,label:"Andamento",icon:Ze},{value:F.COMPLETED,label:"Concluído",icon:ze}]})}),e.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-auto md:overflow-visible custom-scrollbar",children:e.jsx("div",{className:"flex flex-col landscape:flex-row md:flex-row h-full landscape:gap-4 md:gap-6 pb-4",children:N.map(c=>{const f=t.filter(T=>T.status===c.id),C=c.icon,A=i===c.id?"flex":"hidden landscape:flex md:flex";return e.jsxs("div",{className:`${A} flex-1 flex-col min-w-0 md:min-w-[320px] md:max-w-md h-full transition-all duration-300`,onDragOver:y,onDrop:T=>M(T,c.id),children:[e.jsxs("div",{className:`p-3 md:p-4 rounded-t-3xl border-x border-t border-slate-200 dark:border-white/10 ${c.bg} backdrop-blur-sm flex justify-between items-center relative md:sticky top-0 z-10 shrink-0`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:`w-5 h-5 ${c.color}`}),e.jsx("h3",{className:"font-bold text-slate-700 dark:text-white text-sm md:text-base",children:c.label})]}),e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-white dark:bg-white/10 text-xs font-bold text-slate-600 dark:text-white shadow-sm border border-slate-100 dark:border-white/5",children:f.length})]}),e.jsx("div",{className:`flex-1 overflow-y-auto p-2 landscape:p-2 md:p-3 space-y-3 border-x border-b border-slate-200 dark:border-white/10 rounded-b-3xl bg-white/30 dark:bg-white/5 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/10 transition-colors ${h?"bg-slate-50/50 dark:bg-white/10":""}`,children:f.length===0?e.jsx("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 dark:text-white/20 border-2 border-dashed border-slate-300 dark:border-white/10 rounded-xl m-2",children:e.jsx("p",{className:"text-sm",children:"Vazio"})}):f.map(T=>{const g=s.find(D=>D.id===T.citizenId);return e.jsxs("div",{draggable:!0,onDragStart:D=>k(D,T.id),onClick:()=>n(T),className:`
                                                    bg-white dark:bg-[#1e293b] rounded-xl border border-slate-200 dark:border-white/5 shadow-sm 
                                                    hover:shadow-md hover:border-brand-500/50 dark:hover:border-brand-500/50 
                                                    transition-all cursor-pointer group relative overflow-hidden active:cursor-grabbing
                                                    p-4 landscape:p-2.5 
                                                `,children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${T.priority===ee.HIGH?"bg-red-500":T.priority===ee.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-2 landscape:mb-1",children:[e.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-white/40 font-mono",children:["#",T.id.slice(0,6)]}),e.jsxs("div",{className:"flex gap-1",children:[T.level===Je.FEDERAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500",title:"Federal"}),T.level===Je.ESTADUAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500",title:"Estadual"})]})]}),e.jsx("h4",{className:"font-bold text-slate-800 dark:text-white text-sm leading-snug mb-2 pl-2 group-hover:text-brand-600 dark:group-hover:text-brand-400 transition-colors landscape:mb-1 landscape:line-clamp-2",children:T.title}),e.jsxs("div",{className:"flex items-center gap-2 pl-2 mb-3 landscape:mb-1",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-[10px] font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:(g==null?void 0:g.name.charAt(0))||"?"}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 truncate max-w-[120px] landscape:hidden",children:(g==null?void 0:g.name)||"Não identificado"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100 dark:border-white/5 pl-2 landscape:hidden",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 dark:text-white/40",children:[e.jsx(ke,{className:"w-3 h-3"})," ",new Date(T.createdAt).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"})]}),T.deadline&&e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${new Date(T.deadline)<new Date?"bg-red-100 text-red-600":"bg-slate-100 text-slate-500"} dark:bg-white/10 dark:text-white/60`,children:at(T.deadline)})]})]},T.id)})})]},c.id)})})})]})},ns=({demands:t,interactions:s=[],notices:n=[],onEditDemand:o})=>{const[h,l]=a.useState(new Date),[i,v]=a.useState(null),[N,k]=a.useState(!0),[y,M]=a.useState(!0),[c,f]=a.useState(!0),C=h.getFullYear(),G=h.getMonth(),A=new Date(C,G+1,0).getDate(),T=new Date(C,G,1).getDay(),g=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],D=()=>{l(new Date(C,G-1,1)),v(null)},I=()=>{l(new Date(C,G+1,1)),v(null)},V=()=>{const p=new Date;l(p),v(p.getDate())},z=(p,H)=>{const X=p.split("T")[0].split("-").map(Number);return X[2]===H&&X[1]-1===G&&X[0]===C},j=p=>{const H=N?t.filter(w=>w.deadline&&z(w.deadline,p)):[],X=y?s.filter(w=>w.type==="checklist"&&w.deadline&&!w.isCompleted&&z(w.deadline,p)):[],E=c?n.filter(w=>z(w.date,p)):[];return{demands:H,checklists:X,notices:E}},S=new Date(C,G,1),P=[...N?t.filter(p=>p.deadline&&p.status!==F.COMPLETED).map(p=>({type:"demand",data:p,date:new Date(p.deadline)})):[],...y?s.filter(p=>p.type==="checklist"&&p.deadline&&!p.isCompleted).map(p=>({type:"checklist",data:p,date:new Date(p.deadline)})):[],...c?n.filter(p=>new Date(p.date)).map(p=>({type:"notice",data:p,date:new Date(p.date)})):[]].filter(p=>p.date>=S).sort((p,H)=>p.date.getTime()-H.date.getTime()).slice(0,15),m=i?j(i):{demands:[],checklists:[],notices:[]},L=p=>{switch(p){case ee.HIGH:return"bg-red-100 text-red-700 dark:bg-red-500/20 dark:text-red-300 border-l-2 border-red-500";case ee.MEDIUM:return"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300 border-l-2 border-amber-500";case ee.LOW:return"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300 border-l-2 border-green-500"}},q=p=>{switch(p){case"alert":return e.jsx(Jt,{className:"w-3 h-3 text-red-500"});case"event":return e.jsx(ke,{className:"w-3 h-3 text-blue-500"});default:return e.jsx(ga,{className:"w-3 h-3 text-slate-500"})}},$=()=>{const p=[];for(let H=0;H<T;H++)p.push(e.jsx("div",{className:"min-h-[80px] bg-slate-50/30 dark:bg-slate-900/20 border-r border-b border-slate-200 dark:border-white/5"},`empty-${H}`));for(let H=1;H<=A;H++){const{demands:X,checklists:E,notices:w}=j(H),Q=X.length+E.length+w.length,ae=H===new Date().getDate()&&G===new Date().getMonth()&&C===new Date().getFullYear(),B=H===i;p.push(e.jsxs("div",{onClick:()=>v(H),className:`
                min-h-[80px] md:min-h-[120px] h-auto flex flex-col
                border-r border-b border-slate-200 dark:border-white/5 p-1 md:p-2 relative group hover:bg-slate-50 dark:hover:bg-white/5 transition-colors cursor-pointer
                ${B?"bg-brand-50 dark:bg-brand-900/10 shadow-[inset_0_0_0_2px_rgba(14,165,233,0.5)]":ae?"bg-brand-500/5":"bg-transparent"}
            `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`text-xs md:text-sm font-bold w-6 h-6 md:w-7 md:h-7 flex items-center justify-center rounded-full transition-all
                ${ae?"bg-brand-500 text-white shadow-lg shadow-brand-500/30":B?"bg-slate-900 dark:bg-white text-white dark:text-slate-900":"text-slate-500 dark:text-white/50"}
            `,children:H}),Q>0&&e.jsx("span",{className:"text-[9px] bg-slate-200 dark:bg-white/10 text-slate-600 dark:text-white/70 px-1.5 py-0.5 rounded-full font-bold",children:Q})]}),e.jsxs("div",{className:"space-y-1 overflow-y-hidden flex-1",children:[e.jsxs("div",{className:"hidden md:block space-y-1",children:[w.map(_=>e.jsxs("div",{className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 ${_.type==="alert"?"border-red-400 bg-red-50 dark:bg-red-500/10":"border-blue-400 bg-blue-50 dark:bg-blue-500/10"}`,children:[q(_.type)," ",_.title]},_.id)),X.slice(0,3-w.length).map(_=>e.jsx("div",{onClick:re=>{re.stopPropagation(),o(_)},className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 cursor-pointer hover:brightness-95 active:scale-95 transition-all ${L(_.priority)}`,children:_.title},_.id)),E.slice(0,Math.max(0,3-(X.length+w.length))).map(_=>e.jsxs("div",{className:"w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 border-l-slate-400 bg-slate-100 dark:bg-white/5 text-slate-600 dark:text-white/60",children:[e.jsx(Vt,{className:"w-2 h-2"})," ",_.text]},_.id)),X.length+E.length+w.length>3&&e.jsxs("div",{className:"text-[9px] text-slate-400 pl-1",children:["+ ",Q-3," mais"]})]}),e.jsxs("div",{className:"md:hidden flex flex-wrap justify-center content-end h-full pb-1 gap-1",children:[w.map((_,re)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"},`n-${re}`)),X.map((_,re)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-500"},`d-${re}`)),E.map((_,re)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"},`c-${re}`))]})]})]},H))}return p};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 shrink-0",children:[e.jsxs("button",{onClick:()=>k(!N),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${N?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-500/20 dark:border-brand-500/30 dark:text-brand-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${N?"bg-brand-500":"bg-slate-300"}`})," Demandas"]}),e.jsxs("button",{onClick:()=>M(!y),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${y?"bg-slate-100 border-slate-300 text-slate-700 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${y?"bg-slate-500":"bg-slate-300"}`})," Checklists"]}),e.jsxs("button",{onClick:()=>f(!c),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${c?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-500/20 dark:border-blue-500/30 dark:text-blue-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${c?"bg-blue-500":"bg-slate-300"}`})," Avisos"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-6 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 glass-panel rounded-3xl shadow-sm border border-slate-200 dark:border-white/10 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 md:p-6 border-b border-slate-200 dark:border-white/10 flex items-center justify-between bg-white/50 dark:bg-white/5 backdrop-blur-sm shrink-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white capitalize flex items-center gap-2",children:[e.jsx(ke,{className:"w-6 h-6 text-brand-600 dark:text-brand-400"}),g[G]," ",e.jsx("span",{className:"text-slate-400 dark:text-white/40 font-normal",children:C})]}),e.jsxs("div",{className:"flex bg-white dark:bg-white/10 rounded-xl border border-slate-200 dark:border-white/10 shadow-sm",children:[e.jsx("button",{onClick:D,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-l-xl border-r border-slate-200 dark:border-white/10",children:e.jsx(qe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:V,className:"px-4 text-xs font-bold text-slate-600 dark:text-white/70 hover:bg-slate-50 dark:hover:bg-white/10",children:"Hoje"}),e.jsx("button",{onClick:I,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-r-xl border-l border-slate-200 dark:border-white/10",children:e.jsx(Xe,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"grid grid-cols-7 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(p=>e.jsx("div",{className:"py-2 text-center text-[10px] md:text-xs font-bold text-slate-500 dark:text-white/30 uppercase tracking-wider",children:p},p))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"grid grid-cols-7 bg-transparent min-h-full",children:$()})})]}),e.jsx("div",{className:"w-full lg:w-80 glass-panel rounded-3xl border border-slate-200 dark:border-white/10 flex flex-col shrink-0 overflow-hidden h-[300px] lg:h-auto",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:[i," de ",g[G]]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-white/50",children:[m.demands.length+m.checklists.length+m.notices.length," eventos"]})]}),e.jsx("button",{onClick:()=>v(null),className:"text-xs text-brand-600 hover:underline",children:"Ver Geral"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar",children:[[...m.notices,...m.demands,...m.checklists].map((p,H)=>e.jsxs("div",{onClick:()=>p.type==="demand"&&o(p),className:`p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10 ${p.type==="demand"?"cursor-pointer hover:border-brand-200 hover:shadow-sm transition-all":""}`,children:[e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white line-clamp-2",children:p.title||p.text}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 capitalize",children:p.type==="checklist"?"Tarefa":p.type||"Demanda"})]},H)),m.demands.length===0&&m.notices.length===0&&m.checklists.length===0&&e.jsx("p",{className:"text-center text-xs text-slate-400 mt-4",children:"Nada para este dia."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-brand-600 dark:text-brand-400"}),"Próximos Prazos"]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-white/50",children:["A partir de ",g[G]]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:P.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-slate-400 dark:text-white/30 text-center",children:[e.jsx(Ne,{className:"w-10 h-10 mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Nenhum evento futuro."})]}):P.map((p,H)=>{const X=p.date.getDate()===new Date().getDate()&&p.date.getMonth()===new Date().getMonth(),E=p.type==="notice"?"bg-blue-50 text-blue-600 border-blue-100 dark:bg-blue-500/10 dark:text-blue-400":p.type==="demand"?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400":"bg-slate-50 text-slate-600 border-slate-100 dark:bg-white/5 dark:text-slate-400";return e.jsxs("div",{onClick:()=>p.type==="demand"&&o(p.data),className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:`w-10 h-10 rounded-lg flex flex-col items-center justify-center font-bold shrink-0 border ${E}`,children:[e.jsx("span",{className:"text-xs",children:p.date.getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:p.date.toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:p.type==="notice"||p.type==="demand"?p.data.title:p.data.text}),p.type==="demand"&&e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${X?"bg-red-100 text-red-600":"bg-slate-100 text-slate-600"} dark:bg-white/10`,children:X?"HOJE":p.data.status})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:p.type==="notice"?"Aviso Mural":p.type==="demand"?p.data.description:"Tarefa Checklist"})]})]},`${p.type}-${p.data.id}-${H}`)})})]})})]})]})},os=({currentPage:t,totalPages:s,onPageChange:n,totalItems:o,itemsPerPage:h})=>{if(s<=1)return null;const l=(t-1)*h+1,i=Math.min(t*h,o);return e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 py-4 px-2 border-t border-slate-200 dark:border-white/10 mt-auto",children:[e.jsxs("div",{className:"text-xs text-slate-500 dark:text-white/50 font-medium order-2 sm:order-1",children:["Mostrando ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:l})," a ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:i})," de ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:o})," registros"]}),e.jsxs("div",{className:"flex items-center gap-2 order-1 sm:order-2",children:[e.jsx("button",{onClick:()=>n(t-1),disabled:t===1,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Página anterior",children:e.jsx(qe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-1 px-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700 dark:text-white",children:t}),e.jsx("span",{className:"text-sm text-slate-400 dark:text-white/40",children:"/"}),e.jsx("span",{className:"text-sm text-slate-500 dark:text-white/50 font-medium",children:s})]}),e.jsx("button",{onClick:()=>n(t+1),disabled:t===s,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Próxima página",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})},ds=$e.memo(({demand:t,onUpdateStatus:s})=>{const n=l=>{s(t.id,l.target.value)},o=l=>l.stopPropagation(),h=l=>{switch(l){case F.COMPLETED:return"bg-green-50 text-green-700 border-green-200 dark:bg-green-500/10 dark:text-green-400 dark:border-green-500/20";case F.IN_PROGRESS:return"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";default:return"bg-slate-100 text-slate-600 border-slate-200 dark:bg-white/5 dark:text-slate-400 dark:border-white/10"}};return e.jsxs("div",{className:"relative inline-block group/status",onClick:o,children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg border transition-colors shadow-sm ${h(t.status)}`,children:[t.status===F.COMPLETED&&e.jsx(ze,{className:"w-3.5 h-3.5"}),t.status===F.IN_PROGRESS&&e.jsx(Ze,{className:"w-3.5 h-3.5"}),t.status===F.PENDING&&e.jsx(Ne,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:t.status}),e.jsx("div",{className:"ml-1 pl-1 border-l border-current/20 opacity-50",children:e.jsx(mt,{className:"w-3 h-3"})})]}),e.jsx("select",{value:t.status,onChange:n,onClick:o,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer font-bold text-sm appearance-none",children:Object.values(F).map(l=>e.jsx("option",{value:l,children:l},l))})]})}),is=({demands:t,citizens:s,onUpdateStatus:n,onEdit:o,onViewDemand:h,initialSelectionId:l,clearSelection:i,onInteractionUpdate:v,onNotification:N,onViewCitizen:k})=>{const[y,M]=a.useState("createdAt"),[c,f]=a.useState("desc"),[C,G]=a.useState(1),A=10,T=j=>{y===j?f(S=>S==="asc"?"desc":"asc"):(M(j),f("desc"))},g=j=>y!==j?e.jsx(fa,{className:"w-3 h-3 text-slate-300"}):c==="asc"?e.jsx(wa,{className:"w-3 h-3 text-brand-600"}):e.jsx(va,{className:"w-3 h-3 text-brand-600"}),D=a.useMemo(()=>[...t].sort((j,S)=>{let P=0;switch(y){case"createdAt":P=new Date(j.createdAt).getTime()-new Date(S.createdAt).getTime();break;case"deadline":const m=j.deadline?new Date(j.deadline).getTime():0,L=S.deadline?new Date(S.deadline).getTime():0;P=m-L;break;case"priority":const q={[ee.LOW]:1,[ee.MEDIUM]:2,[ee.HIGH]:3};P=q[j.priority]-q[S.priority];break;case"status":const $={[F.PENDING]:1,[F.IN_PROGRESS]:2,[F.COMPLETED]:3};P=$[j.status]-$[S.status];break;default:P=0}return c==="asc"?P:-P}),[t,y,c]);a.useEffect(()=>{G(1)},[t]);const I=Math.ceil(D.length/A),V=D.slice((C-1)*A,C*A),z=j=>{switch(j){case ee.HIGH:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-red-100 text-red-600 dark:bg-red-500/10 dark:text-red-300 border border-red-200 dark:border-red-500/20",children:"Alta"});case ee.MEDIUM:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-amber-100 text-amber-600 dark:bg-amber-500/10 dark:text-amber-300 border border-amber-200 dark:border-amber-500/20",children:"Média"});case ee.LOW:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-green-100 text-green-600 dark:bg-green-500/10 dark:text-green-300 border border-green-200 dark:border-green-500/20",children:"Baixa"})}};return e.jsx("div",{className:"flex flex-col w-full gap-2 relative",children:e.jsx("div",{className:"glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-slate-900/50 shadow-sm relative w-full flex flex-col min-h-0",children:D.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 dark:text-white/30 text-sm py-20",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-4",children:e.jsx(st,{className:"w-6 h-6 opacity-30"})}),e.jsx("p",{children:"Nenhuma demanda encontrada."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full relative",children:[e.jsxs("table",{className:"w-full text-left border-collapse hidden md:table",children:[e.jsx("thead",{className:"bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-sm border-b border-slate-200 dark:border-white/10",children:e.jsxs("tr",{className:"text-xs font-bold text-slate-500 dark:text-blue-200/50 uppercase tracking-wider",children:[e.jsx("th",{className:"p-4 first:pl-6 w-[35%] min-w-[200px]",children:"Título"}),e.jsx("th",{className:"p-4 w-[20%] min-w-[150px]",children:"Solicitante"}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>T("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",g("status")]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>T("priority"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prioridade ",g("priority")]})}),e.jsx("th",{className:"p-4 hidden lg:table-cell cursor-pointer",onClick:()=>T("createdAt"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Criação ",g("createdAt")]})}),e.jsx("th",{className:"p-4 hidden xl:table-cell cursor-pointer",onClick:()=>T("deadline"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prazo ",g("deadline")]})}),e.jsx("th",{className:"p-4 text-right last:pr-6 w-[80px]",children:"Ação"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-white/5 text-sm",children:V.map(j=>{const S=s.find(P=>P.id===j.citizenId);return e.jsxs("tr",{onClick:()=>h(j),className:"hover:bg-white/60 dark:hover:bg-white/5 transition-colors cursor-pointer group",children:[e.jsxs("td",{className:"p-4 first:pl-6",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white truncate max-w-[250px]",title:j.title,children:j.title}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-white/50 truncate mt-0.5 max-w-[250px]",children:j.description})]}),e.jsx("td",{className:"p-4",children:S?e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group/citizen p-1 -ml-1 rounded-lg hover:bg-brand-50 dark:hover:bg-white/10 transition-colors",onClick:P=>{P.stopPropagation(),k&&k(S.id)},children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs border border-slate-200 dark:border-white/10 shrink-0",children:S.name.charAt(0)}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"font-medium text-slate-900 dark:text-white truncate max-w-[150px] group-hover/citizen:text-brand-600 transition-colors",children:S.name})})]}):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"Não vinculado"})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:e.jsx(ds,{demand:j,onUpdateStatus:n})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:z(j.priority)}),e.jsx("td",{className:"p-4 hidden lg:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:new Date(j.createdAt).toLocaleDateString()}),e.jsx("td",{className:"p-4 hidden xl:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:j.deadline?at(j.deadline):"-"}),e.jsx("td",{className:"p-4 text-right last:pr-6",children:e.jsx("div",{className:"p-2 text-slate-400 group-hover:text-brand-600 transition-colors inline-flex bg-slate-100 dark:bg-white/5 rounded-lg group-hover:bg-brand-50 dark:group-hover:bg-brand-500/10",children:e.jsx(rt,{className:"w-4 h-4"})})})]},j.id)})})]}),e.jsx("div",{className:"md:hidden space-y-3 p-3",children:V.map(j=>{const S=s.find(P=>P.id===j.citizenId);return e.jsxs("div",{onClick:()=>h(j),className:"glass-panel p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm active:scale-[0.98] transition-all cursor-pointer relative overflow-hidden group",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${j.priority===ee.HIGH?"bg-red-500":j.priority===ee.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-xs font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:S?S.name.charAt(0):"?"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-bold text-slate-900 dark:text-white truncate",children:S?S.name.split(" ")[0]:"S/ Solicitante"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-white/50",children:new Date(j.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase border ${j.status===F.COMPLETED?"bg-green-50 text-green-700 border-green-200":"bg-slate-50 text-slate-600 border-slate-200"}`,children:j.status})]}),e.jsxs("div",{className:"pl-3",children:[e.jsx("h4",{className:"font-bold text-sm text-slate-800 dark:text-white mb-1 leading-snug",children:j.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/60 line-clamp-2 mb-3",children:j.description}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-100 dark:border-white/5 pt-2",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 font-bold uppercase",children:[e.jsx(je,{className:"w-3 h-3"})," ",j.level]}),e.jsxs("div",{className:"flex items-center gap-1 text-brand-600 text-xs font-bold",children:["Detalhes ",e.jsx(rt,{className:"w-3 h-3"})]})]})]})]},j.id)})})]}),e.jsx("div",{className:"bg-slate-50/50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-white/5 rounded-b-3xl",children:e.jsx(os,{currentPage:C,totalPages:I,onPageChange:G,totalItems:D.length,itemsPerPage:A})})]})})})};Oe.Icon&&Oe.Icon.Default&&(delete Oe.Icon.Default.prototype._getIconUrl,Oe.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}));const Ct={},cs=(t,s,n)=>t==="citizen"?"blue":s===F.COMPLETED?"green":n===ee.HIGH?"red":s===F.IN_PROGRESS?"orange":n===ee.MEDIUM?"gold":"blue",xs=(t,s,n)=>{const o=cs(t,s,n),h=`${t}-${o}`;if(Ct[h])return Ct[h];const l=new Oe.Icon({iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${o}.png`,shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:t==="citizen"?"custom-citizen-icon":""});return Ct[h]=l,l},hs=({markers:t})=>{const s=ft();return a.useEffect(()=>{const n=setTimeout(()=>{s.invalidateSize()},100);return()=>clearTimeout(n)},[s]),null},ms=({markers:t})=>{const s=ft(),[n,o]=a.useState([]),h=a.useCallback(()=>{s&&s.whenReady(()=>{const i=s.getBounds().pad(.1),v=t.filter(N=>i.contains(Oe.latLng(N.lat,N.lon)));o(v.slice(0,1e3))})},[s,t]);return a.useEffect(()=>{h();const l=()=>{requestAnimationFrame(h)};return s.on("moveend",l),s.on("zoomend",l),()=>{s.off("moveend",l),s.off("zoomend",l)}},[s,h,t]),e.jsx(e.Fragment,{children:n.map(l=>e.jsx(Ha,{center:[l.lat,l.lon],radius:5,pathOptions:{fillColor:"#0ea5e9",fillOpacity:.6,color:"#0284c7",weight:1,opacity:.5},eventHandlers:{click:()=>{const i=new CustomEvent("navigate-to-map",{detail:{citizenId:l.id}});window.dispatchEvent(i)}},children:e.jsx(Zt,{children:e.jsxs("div",{className:"p-1 min-w-[150px]",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-900",children:l.name}),e.jsx("p",{className:"text-xs text-slate-500",children:l.bairro||"Sem Bairro"})]})})},`dot-${l.id}`))})},bs=({markers:t,onViewDemand:s})=>{const n=ft(),[o,h]=a.useState([]),l=a.useCallback(()=>{n&&n.whenReady(()=>{const v=n.getBounds().pad(.2),N=t.filter(k=>v.contains(Oe.latLng(k.lat,k.lon)));h(N.slice(0,200))})},[n,t]);return a.useEffect(()=>{l();const i=()=>{requestAnimationFrame(l)};return n.on("moveend",i),n.on("zoomend",i),()=>{n.off("moveend",i),n.off("zoomend",i)}},[n,l,t]),e.jsx(e.Fragment,{children:o.map(i=>e.jsx(Xt,{position:[i.lat,i.lon],icon:xs(i.type,i.status,i.priority),eventHandlers:{click:()=>{window.innerWidth<768&&n.flyTo([i.lat,i.lon],16,{duration:.5})}},children:e.jsx(Zt,{children:e.jsx("div",{className:"p-1 min-w-[200px]",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-800 leading-tight",children:i.title}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full ${i.status==="Concluído"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:i.status}),i.priority===ee.HIGH&&e.jsx("span",{className:"text-red-600 font-bold",children:"ALTA"})]}),e.jsx("button",{onClick:v=>{v.stopPropagation(),s&&s(i.id)},className:"mt-1 w-full bg-brand-600 text-white text-xs font-bold py-1.5 rounded hover:bg-brand-700 transition-colors",children:"Ver Detalhes"})]})})})},`m-${i.type}-${i.id}`))})},us=({zoomIn:t,zoomOut:s})=>e.jsxs("div",{className:"flex flex-col gap-2 pointer-events-auto shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-white/10",children:[e.jsx("button",{onClick:t,className:"w-12 h-12 md:w-10 md:h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors border-b border-slate-100 dark:border-white/10 active:bg-slate-100",children:e.jsx(bt,{className:"w-6 h-6 md:w-5 md:h-5"})}),e.jsx("button",{onClick:s,className:"w-12 h-12 md:w-10 md:h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors active:bg-slate-100",children:e.jsx(ja,{className:"w-6 h-6 md:w-5 md:h-5"})})]}),ps=({focus:t})=>{const s=ft();return a.useEffect(()=>{t&&s.flyTo([t.lat,t.lon],18,{duration:1.5})},[t,s]),null},gs=({defaultCenter:t,onViewDemand:s,preloadedMarkers:n,currentViewMode:o,onChangeViewMode:h,mapFocus:l})=>{const i=a.useRef(null),[v,N]=a.useState(!1),k=t?[t.lat,t.lon]:[-23.5505,-46.6333],y=a.useMemo(()=>n?n.filter(f=>f.type===(o==="demands"?"demand":"citizen")):[],[o,n]);a.useEffect(()=>{N(!0);const f=setTimeout(()=>{N(!1)},500);return()=>clearTimeout(f)},[y,o,n]);const M=()=>{var f;return(f=i.current)==null?void 0:f.zoomIn()},c=()=>{var f;return(f=i.current)==null?void 0:f.zoomOut()};return e.jsxs("div",{className:"transition-all duration-300 ease-in-out border-slate-200 dark:border-white/10 shadow-sm bg-slate-100 dark:bg-slate-900 overflow-hidden h-full w-full relative",children:[v&&e.jsx("div",{className:"absolute top-20 md:top-4 left-1/2 -translate-x-1/2 z-[1000] animate-in fade-in zoom-in-95 duration-200 pointer-events-none",children:e.jsxs("div",{className:"bg-white/90 dark:bg-slate-800/90 backdrop-blur-md px-4 py-2 rounded-full shadow-xl border border-brand-100 dark:border-white/10 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 animate-spin text-brand-600"}),e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-white",children:"Atualizando mapa..."})]})}),e.jsx("div",{className:"absolute right-4 bottom-24 md:bottom-8 z-[400] flex flex-col gap-3 pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",children:e.jsx(us,{zoomIn:M,zoomOut:c})})}),e.jsxs(Kt,{ref:i,center:k,zoom:13,style:{width:"100%",height:"100%"},zoomControl:!1,scrollWheelZoom:!0,dragging:!0,preferCanvas:!0,children:[e.jsx(hs,{markers:y}),e.jsx(Qt,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'© <a href="https://carto.com/attributions">CARTO</a>'}),o==="citizens"?e.jsx(ms,{markers:y}):e.jsx(bs,{markers:y,onViewDemand:s}),e.jsx(ps,{focus:l||null})]})]})},it=({options:t,selectedValues:s,onChange:n,placeholder:o,label:h})=>{const[l,i]=a.useState(!1),[v,N]=a.useState(""),k=a.useRef(null);a.useEffect(()=>{const f=C=>{k.current&&!k.current.contains(C.target)&&(i(!1),N(""))};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]);const y=a.useMemo(()=>t.filter(f=>f.label.toLowerCase().includes(v.toLowerCase())),[t,v]),M=f=>{s.includes(f)?n(s.filter(C=>C!==f)):n([...s,f])},c=(f,C)=>{C.stopPropagation(),n(s.filter(G=>G!==f))};return e.jsxs("div",{className:"relative min-w-[200px]",ref:k,children:[h&&e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:h}),e.jsxs("div",{onClick:()=>i(!l),className:`
            w-full min-h-[46px] px-3 py-2 glass-input border border-slate-300 dark:border-white/10 rounded-2xl 
            focus:border-brand-500 outline-none font-bold text-slate-700 dark:text-white cursor-pointer shadow-sm
            flex items-center justify-between transition-all hover:bg-slate-50 dark:hover:bg-white/5
            ${l?"ring-2 ring-brand-500/20 border-brand-500":""}
        `,children:[e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.length===0?e.jsx("span",{className:"text-slate-400 dark:text-white/40 text-sm font-medium py-1",children:o}):s.map(f=>{const C=t.find(G=>G.value===f);return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 text-xs font-bold border border-brand-200 dark:border-brand-500/30",children:[(C==null?void 0:C.label)||f,e.jsx("div",{onClick:G=>c(f,G),className:"hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-full p-0.5 cursor-pointer",children:e.jsx(Pe,{className:"w-3 h-3"})})]},f)})}),e.jsx(mt,{className:`w-4 h-4 text-slate-400 transition-transform duration-300 ${l?"rotate-180":""}`})]}),l&&e.jsxs("div",{className:"absolute top-full left-0 w-full mt-2 glass-panel bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden z-50 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"p-2 border-b border-slate-100 dark:border-white/5",children:e.jsxs("div",{className:"relative",children:[e.jsx(st,{className:"w-4 h-4 text-slate-400 absolute left-3 top-2.5"}),e.jsx("input",{type:"text",value:v,onChange:f=>N(f.target.value),placeholder:"Filtrar opções...",className:"w-full pl-9 pr-3 py-2 text-sm bg-slate-50 dark:bg-white/5 rounded-lg border-none outline-none text-slate-900 dark:text-white placeholder:text-slate-400",autoFocus:!0,onClick:f=>f.stopPropagation()})]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/20",children:y.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-slate-400 dark:text-white/40 italic",children:"Nenhuma opção encontrada."}):y.map(f=>{const C=s.includes(f.value);return e.jsxs("div",{onClick:()=>M(f.value),className:`
                                    flex items-center justify-between px-3 py-2.5 rounded-lg cursor-pointer text-sm font-medium transition-colors
                                    ${C?"bg-brand-50 dark:bg-brand-500/10 text-brand-700 dark:text-brand-300":"text-slate-700 dark:text-white hover:bg-slate-50 dark:hover:bg-white/5"}
                                `,children:[e.jsx("span",{children:f.label}),C&&e.jsx(nt,{className:"w-4 h-4 text-brand-500"})]},f.value)})}),e.jsxs("div",{className:"p-2 border-t border-slate-100 dark:border-white/5 bg-slate-50/50 dark:bg-white/5 flex justify-between",children:[e.jsx("button",{onClick:()=>n([]),className:"text-xs text-slate-500 hover:text-red-500 px-2 py-1 transition-colors",children:"Limpar"}),e.jsx("button",{onClick:()=>i(!1),className:"text-xs font-bold text-brand-600 dark:text-brand-400 px-2 py-1 hover:bg-brand-50 dark:hover:bg-white/5 rounded transition-colors",children:"Pronto"})]})]})]})},Qe=({label:t,onRemove:s})=>e.jsxs("div",{className:"flex items-center gap-1 pl-3 pr-1 py-1 bg-brand-50 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 border border-brand-100 dark:border-brand-500/30 rounded-lg text-xs font-bold animate-in zoom-in-95 shadow-sm whitespace-nowrap",children:[e.jsx("span",{children:t}),e.jsx("button",{onClick:n=>{n.stopPropagation(),s()},className:"p-0.5 hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-md transition-colors text-brand-600 dark:text-brand-400",children:e.jsx(Pe,{className:"w-3 h-3"})})]}),ct=({label:t,icon:s,isActive:n,onClick:o})=>e.jsxs("button",{onClick:o,className:`
            flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold transition-all shadow-sm whitespace-nowrap border
            ${n?"bg-brand-600 text-white border-brand-600":"bg-white dark:bg-slate-800 text-slate-600 dark:text-white border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}
        `,children:[s&&e.jsx(s,{className:`w-3.5 h-3.5 ${n?"text-white":"text-slate-400"}`}),t]}),fs=({filters:t,setFilters:s,onExport:n,users:o=[],availableTags:h=[],isMapMode:l=!1,mapViewMode:i,onMapViewModeChange:v})=>{var re,ge;const[N,k]=a.useState(!1),[y,M]=a.useState(!1),[c,f]=a.useState(new Date),C=a.useRef(null),G=a.useRef(null),A=(u,W)=>{s(te=>({...te,[u]:W}))},T=()=>{s({search:t.search,level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",responsibleId:void 0,tags:[]})},g=(u,W)=>{Array.isArray(t[u])&&W?s(te=>({...te,[u]:te[u].filter(ne=>ne!==W)})):s(u==="startDate"||u==="endDate"?te=>({...te,startDate:"",endDate:""}):te=>({...te,[u]:void 0}))},D=u=>{const W=t.status;W.includes(u)?A("status",W.filter(te=>te!==u)):A("status",[...W,u])},I=u=>{const W=t.priority;W.includes(u)?A("priority",W.filter(te=>te!==u)):A("priority",[...W,u])},V=()=>{if(t.startDate)A("startDate",""),A("endDate","");else{const u=new Date().toLocaleDateString("en-CA");A("startDate",u),A("endDate",u)}},z=u=>u?u.split("_").map(W=>W.charAt(0).toUpperCase()+W.slice(1)).join(" "):"",j=u=>{const W=o.find(te=>te.id===u);return W?W.nome:"Usuário"},S=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],P=(u,W)=>new Date(u,W+1,0).getDate(),m=(u,W)=>new Date(u,W,1).getDay(),L=u=>{const te=new Date(c.getFullYear(),c.getMonth(),u).toLocaleDateString("en-CA");!t.startDate||t.startDate&&t.endDate?s(ne=>({...ne,startDate:te,endDate:""})):te<t.startDate?s(ne=>({...ne,startDate:te,endDate:t.startDate})):(s(ne=>({...ne,endDate:te})),setTimeout(()=>M(!1),300))},q=t.startDate?new Date(t.startDate+"T00:00:00").getTime():null,$=t.endDate?new Date(t.endDate+"T00:00:00").getTime():null,p=u=>{if(!q)return!1;const W=new Date(c.getFullYear(),c.getMonth(),u).getTime();return W===q?"start":$&&W===$?"end":$&&W>q&&W<$?"range":!1};a.useEffect(()=>{const u=W=>{C.current&&!C.current.contains(W.target)&&M(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const H=t.level.length+t.status.length+t.priority.length+(((re=t.tags)==null?void 0:re.length)||0)+(t.startDate?1:0)+(t.responsibleId?1:0),X=t.startDate?`${new Date(t.startDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})} ${t.endDate?" - "+new Date(t.endDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}):""}`:"Selecionar Período",E={createdAt:"Criação",updatedAt:"Atualização",deadline:"Prazo"},w=Object.values(Je).map(u=>({value:u,label:u})),Q=Object.values(F).map(u=>({value:u,label:u})),ae=Object.values(ee).map(u=>({value:u,label:u})),B=h.map(u=>({value:u,label:u})),_=!l||i==="demands";return e.jsxs("div",{className:"flex flex-col relative z-30 space-y-3",children:[e.jsxs("div",{className:`
          flex flex-col md:flex-row gap-3 items-center relative z-20 
          ${l?"bg-transparent":"glass-panel p-2 md:p-3 rounded-2xl shadow-sm border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md"}
      `,children:[e.jsxs("div",{className:`flex-1 w-full relative group ${l?"shadow-lg rounded-2xl":""}`,children:[e.jsx("input",{type:"text",value:t.search,onChange:u=>A("search",u.target.value),placeholder:l?"Buscar locais ou demandas...":"Buscar por título, nome ou celular...",className:`
                    w-full pl-11 pr-4 py-3 outline-none transition-all font-medium text-slate-700 dark:text-white placeholder:text-slate-400
                    ${l?"bg-white/95 dark:bg-[#1e293b]/95 border-0 rounded-2xl shadow-md focus:ring-2 ring-brand-500/50":"bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl focus:border-brand-500 focus:bg-white dark:focus:bg-black/20"}
                `}),e.jsx(st,{className:"w-5 h-5 text-slate-400 absolute left-3.5 top-3.5 group-focus-within:text-brand-500 transition-colors"}),t.search&&e.jsx("button",{onClick:()=>A("search",""),className:"absolute right-3 top-3.5 text-slate-400 hover:text-slate-600 dark:hover:text-white",children:e.jsx(Pe,{className:"w-5 h-5"})})]}),l&&v&&i&&e.jsx("div",{className:"w-full md:w-auto min-w-[200px] shadow-lg rounded-xl",children:e.jsx(Re,{value:i,onChange:u=>v(u),options:[{value:"demands",label:"Demandas",icon:et},{value:"citizens",label:"Cidadãos",icon:Ve}]})}),l?e.jsx("div",{className:"hidden md:flex",children:e.jsx("button",{onClick:()=>k(!N),className:"w-12 h-12 bg-white dark:bg-slate-800 text-slate-600 dark:text-white rounded-2xl shadow-lg flex items-center justify-center hover:bg-slate-50 transition-transform active:scale-95",children:e.jsx(Ot,{className:"w-5 h-5"})})}):e.jsxs("div",{className:"flex w-full md:w-auto gap-2",children:[e.jsxs("button",{onClick:()=>k(!N),className:`flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-3 rounded-xl font-bold transition-all border ${N||H>0?"bg-brand-500 text-white border-brand-500 shadow-lg shadow-brand-500/20":"bg-white dark:bg-white/5 text-slate-600 dark:text-white/70 border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}`,children:[e.jsx(Ot,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Filtros"}),H>0&&e.jsx("span",{className:"bg-white text-brand-600 text-[10px] w-5 h-5 flex items-center justify-center rounded-full ml-1 shadow-sm",children:H})]}),n&&e.jsx("button",{onClick:n,className:"w-[46px] h-[46px] bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 rounded-xl flex items-center justify-center shrink-0 transition-all",title:"Exportar Dados",children:e.jsx(ka,{className:"w-5 h-5"})})]})]}),l&&i!=="citizens"&&e.jsxs("div",{className:"flex overflow-x-auto gap-2 pb-2 -mx-4 px-4 md:mx-0 md:px-0 scrollbar-none snap-x",children:[e.jsx(ct,{label:"Pendentes",icon:Ne,isActive:t.status.includes(F.PENDING),onClick:()=>D(F.PENDING)}),e.jsx(ct,{label:"Alta Prioridade",icon:gt,isActive:t.priority.includes(ee.HIGH),onClick:()=>I(ee.HIGH)}),e.jsx(ct,{label:"Em Andamento",icon:Ze,isActive:t.status.includes(F.IN_PROGRESS),onClick:()=>D(F.IN_PROGRESS)}),e.jsx(ct,{label:"Hoje",icon:ke,isActive:!!t.startDate,onClick:V})]}),(!l||l&&window.innerWidth>=768)&&H>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center px-1",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase text-slate-400 dark:text-white/40 mr-1 flex items-center gap-1",children:[e.jsx(Tt,{className:"w-3 h-3"})," Ativos:"]}),_&&t.status.map(u=>e.jsx(Qe,{label:`Status: ${u}`,onRemove:()=>g("status",u)},`status-${u}`)),_&&t.priority.map(u=>e.jsx(Qe,{label:`Prioridade: ${u}`,onRemove:()=>g("priority",u)},`prio-${u}`)),_&&t.level.map(u=>e.jsx(Qe,{label:`Esfera: ${u}`,onRemove:()=>g("level",u)},`lvl-${u}`)),_&&((ge=t.tags)==null?void 0:ge.map(u=>e.jsx(Qe,{label:`Tag: ${u}`,onRemove:()=>g("tags",u)},`tag-${u}`))),_&&t.responsibleId&&e.jsx(Qe,{label:`Resp: ${j(t.responsibleId)}`,onRemove:()=>g("responsibleId")}),t.startDate&&e.jsx(Qe,{label:`${E[t.dateType]}: ${X}`,onRemove:()=>g("startDate")}),e.jsxs("button",{onClick:T,className:"text-[10px] font-bold text-red-500 hover:text-red-600 ml-auto hover:bg-red-50 dark:hover:bg-red-900/20 px-2 py-1 rounded transition-colors flex items-center gap-1",children:[e.jsx(Na,{className:"w-3 h-3"})," Limpar"]})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10 bg-slate-900/30 backdrop-blur-sm transition-opacity",onClick:()=>k(!1)}),e.jsxs("div",{ref:G,className:`
                    absolute z-[60] glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white dark:bg-[#0f172a] shadow-2xl animate-in slide-in-from-top-2 duration-200 overflow-hidden
                    w-full md:w-[800px] md:right-0 md:left-auto
                    ${l?"top-[70px]":"top-[calc(100%+12px)]"}
                `,children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2 text-sm",children:[e.jsx(Tt,{className:"w-4 h-4 text-brand-500"})," Filtros Avançados"]}),e.jsx("button",{onClick:()=>k(!1),className:"p-1.5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Pe,{className:"w-4 h-4 text-slate-500 dark:text-white/60"})})]}),e.jsxs("div",{className:`p-6 grid gap-8 max-h-[70vh] overflow-y-auto custom-scrollbar ${_?"grid-cols-1 md:grid-cols-3":"grid-cols-1"}`,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Período"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Re,{options:["createdAt","updatedAt","deadline"].map(u=>({value:u,label:E[u]})),value:t.dateType,onChange:u=>A("dateType",u),size:"sm"}),e.jsxs("div",{className:"relative",ref:C,children:[e.jsx("button",{onClick:()=>M(!y),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl text-sm font-bold transition-all border ${t.startDate?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-900/20 dark:border-brand-500/30 dark:text-brand-300":"bg-slate-50 dark:bg-white/5 border-slate-200 dark:border-white/10 text-slate-600 dark:text-white/70 hover:bg-slate-100"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 opacity-70"})," ",X]})}),y&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-72 bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 p-4 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>f(new Date(c.getFullYear(),c.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(qe,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-bold text-sm",children:[S[c.getMonth()]," ",c.getFullYear()]}),e.jsx("button",{onClick:()=>f(new Date(c.getFullYear(),c.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Xe,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["D","S","T","Q","Q","S","S"].map(u=>e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:u},u))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:m(c.getFullYear(),c.getMonth())}).map((u,W)=>e.jsx("div",{},`empty-${W}`)),Array.from({length:P(c.getFullYear(),c.getMonth())}).map((u,W)=>{const te=W+1,ne=p(te);return e.jsx("button",{onClick:()=>L(te),className:`h-8 w-8 rounded-full text-xs font-medium transition-all ${ne==="start"||ne==="end"?"bg-brand-500 text-white shadow-lg":ne==="range"?"bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 rounded-none":"hover:bg-slate-100 dark:hover:bg-white/10"}`,children:te},te)})]})]})]})]})]}),_&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Classificação"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(it,{options:Q,selectedValues:t.status,onChange:u=>A("status",u),placeholder:"Todos Status",label:"Status"}),e.jsx(it,{options:ae,selectedValues:t.priority,onChange:u=>A("priority",u),placeholder:"Todas Prioridades",label:"Prioridade"}),e.jsx(it,{options:w,selectedValues:t.level,onChange:u=>A("level",u),placeholder:"Todas Esferas",label:"Esfera"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Contexto"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:"Responsável"}),e.jsxs("div",{className:"relative",children:[e.jsx(pt,{className:"w-4 h-4 text-slate-400 absolute left-3 top-3 pointer-events-none"}),e.jsxs("select",{value:t.responsibleId||"",onChange:u=>A("responsibleId",u.target.value||void 0),className:"w-full pl-9 pr-8 py-2.5 bg-slate-50 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-xl text-sm outline-none focus:border-brand-500 font-bold text-slate-700 dark:text-white appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"Todos os Responsáveis"}),o.map(u=>e.jsxs("option",{value:u.id,children:[u.nome," (",z(u.perfil),")"]},u.id))]}),e.jsx("div",{className:"absolute right-3 top-3 pointer-events-none text-slate-400 text-xs",children:"▼"})]})]}),e.jsx(it,{options:B,selectedValues:t.tags||[],onChange:u=>A("tags",u),placeholder:"Filtrar por Tags",label:"Etiquetas (Tags)"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5 flex justify-end gap-3",children:[e.jsx("button",{onClick:T,className:"px-4 py-2 text-xs font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-xl transition-colors",children:"Limpar Tudo"}),e.jsx("button",{onClick:()=>k(!1),className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold text-sm shadow-lg shadow-brand-500/20 transition-all active:scale-95",children:"Aplicar Filtros"})]})]})]})]})},Me=$e.memo(({title:t,value:s,icon:n,colorClass:o,textClass:h,trend:l,subValue:i,isLoading:v=!1})=>e.jsx("div",{className:"glass-panel p-3 md:p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex flex-col justify-between hover:bg-white/60 dark:hover:bg-white/5 transition-colors group min-h-[100px] will-change-transform relative overflow-hidden",children:v?e.jsxs("div",{className:"animate-pulse flex flex-col justify-between h-full w-full",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx("div",{className:"w-8 h-8 rounded-xl bg-slate-200 dark:bg-white/10"})}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-6 w-16 bg-slate-200 dark:bg-white/10 rounded"}),e.jsx("div",{className:"h-3 w-24 bg-slate-200 dark:bg-white/10 rounded"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:`p-2 rounded-xl ${o} bg-opacity-10 shrink-0`,children:e.jsx(n,{className:`w-4 h-4 ${h}`})}),l&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-bold text-emerald-600 bg-emerald-100 dark:bg-emerald-500/20 px-1.5 py-0.5 rounded-full border border-emerald-200 dark:border-emerald-500/10",children:[e.jsx(ya,{className:"w-3 h-3"})," ",l]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-800 dark:text-white tracking-tight block",children:i||s}),e.jsx("span",{className:`block text-[10px] font-bold uppercase tracking-wider opacity-70 ${h} mt-1`,children:t})]})]})})),ws=({demandId:t,entityId:s,tableName:n="demands",lat:o,lon:h,address:l,onClick:i,onLocationUpdate:v,status:N,priority:k})=>{const[y,M]=a.useState(null),[c,f]=a.useState(!1),C=s||t,G=()=>n==="citizens"?"blue":N===F.COMPLETED?"green":k===ee.HIGH?"red":N===F.IN_PROGRESS?"orange":k===ee.MEDIUM?"gold":"blue",A=new Oe.Icon({iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${G()}.png`,shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});if(a.useEffect(()=>{if(o&&h){M({lat:o,lon:h});return}if(l&&(!o||!h)){f(!0);const D=setTimeout(async()=>{try{const I=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(l)}&limit=1`,V=await fetch(I,{headers:{"User-Agent":"GabineteDigitalApp/1.0"}});if(!V.ok)throw new Error("Falha na requisição de geocodificação");const z=await V.json();if(z&&z.length>0){const j=parseFloat(z[0].lat),S=parseFloat(z[0].lon);if(M({lat:j,lon:S}),ie()&&R&&C){const{error:P}=await R.from(n).update({lat:j,lon:S}).eq("id",C);!P&&v&&v(j,S)}}}catch(I){console.error("Geocoding error:",I)}finally{f(!1)}},1500);return()=>clearTimeout(D)}},[o,h,l,C,n]),!y&&!c)return e.jsxs("div",{className:"w-full h-full bg-slate-100 dark:bg-white/5 flex flex-col items-center justify-center text-slate-400 rounded-xl border border-slate-200 dark:border-white/10 min-h-[150px]",children:[e.jsx(je,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("span",{className:"text-xs",children:"Sem localização GPS"})]});const T=g=>{g.preventDefault(),g.stopPropagation(),i()};return e.jsxs("div",{className:"relative w-full h-48 rounded-xl overflow-hidden border border-slate-200 dark:border-white/10 group cursor-pointer bg-slate-50 dark:bg-white/5",onClick:T,children:[c&&e.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[1000] animate-in fade-in zoom-in-95 duration-200 pointer-events-none",children:e.jsxs("div",{className:"bg-white/90 dark:bg-slate-800/90 backdrop-blur-md px-4 py-2 rounded-full shadow-xl border border-brand-100 dark:border-white/10 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 animate-spin text-brand-600"}),e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-white",children:"Carregando mapa..."})]})}),y?e.jsxs(e.Fragment,{children:[e.jsxs(Kt,{center:[y.lat,y.lon],zoom:15,scrollWheelZoom:!1,zoomControl:!1,dragging:!1,doubleClickZoom:!1,attributionControl:!1,style:{width:"100%",height:"100%"},children:[e.jsx(Qt,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'© <a href="https://carto.com/attributions">CARTO</a>'}),e.jsx(Xt,{position:[y.lat,y.lon],icon:A})]},`${y.lat}-${y.lon}-${G()}`),e.jsx("div",{className:"absolute inset-0 z-[500] bg-transparent",onClick:T})]}):e.jsx("div",{className:"w-full h-full bg-slate-100/50 dark:bg-white/5 flex items-center justify-center"}),!c&&e.jsx("div",{className:"absolute inset-0 bg-brand-900/0 group-hover:bg-brand-900/10 transition-colors z-[600] flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"bg-white/90 dark:bg-black/80 backdrop-blur-md px-3 py-1.5 rounded-full text-xs font-bold text-slate-900 dark:text-white opacity-0 group-hover:opacity-100 transition-all transform translate-y-2 group-hover:translate-y-0 duration-200 shadow-lg border border-slate-200 dark:border-white/10 flex items-center gap-2",children:[e.jsx(Ca,{className:"w-3 h-3"})," Ver no Mapa Global"]})})]})},vs=({demand:t,citizen:s,onClose:n,onEdit:o,onUpdateStatus:h,onInteractionUpdate:l,onNavigate:i,canNavigatePrev:v,canNavigateNext:N,onNotification:k,onViewCitizen:y})=>{const[M,c]=a.useState([]),[f,C]=a.useState(!1),[G,A]=a.useState([]),[T,g]=a.useState(""),[D,I]=a.useState(""),[V,z]=a.useState(""),[j,S]=a.useState(!1),[P,m]=a.useState(t.tags||[]),[L,q]=a.useState(""),[$,p]=a.useState(!1),H=a.useRef(null),[X,E]=a.useState(!1),[w,Q]=a.useState(new Date),ae=a.useRef(null),B=a.useMemo(()=>{const x=localStorage.getItem("geo_user");return x?JSON.parse(x):{name:"Usuário"}},[]);a.useEffect(()=>{_(),A([]),m(t.tags||[])},[t.id,t.status]),a.useEffect(()=>{const x=O=>{ae.current&&!ae.current.contains(O.target)&&E(!1),$&&H.current&&!H.current.contains(O.target)&&O.target.tagName!=="BUTTON"&&p(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[$]);const _=async()=>{C(!0);try{if(ie()&&R){const{data:x,error:O}=await R.from("demand_interactions").select("*").eq("demanda_id",t.id).order("created_at",{ascending:!1});if(O)throw O;x&&c(x.map(U=>({id:U.id,demandId:U.demanda_id,type:U.tipo,text:U.texto,isCompleted:U.concluido,deadline:U.prazo,user:U.usuario,createdAt:U.created_at})))}}catch(x){console.error("Erro ao carregar interações",x)}finally{C(!1)}},re=async x=>{const O=x==="comentario"?T:D;if(!O.trim())return;const U=crypto.randomUUID(),ce={id:U,demandId:t.id,type:x,text:O,isCompleted:!1,deadline:x==="checklist"&&V?V:void 0,user:B.name,createdAt:new Date().toISOString()};c(le=>[ce,...le]),A(le=>[...le,U]),x==="comentario"&&g(""),x==="checklist"&&(I(""),z(""),S(!1));try{if(ie()&&R){const le={demanda_id:t.id,tipo:x,texto:O,usuario:B.name};x==="checklist"&&(le.concluido=!1,le.prazo=V||null);const{data:xe,error:me}=await R.from("demand_interactions").insert(le).select().single();if(me)throw me;xe&&(c(Te=>Te.map(ve=>ve.id===U?{...ve,id:xe.id,createdAt:xe.created_at}:ve)),A(Te=>[...Te.filter(ve=>ve!==U),xe.id]),setTimeout(()=>{A(Te=>Te.filter(ve=>ve!==xe.id))},3e3),l&&l())}}catch(le){console.error("Erro ao salvar interação",le),k&&k("error","Erro ao salvar interação"),c(xe=>xe.filter(me=>me.id!==U)),A(xe=>xe.filter(me=>me!==U))}},ge=async(x,O)=>{c(U=>U.map(ce=>ce.id===x?{...ce,isCompleted:!O}:ce));try{ie()&&R&&(await R.from("demand_interactions").update({concluido:!O}).eq("id",x),l&&l())}catch(U){console.error("Erro ao atualizar checklist",U),k&&k("error","Erro ao atualizar checklist"),c(ce=>ce.map(le=>le.id===x?{...le,isCompleted:O}:le))}},u=async x=>{c(O=>O.filter(U=>U.id!==x));try{ie()&&R&&(await R.from("demand_interactions").delete().eq("id",x),l&&l())}catch(O){console.error(O)}},W=async()=>{if(!L.trim())return;const x=[...P,L.trim()];m(x),q(""),p(!1);try{ie()&&R&&(await R.from("demands").update({tags:x}).eq("id",t.id),l&&l())}catch(O){console.error(O)}},te=async x=>{const O=P.filter(U=>U!==x);m(O);try{ie()&&R&&(await R.from("demands").update({tags:O}).eq("id",t.id),l&&l())}catch(U){console.error(U)}},ne=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],Le=(x,O)=>new Date(x,O+1,0).getDate(),he=(x,O)=>new Date(x,O,1).getDay(),Fe=x=>{const O=new Date(w.getFullYear(),w.getMonth(),x),U=O.getFullYear(),ce=String(O.getMonth()+1).padStart(2,"0"),le=String(O.getDate()).padStart(2,"0");z(`${U}-${ce}-${le}`),E(!1)},fe=M.filter(x=>x.type==="checklist"),De=M.filter(x=>x.type==="comentario"||x.type==="status_change"),Ye=a.useMemo(()=>{if(fe.length===0)return 0;const x=fe.filter(O=>O.isCompleted).length;return Math.round(x/fe.length*100)},[fe]),Ue=[{value:F.PENDING,label:"Pendente",icon:Ne},{value:F.IN_PROGRESS,label:"Em Andamento",icon:Ze},{value:F.COMPLETED,label:"Concluído",icon:ze}],Ee=x=>{switch(x){case F.PENDING:return 1;case F.IN_PROGRESS:return 2;case F.COMPLETED:return 3;default:return 1}},we=x=>{if(x===F.PENDING)return new Date(t.createdAt);const O=M.find(U=>U.type==="status_change"&&(U.text.includes(`para "${x}"`)||U.text.includes(`para ${x}`)));return O?new Date(O.createdAt):null},ye=x=>{const O=x.replace(/\D/g,"");window.open(`https://wa.me/55${O}`,"_blank")},Ce=x=>{window.open(`mailto:${x}`,"_blank")},Ie=()=>{setTimeout(()=>{const x=new CustomEvent("navigate-to-map",{detail:{demandId:t.id,lat:t.lat,lon:t.lon}});window.dispatchEvent(x)},0),n()},Ge=s?`${s.logradouro}, ${s.numero} - ${s.bairro}, ${s.cidade} - ${s.estado}`:void 0;return e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-end md:items-center justify-center sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity duration-300",onClick:n}),e.jsxs("div",{className:"relative w-full h-full md:h-[90vh] md:max-w-6xl bg-white dark:bg-[#0b1121] md:rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in slide-in-from-bottom-10 md:zoom-in-95 duration-300 border-t md:border border-slate-200 dark:border-white/10",children:[e.jsxs("div",{className:"px-4 py-3 md:px-8 md:py-5 border-b border-slate-200 dark:border-white/10 flex items-start justify-between bg-white/90 dark:bg-[#0b1121]/90 backdrop-blur-md z-20 shrink-0 sticky top-0",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 flex-wrap",children:[e.jsx("button",{onClick:n,className:"mr-2 p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors md:hidden",children:e.jsx(qe,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-white/40 font-mono",children:["#",t.id.slice(0,8)]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold uppercase border ${t.priority===ee.HIGH?"bg-red-50 text-red-600 border-red-100 dark:bg-red-500/10 dark:text-red-300 dark:border-red-500/20":t.priority===ee.MEDIUM?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-300 dark:border-amber-500/20":"bg-green-50 text-green-600 border-green-100 dark:bg-green-500/10 dark:text-green-300 dark:border-green-500/20"}`,children:t.priority})]}),e.jsx("h2",{className:"text-lg md:text-2xl font-bold text-slate-900 dark:text-white leading-tight line-clamp-1",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsxs("div",{className:"hidden md:flex items-center bg-slate-100 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10 mr-2",children:[e.jsx("button",{onClick:()=>i("prev"),disabled:!v,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors border-r border-slate-200 dark:border-white/10",title:"Demanda Anterior",children:e.jsx(qe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>i("next"),disabled:!N,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors",title:"Próxima Demanda",children:e.jsx(Xe,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>{o(t),n()},className:"p-2 md:p-2.5 text-slate-500 hover:text-brand-600 hover:bg-slate-100 rounded-xl transition-colors dark:text-white/50 dark:hover:text-white dark:hover:bg-white/10",title:"Editar",children:e.jsx(Sa,{className:"w-5 h-5"})}),e.jsx("button",{onClick:n,className:"p-2 md:p-2.5 text-slate-400 hover:text-slate-800 hover:bg-slate-100 rounded-full transition-colors dark:text-white/40 dark:hover:text-white dark:hover:bg-white/10",children:e.jsx(Pe,{className:"w-6 h-6"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50/30 dark:bg-black/20 custom-scrollbar overscroll-contain flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 p-4 md:p-8 space-y-6 md:space-y-8 min-w-0",children:[e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex justify-between items-start relative px-4 md:px-12 mb-8 mt-2",children:[e.jsx("div",{className:"absolute top-3 left-4 right-4 md:left-12 md:right-12 h-0.5 bg-slate-200 dark:bg-white/10 -z-10"}),Ue.map((x,O)=>{const U=Ee(t.status),ce=O+1,le=ce<=U,xe=ce===U,me=we(x.value);return e.jsxs("div",{className:"flex flex-col items-center gap-2 group bg-transparent",children:[e.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center border-4 transition-all duration-500 z-10 bg-white dark:bg-slate-900 ${le?"border-brand-500":"border-slate-300 dark:border-white/20"} ${xe?"ring-4 ring-brand-100 dark:ring-brand-500/20 scale-110":""}`,children:e.jsx("div",{className:`w-2.5 h-2.5 rounded-full transition-colors duration-500 ${le?"bg-brand-500":"bg-slate-300 dark:bg-white/20"}`})}),e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${xe?"text-brand-600 dark:text-brand-400":"text-slate-500 dark:text-white/40"}`,children:x.label}),me&&e.jsxs("span",{className:"text-[9px] text-slate-400 dark:text-white/30 font-medium h-3 mt-0.5",children:[me.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})," ",me.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]})]},x.value)})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx($t,{className:"w-4 h-4"})," Descrição"]})}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 md:p-6 shadow-sm",children:[e.jsx("p",{className:"text-sm md:text-base text-slate-700 dark:text-slate-200 leading-relaxed whitespace-pre-line",children:t.description}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-white/5 flex flex-wrap gap-2 items-center",children:[e.jsx(Da,{className:"w-4 h-4 text-slate-400"}),P.map(x=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1 group",children:[x,e.jsx(Pe,{onClick:()=>te(x),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500 hidden group-hover:block"})]},x)),$?e.jsxs("div",{className:"flex items-center gap-2",ref:ae,children:[e.jsx("input",{ref:H,autoFocus:!0,type:"text",value:L,onChange:x=>q(x.target.value),className:"w-24 px-2 py-1 text-xs border rounded-lg outline-none",placeholder:"Nova tag...",onKeyDown:x=>{x.key==="Enter"&&W(),x.key==="Escape"&&p(!1)}}),e.jsx("button",{onClick:W,className:"text-xs font-bold text-brand-600",children:"OK"})]}):e.jsxs("button",{onClick:()=>p(!0),className:"text-xs text-slate-400 hover:text-brand-600 flex items-center gap-1 px-2 py-1 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(bt,{className:"w-3 h-3"})," Adicionar"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(je,{className:"w-4 h-4"})," Localização"]}),e.jsx(ws,{demandId:t.id,lat:t.lat,lon:t.lon,address:Ge,onClick:Ie,onLocationUpdate:l,status:t.status,priority:t.priority})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Vt,{className:"w-4 h-4"})," Checklist"]}),fe.length>0&&e.jsxs("span",{className:"text-xs font-mono text-slate-400 dark:text-white/40",children:[Math.round(Ye),"%"]})]}),fe.length>0&&e.jsx("div",{className:"h-1.5 w-full bg-slate-200 dark:bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-500",style:{width:`${Ye}%`}})}),e.jsxs("div",{className:"space-y-2",children:[fe.map(x=>e.jsxs("div",{className:"flex items-start gap-3 group bg-white dark:bg-white/5 p-3 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 dark:hover:border-white/10 transition-colors",children:[e.jsx("button",{onClick:()=>ge(x.id,x.isCompleted||!1),className:`mt-0.5 w-5 h-5 rounded-lg border flex items-center justify-center transition-all ${x.isCompleted?"bg-green-500 border-green-500 text-white":"bg-white dark:bg-transparent border-slate-300 dark:border-white/20 hover:border-brand-500 text-transparent hover:text-brand-500/20"}`,children:e.jsx(nt,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm transition-all font-medium ${x.isCompleted?"text-slate-400 line-through dark:text-white/30":"text-slate-800 dark:text-white"}`,children:x.text}),(x.deadline||x.isCompleted)&&e.jsx("div",{className:"flex items-center gap-2 mt-1.5",children:x.deadline&&e.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold uppercase flex items-center gap-1 ${x.isCompleted?"bg-slate-100 text-slate-400 dark:bg-white/5":new Date(x.deadline)<new Date?"bg-red-100 text-red-600 dark:bg-red-500/20 dark:text-red-300":"bg-slate-100 text-slate-500 dark:bg-white/10 dark:text-white/60"}`,children:[e.jsx(ke,{className:"w-3 h-3"})," ",at(x.deadline)]})})]}),e.jsx("button",{onClick:()=>u(x.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",children:e.jsx(Mt,{className:"w-4 h-4"})})]},x.id)),j?e.jsxs("div",{className:"bg-white dark:bg-white/5 p-4 rounded-xl border border-brand-500/30 shadow-lg ring-1 ring-brand-500/10 animate-in fade-in zoom-in-95",children:[e.jsx("input",{type:"text",autoFocus:!0,value:D,onChange:x=>I(x.target.value),placeholder:"Descreva a tarefa...",className:"w-full bg-transparent border-none outline-none text-sm text-slate-900 dark:text-white placeholder:text-slate-400 mb-4 font-medium",onKeyDown:x=>x.key==="Enter"&&re("checklist")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 border-t border-slate-100 dark:border-white/5 pt-3",children:[e.jsxs("div",{className:"relative w-full sm:w-auto",ref:ae,children:[e.jsxs("button",{onClick:()=>E(!X),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all border ${V?"bg-brand-50 text-brand-700 border-brand-200 dark:bg-brand-500/20 dark:text-brand-300 dark:border-brand-500/30":"bg-slate-50 text-slate-500 border-slate-200 dark:bg-white/5 dark:text-white/50 dark:border-white/10 hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),V?at(V):"Definir Prazo"]}),X&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-64 glass-panel bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 p-3 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:()=>Q(new Date(w.getFullYear(),w.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(qe,{className:"w-4 h-4 text-slate-600 dark:text-white"})}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white text-xs",children:[ne[w.getMonth()]," ",w.getFullYear()]}),e.jsx("button",{onClick:()=>Q(new Date(w.getFullYear(),w.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Xe,{className:"w-4 h-4 text-slate-600 dark:text-white"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-1",children:["D","S","T","Q","Q","S","S"].map(x=>e.jsx("span",{className:"text-[9px] font-bold text-slate-400 dark:text-white/40",children:x},x))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:he(w.getFullYear(),w.getMonth())}).map((x,O)=>e.jsx("div",{},`empty-${O}`)),Array.from({length:Le(w.getFullYear(),w.getMonth())}).map((x,O)=>{const U=O+1,ce=V&&new Date(V).getDate()===U&&new Date(V).getMonth()===w.getMonth();return e.jsx("button",{onClick:()=>Fe(U),className:`h-6 w-6 rounded-full text-[10px] font-medium flex items-center justify-center transition-all ${ce?"bg-brand-500 text-white":"text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:U},U)})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-end",children:[e.jsx("button",{onClick:()=>S(!1),className:"px-3 py-1.5 text-xs font-bold text-slate-500 hover:text-slate-700 dark:text-white/60 dark:hover:text-white",children:"Cancelar"}),e.jsx("button",{onClick:()=>re("checklist"),className:"px-4 py-1.5 bg-brand-600 text-white text-xs font-bold rounded-lg hover:bg-brand-500 shadow-sm",children:"Salvar Item"})]})]})]}):e.jsxs("button",{onClick:()=>S(!0),className:"flex items-center justify-center gap-2 text-sm text-slate-500 dark:text-white/50 hover:text-brand-600 dark:hover:text-brand-400 transition-colors px-4 py-3 rounded-xl border border-dashed border-slate-300 dark:border-white/10 hover:border-brand-300 dark:hover:border-brand-500/30 hover:bg-slate-50 dark:hover:bg-white/5 w-full group",children:[e.jsx(bt,{className:"w-4 h-4 group-hover:scale-110 transition-transform"})," Adicionar item ao checklist"]})]})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Ea,{className:"w-4 h-4"})," Comentários e Histórico"]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-3 md:p-4 bg-slate-50 dark:bg-white/5 border-b border-slate-200 dark:border-white/10 flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold text-xs shrink-0",children:B.name.charAt(0)}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:T,onChange:x=>g(x.target.value),placeholder:"Escreva um comentário...",className:"w-full bg-white dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl pl-4 pr-10 py-2.5 text-sm outline-none focus:border-brand-500 transition-all text-slate-900 dark:text-white shadow-sm",onKeyDown:x=>x.key==="Enter"&&re("comentario")}),e.jsx("button",{onClick:()=>re("comentario"),disabled:!T.trim(),className:"absolute right-2 top-2 p-1 text-slate-400 hover:text-brand-600 disabled:opacity-30 transition-colors",children:e.jsx(Ia,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-white/5 max-h-[300px] overflow-y-auto custom-scrollbar",children:De.length===0?e.jsx("div",{className:"p-6 text-center text-slate-400 dark:text-white/30 text-sm italic",children:"Nenhum comentário ou registro de atividade."}):De.map(x=>e.jsxs("div",{className:`p-4 flex gap-3 hover:bg-slate-50 dark:hover:bg-white/5 transition-colors group ${G.includes(x.id)?"bg-amber-50 dark:bg-amber-500/10 animate-pulse duration-1000":""}`,children:[x.type==="status_change"?e.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-100 dark:bg-amber-500/20 flex items-center justify-center text-amber-600 dark:text-amber-400 font-bold text-xs shrink-0 border border-amber-200 dark:border-amber-500/20",children:e.jsx(Ne,{className:"w-4 h-4"})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs shrink-0 border border-slate-300 dark:border-white/10",children:x.user.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-slate-900 dark:text-white",children:x.user}),e.jsx("span",{className:"text-[10px] text-slate-400",children:new Date(x.createdAt).toLocaleString()})]}),e.jsx("p",{className:`text-sm leading-relaxed break-words p-3 rounded-tr-xl rounded-br-xl rounded-bl-xl border ${x.type==="status_change"?"bg-amber-50/50 dark:bg-amber-900/10 text-slate-600 dark:text-slate-300 border-amber-100 dark:border-amber-500/10 italic":"bg-slate-50 dark:bg-white/5 text-slate-600 dark:text-slate-300 border-slate-100 dark:border-white/5"}`,children:x.text})]}),x.type==="comentario"&&e.jsx("button",{onClick:()=>u(x.id),className:"opacity-0 group-hover:opacity-100 self-start p-2 text-slate-300 hover:text-red-500 transition-all",children:e.jsx(Mt,{className:"w-4 h-4"})})]},x.id))})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white/50 dark:bg-black/20 border-t md:border-t-0 md:border-l border-slate-200 dark:border-white/10 p-4 md:p-6 space-y-6 md:h-auto overflow-y-auto",children:[e.jsxs("div",{className:"hidden md:block",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 mb-3 block",children:"Status"}),e.jsx("div",{className:"bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex flex-col relative border border-slate-200 dark:border-white/5 gap-1",children:Ue.map(x=>{const O=t.status===x.value;return e.jsxs("button",{onClick:()=>h(t.id,x.value),className:`
                                                w-full py-2.5 px-3 text-sm font-bold rounded-lg transition-all duration-300 flex items-center gap-3
                                                ${O?"bg-white dark:bg-white/10 text-brand-600 dark:text-white shadow-sm ring-1 ring-slate-200 dark:ring-white/10":"text-slate-500 dark:text-white/40 hover:bg-slate-200 dark:hover:bg-white/5"}
                                            `,children:[e.jsx(x.icon,{className:`w-4 h-4 ${O?"text-brand-500 dark:text-brand-400":"opacity-50"}`}),x.label]},x.value)})})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4 space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40 mb-2",children:"Datas"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-500 dark:text-white/50",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Criado em"}),e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white",children:new Date(t.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${t.deadline?"bg-brand-100 dark:bg-brand-500/20 text-brand-600 dark:text-brand-400":"bg-slate-100 dark:bg-white/10 text-slate-500"}`,children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Prazo Demanda"}),e.jsx("p",{className:`text-sm font-bold ${t.deadline?"text-slate-800 dark:text-white":"text-slate-400 italic"}`,children:at(t.deadline)||"Sem prazo"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40",children:"Solicitante"})}),s?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-white/5 p-2 -ml-2 rounded-xl transition-colors group",onClick:()=>y&&y(s.id),title:"Ver perfil do cidadão",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-sm shadow-inner shrink-0",children:s.name.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-bold text-slate-900 dark:text-white truncate group-hover:text-brand-600 transition-colors flex items-center gap-1",children:[s.name,e.jsx(Ta,{className:"w-3 h-3 opacity-0 group-hover:opacity-100"})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:We(s.phone)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.phone&&e.jsxs("button",{onClick:()=>ye(s.phone),className:"flex-1 py-1.5 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Conversar no WhatsApp",children:[e.jsx(Aa,{className:"w-3.5 h-3.5"})," WhatsApp"]}),s.email&&e.jsxs("button",{onClick:()=>Ce(s.email),className:"flex-1 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Enviar Email",children:[e.jsx(Bt,{className:"w-3.5 h-3.5"})," Email"]})]})]}):e.jsx("div",{className:"text-center py-4 text-slate-400 text-xs italic",children:"Nenhum solicitante vinculado."})]})]})]})]})]})},js=({demands:t,citizens:s,interactions:n=[],onViewDemand:o,onEditDemand:h,onCreateDemand:l,onUpdateStatus:i,onInteractionUpdate:v,initialSelectionId:N,clearSelection:k,initialViewMode:y="list",filters:M,setFilters:c,users:f=[],onNotification:C,defaultLocation:G,onViewCitizen:A,mapMarkers:T,mapFocus:g,initialMapViewMode:D="demands"})=>{const[I,V]=a.useState(y),[z,j]=a.useState("demands"),[S,P]=a.useState([]),[m,L]=a.useState("all"),[q,$]=a.useState(null),p=a.useMemo(()=>{const B=t.length;let _=0,re=0,ge=0;for(const u of t)u.status===F.PENDING?_++:u.status===F.COMPLETED&&re++,u.priority===ee.HIGH&&ge++;return{total:B,pending:_,completed:re,highPriority:ge}},[t]);a.useEffect(()=>{N&&$(N)},[N]),a.useEffect(()=>{y&&V(y)},[y]),a.useEffect(()=>{D&&j(D)},[D]),a.useEffect(()=>{(async()=>{if(ie()&&R){const{data:_}=await R.from("app_config").select("value").eq("key","dashboard_notices").maybeSingle();_&&P(_.value)}else{const _=localStorage.getItem("geo_notices");_&&P(JSON.parse(_))}})()},[]);const H=B=>{if(L(B),!!c){c(_=>({..._,startDate:"",endDate:""}));return}};a.useEffect(()=>{I==="map"&&c&&H("all")},[I]);const X=B=>{if(!q)return;const _=t.findIndex(re=>re.id===q);_!==-1&&(B==="prev"&&_>0?$(t[_-1].id):B==="next"&&_<t.length-1&&$(t[_+1].id))},E=q?t.findIndex(B=>B.id===q):-1,w=E>0,Q=E!==-1&&E<t.length-1,ae=()=>e.jsx("div",{className:"shrink-0 flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-3",children:[e.jsx(et,{className:"w-8 h-8 text-brand-600 dark:text-brand-400"}),"Gestão de Demandas"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsx("div",{className:"w-full md:w-[280px]",children:e.jsx(Re,{value:I,onChange:B=>V(B),options:[{value:"list",label:"Lista",icon:Pa},{value:"board",label:"Quadro",icon:$a},{value:"calendar",label:"Calendário",icon:La}]})}),e.jsxs("button",{onClick:l,className:"w-full sm:w-auto px-5 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 transition-all flex items-center justify-center gap-2 active:scale-95 h-11 shrink-0",children:[e.jsx(Ht,{className:"w-5 h-5"}),e.jsx("span",{className:"whitespace-nowrap",children:"Nova Demanda"})]})]})]})});return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500 relative",children:[e.jsxs("div",{className:"flex flex-col gap-4 h-full max-w-[1600px] mx-auto w-full",children:[ae(),M&&c&&e.jsx("div",{className:"shrink-0",children:e.jsx(fs,{filters:M,setFilters:c,users:f,isMapMode:I==="map",mapViewMode:z,onMapViewModeChange:j})}),e.jsxs("div",{className:"flex flex-col min-h-0 w-full relative h-full",children:[I!=="calendar"&&I!=="map"&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-4 shrink-0",children:[e.jsx(Me,{title:"Total",value:p.total,icon:Wt,colorClass:"bg-blue-500",textClass:"text-blue-600 dark:text-blue-400"}),e.jsx(Me,{title:"Pendentes",value:p.pending,icon:Ne,colorClass:"bg-slate-500",textClass:"text-slate-600 dark:text-slate-400"}),e.jsx(Me,{title:"Concluídas",value:p.completed,icon:ze,colorClass:"bg-green-500",textClass:"text-green-600 dark:text-green-400"}),e.jsx(Me,{title:"Alta Prioridade",value:p.highPriority,icon:Ze,colorClass:"bg-red-500",textClass:"text-red-600 dark:text-red-400"})]}),e.jsxs("div",{className:"flex-1 min-h-0 w-full relative",children:[I==="list"&&e.jsx(is,{demands:t,citizens:s,onUpdateStatus:i||(()=>{}),onEdit:h,onViewDemand:B=>$(B.id),initialSelectionId:N,clearSelection:k,onInteractionUpdate:v,onNotification:C,onViewCitizen:A}),I==="board"&&e.jsx(ls,{demands:t,citizens:s,onViewDemand:B=>$(B.id),onUpdateStatus:i||(()=>{})}),I==="calendar"&&e.jsx(ns,{demands:t,interactions:n,notices:S,onEditDemand:B=>$(B.id)}),I==="map"&&e.jsx("div",{className:"h-[600px] md:h-full w-full rounded-3xl overflow-hidden border border-slate-200 dark:border-white/10 shadow-sm relative",children:e.jsx(gs,{defaultCenter:G,onViewDemand:B=>$(B),preloadedMarkers:T,currentViewMode:z,onChangeViewMode:j,mapFocus:g})})]})]})]}),q&&e.jsx(vs,{demand:t.find(B=>B.id===q),citizen:s.find(B=>{var _;return B.id===((_=t.find(re=>re.id===q))==null?void 0:_.citizenId)})||null,onClose:()=>{$(null),k&&k()},onEdit:h,onUpdateStatus:i||(()=>{}),onInteractionUpdate:v,onNavigate:X,canNavigatePrev:w,canNavigateNext:Q,onNotification:C,onViewCitizen:A})]})},ks=({locations:t})=>{const[s,n]=a.useState(null),[o,h]=a.useState(!1),l=t.length>0?t[0]:null;a.useEffect(()=>{(async()=>{if(!l){h(!1);return}const y=`weather_cache_${l.lat}_${l.lon}`,M=localStorage.getItem(y),c=new Date().toISOString().slice(0,13);if(M){const f=JSON.parse(M);if(f.hour===c){n(f.data);return}}h(!0);try{const C=await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${l.lat}&longitude=${l.lon}&current=temperature_2m,weather_code&timezone=auto`)).json();n(C),localStorage.setItem(y,JSON.stringify({hour:c,data:C}))}catch(f){console.error("Failed to fetch weather",f)}finally{h(!1)}})()},[l]);const i=k=>k===0?e.jsx(It,{className:"w-6 h-6 text-amber-500"}):k>=1&&k<=3?e.jsx(_a,{className:"w-6 h-6 text-slate-400"}):k>=51&&k<=67?e.jsx(Oa,{className:"w-6 h-6 text-blue-400"}):k>=71&&k<=77?e.jsx(Ma,{className:"w-6 h-6 text-cyan-300"}):e.jsx(It,{className:"w-6 h-6 text-amber-500"});if(o&&l)return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-slate-200/50 dark:bg-white/5 animate-pulse min-w-[140px] h-[46px]",children:[e.jsx(ue,{className:"w-4 h-4 animate-spin text-slate-400"}),e.jsx("div",{className:"h-3 w-16 bg-slate-300 dark:bg-white/10 rounded"})]});if(!l||!s)return null;const v=Math.round(s.current.temperature_2m),N=s.current.weather_code;return e.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 rounded-xl bg-white/60 dark:bg-white/5 backdrop-blur-md border border-slate-200 dark:border-white/10 shadow-sm transition-all hover:bg-white/80 dark:hover:bg-white/10 cursor-default",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i(N),e.jsxs("span",{className:"text-xl font-bold text-slate-900 dark:text-white",children:[v,"°"]})]}),e.jsxs("div",{className:"flex flex-col border-l border-slate-300 dark:border-white/10 pl-4 h-8 justify-center",children:[e.jsxs("span",{className:"text-xs font-bold text-slate-700 dark:text-white uppercase tracking-wide flex items-center gap-1",children:[e.jsx(je,{className:"w-3 h-3 text-brand-600 dark:text-brand-400"}),l.name]}),e.jsx("span",{className:"text-[10px] text-slate-500 dark:text-white/50",children:"Tempo Agora"})]})]})},Ns=({onBack:t,onSuccess:s})=>{const[n,o]=a.useState(""),[h,l]=a.useState("search"),[i,v]=a.useState([]),[N,k]=a.useState(!1),[y,M]=a.useState(""),[c,f]=a.useState(""),[C,G]=a.useState(""),[A,T]=a.useState(!1);a.useEffect(()=>{const D=setTimeout(()=>M(n),500);return()=>clearTimeout(D)},[n]),a.useEffect(()=>{if(!y||y.length<3){v([]);return}(async()=>{if(k(!0),ie()&&R){const I=Be(y),{data:V}=await R.from("citizens").select("*").or(`telefone.ilike.%${I}%,nome.ilike.%${y}%`).limit(5);V&&v(V.map(z=>({id:z.id,name:`${z.nome} ${z.sobrenome}`,phone:z.telefone,bairro:z.bairro,email:z.email||"",createdAt:z.created_at})))}k(!1)})()},[y]);const g=async()=>{if(!c||!n)return;T(!0);const D=Be(n),I=c.trim().split(" "),V=I[0],z=I.slice(1).join(" ")||".";try{if(ie()&&R){const{data:j,error:S}=await R.from("citizens").insert({nome:V,sobrenome:z,telefone:D,bairro:C,origem:"fast_track_mobile"}).select().single();if(S)throw S;j&&s(j.id)}}catch(j){console.error(j),alert("Erro ao criar cidadão rápido.")}finally{T(!1)}};return e.jsxs("div",{className:"fixed inset-0 bg-slate-50 dark:bg-[#020617] z-[100] flex flex-col animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"p-4 flex items-center gap-4 border-b border-slate-200 dark:border-white/10 bg-white dark:bg-[#0b1121]",children:[e.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-white/10",children:e.jsx(Pt,{className:"w-6 h-6 text-slate-600 dark:text-white"})}),e.jsx("h1",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Nova Solicitação"})]}),h==="search"&&e.jsxs("div",{className:"flex-1 p-6 flex flex-col",children:[e.jsx("label",{className:"text-sm font-bold text-slate-500 dark:text-white/50 mb-2 uppercase",children:"Quem está solicitando?"}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("input",{autoFocus:!0,type:"text",value:n,onChange:D=>o(D.target.value),placeholder:"Telefone ou Nome...",className:"w-full text-2xl font-bold bg-transparent border-b-2 border-slate-300 dark:border-white/20 py-2 outline-none focus:border-brand-500 text-slate-900 dark:text-white placeholder:text-slate-300"}),N&&e.jsx(ue,{className:"absolute right-0 top-3 w-6 h-6 animate-spin text-brand-500"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3",children:[i.map(D=>e.jsxs("button",{onClick:()=>s(D.id),className:"w-full text-left p-4 bg-white dark:bg-white/5 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex items-center justify-between active:scale-95 transition-transform",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 dark:bg-brand-500/20 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold",children:D.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:D.name}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:We(D.phone)})]})]}),e.jsx("div",{className:"bg-brand-600 text-white p-2 rounded-xl",children:e.jsx(bt,{className:"w-5 h-5"})})]},D.id)),y.length>3&&e.jsxs("button",{onClick:()=>l("create-citizen"),className:"w-full p-4 mt-4 bg-slate-100 dark:bg-white/5 rounded-2xl border-2 border-dashed border-slate-300 dark:border-white/10 flex items-center justify-center gap-2 text-slate-500 dark:text-white/60 font-bold active:scale-95 transition-transform",children:[e.jsx(Yt,{className:"w-5 h-5"}),'Cadastrar "',n,'"']})]})]}),h==="create-citizen"&&e.jsx("div",{className:"flex-1 p-6 flex flex-col",children:e.jsxs("div",{className:"bg-white dark:bg-white/5 p-6 rounded-3xl border border-slate-200 dark:border-white/10 shadow-lg space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Telefone"}),e.jsx("p",{className:"text-xl font-mono font-bold text-slate-900 dark:text-white border-b border-slate-100 pb-2",children:We(n)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Nome Completo"}),e.jsx("input",{autoFocus:!0,type:"text",value:c,onChange:D=>f(D.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: João da Silva"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Bairro (Opcional)"}),e.jsx("input",{type:"text",value:C,onChange:D=>G(D.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: Centro"})]}),e.jsxs("button",{onClick:g,disabled:A||!c,className:"w-full py-4 bg-brand-600 text-white rounded-xl font-bold text-lg shadow-xl shadow-brand-500/20 flex items-center justify-center gap-2 active:scale-95 transition-transform disabled:opacity-50",children:[A?e.jsx(ue,{className:"w-6 h-6 animate-spin"}):e.jsx(nt,{className:"w-6 h-6"}),"Salvar e Criar Demanda"]})]})})]})},Ae=[{title:"Bem-vindo ao Gabinete Digital",description:"Sua plataforma completa para gestão de mandato. Centralize demandas, cidadãos e inteligência geográfica em um só lugar.",icon:za,color:"bg-blue-500"},{title:"Gestão de Demandas",description:"Acompanhe solicitações em tempo real. Visualize por Lista, Kanban ou Calendário e nunca perca um prazo.",icon:et,color:"bg-brand-500"},{title:"Base de Cidadãos",description:"Conheça seu eleitorado. Mantenha um histórico completo de interações e localização de cada cidadão.",icon:Ve,color:"bg-green-500"},{title:"Mapa Interativo",description:"Inteligência espacial. Identifique problemas por região e tome decisões estratégicas baseadas em dados.",icon:At,color:"bg-purple-500"}],ys=({onFinish:t})=>{const[s,n]=a.useState(0),[o,h]=a.useState("next"),l=()=>{s<Ae.length-1?(h("next"),n(k=>k+1)):v()},i=()=>{s>0&&(h("prev"),n(k=>k-1))},v=()=>{localStorage.setItem("geo_onboarding_completed","true"),t()},N=Ae[s].icon;return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-[#0f172a] rounded-3xl shadow-2xl overflow-hidden border border-white/20 relative flex flex-col",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1.5 bg-slate-100 dark:bg-white/10 z-10",children:e.jsx("div",{className:"h-full bg-brand-500 transition-all duration-500 ease-out",style:{width:`${(s+1)/Ae.length*100}%`}})}),e.jsxs("button",{onClick:v,className:"absolute top-4 right-4 p-2 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors z-20 hover:bg-slate-100 dark:hover:bg-white/10 rounded-full",title:"Pular Tutorial",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider mr-1",children:"Pular"}),e.jsx(Pe,{className:"w-4 h-4 inline-block"})]}),e.jsxs("div",{className:"p-8 flex flex-col items-center text-center flex-1",children:[e.jsxs("div",{className:`flex flex-col items-center animate-in ${o==="next"?"slide-in-from-right-8":"slide-in-from-left-8"} fade-in duration-300 fill-mode-both`,children:[e.jsx("div",{className:`w-24 h-24 rounded-3xl ${Ae[s].color} flex items-center justify-center shadow-xl shadow-brand-500/10 mb-8 transform transition-transform duration-500 hover:scale-105`,children:e.jsx(N,{className:"w-12 h-12 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-4 leading-tight",children:Ae[s].title}),e.jsx("p",{className:"text-slate-500 dark:text-white/60 mb-8 leading-relaxed text-sm md:text-base min-h-[80px]",children:Ae[s].description})]},s),e.jsxs("div",{className:"mt-auto w-full",children:[e.jsx("div",{className:"flex justify-center gap-2 mb-8",children:Ae.map((k,y)=>e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${y===s?"bg-brand-600 w-8":"bg-slate-200 dark:bg-white/10 w-2"}`},y))}),e.jsxs("div",{className:"flex gap-3 items-center",children:[s>0&&e.jsx("button",{onClick:i,className:"p-3.5 rounded-xl border border-slate-200 dark:border-white/10 text-slate-500 dark:text-white hover:bg-slate-50 dark:hover:bg-white/5 transition-colors active:scale-95",children:e.jsx(qe,{className:"w-6 h-6"})}),e.jsxs("button",{onClick:l,className:"flex-1 py-3.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 flex items-center justify-center gap-2 transition-all active:scale-[0.98] group",children:[s===Ae.length-1?"Começar Agora":"Próximo",s===Ae.length-1?e.jsx(nt,{className:"w-5 h-5"}):e.jsx(Xe,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})]})]})]})})},Cs=t=>{const[s,n]=a.useState(navigator.onLine),[o,h]=a.useState(!0),[l,i]=a.useState([]),[v,N]=a.useState([]),[k,y]=a.useState([]),[M,c]=a.useState([]),[f,C]=a.useState([]),[G,A]=a.useState(null),[T,g]=a.useState(null),[D,I]=a.useState(0),V=a.useCallback((S,P)=>{try{const m=localStorage.getItem("geo_map_cache"),L=m?JSON.parse(m):{};let q=!1;P.forEach($=>{$.lat&&$.lon&&!L[$.id]&&(L[$.id]={lat:$.lat,lon:$.lon},q=!0)}),S.forEach($=>{$.lat&&$.lon&&!L[$.id]&&(L[$.id]={lat:$.lat,lon:$.lon},q=!0)}),q&&localStorage.setItem("geo_map_cache",JSON.stringify(L))}catch(m){console.error("Error preloading map cache",m)}},[]),z=a.useCallback(async()=>{if(h(!0),!navigator.onLine){console.log("Offline mode: Loading from cache");const S=localStorage.getItem("cache_demands"),P=localStorage.getItem("cache_citizens"),m=localStorage.getItem("offline_demands_queue");let L=S?JSON.parse(S):[];const q=P?JSON.parse(P):[];m&&(L=[...JSON.parse(m),...L]),i(L),N(q),h(!1);return}if(ie()&&R)try{const[{data:S},{data:P},{data:m},{data:L},{data:q},{data:$},{data:p}]=await Promise.all([R.from("demands").select("*").order("created_at",{ascending:!1}).limit(2e3),R.from("citizens").select("*").limit(3e3),R.from("system_users").select("*"),R.from("demand_interactions").select("*").order("created_at",{ascending:!1}).limit(1e3),R.from("app_config").select("*").eq("key","weather_locations").maybeSingle(),R.from("app_config").select("*").eq("key","global_theme_mode").maybeSingle(),R.from("dashboard_stats").select("*").maybeSingle()]),H=S?S.map(E=>({...E,citizenId:E.citizen_id,createdAt:E.created_at})):[],X=P?P.map(E=>({id:E.id,cpf:E.cpf,name:`${E.nome} ${E.sobrenome}`,email:E.email,phone:E.telefone,createdAt:E.created_at,logradouro:E.logradouro,numero:E.numero,bairro:E.bairro,cidade:E.cidade,estado:E.estado,cep:E.cep,lat:E.lat,lon:E.lon})):[];localStorage.setItem("cache_demands",JSON.stringify(H)),localStorage.setItem("cache_citizens",JSON.stringify(X)),S&&i(H),P&&N(X),m&&y(m),L&&c(L.map(E=>({id:E.id,demandId:E.demanda_id,type:E.tipo,text:E.texto,isCompleted:E.concluido,deadline:E.prazo,user:E.usuario,createdAt:E.created_at}))),q&&C(q.value),p&&A(p),$&&$.value&&g($.value),V(H,X)}catch(S){console.error("Error fetching data, trying cache...",S);const P=localStorage.getItem("cache_demands"),m=localStorage.getItem("cache_citizens");P&&i(JSON.parse(P)),m&&N(JSON.parse(m))}finally{h(!1)}else i([]),h(!1)},[V]),j=a.useCallback(async()=>{const S=localStorage.getItem("offline_demands_queue");if(!S)return 0;const P=JSON.parse(S);if(P.length===0)return 0;if(ie()&&R){console.log(`Syncing ${P.length} offline demands...`);let m=0;for(const L of P)try{const{error:q}=await R.from("demands").insert({id:L.id,title:L.title,description:L.description,level:L.level,status:L.status,priority:L.priority,type:L.type,deadline:L.deadline,citizen_id:L.citizenId,tags:L.tags});q?console.error("Failed to sync item",L.id,q):m++}catch(q){console.error("Error syncing item",q)}return localStorage.removeItem("offline_demands_queue"),I(m),z(),m}return 0},[z]);return a.useEffect(()=>{const S=()=>{n(!0),j(),z()},P=()=>{n(!1)};return window.addEventListener("online",S),window.addEventListener("offline",P),()=>{window.removeEventListener("online",S),window.removeEventListener("offline",P)}},[z,j]),a.useEffect(()=>{t?(z(),setTimeout(()=>{navigator.onLine&&j()},2e3)):i([])},[t,z,j]),{isOnline:s,isLoading:o,demands:l,setDemands:i,citizens:v,setCitizens:N,users:k,interactions:M,weatherLocations:f,setWeatherLocations:C,dbStats:G,themePreference:T,fetchData:z,processOfflineQueue:j,syncCount:D,setSyncCount:I}},Ss=({status:t,setStatus:s,priority:n,setPriority:o,timeRange:h,setTimeRange:l,scope:i,setScope:v,showScope:N=!0,className:k=""})=>e.jsxs("div",{className:`glass-panel p-3 rounded-3xl flex flex-col md:flex-row gap-4 items-center border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md shadow-sm ${k}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-white/50 text-xs font-bold uppercase tracking-wider shrink-0",children:[e.jsx(Tt,{className:"w-4 h-4 text-brand-500"})," Filtros"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto overflow-x-auto scrollbar-none items-start sm:items-center flex-1",children:[N&&i&&v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-w-[200px]",children:e.jsx(Re,{value:i,onChange:v,options:[{value:"demands",label:"Demandas",icon:et},{value:"citizens",label:"Cidadãos",icon:Ve}]})}),e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"})]}),e.jsx("div",{className:"min-w-[280px]",children:e.jsx(Re,{value:h,onChange:l,options:[{value:"7",label:"7d"},{value:"30",label:"30d"},{value:"90",label:"90d"},{value:"365",label:"Ano"},{value:"all",label:"Tudo"}]})}),(!N||i==="demands")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:t,onChange:y=>s(y.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Status: Todos"}),e.jsx("option",{value:F.PENDING,children:"Pendentes"}),e.jsx("option",{value:F.IN_PROGRESS,children:"Em Andamento"}),e.jsx("option",{value:F.COMPLETED,children:"Concluídos"})]}),e.jsx(mt,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]}),e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:n,onChange:y=>o(y.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Prioridade: Todas"}),e.jsx("option",{value:ee.HIGH,children:"Alta"}),e.jsx("option",{value:ee.MEDIUM,children:"Média"}),e.jsx("option",{value:ee.LOW,children:"Baixa"})]}),e.jsx(mt,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]})]})]})]}),(t!=="all"||n!=="all"||h!=="30")&&e.jsxs("button",{onClick:()=>{s("all"),o("all"),l("30")},className:"ml-auto p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-slate-400 hover:text-red-500 rounded-xl transition-colors flex items-center gap-1 text-[10px] font-bold uppercase",title:"Limpar Filtros",children:[e.jsx(Pe,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden md:inline",children:"Limpar"})]})]}),Ds=$e.lazy(()=>aa(()=>import("./PeopleManager-Cb8FxCNb.js"),__vite__mapDeps([0,1,2,3]))),Es=$e.lazy(()=>aa(()=>import("./AdminScreen-D0q-hpT1.js"),__vite__mapDeps([4,1,2,3]))),St={administrador:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","admin_panel","map"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!0,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},chefe_de_gabinete:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},assessor:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!1,showPending:!0,showInProgress:!0,showCompleted:!1,showHighPriority:!0,showAnalytics:!1,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0}},Is=$e.memo(({data:t,title:s})=>{const n=t.reduce((h,l)=>h+l.value,0);let o=0;return n===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados"}):e.jsxs("div",{className:"flex items-center gap-6 h-full justify-center",children:[e.jsxs("div",{className:"relative w-32 h-32 shrink-0",children:[e.jsx("svg",{viewBox:"0 0 100 100",className:"transform -rotate-90 w-full h-full",children:t.map((h,l)=>{const i=h.value/n,v=40,N=2*Math.PI*v,k=`${i*N} ${N}`;return o+=i*100,e.jsx("circle",{cx:"50",cy:"50",r:v,fill:"transparent",stroke:h.color,strokeWidth:"12",strokeDasharray:k,strokeDashoffset:-(o-i*100)/100*N,className:"transition-all duration-1000 ease-out"},l)})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-xl font-bold text-slate-800 dark:text-white",children:n}),e.jsx("span",{className:"text-[9px] uppercase font-bold text-slate-400",children:"Total"})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:t.map((h,l)=>e.jsxs("div",{className:"flex items-center justify-between text-xs gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:h.color}}),e.jsx("span",{className:"font-medium text-slate-600 dark:text-white/80",children:h.label})]}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white",children:[Math.round(h.value/n*100),"%"]})]},l))})]})}),Ts=$e.memo(({data:t,unit:s=""})=>{const n=Math.max(...t.map(o=>o.value),1);return t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados geográficos"}):e.jsx("div",{className:"h-full w-full flex items-end justify-between gap-2 px-2 pb-2 pt-4",children:t.slice(0,7).map((o,h)=>{const l=o.value/n*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1 group h-full justify-end",children:[e.jsxs("div",{className:"text-[10px] font-bold text-slate-600 dark:text-slate-300 mb-0.5",children:[o.value,s]}),e.jsx("div",{style:{height:`${l}%`},className:"w-full bg-brand-200 dark:bg-brand-500/30 rounded-t-sm group-hover:bg-brand-50 dark:group-hover:bg-brand-500 transition-colors min-h-[4px]"}),e.jsx("div",{className:"text-[9px] text-slate-400 truncate w-full text-center",title:o.label,children:o.label.slice(0,6)})]},h)})})}),sa=()=>{const[t,s]=a.useState(()=>{if(typeof window<"u"){const d=localStorage.getItem("geo_user");return d?JSON.parse(d):null}return null}),[n,o]=a.useState("dashboard"),[h,l]=a.useState(!0),i=a.useRef(0),v=a.useRef(null),[N,k]=a.useState("list"),[y,M]=a.useState(()=>typeof window<"u"&&localStorage.getItem("geo_theme_pref")||"auto"),[c,f]=a.useState(!1),[C,G]=a.useState("all"),[A,T]=a.useState("all"),[g,D]=a.useState("30"),[I,V]=a.useState("demands"),[z,j]=a.useState("activity"),[S,P]=a.useState(St),[m,L]=a.useState({search:"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[],responsibleId:void 0}),[q,$]=a.useState(null),[p,H]=a.useState(null),[X,E]=a.useState(null),[w,Q]=a.useState(null),[ae,B]=a.useState("demands"),[_,re]=a.useState(null),[ge,u]=a.useState("list"),[W,te]=a.useState(!1),{demands:ne,setDemands:Le,citizens:he,users:Fe,interactions:fe,weatherLocations:De,setWeatherLocations:Ye,isOnline:Ue,isLoading:Ee,themePreference:we,fetchData:ye,syncCount:Ce}=Cs(t);a.useEffect(()=>{t&&t.firstLogin&&(localStorage.getItem("geo_onboarding_completed")||te(!0))},[t]),a.useEffect(()=>{we&&M(we)},[we]);const Ie=a.useMemo(()=>{let d=null,b=null;m.startDate&&(d=new Date(m.startDate+"T00:00:00").getTime(),m.endDate?b=new Date(m.endDate+"T23:59:59.999").getTime():b=new Date(m.startDate+"T23:59:59.999").getTime());const J=m.search.toLowerCase();return ne.filter(Y=>{if(m.search){const K=Y.id.toLowerCase().includes(J),Z=Y.title.toLowerCase().includes(J),de=Y.description.toLowerCase().includes(J);if(!K&&!Z&&!de)return!1}if(m.status.length>0&&!m.status.includes(Y.status)||m.priority.length>0&&!m.priority.includes(Y.priority)||m.level.length>0&&!m.level.includes(Y.level)||m.responsibleId&&Y.responsibleId!==m.responsibleId||m.tags&&m.tags.length>0&&(!Y.tags||!m.tags.some(K=>Y.tags.includes(K))))return!1;if(d!==null&&b!==null){let K;if(m.dateType==="deadline"?K=Y.deadline:m.dateType==="updatedAt"?K=Y.updatedAt:K=Y.createdAt,!K)return!1;let Z;if(/^\d{4}-\d{2}-\d{2}$/.test(K)){const[de,Ke,jt]=K.split("-").map(Number);Z=new Date(de,Ke-1,jt,12,0,0).getTime()}else Z=new Date(K).getTime();if(Z<d||Z>b)return!1}return!0})},[ne,m]),Ge=a.useMemo(()=>{const d=m.search.toLowerCase();return m.search?he.filter(b=>{var Z,de;const J=b.name.toLowerCase().includes(d),Y=(Z=b.email)==null?void 0:Z.toLowerCase().includes(d),K=(de=b.phone)==null?void 0:de.includes(d);return J||Y||K}):he},[he,m.search]),x=a.useMemo(()=>{const d=[];return Ie.length>0&&Ie.forEach(b=>{b.lat&&b.lon&&d.push({id:b.id,type:"demand",lat:b.lat,lon:b.lon,title:b.title,status:b.status,priority:b.priority})}),Ge.length>0&&Ge.forEach(b=>{b.lat&&b.lon&&d.push({id:b.id,type:"citizen",lat:b.lat,lon:b.lon,name:b.name,bairro:b.bairro})}),d},[Ie,Ge]);a.useEffect(()=>{const d=b=>{var J,Y;l(!0),E(null),$(null),L({search:"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[],responsibleId:void 0}),D("all"),(J=b.detail)!=null&&J.demandId?(b.detail.lat&&b.detail.lon&&Q({lat:b.detail.lat,lon:b.detail.lon}),B("demands"),o("map")):(Y=b.detail)!=null&&Y.citizenId&&(b.detail.lat&&b.detail.lon&&Q({lat:b.detail.lat,lon:b.detail.lon}),B("citizens"),o("map"))};return window.addEventListener("navigate-to-map",d),()=>window.removeEventListener("navigate-to-map",d)},[]),a.useEffect(()=>{Ce>0&&U("success",`${Ce} itens sincronizados.`)},[Ce]),a.useEffect(()=>{l(!0),v.current&&v.current.scrollTo(0,0)},[n]);const O=d=>{const b=d.currentTarget.scrollTop;Math.abs(b-i.current)>5&&(b>i.current&&b>50?l(!1):l(!0),i.current=b)};a.useEffect(()=>{const d=()=>{let J=!1;if(y==="dark")J=!0;else if(y==="light")J=!1;else{const Y=new Date().getHours();J=Y<6||Y>=18}f(J),J?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};d();const b=setInterval(d,6e4);return()=>clearInterval(b)},[y]);const U=a.useCallback((d,b)=>{re({type:d,message:b}),setTimeout(()=>re(null),4e3)},[]),ce=d=>{s(d),o("dashboard")},le=()=>{s(null),localStorage.removeItem("geo_user"),Le([]),o("dashboard")},xe=()=>{const d=c?"light":"dark";M(d),localStorage.setItem("geo_theme_pref",d)},me=d=>{H(d),o("people")},Te=d=>{H(null),$(null),E(null),Q(null),B("demands"),L({search:"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[],responsibleId:void 0}),o(d)},ve=async(d,b)=>{const J=ne.find(K=>K.id===d),Y=J==null?void 0:J.status;if(!(!J||Y===b)&&(Le(K=>K.map(Z=>Z.id===d?{...Z,status:b}:Z)),ie()&&R))try{const{error:K}=await R.from("demands").update({status:b}).eq("id",d);if(K)throw K;const Z=JSON.parse(localStorage.getItem("geo_user")||"{}"),{error:de}=await R.from("demand_interactions").insert({demanda_id:d,tipo:"status_change",texto:`Status alterado de "${Y}" para "${b}"`,usuario:Z.name||"Sistema",created_at:new Date().toISOString()});if(de)throw de;ye(),U("success","Status atualizado com sucesso!")}catch(K){console.error("Error updating status:",K),U("error","Erro ao atualizar status: "+K.message),Le(Z=>Z.map(de=>de.id===d?{...de,status:Y}:de))}},ot=()=>{const d=new Date,b=new Date;if(g!=="all"){const J=parseInt(g);J===365?(b.setMonth(0,1),b.setHours(0,0,0,0)):b.setDate(d.getDate()-J)}else b.setFullYear(1970);return b},be=a.useMemo(()=>{const d=ot();return ne.filter(b=>{const Y=new Date(b.createdAt)>=d,K=C==="all"||b.status===C,Z=A==="all"||b.priority===A;return Y&&K&&Z})},[ne,C,A,g]),Se=a.useMemo(()=>{const d=ot();return he.filter(b=>b.createdAt?new Date(b.createdAt)>=d:!0)},[he,g]),r=a.useMemo(()=>{if(I==="demands"){const d=be.length;let b=0,J=0,Y=0;for(const K of be)K.status===F.PENDING?b++:K.status===F.COMPLETED&&J++,K.priority===ee.HIGH&&Y++;return{stat1:{label:"Filtradas",value:d,icon:Wt,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Pendentes",value:b,icon:Ne,color:"bg-slate-500",text:"text-slate-600 dark:text-slate-400"},stat3:{label:"Concluídos",value:J,icon:ze,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat4:{label:"Alta Prioridade",value:Y,icon:gt,color:"bg-red-500",text:"text-red-600 dark:text-red-400"}}}else{const d=he.length,b=new Date().toDateString(),J=he.filter(Z=>Z.createdAt&&new Date(Z.createdAt).toDateString()===b).length,Y={};for(const Z of he)Z.bairro&&(Y[Z.bairro]=(Y[Z.bairro]||0)+1);const K=Object.entries(Y).sort((Z,de)=>de[1]-Z[1])[0];return{stat1:{label:"Total Cidadãos",value:d,icon:Ve,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Novos Hoje",value:J,icon:Yt,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat3:{label:"Top Bairro",value:K?K[0]:"N/A",icon:je,color:"bg-brand-500",text:"text-brand-600 dark:text-brand-400"},stat4:{label:"Cadastros (Bairro)",value:K?K[1]:0,icon:qt,color:"bg-purple-500",text:"text-purple-600 dark:text-purple-400"}}}},[be,Se,he,I]),se=a.useMemo(()=>{if(I==="demands"){const d={[F.PENDING]:0,[F.IN_PROGRESS]:0,[F.COMPLETED]:0};return be.forEach(b=>{d[b.status]!==void 0&&d[b.status]++}),[{label:"Pendente",value:d[F.PENDING],color:"#64748b"},{label:"Em Andamento",value:d[F.IN_PROGRESS],color:"#f59e0b"},{label:"Concluído",value:d[F.COMPLETED],color:"#10b981"}].filter(b=>b.value>0)}else{const d={};Se.forEach(Z=>{const de=Z.createdAt?new Date(Z.createdAt):new Date,Ke=`${de.getFullYear()}-${String(de.getMonth()+1).padStart(2,"0")}`;d[Ke]=(d[Ke]||0)+1});const b=Object.keys(d).sort().reverse(),J=["#0ea5e9","#6366f1","#8b5cf6","#ec4899","#64748b"],Y=b.slice(0,4).map((Z,de)=>{const[Ke,jt]=Z.split("-"),Lt=new Date(parseInt(Ke),parseInt(jt)-1).toLocaleString("pt-BR",{month:"short",year:"2-digit"});return{label:Lt.charAt(0).toUpperCase()+Lt.slice(1),value:d[Z],color:J[de%J.length]}}),K=b.slice(4).reduce((Z,de)=>Z+d[de],0);return K>0&&Y.push({label:"Antigos",value:K,color:"#94a3b8"}),Y}},[be,Se,I]),oe=a.useMemo(()=>{const d={};return I==="demands"?be.forEach(b=>{const J=he.find(Y=>Y.id===b.citizenId);J&&J.bairro&&(d[J.bairro]=(d[J.bairro]||0)+1)}):Se.forEach(b=>{b.bairro&&(d[b.bairro]=(d[b.bairro]||0)+1)}),Object.entries(d).sort((b,J)=>J[1]-b[1]).slice(0,7).map(([b,J])=>({label:b,value:J}))},[be,Se,he,I]),_e=a.useMemo(()=>[...be].sort((d,b)=>new Date(b.createdAt).getTime()-new Date(d.createdAt).getTime()).slice(0,5),[be]),pe=a.useMemo(()=>[...Se].sort((d,b)=>new Date(b.createdAt||0).getTime()-new Date(d.createdAt||0).getTime()).slice(0,5),[Se]),He=a.useMemo(()=>{const d=new Date;return d.setHours(0,0,0,0),be.filter(b=>b.deadline&&b.status!==F.COMPLETED).map(b=>({...b,date:new Date(b.deadline)})).filter(b=>b.date>=d).sort((b,J)=>b.date.getTime()-J.date.getTime()).slice(0,5)},[be]),tt=t?S[t.role]||St.assessor:St.administrador,vt=()=>e.jsxs("div",{className:"space-y-2",children:[" ",I==="demands"?_e.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Ua,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):_e.map(d=>e.jsxs("div",{onClick:()=>{t&&(E(d.id),o("demands"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[" ",e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-brand-50 dark:bg-brand-500/10 flex flex-col items-center justify-center text-brand-600 dark:text-brand-400 font-bold shrink-0 border border-brand-100 dark:border-brand-500/20",children:[" ",e.jsx("span",{className:"text-xs",children:new Date(d.createdAt).getDate()})," ",e.jsx("span",{className:"text-[8px] uppercase",children:new Date(d.createdAt).toLocaleString("default",{month:"short"}).slice(0,3)})," "]})," ",e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsxs("div",{className:"flex justify-between items-start",children:[" ",e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:d.title})," ",e.jsxs("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${d.status==="Concluído"?"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300":d.status==="Em Andamento"?"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300":"bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300"}`,children:[" ",d.status," "]})," "]})," ",e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:d.description})," "]})," "]},d.id)):pe.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Ve,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):pe.map(d=>e.jsxs("div",{onClick:()=>{me(d.id)},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[" ",e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-blue-50 dark:bg-blue-500/10 flex flex-col items-center justify-center text-blue-600 dark:text-blue-400 font-bold shrink-0 border border-blue-100 dark:border-blue-500/20",children:[" ",e.jsx("span",{className:"text-xs",children:new Date(d.createdAt||Date.now()).getDate()})," ",e.jsx("span",{className:"text-[8px] uppercase",children:new Date(d.createdAt||Date.now()).toLocaleString("default",{month:"short"}).slice(0,3)})," "]})," ",e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsxs("div",{className:"flex justify-between items-start",children:[" ",e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:d.name})," ",e.jsxs("span",{className:"shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300",children:[" ",d.phone?We(d.phone):"Sem Tel"," "]})," "]})," ",e.jsxs("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1 flex items-center gap-1",children:[" ",d.bairro&&e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-2.5 h-2.5"})," ",d.bairro]})," "]})," "]})," "]},d.id))," "]}),dt=()=>e.jsxs("div",{className:"space-y-2",children:[" ",I==="demands"?He.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(ze,{className:"w-6 h-6 mb-2 opacity-20"}),"Tudo em dia!"]}):He.map(d=>{const b=Math.ceil((d.date.getTime()-new Date().getTime())/864e5);return e.jsxs("div",{onClick:()=>{t&&(E(d.id),o("demands"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[" ",e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-amber-50 dark:bg-amber-500/10 flex flex-col items-center justify-center text-amber-600 dark:text-amber-400 font-bold shrink-0 border border-amber-100 dark:border-amber-500/20",children:[" ",e.jsx("span",{className:"text-xs",children:d.date.getDate()})," ",e.jsx("span",{className:"text-[8px] uppercase",children:d.date.toLocaleString("default",{month:"short"}).slice(0,3)})," "]})," ",e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsxs("div",{className:"flex justify-between items-start",children:[" ",e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:d.title})," ",e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${b<=2?"bg-red-100 text-red-600 dark:bg-red-500/20":"bg-slate-100 text-slate-600 dark:bg-white/10"}`,children:b<0?"Exp.":`${b}d`})," "]})," ",e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:d.description})," "]})," "]},d.id)}):oe.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(je,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):oe.slice(0,5).map((d,b)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5",children:[" ",e.jsxs("div",{className:"flex items-center gap-3",children:[" ",e.jsx("span",{className:"text-xs font-bold text-slate-400 w-4",children:b+1})," ",e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-white",children:d.label})," "]})," ",e.jsx("span",{className:"text-[10px] font-bold bg-purple-100 text-purple-600 dark:bg-purple-500/20 dark:text-purple-300 px-2 py-1 rounded-full",children:d.value})," "]},b))," "]});return e.jsxs("div",{className:`flex h-screen bg-slate-50 dark:bg-[#020617] transition-colors duration-500 overflow-hidden ${c?"dark":""}`,children:[!t&&e.jsx("div",{className:"absolute inset-0 z-[100]",children:e.jsx(rs,{onLogin:ce})}),W&&t&&e.jsx(ys,{onFinish:()=>te(!1)}),e.jsxs("div",{className:`dashboard-root flex h-full w-full transition-all duration-700 ease-in-out ${t?"filter-none scale-100 opacity-100":"blur-[5px] scale-[1.02] pointer-events-none grayscale-[0.2]"}`,children:[e.jsx(Za,{currentView:n==="fast-track"?"demands":n,setView:Te,user:t,onLogout:le,toggleTheme:xe,isDarkMode:c,systemConfig:S,showMobileDock:h}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 transition-all duration-300 relative lg:my-4 lg:mr-4 lg:ml-4",children:[!Ue&&e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-[1000] bg-amber-500/90 backdrop-blur-sm text-white text-xs font-bold text-center py-1.5 flex items-center justify-center gap-2 lg:rounded-t-[2.5rem]",children:[e.jsx(Ra,{className:"w-3 h-3"})," Modo Offline. As alterações serão salvas localmente."]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden flex flex-col glass-container rounded-[2.5rem]",children:[_&&e.jsxs("div",{className:`fixed top-6 right-6 z-[1000] px-4 py-3 rounded-xl shadow-2xl border flex items-center gap-3 animate-in slide-in-from-right duration-300 ${_.type==="success"?"bg-green-500 text-white border-green-600":"bg-red-500 text-white border-red-600"}`,children:[_.type==="success"?e.jsx(ze,{className:"w-5 h-5"}):e.jsx(Jt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-sm",children:_.message})]}),e.jsxs(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(ue,{className:"w-8 h-8 animate-spin text-brand-500"})}),children:[["dashboard","new-demand","edit-demand","admin_panel","demands","people","map"].includes(n)&&e.jsxs("div",{className:"absolute inset-0 overflow-y-auto custom-scrollbar p-4 lg:p-6 pb-32 lg:pb-6",onScroll:O,ref:v,children:[e.jsx("div",{className:"lg:hidden h-2 w-full"}),n==="dashboard"&&e.jsxs("div",{className:"flex flex-col gap-6 max-w-[1600px] mx-auto w-full",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 shrink-0",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold tracking-tight text-slate-900 dark:text-white",children:["Olá, ",t?t.name.split(" ")[0]:"Bem-vindo"]})}),e.jsx(ks,{locations:De})]}),e.jsx(Ss,{status:C,setStatus:G,priority:A,setPriority:T,timeRange:g,setTimeRange:D,scope:I,setScope:V,className:"sticky top-0 z-30"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 shrink-0",children:[e.jsx(Me,{isLoading:Ee,title:r.stat1.label,value:typeof r.stat1.value=="string"?0:r.stat1.value,subValue:typeof r.stat1.value=="string"?r.stat1.value:void 0,icon:r.stat1.icon,colorClass:r.stat1.color,textClass:r.stat1.text}),e.jsx(Me,{isLoading:Ee,title:r.stat2.label,value:typeof r.stat2.value=="string"?0:r.stat2.value,subValue:typeof r.stat2.value=="string"?r.stat2.value:void 0,icon:r.stat2.icon,colorClass:r.stat2.color,textClass:r.stat2.text}),e.jsx(Me,{isLoading:Ee,title:r.stat3.label,value:typeof r.stat3.value=="string"?0:r.stat3.value,subValue:typeof r.stat3.value=="string"?r.stat3.value:void 0,icon:r.stat3.icon,colorClass:r.stat3.color,textClass:r.stat3.text}),e.jsx(Me,{isLoading:Ee,title:r.stat4.label,value:typeof r.stat4.value=="string"?0:r.stat4.value,subValue:typeof r.stat4.value=="string"?r.stat4.value:void 0,icon:r.stat4.icon,colorClass:r.stat4.color,textClass:r.stat4.text})]}),tt.dashboardWidgets.showAnalytics&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-auto shrink-0",children:[e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(Fa,{className:"w-3 h-3"})," ",I==="demands"?"Distribuição por Status":"Cadastros por Mês"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Is,{data:se,title:I==="demands"?"Demandas":"Cidadãos"})})]}),e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(je,{className:"w-3 h-3"})," ",I==="demands"?"Top Bairros (Demandas)":"Top Bairros (Residentes)"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Ts,{data:oe})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 min-h-0",children:[e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${z!=="activity"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(Re,{value:z,onChange:d=>j(d),options:[{value:"activity",label:"Atividade Recente",icon:xt},{value:"upcoming",label:"Próx. Prazos",icon:yt}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(xt,{className:"w-4 h-4"})," Atividades Recentes"]}),e.jsxs("button",{onClick:()=>o(I==="demands"?"demands":"people"),className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(rt,{className:"w-3 h-3"})]})]}),vt()]}),e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${z!=="upcoming"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(Re,{value:z,onChange:d=>j(d),options:[{value:"activity",label:"Atividade Recente",icon:xt},{value:"upcoming",label:"Próx. Prazos",icon:yt}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(yt,{className:"w-4 h-4"})," ",I==="demands"?"Próximos Prazos":"Top Bairros"]}),e.jsxs("button",{onClick:()=>{I==="demands"?(u("calendar"),o("demands")):o("map")},className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(rt,{className:"w-3 h-3"})]})]}),dt()]})]})]}),n==="new-demand"&&e.jsx("div",{className:"max-w-[1600px] mx-auto w-full h-full",children:e.jsx(ts,{initialSearchTerm:p||void 0,onSuccess:d=>{ye(),o("demands"),H(null)},onCancel:()=>{o("demands"),H(null)},onNotification:U})}),n==="edit-demand"&&q&&e.jsx("div",{className:"max-w-[1600px] mx-auto w-full h-full",children:e.jsx(as,{demand:q,onSuccess:d=>{ye(),o("demands"),$(null)},onCancel:()=>{o("demands"),$(null)},onNotification:U})}),n==="admin_panel"&&t&&e.jsx(Es,{currentUser:t,systemConfig:S,onUpdateConfig:P,onUpdateLocation:Ye,onNotification:U,onLogout:le,toggleTheme:xe,isDarkMode:c}),(n==="demands"||n==="map")&&e.jsx(js,{demands:Ie,citizens:he,interactions:fe,users:Fe,onViewDemand:()=>{},onEditDemand:d=>{$(d),o("edit-demand")},onCreateDemand:()=>o("new-demand"),onUpdateStatus:ve,onInteractionUpdate:ye,filters:m,setFilters:L,onNotification:U,defaultLocation:De.length>0?De[0]:null,onViewCitizen:me,initialViewMode:n==="map"?"map":ge,mapMarkers:x,initialSelectionId:X,clearSelection:()=>E(null),mapFocus:w,initialMapViewMode:ae}),n==="people"&&e.jsx(Ds,{initialSearchTerm:p||void 0,onCreateDemand:d=>{H(d),o("new-demand")},onEditDemand:d=>{$(d),o("edit-demand")},onNotification:U,onPersonUpdate:ye,permissions:tt,onModeChange:k,demands:ne})]}),n==="fast-track"&&e.jsx(Ns,{onBack:()=>o("demands"),onSuccess:d=>{H(d),o("new-demand")}})]})]})]})]})]})};console.log("Iniciando Gabinete Digital (Main)...");const Dt=document.getElementById("root");if(!Dt)console.error("ERRO CRÍTICO: Elemento 'root' não encontrado no HTML.");else try{ut.createRoot(Dt).render(e.jsx($e.StrictMode,{children:e.jsx(sa,{})})),console.log("React montado com sucesso via src/main.tsx")}catch(t){console.error("Erro ao montar React:",t),Dt.innerHTML='<div style="color:red; padding: 20px;">Erro ao carregar a aplicação. Verifique o console.</div>'}console.log("Iniciando Gabinete Digital...");const Et=document.getElementById("root");if(!Et)console.error("ERRO CRÍTICO: Elemento 'root' não encontrado no HTML.");else try{ut.createRoot(Et).render(e.jsx($e.StrictMode,{children:e.jsx(sa,{})})),console.log("React montado com sucesso.")}catch(t){console.error("Erro ao montar React:",t),Et.innerHTML='<div style="color:red; padding: 20px;">Erro ao carregar a aplicação. Verifique o console.</div>'}export{ws as D,os as P,Me as S,Gt as a,Be as b,Re as c,We as f,ie as i,e as j,R as s};
