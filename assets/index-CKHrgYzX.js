const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PeopleManager-DNLUlquc.js","assets/vendor-CC2eIyRy.js","assets/db-DxBk-dGO.js","assets/maps-BiYucuft.js","assets/AdminScreen-LtJjAJhn.js"])))=>i.map(i=>d[i]);
import{r as a,a as Zt,R as ye,H as Xt,L as Ke,U as Pe,M as Lt,b as ea,P as ta,d as aa,S as ft,e as sa,f as Nt,h as ra,i as dt,A as vt,j as qe,k as be,l as it,m as fe,F as jt,X as Ee,n as _t,C as we,o as rt,p as la,q as na,s as st,B as oa,t as Mt,u as da,v as ia,w as Ve,x as Ot,y as ca,z as ct,D as pe,Z as We,E as $e,G as Fe,I as Je,J as Rt,K as xa,N as zt,O as lt,Q as ha,T as ma,V as ba,W as nt,Y as ua,_ as yt,$ as pa,a0 as wt,a1 as ga,a2 as fa,a3 as wa,a4 as va,a5 as ja,a6 as Ct,a7 as ka,a8 as Na,a9 as ya,aa as Ca,ab as St,ac as Dt,ad as Et,ae as Ut,af as Sa,ag as Da,ah as Ea,ai as Ft,aj as Ia,ak as Aa,al as mt,am as Ta}from"./vendor-CC2eIyRy.js";import{c as $a}from"./db-DxBk-dGO.js";import{l as Se,M as Gt,T as Ht,u as Bt,C as Pa,P as qt,a as Vt}from"./maps-BiYucuft.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))c(b);new MutationObserver(b=>{for(const n of b)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&c(h)}).observe(document,{childList:!0,subtree:!0});function l(b){const n={};return b.integrity&&(n.integrity=b.integrity),b.referrerPolicy&&(n.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?n.credentials="include":b.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(b){if(b.ep)return;b.ep=!0;const n=l(b);fetch(b.href,n)}})();var Wt={exports:{}},xt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var La=a,_a=Symbol.for("react.element"),Ma=Symbol.for("react.fragment"),Oa=Object.prototype.hasOwnProperty,Ra=La.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,za={key:!0,ref:!0,__self:!0,__source:!0};function Jt(t,s,l){var c,b={},n=null,h=null;l!==void 0&&(n=""+l),s.key!==void 0&&(n=""+s.key),s.ref!==void 0&&(h=s.ref);for(c in s)Oa.call(s,c)&&!za.hasOwnProperty(c)&&(b[c]=s[c]);if(t&&t.defaultProps)for(c in s=t.defaultProps,s)b[c]===void 0&&(b[c]=s[c]);return{$$typeof:_a,type:t,key:n,ref:h,props:b,_owner:Ra.current}}xt.Fragment=Ma;xt.jsx=Jt;xt.jsxs=Jt;Wt.exports=xt;var e=Wt.exports,ot={},It=Zt;ot.createRoot=It.createRoot,ot.hydrateRoot=It.hydrateRoot;const Ua="modulepreload",Fa=function(t){return"/Gabinete-Digital/"+t},At={},Yt=function(s,l,c){let b=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),N=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));b=Promise.allSettled(l.map(f=>{if(f=Fa(f),f in At)return;At[f]=!0;const y=f.endsWith(".css"),k=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${k}`))return;const v=document.createElement("link");if(v.rel=y?"stylesheet":Ua,y||(v.as="script"),v.crossOrigin="",v.href=f,N&&v.setAttribute("nonce",N),document.head.appendChild(v),y)return new Promise((m,j)=>{v.addEventListener("load",m),v.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${f}`)))})}))}function n(h){const N=new Event("vite:preloadError",{cancelable:!0});if(N.payload=h,window.dispatchEvent(N),!N.defaultPrevented)throw h}return b.then(h=>{for(const N of h||[])N.status==="rejected"&&n(N.reason);return s().catch(n)})},Ga=ye.memo(({currentView:t,setView:s,user:l,onLogout:c,toggleTheme:b,isDarkMode:n,systemConfig:h,showMobileDock:N=!0})=>{const[f,y]=a.useState(!0),[k,v]=a.useState(!1),m=f||k,j=l&&h[l.role]?h[l.role]:{allowedViews:[]},I=[{id:"dashboard",label:"Home",icon:Xt},{id:"demands",label:"Demandas",icon:Ke},{id:"people",label:"Cidadãos",icon:Pe},{id:"map",label:"Mapa",icon:Lt}].filter(g=>j.allowedViews.includes(g.id)),B=g=>g.split("_").map(P=>P.charAt(0).toUpperCase()+P.slice(1)).join(" "),E=g=>{s(g)};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`
          hidden lg:flex
          transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]
          flex-col will-change-transform group z-40 overflow-hidden
          static h-auto
          my-4 ml-4 mr-0
          rounded-[2.5rem] border border-white/60 dark:border-white/5
          bg-white/80 dark:bg-[#020617]/80 backdrop-blur-2xl
          shadow-xl shadow-slate-200/50 dark:shadow-black/20
          ${m?"w-72":"w-24"}
        `,onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),children:[e.jsxs("div",{className:`p-6 flex items-center ${m?"justify-between":"justify-center"} border-b border-slate-100 dark:border-white/5 h-28 shrink-0 relative`,children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden whitespace-nowrap",children:[e.jsx("div",{className:`w-12 h-12 min-w-[3rem] bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30 ring-1 ring-white/20 transition-transform duration-300 ${!m&&!f?"scale-110":""}`,children:e.jsx(ea,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:`transition-all duration-300 origin-left ${m?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight text-slate-900 dark:text-white leading-none",children:"Gabinete"}),e.jsx("span",{className:"text-[10px] text-brand-600 dark:text-brand-400 font-bold tracking-[0.2em] uppercase",children:"Digital"})]})]}),e.jsx("button",{onClick:()=>y(!f),className:`
                flex absolute right-6 top-1/2 -translate-y-1/2 text-slate-400 dark:text-white/30 hover:text-brand-600 dark:hover:text-white transition-all duration-300
                ${m?"opacity-0 group-hover:opacity-100 delay-100":"opacity-0 pointer-events-none"}
            `,title:f?"Desafixar menu":"Fixar menu",children:f?e.jsx(ta,{className:"w-4 h-4"}):e.jsx(aa,{className:"w-4 h-4"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-x-hidden overflow-y-auto custom-scrollbar flex flex-col",children:I.map(g=>{const P=g.icon,O=t===g.id;return e.jsxs("button",{onClick:()=>E(g.id),disabled:!l,className:`
                  w-full flex items-center gap-4 px-4 py-3.5 rounded-2xl text-sm font-bold transition-all duration-300 relative group/item
                  ${l?"":"opacity-30 cursor-not-allowed"}
                  ${O?"bg-brand-500/10 dark:bg-white/10 text-brand-700 dark:text-white shadow-sm ring-1 ring-brand-500/20 dark:ring-white/10":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white"}
                  ${m?"":"justify-center"}
                `,children:[e.jsx(P,{className:`w-6 h-6 min-w-[1.5rem] transition-transform duration-300 ${O?"scale-110":"group-hover/item:scale-110"}`}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${m?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:g.label}),O&&m&&e.jsx("div",{className:"absolute right-4 w-1.5 h-1.5 rounded-full bg-brand-500 shadow-[0_0_8px_currentColor]"})]},g.id)})}),e.jsxs("div",{className:"p-4 border-t border-slate-100 dark:border-white/5 shrink-0 space-y-2",children:[e.jsxs("button",{onClick:b,className:`
                  lg:hidden w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5
                  ${m?"":"justify-center"}
                `,children:[n?e.jsx(ft,{className:"w-5 h-5 min-w-[1.25rem] text-amber-400"}):e.jsx(sa,{className:"w-5 h-5 min-w-[1.25rem] text-slate-600"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${m?"opacity-100":"opacity-0 w-0 hidden"}`,children:n?"Modo Claro":"Modo Escuro"})]}),l&&e.jsxs("button",{onClick:()=>E("admin_panel"),className:`
                  w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  ${t==="admin_panel"?"bg-slate-100 dark:bg-white/10 text-brand-700 dark:text-brand-300":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5"}
                  ${m?"":"justify-center"}
                `,children:[e.jsx(Nt,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${m?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Configurações"})]}),e.jsxs("button",{onClick:c,disabled:!l,className:`
                w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors
                ${m?"":"justify-center"}
                `,children:[e.jsx(ra,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${m?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Sair"})]}),e.jsxs("div",{className:`mt-2 flex items-center gap-3 p-2 rounded-2xl border transition-all duration-300 
                ${m?"bg-slate-50/50 dark:bg-white/5 border-slate-100 dark:border-white/5":"bg-transparent border-transparent justify-center"}
            `,children:[e.jsx("div",{className:"w-9 h-9 min-w-[2.25rem] rounded-full bg-slate-200 dark:bg-slate-800 flex items-center justify-center overflow-hidden border border-white dark:border-white/10 shadow-sm",children:l!=null&&l.avatar?e.jsx("img",{src:l.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(dt,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"})}),e.jsxs("div",{className:`flex-1 min-w-0 overflow-hidden transition-all duration-300 ${m?"opacity-100":"opacity-0 w-0 hidden"}`,children:[e.jsx("p",{className:"text-xs font-bold truncate text-slate-800 dark:text-white",children:l?l.name.split(" ")[0]:"..."}),e.jsx("p",{className:"text-[9px] text-brand-600 dark:text-brand-400 font-bold uppercase truncate tracking-wider",children:l?B(l.role):""})]})]})]})]}),e.jsx("nav",{className:`
            lg:hidden fixed bottom-0 left-0 right-0 z-[900] 
            bg-white/95 dark:bg-[#0f172a]/95 backdrop-blur-xl 
            border-t border-slate-200 dark:border-white/10 
            pb-safe-area shadow-[0_-4px_20px_rgba(0,0,0,0.05)]
            transition-transform duration-300 ease-in-out
            ${N?"translate-y-0":"translate-y-full"}
        `,children:e.jsxs("div",{className:"flex items-center justify-around h-[76px] px-2 pb-2",children:[I.map(g=>{const P=t===g.id,O=g.icon;return e.jsxs("button",{onClick:()=>E(g.id),className:`
                    flex flex-col items-center justify-center gap-1.5 w-full h-full transition-all duration-200 active:scale-95
                    ${P?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`
                    relative p-2 rounded-2xl transition-all duration-300
                    ${P?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}
                `,children:e.jsx(O,{className:`w-6 h-6 transition-all ${P?"stroke-[2.5px] scale-110":"stroke-2"}`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide transition-opacity ${P?"opacity-100":"opacity-60"}`,children:g.label})]},g.id)}),e.jsxs("button",{onClick:()=>E("admin_panel"),className:`
                flex flex-col items-center justify-center gap-1.5 w-full h-full transition-all duration-200 active:scale-95
                ${t==="admin_panel"?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`relative p-2 rounded-2xl transition-all duration-300 ${t==="admin_panel"?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}`,children:e.jsx(Nt,{className:`w-6 h-6 ${t==="admin_panel"?"stroke-[2.5px]":"stroke-2"}`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide ${t==="admin_panel"?"opacity-100":"opacity-60"}`,children:"Configurações"})]})]})})]})});var Le=(t=>(t.MUNICIPAL="Municipal",t.ESTADUAL="Estadual",t.FEDERAL="Federal",t))(Le||{}),H=(t=>(t.PENDING="Pendente",t.IN_PROGRESS="Em Andamento",t.COMPLETED="Concluído",t))(H||{}),X=(t=>(t.LOW="Baixa",t.MEDIUM="Média",t.HIGH="Alta",t))(X||{}),Ye=(t=>(t.SOLICITACAO="Solicitação",t.RECLAMACAO="Reclamação",t.ELOGIO="Elogio",t.DENUNCIA="Denúncia",t.SUGESTAO="Sugestão",t))(Ye||{});const Ha="yioefhebxsohutdypxqd",Tt=`https://${Ha}.supabase.co`,$t="sb_publishable_ltKmfB3EreWKb757l0c6mw__0FBPSeR",R=Tt&&$t?$a(Tt,$t):null,le=()=>!!R,_e=t=>{const s=t.replace(/\D/g,"");return s.length>11?t.slice(0,15):s.length>10?s.replace(/^(\d\d)(\d{5})(\d{4}).*/,"($1) $2-$3"):s.length>5?s.replace(/^(\d\d)(\d{4})(\d{0,4}).*/,"($1) $2-$3"):s.length>2?s.replace(/^(\d\d)(\d{0,5})/,"($1) $2"):s},Ue=t=>t.replace(/\D/g,""),Ba=t=>{if(!t)return new Date;if(t.length===10&&t.includes("-")){const[s,l,c]=t.split("-").map(Number);return new Date(s,l-1,c)}return new Date(t)},Be=t=>t?Ba(t).toLocaleDateString("pt-BR"):"",qa=({initialSearchTerm:t,onSuccess:s,onCancel:l,onNotification:c})=>{const[b,n]=a.useState(""),[h,N]=a.useState([]),[f,y]=a.useState(!1),[k,v]=a.useState(!1),[m,j]=a.useState(null),[S,I]=a.useState(!1),B=a.useRef(null),[E,g]=a.useState(""),[P,O]=a.useState(""),[K,z]=a.useState(""),[C,L]=a.useState(""),[T,u]=a.useState(""),[D,w]=a.useState(!1),[d,$]=a.useState(""),[q,ae]=a.useState(""),[A,ee]=a.useState(""),[xe,ie]=a.useState(""),[Z,re]=a.useState(""),[_,o]=a.useState(""),[M,J]=a.useState(""),[se,Ie]=a.useState(Le.MUNICIPAL),[ve,Ae]=a.useState(H.PENDING),[ue,me]=a.useState(X.MEDIUM),[ge,Ce]=a.useState(Ye.SOLICITACAO),[Te,Oe]=a.useState(""),[ce,Re]=a.useState([]),[je,p]=a.useState(""),[F,Q]=a.useState(!1),[ne,te]=a.useState(!1);a.useEffect(()=>{const i=new Date;i.setDate(i.getDate()+7),Oe(i.toISOString().split("T")[0]),t&&(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)?ke(t):(n(t),he(t)))},[]),a.useEffect(()=>{const i=r=>{B.current&&!B.current.contains(r.target)&&y(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const oe=i=>({id:i.id||"temp-id",cpf:i.cpf,name:`${i.nome} ${i.sobrenome}`,email:i.email||"",phone:i.telefone||"",logradouro:i.logradouro,numero:i.numero,complemento:i.complemento||void 0,bairro:i.bairro,cep:i.cep,cidade:i.cidade,estado:i.estado}),V=i=>{i.cep&&u(i.cep),i.logradouro&&$(i.logradouro),i.numero&&ae(i.numero),i.bairro&&ee(i.bairro),i.cidade&&ie(i.cidade),i.estado&&re(i.estado)},ke=async i=>{if(le()&&R){const{data:r}=await R.from("citizens").select("*").eq("id",i).maybeSingle();if(r){const x=oe(r);j(x),n(x.name),V(x),I(!1)}}},he=async i=>{if(!(!i||i.length<2)){v(!0),y(!0),N([]);try{if(le()&&R){const r=Ue(i);let x=R.from("citizens").select("*").limit(10);r.length>3?x=x.or(`telefone.ilike.%${r}%,nome.ilike.%${i}%,sobrenome.ilike.%${i}%`):x=x.or(`nome.ilike.%${i}%,sobrenome.ilike.%${i}%`);const{data:G}=await x;G&&N(G.map(U=>oe(U)))}}catch(r){console.error(r)}finally{v(!1)}}},Qe=i=>{j(i),n(i.name),y(!1),I(!1),V(i)},Ze=()=>{j(null),I(!0),y(!1);const i=Ue(b);if(i.length>=8)z(i);else{const r=b.split(" ");r.length>0&&g(r[0]),r.length>1&&O(r.slice(1).join(" "))}},Xe=async()=>{const i=T.replace(/\D/g,"");if(i.length===8){w(!0);try{const x=await(await fetch(`https://viacep.com.br/ws/${i}/json/`)).json();x.erro||($(x.logradouro),ee(x.bairro),ie(x.localidade),re(x.uf))}catch(r){console.error(r)}finally{w(!1)}}},Ge=async i=>{if(i.preventDefault(),!_||!M){c&&c("error","Preencha título e descrição.");return}if(S&&!m){if(!E){c&&c("error","Nome é obrigatório.");return}if(!K){c&&c("error","Telefone é obrigatório.");return}}te(!0);try{let r=m==null?void 0:m.id;if(S&&!r){const U=Ue(K);if(!navigator.onLine)r=crypto.randomUUID();else if(le()&&R){const{data:W}=await R.from("citizens").select("id").eq("telefone",U).maybeSingle();if(W)r=W.id;else{const{data:Y,error:de}=await R.from("citizens").insert({nome:E,sobrenome:P||".",telefone:U,email:C||null,cep:T||null,logradouro:d||null,numero:q||null,bairro:A||null,cidade:xe||null,estado:Z||null}).select().single();if(de)throw de;r=Y.id}}}const x=crypto.randomUUID(),G={id:x,title:_,description:M,level:se,status:ve,priority:ue,type:ge,deadline:Te||null,citizen_id:r,tags:ce,created_at:new Date().toISOString()};if(navigator.onLine){if(le()&&R){const{error:U}=await R.from("demands").insert(G);if(U)throw U;c&&c("success","Demanda criada com sucesso!")}}else{const U=localStorage.getItem("offline_demands_queue"),W=U?JSON.parse(U):[];W.push(G),localStorage.setItem("offline_demands_queue",JSON.stringify(W)),c&&c("success","Salvo Offline! Será sincronizado quando online.")}setTimeout(()=>s(x),1e3)}catch(r){c&&c("error",`Erro: ${r.message}`),te(!1)}},et=()=>{je.trim()&&!ce.includes(je.trim())&&(Re([...ce,je.trim()]),p(""),Q(!1))};return e.jsxs("div",{className:"h-full flex flex-col relative animate-in fade-in slide-in-from-right duration-500 pb-20",children:[e.jsx("div",{className:"shrink-0 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:l,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:e.jsx(vt,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-2",children:"Nova Demanda"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50 font-medium",children:"Preencha os dados da solicitação."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar pb-6 -mr-2 pr-2",children:e.jsx("div",{className:"max-w-none mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 items-start",children:[e.jsxs("div",{className:"lg:col-span-7 space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-visible z-20",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[e.jsx(dt,{className:"w-4 h-4"})," Solicitante"]})}),e.jsxs("div",{className:"relative",ref:B,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:b,onChange:i=>n(i.target.value),onKeyDown:i=>i.key==="Enter"&&he(b),placeholder:"Buscar por Nome ou Telefone (Enter)",className:`w-full pl-10 pr-10 py-3 glass-input border rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium transition-all ${S?"border-blue-300 dark:border-blue-500/50":"border-slate-300 dark:border-white/10"}`,autoComplete:"off"}),e.jsx(qe,{className:"w-5 h-5 text-slate-400 absolute left-3 top-3.5"}),k&&e.jsx(be,{className:"absolute right-3 top-3.5 w-5 h-5 text-brand-500 animate-spin"})]}),f&&!m&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden max-h-60 overflow-y-auto z-50",children:h.length>0?h.map(i=>e.jsxs("button",{onClick:()=>Qe(i),className:"w-full text-left p-3 hover:bg-slate-50 dark:hover:bg-white/5 border-b border-slate-100 dark:border-white/5 flex flex-col",children:[e.jsx("span",{className:"font-bold text-slate-800 dark:text-white text-sm",children:i.name}),e.jsxs("div",{className:"flex gap-2 text-xs text-slate-500",children:[i.phone&&e.jsx("span",{children:_e(i.phone)}),i.bairro&&e.jsxs("span",{children:["• ",i.bairro]})]})]},i.id)):!k&&b.length>2&&e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Nenhum resultado."}),e.jsx("button",{onClick:Ze,className:"text-sm font-bold text-brand-600 hover:underline",children:"Cadastrar Novo"})]})})]}),m&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-slate-50 dark:bg-white/5 p-4 rounded-2xl border border-slate-100 dark:border-white/5 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white dark:bg-slate-800 rounded-full border border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 font-bold text-brand-600",children:m.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-slate-900 dark:text-white",children:m.name}),e.jsx("p",{className:"text-xs text-slate-500",children:_e(m.phone)})]})]}),e.jsx("button",{onClick:()=>{j(null),n("")},className:"text-xs text-red-500 hover:underline",children:"Trocar"})]}),S&&!m&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl border border-blue-100 dark:border-blue-500/20 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300 text-xs font-bold uppercase",children:[e.jsx(it,{className:"w-4 h-4"})," Novo Cadastro"]}),e.jsx("button",{onClick:()=>I(!1),className:"text-xs text-slate-400 hover:text-slate-600",children:"Cancelar"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Nome",value:E,onChange:i=>g(i.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"text",placeholder:"Sobrenome",value:P,onChange:i=>O(i.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"}),e.jsx("input",{type:"tel",placeholder:"Telefone (Só números)",value:K,onChange:i=>z(Ue(i.target.value)),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"email",placeholder:"Email (Opcional)",value:C,onChange:i=>L(i.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx(fe,{className:"w-4 h-4"})," Endereço da Ocorrência"]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"CEP"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:T,onChange:i=>u(i.target.value),onBlur:Xe,className:"w-full pl-9 pr-8 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm",placeholder:"00000-000"}),e.jsx(qe,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400"}),D&&e.jsx(be,{className:"absolute right-3 top-3 w-4 h-4 text-brand-500 animate-spin"})]})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Cidade"}),e.jsx("input",{type:"text",value:xe,onChange:i=>ie(i.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-9",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Logradouro"}),e.jsx("input",{type:"text",value:d,onChange:i=>$(i.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-3",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Número"}),e.jsx("input",{type:"text",value:q,onChange:i=>ae(i.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Bairro"}),e.jsx("input",{type:"text",value:A,onChange:i=>ee(i.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"UF"}),e.jsx("input",{type:"text",value:Z,onChange:i=>re(i.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm uppercase",maxLength:2})]})]})]})]}),e.jsx("div",{className:"lg:col-span-5 space-y-6",children:e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx(jt,{className:"w-4 h-4"})," Detalhes da Solicitação"]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:ge,onChange:i=>Ce(i.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(Ye).map(i=>e.jsx("option",{value:i,children:i},i))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título"}),e.jsx("input",{type:"text",value:_,onChange:i=>o(i.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base font-bold text-slate-900 dark:text-white",placeholder:"Ex: Buraco na via"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição"}),e.jsx("textarea",{value:M,onChange:i=>J(i.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none",placeholder:"Descreva a situação em detalhes..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Etiquetas (Tags)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:ce.map(i=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1",children:[i,e.jsx(Ee,{onClick:()=>Re(ce.filter(r=>r!==i)),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500"})]},i))}),F?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text",value:je,onChange:i=>p(i.target.value),className:"flex-1 px-3 py-2 rounded-xl border border-slate-300 dark:border-white/10 glass-input text-sm",placeholder:"Nova tag...",onKeyDown:i=>{i.key==="Enter"&&et()}}),e.jsx("button",{type:"button",onClick:et,className:"px-3 py-2 bg-brand-600 text-white rounded-xl text-xs font-bold",children:"Add"})]}):e.jsxs("button",{type:"button",onClick:()=>Q(!0),className:"text-xs text-brand-600 font-bold flex items-center gap-1 hover:underline",children:[e.jsx(_t,{className:"w-3 h-3"})," Adicionar Tag"]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Inicial"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:ve,onChange:i=>Ae(i.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(H).map(i=>e.jsx("option",{value:i,children:i},i))})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:se,onChange:i=>Ie(i.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(Le).map(i=>e.jsx("option",{value:i,children:i},i))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:Te,onChange:i=>Oe(i.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"}),e.jsx(we,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.values(X).map(i=>e.jsxs("label",{className:`flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition-all ${ue===i?i==="Alta"?"text-red-600 bg-red-100":i==="Média"?"text-amber-600 bg-amber-100":"text-green-600 bg-green-100":"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[e.jsx("input",{type:"radio",name:"priority",value:i,checked:ue===i,onChange:()=>me(i),className:"hidden"}),e.jsx("span",{className:"font-bold text-sm uppercase",children:i})]},i))})]})]})]})]})})]})})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-[60] flex gap-3 md:hidden",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:Ge,disabled:ne,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[ne?e.jsx(be,{className:"w-5 h-5 animate-spin"}):navigator.onLine?e.jsx(rt,{className:"w-5 h-5"}):e.jsx(la,{className:"w-5 h-5"}),ne?"Salvando...":navigator.onLine?"Criar":"Salvar Offline"]})]}),e.jsxs("div",{className:"hidden md:flex fixed bottom-6 right-6 z-50 gap-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-3 rounded-xl font-bold text-slate-500 bg-white shadow-lg border border-slate-200 hover:bg-slate-50 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:Ge,disabled:ne,className:"px-8 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-xl flex items-center gap-2 disabled:opacity-70 transition-all",children:[ne?e.jsx(be,{className:"w-5 h-5 animate-spin"}):e.jsx(rt,{className:"w-5 h-5"}),ne?"Salvando...":"Criar Demanda"]})]})]})},Va=({demand:t,onSuccess:s,onCancel:l,onNotification:c})=>{const[b,n]=a.useState(t.title),[h,N]=a.useState(t.description),[f,y]=a.useState(t.level),[k,v]=a.useState(t.status),[m,j]=a.useState(t.priority),[S,I]=a.useState(t.type||Ye.SOLICITACAO),[B,E]=a.useState(t.deadline?t.deadline.split("T")[0]:""),[g,P]=a.useState(null),[O,K]=a.useState(!1),[z,C]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!(!t.citizenId||!le()||!R)){K(!0);try{const{data:D,error:w}=await R.from("citizens").select("*").eq("id",t.citizenId).maybeSingle();if(D)P(D);else{const{data:d}=await R.from("citizens").select("*").eq("cpf",t.citizenId).maybeSingle();d&&P(d)}}catch(D){console.error("Error fetching citizen details:",D.message||D)}finally{K(!1)}}})()},[t.citizenId]);const L=async u=>{u.preventDefault(),C(!0);try{if(!le()||!R)throw new Error("Supabase não configurado.");const{error:D}=await R.from("demands").update({title:b,description:h,level:f,status:k,priority:m,type:S,deadline:B||null}).eq("id",t.id);if(D)throw D;c&&c("success","Alterações salvas com sucesso!"),setTimeout(()=>s(t.id),1e3)}catch(D){c&&c("error",D.message||"Erro ao atualizar demanda."),C(!1)}},T=u=>{switch(u){case X.HIGH:return"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-500/10 border-red-200 dark:border-red-500/20";case X.MEDIUM:return"text-amber-600 dark:text-amber-400 bg-amber-100 dark:bg-amber-500/10 border-amber-200 dark:border-amber-500/20";case X.LOW:return"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-500/10 border-green-200 dark:border-green-500/20"}};return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 md:pb-0 animate-in fade-in slide-in-from-right duration-500 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-slate-50/95 dark:bg-[#020617]/95 backdrop-blur-sm z-20 py-2 md:static md:bg-transparent md:py-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:l,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:[" ",e.jsx(vt,{className:"w-6 h-6"})," "]}),e.jsxs("div",{children:[" ",e.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white tracking-tight flex flex-col md:flex-row md:items-center gap-1 md:gap-2",children:[" Edição de Demanda ",e.jsxs("span",{className:"text-xs md:text-sm font-normal text-slate-400 dark:text-white/40 border border-slate-200 dark:border-white/10 px-2 py-0.5 rounded-md font-mono w-fit",children:["#",t.id.slice(0,8)]})," "]})," "]})]}),e.jsxs("div",{className:"hidden md:flex gap-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 dark:text-white/60 hover:bg-slate-100 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white transition-colors border border-transparent",children:" Cancelar "}),e.jsxs("button",{onClick:L,disabled:z,className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-[0_0_20px_rgba(14,165,233,0.3)] transition-all flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[" ",z?e.jsx(be,{className:"w-5 h-5 animate-spin"}):e.jsx(rt,{className:"w-5 h-5"})," ",z?"Salvando...":"Salvar Alterações"," "]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-500 via-blue-500 to-brand-500"}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[" ",e.jsx(dt,{className:"w-4 h-4"})," Solicitante Vinculado "]}),O?e.jsxs("div",{className:"flex items-center gap-4 animate-pulse",children:[" ",e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-200 dark:bg-white/10 rounded-full"})," ",e.jsxs("div",{className:"space-y-2 flex-1",children:[" ",e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-white/10 rounded w-1/3"})," ",e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-white/10 rounded w-1/4"})," "]})," "]}):g?e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 md:gap-6",children:[" ",e.jsxs("div",{className:"flex items-center gap-4 md:gap-5",children:[" ",e.jsxs("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-100 dark:bg-slate-900 rounded-full border-2 border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 shadow-inner",children:[" ",e.jsx("span",{className:"text-xl md:text-2xl font-bold text-brand-600 dark:text-brand-400",children:g.nome.charAt(0)})," "]})," ",e.jsxs("div",{children:[" ",e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-slate-900 dark:text-white",children:[g.nome," ",g.sobrenome]})," ",g.telefone&&e.jsxs("p",{className:"text-slate-500 dark:text-white/50 font-mono text-xs md:text-sm mt-1 flex items-center gap-2",children:[" ",e.jsx(na,{className:"w-3 h-3"})," ",_e(g.telefone)," "]})," "]})," "]})," ",e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 text-xs md:text-sm",children:[" ",e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-white/80 bg-slate-50 dark:bg-white/5 px-3 py-1.5 rounded-lg border border-slate-200 dark:border-white/5",children:[" ",e.jsx(fe,{className:"w-4 h-4 text-brand-500"})," ",g.cidade," - ",g.estado," "]})," "]})," "]}):e.jsx("div",{className:"text-slate-500 dark:text-white/50 italic text-sm",children:"Cidadão não encontrado."})]}),e.jsxs("div",{className:"glass-panel p-4 md:p-8 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx(jt,{className:"w-4 h-4"})," Detalhes da Solicitação "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:S,onChange:u=>I(u.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(Ye).map(u=>e.jsx("option",{value:u,children:u},u))," "]})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título da Ocorrência"})," ",e.jsx("input",{type:"text",value:b,onChange:u=>n(u.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base md:text-lg font-bold text-slate-900 dark:text-white"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição Detalhada"})," ",e.jsx("textarea",{value:h,onChange:u=>N(u.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none"})," "]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/5",children:[" ",e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/40 uppercase mb-2",children:"Localização Registrada"})," ",e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-white",children:[" ",e.jsx(fe,{className:"w-5 h-5 text-red-500 shrink-0"})," ",e.jsxs("span",{className:"font-medium text-sm",children:[" ",g==null?void 0:g.logradouro,", ",g==null?void 0:g.numero," - ",g==null?void 0:g.bairro,", ",g==null?void 0:g.cidade,"/",g==null?void 0:g.estado," "]})," "]})," "]})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 lg:sticky lg:top-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx(st,{className:"w-4 h-4"})," Controle de Gestão "]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Atual"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:k,onChange:u=>v(u.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(H).map(u=>e.jsx("option",{value:u,children:u},u))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"})," ",e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[" ",Object.values(X).map(u=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${m===u?T(u):"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[" ",e.jsx("input",{type:"radio",name:"priority",value:u,checked:m===u,onChange:()=>j(u),className:"accent-current"})," ",e.jsx("span",{className:"font-bold text-sm uppercase",children:u})," "]},u))," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível de Governo"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:f,onChange:u=>y(u.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(Le).map(u=>e.jsx("option",{value:u,children:u},u))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo Limite"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsx("input",{type:"date",value:B,onChange:u=>E(u.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"})," ",e.jsx(we,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})," "]})," "]})]})]})})]}),e.jsxs("div",{className:"md:hidden fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-30 flex gap-3 pb-6",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:" Cancelar "}),e.jsxs("button",{onClick:L,disabled:z,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[" ",z?e.jsx(be,{className:"w-5 h-5 animate-spin"}):e.jsx(rt,{className:"w-5 h-5"})," ",z?"Salvando...":"Salvar"," "]})]})]})},Wa=()=>e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none select-none p-4 lg:p-8 flex gap-6 bg-slate-100 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"hidden lg:flex w-72 h-full flex-col gap-8 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-8 opacity-40 blur-[2px] shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-5 w-32 bg-slate-200 dark:bg-white/10 rounded-lg"})]}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-12 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"},t))}),e.jsx("div",{className:"mt-auto h-14 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6 opacity-30 lg:opacity-50 blur-[3px] lg:blur-[1px]",children:[e.jsxs("div",{className:"h-24 w-full bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 flex items-center justify-between px-10 shadow-sm",children:[e.jsx("div",{className:"h-8 w-64 bg-slate-200 dark:bg-white/10 rounded-xl"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"})]})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"h-40 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-6 flex flex-col justify-between shadow-sm",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-100 dark:bg-white/5"}),e.jsx("div",{className:"h-5 w-24 bg-slate-200 dark:bg-white/10 rounded-lg"})]},t))}),e.jsx("div",{className:"flex-1 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-10 flex items-end justify-between gap-6 shadow-sm",children:[40,70,50,90,60,80,50,75,45,65,85,55,70,40,60].map((t,s)=>e.jsx("div",{className:"w-full bg-slate-200 dark:bg-white/5 rounded-t-xl",style:{height:`${t}%`}},s))})]})]}),Ja=({onLogin:t})=>{const[s,l]=a.useState("login"),[c,b]=a.useState(!1),[n,h]=a.useState(!1),[N,f]=a.useState(""),[y,k]=a.useState(""),[v,m]=a.useState(""),[j,S]=a.useState(""),[I,B]=a.useState(null),[E,g]=a.useState(!1),[P,O]=a.useState(null);a.useEffect(()=>{h(!0)},[]);const K=a.useMemo(()=>async w=>{const d=new TextEncoder().encode(w),$=await crypto.subtle.digest("SHA-256",d);return Array.from(new Uint8Array($)).map(ae=>ae.toString(16).padStart(2,"0")).join("")},[]),z=a.useMemo(()=>{const w=v;return{length:w.length>=8&&w.length<=12,hasUpper:/[A-Z]/.test(w),isAlphanumeric:/[a-zA-Z]/.test(w)&&/[0-9]/.test(w),match:w===j&&w.length>0}},[v,j]),C=Object.values(z).every(Boolean),L=async w=>{w.preventDefault(),g(!0),O(null);try{if(le()&&R){const d=await K(y),{data:$,error:q}=await R.from("system_users").select("*").eq("email",N).maybeSingle();if(q)throw q;if(!$||$.senha_hash!==d){O("Credenciais inválidas."),g(!1);return}if(!$.ativo){O("Conta desativada."),g(!1);return}if(!$.last_login){B($),l("new_password"),g(!1);return}await u($)}else await new Promise(d=>setTimeout(d,800)),N==="admin@admin"&&y==="admin"?await u({id:"demo-admin",email:"admin@admin",name:"Administrador Demo",role:"administrador",avatar:"https://ui-avatars.com/api/?name=Admin&background=0284c7&color=fff"},!0):(O("Credenciais inválidas."),g(!1))}catch{O("Erro ao processar login."),g(!1)}},T=async w=>{if(w.preventDefault(),!(!C||!I)){if(g(!0),O(null),v==="Senha4321"){O("A nova senha não pode ser igual à senha padrão."),g(!1);return}try{if(le()&&R){const d=await K(v),{error:$}=await R.from("system_users").update({senha_hash:d,last_login:new Date().toISOString()}).eq("id",I.id);if($)throw $;const q={...I,last_login:new Date().toISOString()};await u(q)}}catch(d){O("Erro ao salvar nova senha: "+d.message),g(!1)}}},u=async(w,d=!1)=>{!d&&le()&&R&&s==="login"&&await R.from("system_users").update({last_login:new Date().toISOString()}).eq("id",w.id);const $=d?w:{id:w.id,email:w.email,name:w.nome,role:w.perfil,avatar:`https://ui-avatars.com/api/?name=${w.nome}&background=0284c7&color=fff`};b(!0),setTimeout(()=>{localStorage.setItem("geo_user",JSON.stringify($)),t($)},400)},D=({fulfilled:w,label:d})=>e.jsxs("div",{className:`flex items-center gap-2 text-xs transition-colors duration-200 ${w?"text-emerald-600 font-bold":"text-slate-400"}`,children:[e.jsx("div",{className:`w-3.5 h-3.5 rounded-full flex items-center justify-center border ${w?"bg-emerald-500 border-emerald-500 text-white":"border-slate-300 bg-transparent"}`,children:w&&e.jsx(ct,{className:"w-2.5 h-2.5"})}),e.jsx("span",{children:d})]});return e.jsxs("div",{className:`fixed inset-0 z-[100] bg-slate-50 dark:bg-[#020617] transition-all duration-700 overflow-hidden ${c?"opacity-0 scale-105 pointer-events-none":"opacity-100"}`,children:[e.jsx(Wa,{}),e.jsx("div",{className:"absolute inset-0 bg-white/40 dark:bg-black/60 backdrop-blur-[4px] z-10 transition-colors duration-700"}),e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col lg:flex-row w-full h-full",children:[e.jsx("div",{className:"w-full lg:w-1/2 h-full flex items-center justify-center p-6 relative",children:e.jsxs("div",{className:`
                  w-full max-w-[440px]
                  bg-white/80 dark:bg-[#0f172a]/70 backdrop-blur-2xl 
                  border border-white/50 dark:border-white/10 
                  shadow-[0_8px_40px_-12px_rgba(0,0,0,0.1)] dark:shadow-black/50
                  rounded-[2.5rem] p-8 md:p-12
                  transform transition-all duration-700 ease-out flex flex-col
                  ${n?"translate-y-0 opacity-100 scale-100":"translate-y-12 opacity-0 scale-95"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-4 mb-10",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-600 to-brand-700 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-600/20 text-white ring-4 ring-white/50 dark:ring-white/5",children:e.jsx(oa,{className:"w-7 h-7"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-extrabold text-slate-900 dark:text-white tracking-tight leading-none",children:["Gabinete",e.jsx("br",{}),"Digital"]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:s==="login"?"Acesso ao Painel":"Configuração Inicial"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1 font-medium",children:s==="login"?"Gerencie seu mandato com eficiência.":"Defina sua senha de segurança."})]}),P&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-500/20 text-red-600 dark:text-red-300 text-sm font-bold rounded-2xl flex items-center gap-3 animate-in slide-in-from-left-2 shadow-sm",children:[e.jsx(it,{className:"w-5 h-5 flex-shrink-0"}),P]}),s==="login"?e.jsxs("form",{onSubmit:L,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(Mt,{className:"w-5 h-5"})}),e.jsx("input",{type:"email",value:N,onChange:w=>f(w.target.value),className:"block w-full pl-11 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Email",required:!0,autoComplete:"email"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(da,{className:"w-5 h-5"})}),e.jsx("input",{type:"password",value:y,onChange:w=>k(w.target.value),className:"block w-full pl-11 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Senha",required:!0,autoComplete:"current-password"})]})]}),e.jsxs("button",{type:"submit",disabled:E,className:"w-full py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-base transition-all transform active:scale-[0.98] shadow-lg shadow-brand-600/20 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed group relative overflow-hidden",children:[E?e.jsx(be,{className:"w-5 h-5 animate-spin"}):e.jsx(ia,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"}),E?"Conectando...":"Entrar"]})]}):e.jsxs("form",{onSubmit:T,className:"space-y-6 animate-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"password",value:v,onChange:w=>m(w.target.value),className:"block w-full pl-5 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Nova Senha",maxLength:12,autoComplete:"new-password"})}),e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"password",value:j,onChange:w=>S(w.target.value),className:"block w-full pl-5 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Confirmar Senha",maxLength:12,autoComplete:"new-password"})})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-2xl border border-slate-100 dark:border-white/5 grid grid-cols-2 gap-3",children:[e.jsx(D,{fulfilled:z.length,label:"8-12 dígitos"}),e.jsx(D,{fulfilled:z.isAlphanumeric,label:"Letras/Números"}),e.jsx(D,{fulfilled:z.hasUpper,label:"Maiúscula"}),e.jsx(D,{fulfilled:z.match,label:"Senhas Iguais"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{l("login"),m(""),S(""),B(null)},className:"flex-1 py-4 bg-white dark:bg-white/5 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-white/10 rounded-2xl font-bold text-sm border border-slate-200 dark:border-white/10 transition-colors",children:"Voltar"}),e.jsxs("button",{type:"submit",disabled:E||!C,className:"flex-[2] py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 disabled:opacity-50 transition-all",children:[E?e.jsx(be,{className:"w-5 h-5 animate-spin"}):e.jsx(Ve,{className:"w-5 h-5"})," Confirmar"]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-200/50 dark:border-white/5 text-center",children:e.jsxs("p",{className:"text-[10px] uppercase font-bold text-slate-400 dark:text-slate-500 tracking-widest",children:["Desenvolvido por ",e.jsx("a",{href:"mailto:leowaltrick@gmail.com?subject=App Gabinete Digital",title:"Entrar em contato",className:"text-brand-600 dark:text-brand-400 hover:opacity-80 transition-opacity",children:"LW Consulting"})]})})]})}),e.jsx("div",{className:"hidden lg:flex w-1/2 h-full items-center justify-center p-12 xl:p-20 relative pointer-events-none",children:e.jsxs("div",{className:`
                  w-full max-w-xl pointer-events-auto
                  transform transition-all duration-1000 delay-200 flex flex-col gap-10
                  ${n?"translate-x-0 opacity-100":"translate-x-20 opacity-0"}
              `,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-extrabold text-slate-900 dark:text-white leading-tight mb-4 drop-shadow-sm",children:["Gestão inteligente",e.jsx("br",{}),"para mandatos modernos."]}),e.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-300 font-medium leading-relaxed",children:"Centralize demandas, acompanhe solicitações e tome decisões estratégicas baseadas em dados."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{title:"Central de Demandas",icon:Ke,desc:"Acompanhe solicitações em tempo real."},{title:"Base de Cidadãos",icon:Pe,desc:"Histórico completo de atendimentos."},{title:"Mapa de Calor",icon:Lt,desc:"Geolocalização de ocorrências."},{title:"Gestão de Prazos",icon:we,desc:"Alertas automáticos de vencimento."},{title:"Analytics",icon:Ot,desc:"Indicadores de desempenho do gabinete."},{title:"Controle de Acesso",icon:ca,desc:"Permissões granulares por perfil."}].map((w,d)=>e.jsxs("div",{className:"bg-white/60 dark:bg-black/40 backdrop-blur-md border border-white/40 dark:border-white/10 p-4 rounded-2xl shadow-sm hover:bg-white/80 dark:hover:bg-white/10 transition-colors duration-300",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 mb-3",children:e.jsx(w.icon,{className:"w-5 h-5"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white text-sm mb-1",children:w.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-snug",children:w.desc})]},d))})]})})]})]})},Me=({options:t,value:s,onChange:l,size:c="md"})=>{const b=t.findIndex(n=>n.value===s);return e.jsxs("div",{className:`bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex relative border border-slate-200 dark:border-white/5 shadow-inner min-w-max ${c==="sm"?"h-9":"h-11"}`,children:[e.jsx("div",{className:"absolute top-1 bottom-1 rounded-lg bg-white dark:bg-slate-600 shadow-sm transition-all duration-300 ease-out z-0",style:{width:`calc(${100/t.length}% - 0.35rem)`,left:`calc(${b*(100/t.length)}% + 0.18rem)`}}),t.map(n=>{const h=s===n.value,N=n.icon;return e.jsxs("button",{onClick:()=>l(n.value),className:`
                flex-1 px-3 text-xs font-bold rounded-lg transition-all duration-300 relative z-10 flex items-center justify-center gap-1.5 whitespace-nowrap
                ${h?"text-brand-600 dark:text-white":"text-slate-500 dark:text-white/40 hover:text-slate-700"}
            `,children:[N&&e.jsx(N,{className:c==="sm"?"w-3 h-3":"w-4 h-4"}),n.label]},n.value)})]})},Ya=({demands:t,citizens:s,onViewDemand:l,onUpdateStatus:c})=>{const[b,n]=a.useState(null),[h,N]=a.useState(H.PENDING),f=[{id:H.PENDING,label:"Pendente",icon:pe,color:"text-slate-500",bg:"bg-slate-100 dark:bg-slate-900/50",border:"border-slate-300 dark:border-slate-700"},{id:H.IN_PROGRESS,label:"Em Andamento",icon:We,color:"text-amber-500",bg:"bg-amber-50 dark:bg-amber-900/10",border:"border-amber-300 dark:border-amber-700"},{id:H.COMPLETED,label:"Concluído",icon:$e,color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/10",border:"border-green-300 dark:border-green-700"}],y=(m,j)=>{n(j),m.dataTransfer.setData("demandId",j),m.dataTransfer.effectAllowed="move"},k=m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},v=(m,j)=>{m.preventDefault();const S=m.dataTransfer.getData("demandId");S&&c(S,j),n(null)};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500",children:[e.jsx("div",{className:"md:hidden landscape:hidden px-1 pb-3 shrink-0",children:e.jsx(Me,{value:h,onChange:m=>N(m),options:[{value:H.PENDING,label:"Pendente",icon:pe},{value:H.IN_PROGRESS,label:"Andamento",icon:We},{value:H.COMPLETED,label:"Concluído",icon:$e}]})}),e.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-auto md:overflow-visible custom-scrollbar",children:e.jsx("div",{className:"flex flex-col landscape:flex-row md:flex-row h-full landscape:gap-4 md:gap-6 pb-4",children:f.map(m=>{const j=t.filter(E=>E.status===m.id),S=m.icon,B=h===m.id?"flex":"hidden landscape:flex md:flex";return e.jsxs("div",{className:`${B} flex-1 flex-col min-w-0 md:min-w-[320px] md:max-w-md h-full transition-all duration-300`,onDragOver:k,onDrop:E=>v(E,m.id),children:[e.jsxs("div",{className:`p-3 md:p-4 rounded-t-3xl border-x border-t border-slate-200 dark:border-white/10 ${m.bg} backdrop-blur-sm flex justify-between items-center relative md:sticky top-0 z-10 shrink-0`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:`w-5 h-5 ${m.color}`}),e.jsx("h3",{className:"font-bold text-slate-700 dark:text-white text-sm md:text-base",children:m.label})]}),e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-white dark:bg-white/10 text-xs font-bold text-slate-600 dark:text-white shadow-sm border border-slate-100 dark:border-white/5",children:j.length})]}),e.jsx("div",{className:`flex-1 overflow-y-auto p-2 landscape:p-2 md:p-3 space-y-3 border-x border-b border-slate-200 dark:border-white/10 rounded-b-3xl bg-white/30 dark:bg-white/5 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/10 transition-colors ${b?"bg-slate-50/50 dark:bg-white/10":""}`,children:j.length===0?e.jsx("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 dark:text-white/20 border-2 border-dashed border-slate-300 dark:border-white/10 rounded-xl m-2",children:e.jsx("p",{className:"text-sm",children:"Vazio"})}):j.map(E=>{const g=s.find(P=>P.id===E.citizenId);return e.jsxs("div",{draggable:!0,onDragStart:P=>y(P,E.id),onClick:()=>l(E),className:`
                                                    bg-white dark:bg-[#1e293b] rounded-xl border border-slate-200 dark:border-white/5 shadow-sm 
                                                    hover:shadow-md hover:border-brand-500/50 dark:hover:border-brand-500/50 
                                                    transition-all cursor-pointer group relative overflow-hidden active:cursor-grabbing
                                                    p-4 landscape:p-2.5 
                                                `,children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${E.priority===X.HIGH?"bg-red-500":E.priority===X.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-2 landscape:mb-1",children:[e.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-white/40 font-mono",children:["#",E.id.slice(0,6)]}),e.jsxs("div",{className:"flex gap-1",children:[E.level===Le.FEDERAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500",title:"Federal"}),E.level===Le.ESTADUAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500",title:"Estadual"})]})]}),e.jsx("h4",{className:"font-bold text-slate-800 dark:text-white text-sm leading-snug mb-2 pl-2 group-hover:text-brand-600 dark:group-hover:text-brand-400 transition-colors landscape:mb-1 landscape:line-clamp-2",children:E.title}),e.jsxs("div",{className:"flex items-center gap-2 pl-2 mb-3 landscape:mb-1",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-[10px] font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:(g==null?void 0:g.name.charAt(0))||"?"}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 truncate max-w-[120px] landscape:hidden",children:(g==null?void 0:g.name)||"Não identificado"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100 dark:border-white/5 pl-2 landscape:hidden",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 dark:text-white/40",children:[e.jsx(we,{className:"w-3 h-3"})," ",new Date(E.createdAt).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"})]}),E.deadline&&e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${new Date(E.deadline)<new Date?"bg-red-100 text-red-600":"bg-slate-100 text-slate-500"} dark:bg-white/10 dark:text-white/60`,children:Be(E.deadline)})]})]},E.id)})})]},m.id)})})})]})},Ka=({demands:t,interactions:s=[],notices:l=[],onEditDemand:c})=>{const[b,n]=a.useState(new Date),[h,N]=a.useState(null),[f,y]=a.useState(!0),[k,v]=a.useState(!0),[m,j]=a.useState(!0),S=b.getFullYear(),I=b.getMonth(),B=new Date(S,I+1,0).getDate(),E=new Date(S,I,1).getDay(),g=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],P=()=>{n(new Date(S,I-1,1)),N(null)},O=()=>{n(new Date(S,I+1,1)),N(null)},K=()=>{const d=new Date;n(d),N(d.getDate())},z=(d,$)=>{const q=d.split("T")[0].split("-").map(Number);return q[2]===$&&q[1]-1===I&&q[0]===S},C=d=>{const $=f?t.filter(A=>A.deadline&&z(A.deadline,d)):[],q=k?s.filter(A=>A.type==="checklist"&&A.deadline&&!A.isCompleted&&z(A.deadline,d)):[],ae=m?l.filter(A=>z(A.date,d)):[];return{demands:$,checklists:q,notices:ae}},L=[...f?t.filter(d=>d.deadline&&d.status!==H.COMPLETED).map(d=>({type:"demand",data:d,date:new Date(d.deadline)})):[],...k?s.filter(d=>d.type==="checklist"&&d.deadline&&!d.isCompleted).map(d=>({type:"checklist",data:d,date:new Date(d.deadline)})):[],...m?l.filter(d=>new Date(d.date)>=new Date).map(d=>({type:"notice",data:d,date:new Date(d.date)})):[]].sort((d,$)=>d.date.getTime()-$.date.getTime()).slice(0,15),T=h?C(h):{demands:[],checklists:[],notices:[]},u=d=>{switch(d){case X.HIGH:return"bg-red-100 text-red-700 dark:bg-red-500/20 dark:text-red-300 border-l-2 border-red-500";case X.MEDIUM:return"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300 border-l-2 border-amber-500";case X.LOW:return"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300 border-l-2 border-green-500"}},D=d=>{switch(d){case"alert":return e.jsx(zt,{className:"w-3 h-3 text-red-500"});case"event":return e.jsx(we,{className:"w-3 h-3 text-blue-500"});default:return e.jsx(xa,{className:"w-3 h-3 text-slate-500"})}},w=()=>{const d=[];for(let $=0;$<E;$++)d.push(e.jsx("div",{className:"min-h-[80px] bg-slate-50/30 dark:bg-slate-900/20 border-r border-b border-slate-200 dark:border-white/5"},`empty-${$}`));for(let $=1;$<=B;$++){const{demands:q,checklists:ae,notices:A}=C($),ee=q.length+ae.length+A.length,xe=$===new Date().getDate()&&I===new Date().getMonth()&&S===new Date().getFullYear(),ie=$===h;d.push(e.jsxs("div",{onClick:()=>N($),className:`
                min-h-[80px] md:min-h-[120px] h-auto flex flex-col
                border-r border-b border-slate-200 dark:border-white/5 p-1 md:p-2 relative group hover:bg-slate-50 dark:hover:bg-white/5 transition-colors cursor-pointer
                ${ie?"bg-brand-50 dark:bg-brand-900/10 shadow-[inset_0_0_0_2px_rgba(14,165,233,0.5)]":xe?"bg-brand-500/5":"bg-transparent"}
            `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`text-xs md:text-sm font-bold w-6 h-6 md:w-7 md:h-7 flex items-center justify-center rounded-full transition-all
                ${xe?"bg-brand-500 text-white shadow-lg shadow-brand-500/30":ie?"bg-slate-900 dark:bg-white text-white dark:text-slate-900":"text-slate-500 dark:text-white/50"}
            `,children:$}),ee>0&&e.jsx("span",{className:"text-[9px] bg-slate-200 dark:bg-white/10 text-slate-600 dark:text-white/70 px-1.5 py-0.5 rounded-full font-bold",children:ee})]}),e.jsxs("div",{className:"space-y-1 overflow-y-hidden flex-1",children:[e.jsxs("div",{className:"hidden md:block space-y-1",children:[A.map(Z=>e.jsxs("div",{className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 ${Z.type==="alert"?"border-red-400 bg-red-50 dark:bg-red-500/10":"border-blue-400 bg-blue-50 dark:bg-blue-500/10"}`,children:[D(Z.type)," ",Z.title]},Z.id)),q.slice(0,3-A.length).map(Z=>e.jsx("div",{className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 ${u(Z.priority)}`,children:Z.title},Z.id)),ae.slice(0,Math.max(0,3-(q.length+A.length))).map(Z=>e.jsxs("div",{className:"w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 border-l-slate-400 bg-slate-100 dark:bg-white/5 text-slate-600 dark:text-white/60",children:[e.jsx(Rt,{className:"w-2 h-2"})," ",Z.text]},Z.id)),q.length+ae.length+A.length>3&&e.jsxs("div",{className:"text-[9px] text-slate-400 pl-1",children:["+ ",ee-3," mais"]})]}),e.jsxs("div",{className:"md:hidden flex flex-wrap justify-center content-end h-full pb-1 gap-1",children:[A.map((Z,re)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"},`n-${re}`)),q.map((Z,re)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-500"},`d-${re}`)),ae.map((Z,re)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"},`c-${re}`))]})]})]},$))}return d};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 shrink-0",children:[e.jsxs("button",{onClick:()=>y(!f),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${f?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-500/20 dark:border-brand-500/30 dark:text-brand-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${f?"bg-brand-500":"bg-slate-300"}`})," Demandas"]}),e.jsxs("button",{onClick:()=>v(!k),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${k?"bg-slate-100 border-slate-300 text-slate-700 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${k?"bg-slate-500":"bg-slate-300"}`})," Checklists"]}),e.jsxs("button",{onClick:()=>j(!m),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${m?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-500/20 dark:border-blue-500/30 dark:text-blue-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${m?"bg-blue-500":"bg-slate-300"}`})," Avisos"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-6 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 glass-panel rounded-3xl shadow-sm border border-slate-200 dark:border-white/10 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 md:p-6 border-b border-slate-200 dark:border-white/10 flex items-center justify-between bg-white/50 dark:bg-white/5 backdrop-blur-sm shrink-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white capitalize flex items-center gap-2",children:[e.jsx(we,{className:"w-6 h-6 text-brand-600 dark:text-brand-400"}),g[I]," ",e.jsx("span",{className:"text-slate-400 dark:text-white/40 font-normal",children:S})]}),e.jsxs("div",{className:"flex bg-white dark:bg-white/10 rounded-xl border border-slate-200 dark:border-white/10 shadow-sm",children:[e.jsx("button",{onClick:P,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-l-xl border-r border-slate-200 dark:border-white/10",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:K,className:"px-4 text-xs font-bold text-slate-600 dark:text-white/70 hover:bg-slate-50 dark:hover:bg-white/10",children:"Hoje"}),e.jsx("button",{onClick:O,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-r-xl border-l border-slate-200 dark:border-white/10",children:e.jsx(Je,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"grid grid-cols-7 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(d=>e.jsx("div",{className:"py-2 text-center text-[10px] md:text-xs font-bold text-slate-500 dark:text-white/30 uppercase tracking-wider",children:d},d))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"grid grid-cols-7 bg-transparent min-h-full",children:w()})})]}),e.jsx("div",{className:"w-full lg:w-80 glass-panel rounded-3xl border border-slate-200 dark:border-white/10 flex flex-col shrink-0 overflow-hidden h-[300px] lg:h-auto",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:[h," de ",g[I]]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-white/50",children:[T.demands.length+T.checklists.length+T.notices.length," eventos"]})]}),e.jsx("button",{onClick:()=>N(null),className:"text-xs text-brand-600 hover:underline",children:"Ver Geral"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar",children:[[...T.notices,...T.demands,...T.checklists].map((d,$)=>e.jsxs("div",{className:"p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10",children:[e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white line-clamp-2",children:d.title||d.text}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 capitalize",children:d.type==="checklist"?"Tarefa":d.type||"Demanda"})]},$)),T.demands.length===0&&T.notices.length===0&&T.checklists.length===0&&e.jsx("p",{className:"text-center text-xs text-slate-400 mt-4",children:"Nada para este dia."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-brand-600 dark:text-brand-400"}),"Próximos Prazos"]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-white/50",children:"Visão geral de urgências e avisos"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:L.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-slate-400 dark:text-white/30 text-center",children:[e.jsx(pe,{className:"w-10 h-10 mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Nenhum evento futuro."})]}):L.map((d,$)=>{const q=d.date.getDate()===new Date().getDate(),ae=d.type==="notice"?"bg-blue-50 text-blue-600 border-blue-100 dark:bg-blue-500/10 dark:text-blue-400":d.type==="demand"?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400":"bg-slate-50 text-slate-600 border-slate-100 dark:bg-white/5 dark:text-slate-400";return e.jsxs("div",{onClick:()=>d.type==="demand"&&c(d.data),className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:`w-10 h-10 rounded-lg flex flex-col items-center justify-center font-bold shrink-0 border ${ae}`,children:[e.jsx("span",{className:"text-xs",children:d.date.getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:d.date.toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:d.type==="notice"||d.type==="demand"?d.data.title:d.data.text}),d.type==="demand"&&e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${q?"bg-red-100 text-red-600":"bg-slate-100 text-slate-600"} dark:bg-white/10`,children:q?"HOJE":d.data.status})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:d.type==="notice"?"Aviso Mural":d.type==="demand"?d.data.description:"Tarefa Checklist"})]})]},`${d.type}-${d.data.id}-${$}`)})})]})})]})]})},Qa=({currentPage:t,totalPages:s,onPageChange:l,totalItems:c,itemsPerPage:b})=>{if(s<=1)return null;const n=(t-1)*b+1,h=Math.min(t*b,c);return e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 py-4 px-2 border-t border-slate-200 dark:border-white/10 mt-auto",children:[e.jsxs("div",{className:"text-xs text-slate-500 dark:text-white/50 font-medium order-2 sm:order-1",children:["Mostrando ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:n})," a ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:h})," de ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:c})," registros"]}),e.jsxs("div",{className:"flex items-center gap-2 order-1 sm:order-2",children:[e.jsx("button",{onClick:()=>l(t-1),disabled:t===1,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Página anterior",children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-1 px-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700 dark:text-white",children:t}),e.jsx("span",{className:"text-sm text-slate-400 dark:text-white/40",children:"/"}),e.jsx("span",{className:"text-sm text-slate-500 dark:text-white/50 font-medium",children:s})]}),e.jsx("button",{onClick:()=>l(t+1),disabled:t===s,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Próxima página",children:e.jsx(Je,{className:"w-4 h-4"})})]})]})},Za=ye.memo(({demand:t,onUpdateStatus:s})=>{const l=n=>{s(t.id,n.target.value)},c=n=>n.stopPropagation(),b=n=>{switch(n){case H.COMPLETED:return"bg-green-50 text-green-700 border-green-200 dark:bg-green-500/10 dark:text-green-400 dark:border-green-500/20";case H.IN_PROGRESS:return"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";default:return"bg-slate-100 text-slate-600 border-slate-200 dark:bg-white/5 dark:text-slate-400 dark:border-white/10"}};return e.jsxs("div",{className:"relative inline-block group/status",onClick:c,children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg border transition-colors shadow-sm ${b(t.status)}`,children:[t.status===H.COMPLETED&&e.jsx($e,{className:"w-3.5 h-3.5"}),t.status===H.IN_PROGRESS&&e.jsx(We,{className:"w-3.5 h-3.5"}),t.status===H.PENDING&&e.jsx(pe,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:t.status}),e.jsx("div",{className:"ml-1 pl-1 border-l border-current/20 opacity-50",children:e.jsx(lt,{className:"w-3 h-3"})})]}),e.jsx("select",{value:t.status,onChange:l,onClick:c,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer font-bold text-sm appearance-none",children:Object.values(H).map(n=>e.jsx("option",{value:n,children:n},n))})]})}),Xa=({demands:t,citizens:s,onUpdateStatus:l,onEdit:c,onViewDemand:b,initialSelectionId:n,clearSelection:h,onInteractionUpdate:N,onNotification:f,onViewCitizen:y})=>{const[k,v]=a.useState("createdAt"),[m,j]=a.useState("desc"),[S,I]=a.useState(1),B=10,E=C=>{k===C?j(L=>L==="asc"?"desc":"asc"):(v(C),j("desc"))},g=C=>k!==C?e.jsx(ha,{className:"w-3 h-3 text-slate-300"}):m==="asc"?e.jsx(ma,{className:"w-3 h-3 text-brand-600"}):e.jsx(ba,{className:"w-3 h-3 text-brand-600"}),P=a.useMemo(()=>[...t].sort((C,L)=>{let T=0;switch(k){case"createdAt":T=new Date(C.createdAt).getTime()-new Date(L.createdAt).getTime();break;case"deadline":const u=C.deadline?new Date(C.deadline).getTime():0,D=L.deadline?new Date(L.deadline).getTime():0;T=u-D;break;case"priority":const w={[X.LOW]:1,[X.MEDIUM]:2,[X.HIGH]:3};T=w[C.priority]-w[L.priority];break;case"status":const d={[H.PENDING]:1,[H.IN_PROGRESS]:2,[H.COMPLETED]:3};T=d[C.status]-d[L.status];break;default:T=0}return m==="asc"?T:-T}),[t,k,m]);a.useEffect(()=>{I(1)},[t]);const O=Math.ceil(P.length/B),K=P.slice((S-1)*B,S*B),z=C=>{switch(C){case X.HIGH:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-red-100 text-red-600 dark:bg-red-500/10 dark:text-red-300 border border-red-200 dark:border-red-500/20",children:"Alta"});case X.MEDIUM:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-amber-100 text-amber-600 dark:bg-amber-500/10 dark:text-amber-300 border border-amber-200 dark:border-amber-500/20",children:"Média"});case X.LOW:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-green-100 text-green-600 dark:bg-green-500/10 dark:text-green-300 border border-green-200 dark:border-green-500/20",children:"Baixa"})}};return e.jsx("div",{className:"flex flex-col w-full gap-2 relative",children:e.jsx("div",{className:"glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-slate-900/50 shadow-sm relative w-full flex flex-col min-h-0",children:P.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 dark:text-white/30 text-sm py-20",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-4",children:e.jsx(qe,{className:"w-6 h-6 opacity-30"})}),e.jsx("p",{children:"Nenhuma demanda encontrada."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full relative",children:[e.jsxs("table",{className:"w-full text-left border-collapse hidden md:table",children:[e.jsx("thead",{className:"bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-sm border-b border-slate-200 dark:border-white/10",children:e.jsxs("tr",{className:"text-xs font-bold text-slate-500 dark:text-blue-200/50 uppercase tracking-wider",children:[e.jsx("th",{className:"p-4 first:pl-6 w-[35%] min-w-[200px]",children:"Título"}),e.jsx("th",{className:"p-4 w-[20%] min-w-[150px]",children:"Solicitante"}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>E("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",g("status")]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>E("priority"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prioridade ",g("priority")]})}),e.jsx("th",{className:"p-4 hidden lg:table-cell cursor-pointer",onClick:()=>E("createdAt"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Criação ",g("createdAt")]})}),e.jsx("th",{className:"p-4 hidden xl:table-cell cursor-pointer",onClick:()=>E("deadline"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prazo ",g("deadline")]})}),e.jsx("th",{className:"p-4 text-right last:pr-6 w-[80px]",children:"Ação"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-white/5 text-sm",children:K.map(C=>{const L=s.find(T=>T.id===C.citizenId);return e.jsxs("tr",{onClick:()=>b(C),className:"hover:bg-white/60 dark:hover:bg-white/5 transition-colors cursor-pointer group",children:[e.jsxs("td",{className:"p-4 first:pl-6",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white truncate max-w-[250px]",title:C.title,children:C.title}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-white/50 truncate mt-0.5 max-w-[250px]",children:C.description})]}),e.jsx("td",{className:"p-4",children:L?e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group/citizen p-1 -ml-1 rounded-lg hover:bg-brand-50 dark:hover:bg-white/10 transition-colors",onClick:T=>{T.stopPropagation(),y&&y(L.id)},children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs border border-slate-200 dark:border-white/10 shrink-0",children:L.name.charAt(0)}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"font-medium text-slate-900 dark:text-white truncate max-w-[150px] group-hover/citizen:text-brand-600 transition-colors",children:L.name})})]}):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"Não vinculado"})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:e.jsx(Za,{demand:C,onUpdateStatus:l})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:z(C.priority)}),e.jsx("td",{className:"p-4 hidden lg:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:new Date(C.createdAt).toLocaleDateString()}),e.jsx("td",{className:"p-4 hidden xl:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:C.deadline?Be(C.deadline):"-"}),e.jsx("td",{className:"p-4 text-right last:pr-6",children:e.jsx("div",{className:"p-2 text-slate-400 group-hover:text-brand-600 transition-colors inline-flex bg-slate-100 dark:bg-white/5 rounded-lg group-hover:bg-brand-50 dark:group-hover:bg-brand-500/10",children:e.jsx(Ve,{className:"w-4 h-4"})})})]},C.id)})})]}),e.jsx("div",{className:"md:hidden space-y-3 p-3",children:K.map(C=>{const L=s.find(T=>T.id===C.citizenId);return e.jsxs("div",{onClick:()=>b(C),className:"glass-panel p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm active:scale-[0.98] transition-all cursor-pointer relative overflow-hidden group",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${C.priority===X.HIGH?"bg-red-500":C.priority===X.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-xs font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:L?L.name.charAt(0):"?"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-bold text-slate-900 dark:text-white truncate",children:L?L.name.split(" ")[0]:"S/ Solicitante"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-white/50",children:new Date(C.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase border ${C.status===H.COMPLETED?"bg-green-50 text-green-700 border-green-200":"bg-slate-50 text-slate-600 border-slate-200"}`,children:C.status})]}),e.jsxs("div",{className:"pl-3",children:[e.jsx("h4",{className:"font-bold text-sm text-slate-800 dark:text-white mb-1 leading-snug",children:C.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/60 line-clamp-2 mb-3",children:C.description}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-100 dark:border-white/5 pt-2",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 font-bold uppercase",children:[e.jsx(fe,{className:"w-3 h-3"})," ",C.level]}),e.jsxs("div",{className:"flex items-center gap-1 text-brand-600 text-xs font-bold",children:["Detalhes ",e.jsx(Ve,{className:"w-3 h-3"})]})]})]})]},C.id)})})]}),e.jsx("div",{className:"bg-slate-50/50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-white/5 rounded-b-3xl",children:e.jsx(Qa,{currentPage:S,totalPages:O,onPageChange:I,totalItems:P.length,itemsPerPage:B})})]})})})};Se.Icon&&Se.Icon.Default&&(delete Se.Icon.Default.prototype._getIconUrl,Se.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}));const bt={},es=(t,s,l)=>t==="citizen"?"blue":s===H.COMPLETED?"green":l===X.HIGH?"red":s===H.IN_PROGRESS?"orange":l===X.MEDIUM?"gold":"blue",ts=(t,s,l)=>{const c=es(t,s,l),b=`${t}-${c}`;if(bt[b])return bt[b];const n=new Se.Icon({iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${c}.png`,shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:t==="citizen"?"custom-citizen-icon":""});return bt[b]=n,n},as=({markers:t})=>{const s=Bt(),[l,c]=a.useState([]),b=a.useRef(null),n=a.useCallback(()=>{if(!s)return;const h=s.getBounds();let N=2e3;const f=h.pad(.2),y=t.filter(k=>f.contains(Se.latLng(k.lat,k.lon)));c(y.slice(0,N))},[s,t]);return a.useEffect(()=>{n()},[t]),a.useEffect(()=>{if(!s)return;const h=()=>{b.current&&clearTimeout(b.current),b.current=setTimeout(n,200)};return s.on("moveend",h),s.on("zoomend",h),()=>{s.off("moveend",h),s.off("zoomend",h),b.current&&clearTimeout(b.current)}},[s,n]),e.jsx(e.Fragment,{children:l.map(h=>e.jsx(Pa,{center:[h.lat,h.lon],radius:5,pathOptions:{fillColor:"#0ea5e9",fillOpacity:.6,color:"#0284c7",weight:1,opacity:.5},children:e.jsx(qt,{children:e.jsxs("div",{className:"p-1 min-w-[150px]",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-900",children:h.name}),e.jsx("p",{className:"text-xs text-slate-500",children:h.bairro})]})})},`dot-${h.id}`))})},ss=({markers:t,onViewDemand:s})=>{const l=Bt(),[c,b]=a.useState([]),n=a.useRef(null),h=typeof window<"u"&&window.innerWidth<768,N=a.useCallback(()=>{if(!l)return;const f=l.getBounds(),y=l.getZoom();let k=h?40:150;if(t.length<=k){c.length!==t.length&&b(t);return}y<15&&(k=Math.floor(k*.6));const v=f.pad(h?.1:.2),m=t.filter(j=>v.contains(Se.latLng(j.lat,j.lon)));b(m.slice(0,k))},[l,t,h]);return a.useEffect(()=>{N()},[t]),a.useEffect(()=>{if(!l)return;const f=()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(N,250)};return l.on("moveend",f),l.on("zoomend",f),()=>{l.off("moveend",f),l.off("zoomend",f),n.current&&clearTimeout(n.current)}},[l,N]),e.jsx(e.Fragment,{children:c.map(f=>e.jsx(Vt,{position:[f.lat,f.lon],icon:ts(f.type,f.status,f.priority),eventHandlers:{click:()=>{h&&l.flyTo([f.lat,f.lon],16,{duration:.5})}},children:e.jsx(qt,{children:e.jsx("div",{className:"p-1 min-w-[200px]",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-800 leading-tight",children:f.title}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full ${f.status==="Concluído"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:f.status}),f.priority===X.HIGH&&e.jsx("span",{className:"text-red-600 font-bold",children:"ALTA"})]}),e.jsx("button",{onClick:y=>{y.stopPropagation(),s&&s(f.id)},className:"mt-1 w-full bg-brand-600 text-white text-xs font-bold py-1.5 rounded hover:bg-brand-700 transition-colors",children:"Ver Detalhes"})]})})})},`m-${f.type}-${f.id}`))})},rs=({zoomIn:t,zoomOut:s})=>e.jsxs("div",{className:"flex flex-col gap-2 pointer-events-auto shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-white/10",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors border-b border-slate-100 dark:border-white/10",children:e.jsx(nt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:s,className:"w-10 h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors",children:e.jsx(ua,{className:"w-5 h-5"})})]}),ls=({markers:t,viewMode:s,onViewDemand:l})=>{var c;return s==="citizens"?e.jsx(as,{markers:t}):e.jsx(ss,{markers:t,onViewDemand:l},`ml-${t.length}-${((c=t[0])==null?void 0:c.id)||"empty"}`)},ns=({defaultCenter:t,onViewDemand:s,preloadedMarkers:l,currentViewMode:c,onChangeViewMode:b})=>{const n=a.useRef(null),h=t?[t.lat,t.lon]:[-23.5505,-46.6333],N=a.useMemo(()=>l?l.filter(k=>k.type===(c==="demands"?"demand":"citizen")):[],[c,l]),f=()=>{var k;return(k=n.current)==null?void 0:k.zoomIn()},y=()=>{var k;return(k=n.current)==null?void 0:k.zoomOut()};return e.jsxs("div",{className:"transition-all duration-300 ease-in-out border-slate-200 dark:border-white/10 shadow-sm bg-slate-100 dark:bg-slate-900 overflow-hidden h-full w-full relative",children:[e.jsx("div",{className:"absolute left-4 bottom-4 md:bottom-8 z-[400] pointer-events-none flex flex-col gap-2",children:e.jsxs("div",{className:"pointer-events-auto bg-white/90 dark:bg-black/80 backdrop-blur-md p-1.5 rounded-xl shadow-lg border border-slate-200 dark:border-white/10 flex gap-1",children:[e.jsxs("button",{onClick:()=>b("demands"),className:`px-3 py-2 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors ${c==="demands"?"bg-brand-600 text-white":"text-slate-600 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(Ke,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Demandas"})]}),e.jsxs("button",{onClick:()=>b("citizens"),className:`px-3 py-2 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors ${c==="citizens"?"bg-brand-600 text-white":"text-slate-600 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(Pe,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Cidadãos"})]})]})}),e.jsx("div",{className:"absolute right-4 bottom-4 md:bottom-8 z-[400] flex flex-col gap-3 pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",children:e.jsx(rs,{zoomIn:f,zoomOut:y})})}),e.jsxs(Gt,{ref:n,center:h,zoom:13,style:{width:"100%",height:"100%"},zoomControl:!1,scrollWheelZoom:!0,dragging:!0,preferCanvas:!0,children:[e.jsx(Ht,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors © <a href="https://carto.com/attributions">CARTO</a>'}),e.jsx(ls,{markers:N,viewMode:c,onViewDemand:s})]})]})},tt=({options:t,selectedValues:s,onChange:l,placeholder:c,label:b})=>{const[n,h]=a.useState(!1),[N,f]=a.useState(""),y=a.useRef(null);a.useEffect(()=>{const j=S=>{y.current&&!y.current.contains(S.target)&&(h(!1),f(""))};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]);const k=a.useMemo(()=>t.filter(j=>j.label.toLowerCase().includes(N.toLowerCase())),[t,N]),v=j=>{s.includes(j)?l(s.filter(S=>S!==j)):l([...s,j])},m=(j,S)=>{S.stopPropagation(),l(s.filter(I=>I!==j))};return e.jsxs("div",{className:"relative min-w-[200px]",ref:y,children:[b&&e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:b}),e.jsxs("div",{onClick:()=>h(!n),className:`
            w-full min-h-[46px] px-3 py-2 glass-input border border-slate-300 dark:border-white/10 rounded-2xl 
            focus:border-brand-500 outline-none font-bold text-slate-700 dark:text-white cursor-pointer shadow-sm
            flex items-center justify-between transition-all hover:bg-slate-50 dark:hover:bg-white/5
            ${n?"ring-2 ring-brand-500/20 border-brand-500":""}
        `,children:[e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.length===0?e.jsx("span",{className:"text-slate-400 dark:text-white/40 text-sm font-medium py-1",children:c}):s.map(j=>{const S=t.find(I=>I.value===j);return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 text-xs font-bold border border-brand-200 dark:border-brand-500/30",children:[(S==null?void 0:S.label)||j,e.jsx("div",{onClick:I=>m(j,I),className:"hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-full p-0.5 cursor-pointer",children:e.jsx(Ee,{className:"w-3 h-3"})})]},j)})}),e.jsx(lt,{className:`w-4 h-4 text-slate-400 transition-transform duration-300 ${n?"rotate-180":""}`})]}),n&&e.jsxs("div",{className:"absolute top-full left-0 w-full mt-2 glass-panel bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden z-50 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"p-2 border-b border-slate-100 dark:border-white/5",children:e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"w-4 h-4 text-slate-400 absolute left-3 top-2.5"}),e.jsx("input",{type:"text",value:N,onChange:j=>f(j.target.value),placeholder:"Filtrar opções...",className:"w-full pl-9 pr-3 py-2 text-sm bg-slate-50 dark:bg-white/5 rounded-lg border-none outline-none text-slate-900 dark:text-white placeholder:text-slate-400",autoFocus:!0,onClick:j=>j.stopPropagation()})]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/20",children:k.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-slate-400 dark:text-white/40 italic",children:"Nenhuma opção encontrada."}):k.map(j=>{const S=s.includes(j.value);return e.jsxs("div",{onClick:()=>v(j.value),className:`
                                    flex items-center justify-between px-3 py-2.5 rounded-lg cursor-pointer text-sm font-medium transition-colors
                                    ${S?"bg-brand-50 dark:bg-brand-500/10 text-brand-700 dark:text-brand-300":"text-slate-700 dark:text-white hover:bg-slate-50 dark:hover:bg-white/5"}
                                `,children:[e.jsx("span",{children:j.label}),S&&e.jsx(ct,{className:"w-4 h-4 text-brand-500"})]},j.value)})}),e.jsxs("div",{className:"p-2 border-t border-slate-100 dark:border-white/5 bg-slate-50/50 dark:bg-white/5 flex justify-between",children:[e.jsx("button",{onClick:()=>l([]),className:"text-xs text-slate-500 hover:text-red-500 px-2 py-1 transition-colors",children:"Limpar"}),e.jsx("button",{onClick:()=>h(!1),className:"text-xs font-bold text-brand-600 dark:text-brand-400 px-2 py-1 hover:bg-brand-50 dark:hover:bg-white/5 rounded transition-colors",children:"Pronto"})]})]})]})},ze=({label:t,onRemove:s})=>e.jsxs("div",{className:"flex items-center gap-1 pl-3 pr-1 py-1 bg-brand-50 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 border border-brand-100 dark:border-brand-500/30 rounded-lg text-xs font-bold animate-in zoom-in-95 shadow-sm whitespace-nowrap",children:[e.jsx("span",{children:t}),e.jsx("button",{onClick:l=>{l.stopPropagation(),s()},className:"p-0.5 hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-md transition-colors text-brand-600 dark:text-brand-400",children:e.jsx(Ee,{className:"w-3 h-3"})})]}),at=({label:t,icon:s,isActive:l,onClick:c})=>e.jsxs("button",{onClick:c,className:`
            flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold transition-all shadow-sm whitespace-nowrap border
            ${l?"bg-brand-600 text-white border-brand-600":"bg-white dark:bg-slate-800 text-slate-600 dark:text-white border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}
        `,children:[s&&e.jsx(s,{className:`w-3.5 h-3.5 ${l?"text-white":"text-slate-400"}`}),t]}),os=({filters:t,setFilters:s,onExport:l,users:c=[],availableTags:b=[],isMapMode:n=!1,mapViewMode:h})=>{var re,_;const[N,f]=a.useState(!1),[y,k]=a.useState(!1),[v,m]=a.useState(new Date),j=a.useRef(null),S=a.useRef(null),I=(o,M)=>{s(J=>({...J,[o]:M}))},B=()=>{s({search:t.search,level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",responsibleId:void 0,tags:[]})},E=(o,M)=>{Array.isArray(t[o])&&M?s(J=>({...J,[o]:J[o].filter(se=>se!==M)})):s(o==="startDate"||o==="endDate"?J=>({...J,startDate:"",endDate:""}):J=>({...J,[o]:void 0}))},g=o=>{const M=t.status;M.includes(o)?I("status",M.filter(J=>J!==o)):I("status",[...M,o])},P=o=>{const M=t.priority;M.includes(o)?I("priority",M.filter(J=>J!==o)):I("priority",[...M,o])},O=()=>{if(t.startDate)I("startDate",""),I("endDate","");else{const o=new Date().toLocaleDateString("en-CA");I("startDate",o),I("endDate",o)}},K=o=>o?o.split("_").map(M=>M.charAt(0).toUpperCase()+M.slice(1)).join(" "):"",z=o=>{const M=c.find(J=>J.id===o);return M?M.nome:"Usuário"},C=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],L=(o,M)=>new Date(o,M+1,0).getDate(),T=(o,M)=>new Date(o,M,1).getDay(),u=o=>{const J=new Date(v.getFullYear(),v.getMonth(),o).toLocaleDateString("en-CA");!t.startDate||t.startDate&&t.endDate?s(se=>({...se,startDate:J,endDate:""})):J<t.startDate?s(se=>({...se,startDate:J,endDate:t.startDate})):(s(se=>({...se,endDate:J})),setTimeout(()=>k(!1),300))},D=t.startDate?new Date(t.startDate+"T00:00:00").getTime():null,w=t.endDate?new Date(t.endDate+"T00:00:00").getTime():null,d=o=>{if(!D)return!1;const M=new Date(v.getFullYear(),v.getMonth(),o).getTime();return M===D?"start":w&&M===w?"end":w&&M>D&&M<w?"range":!1};a.useEffect(()=>{const o=M=>{j.current&&!j.current.contains(M.target)&&k(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const $=t.level.length+t.status.length+t.priority.length+(((re=t.tags)==null?void 0:re.length)||0)+(t.startDate?1:0)+(t.responsibleId?1:0),q=t.startDate?`${new Date(t.startDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})} ${t.endDate?" - "+new Date(t.endDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}):""}`:"Selecionar Período",ae={createdAt:"Criação",updatedAt:"Atualização",deadline:"Prazo"},A=Object.values(Le).map(o=>({value:o,label:o})),ee=Object.values(H).map(o=>({value:o,label:o})),xe=Object.values(X).map(o=>({value:o,label:o})),ie=b.map(o=>({value:o,label:o})),Z=!n||h==="demands";return e.jsxs("div",{className:"flex flex-col relative z-30 space-y-3",children:[e.jsxs("div",{className:`
          flex flex-col md:flex-row gap-3 items-center relative z-20 
          ${n?"bg-transparent":"glass-panel p-2 md:p-3 rounded-2xl shadow-sm border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md"}
      `,children:[e.jsxs("div",{className:`flex-1 w-full relative group ${n?"shadow-lg rounded-2xl":""}`,children:[e.jsx("input",{type:"text",value:t.search,onChange:o=>I("search",o.target.value),placeholder:n?"Buscar locais ou demandas...":"Buscar por título, nome ou celular...",className:`
                    w-full pl-11 pr-4 py-3 outline-none transition-all font-medium text-slate-700 dark:text-white placeholder:text-slate-400
                    ${n?"bg-white/95 dark:bg-[#1e293b]/95 border-0 rounded-2xl shadow-md focus:ring-2 ring-brand-500/50":"bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl focus:border-brand-500 focus:bg-white dark:focus:bg-black/20"}
                `}),e.jsx(qe,{className:"w-5 h-5 text-slate-400 absolute left-3.5 top-3.5 group-focus-within:text-brand-500 transition-colors"}),t.search&&e.jsx("button",{onClick:()=>I("search",""),className:"absolute right-3 top-3.5 text-slate-400 hover:text-slate-600 dark:hover:text-white",children:e.jsx(Ee,{className:"w-5 h-5"})})]}),n?e.jsx("div",{className:"hidden md:flex",children:e.jsx("button",{onClick:()=>f(!N),className:"w-12 h-12 bg-white dark:bg-slate-800 text-slate-600 dark:text-white rounded-2xl shadow-lg flex items-center justify-center hover:bg-slate-50 transition-transform active:scale-95",children:e.jsx(yt,{className:"w-5 h-5"})})}):e.jsxs("div",{className:"flex w-full md:w-auto gap-2",children:[e.jsxs("button",{onClick:()=>f(!N),className:`flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-3 rounded-xl font-bold transition-all border ${N||$>0?"bg-brand-500 text-white border-brand-500 shadow-lg shadow-brand-500/20":"bg-white dark:bg-white/5 text-slate-600 dark:text-white/70 border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}`,children:[e.jsx(yt,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Filtros"}),$>0&&e.jsx("span",{className:"bg-white text-brand-600 text-[10px] w-5 h-5 flex items-center justify-center rounded-full ml-1 shadow-sm",children:$})]}),l&&e.jsx("button",{onClick:l,className:"w-[46px] h-[46px] bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 rounded-xl flex items-center justify-center shrink-0 transition-all",title:"Exportar Dados",children:e.jsx(pa,{className:"w-5 h-5"})})]})]}),n&&h!=="citizens"&&e.jsxs("div",{className:"flex overflow-x-auto gap-2 pb-2 -mx-4 px-4 md:mx-0 md:px-0 scrollbar-none snap-x",children:[e.jsx(at,{label:"Pendentes",icon:pe,isActive:t.status.includes(H.PENDING),onClick:()=>g(H.PENDING)}),e.jsx(at,{label:"Alta Prioridade",icon:it,isActive:t.priority.includes(X.HIGH),onClick:()=>P(X.HIGH)}),e.jsx(at,{label:"Em Andamento",icon:We,isActive:t.status.includes(H.IN_PROGRESS),onClick:()=>g(H.IN_PROGRESS)}),e.jsx(at,{label:"Hoje",icon:we,isActive:!!t.startDate,onClick:O})]}),n&&h==="citizens"&&e.jsx("div",{className:"flex overflow-x-auto gap-2 pb-2 -mx-4 px-4 md:mx-0 md:px-0 scrollbar-none",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold bg-brand-600 text-white shadow-sm whitespace-nowrap border border-brand-600",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"})," Visualizando Mapa de Cidadãos"]})}),(!n||n&&window.innerWidth>=768)&&$>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center px-1",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase text-slate-400 dark:text-white/40 mr-1 flex items-center gap-1",children:[e.jsx(wt,{className:"w-3 h-3"})," Ativos:"]}),Z&&t.status.map(o=>e.jsx(ze,{label:`Status: ${o}`,onRemove:()=>E("status",o)},`status-${o}`)),Z&&t.priority.map(o=>e.jsx(ze,{label:`Prioridade: ${o}`,onRemove:()=>E("priority",o)},`prio-${o}`)),Z&&t.level.map(o=>e.jsx(ze,{label:`Esfera: ${o}`,onRemove:()=>E("level",o)},`lvl-${o}`)),Z&&((_=t.tags)==null?void 0:_.map(o=>e.jsx(ze,{label:`Tag: ${o}`,onRemove:()=>E("tags",o)},`tag-${o}`))),Z&&t.responsibleId&&e.jsx(ze,{label:`Resp: ${z(t.responsibleId)}`,onRemove:()=>E("responsibleId")}),t.startDate&&e.jsx(ze,{label:`${ae[t.dateType]}: ${q}`,onRemove:()=>E("startDate")}),e.jsxs("button",{onClick:B,className:"text-[10px] font-bold text-red-500 hover:text-red-600 ml-auto hover:bg-red-50 dark:hover:bg-red-900/20 px-2 py-1 rounded transition-colors flex items-center gap-1",children:[e.jsx(ga,{className:"w-3 h-3"})," Limpar"]})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10 bg-slate-900/30 backdrop-blur-sm transition-opacity",onClick:()=>f(!1)}),e.jsxs("div",{ref:S,className:`
                    absolute z-[60] glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white dark:bg-[#0f172a] shadow-2xl animate-in slide-in-from-top-2 duration-200 overflow-hidden
                    w-full md:w-[800px] md:right-0 md:left-auto
                    ${n?"top-[70px]":"top-[calc(100%+12px)]"}
                `,children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2 text-sm",children:[e.jsx(wt,{className:"w-4 h-4 text-brand-500"})," Filtros Avançados"]}),e.jsx("button",{onClick:()=>f(!1),className:"p-1.5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Ee,{className:"w-4 h-4 text-slate-500 dark:text-white/60"})})]}),e.jsxs("div",{className:`p-6 grid gap-8 max-h-[70vh] overflow-y-auto custom-scrollbar ${Z?"grid-cols-1 md:grid-cols-3":"grid-cols-1"}`,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Período"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Me,{options:["createdAt","updatedAt","deadline"].map(o=>({value:o,label:ae[o]})),value:t.dateType,onChange:o=>I("dateType",o),size:"sm"}),e.jsxs("div",{className:"relative",ref:j,children:[e.jsx("button",{onClick:()=>k(!y),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl text-sm font-bold transition-all border ${t.startDate?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-900/20 dark:border-brand-500/30 dark:text-brand-300":"bg-slate-50 dark:bg-white/5 border-slate-200 dark:border-white/10 text-slate-600 dark:text-white/70 hover:bg-slate-100"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 opacity-70"})," ",q]})}),y&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-72 bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 p-4 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>m(new Date(v.getFullYear(),v.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-bold text-sm",children:[C[v.getMonth()]," ",v.getFullYear()]}),e.jsx("button",{onClick:()=>m(new Date(v.getFullYear(),v.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Je,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["D","S","T","Q","Q","S","S"].map(o=>e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:o},o))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:T(v.getFullYear(),v.getMonth())}).map((o,M)=>e.jsx("div",{},`empty-${M}`)),Array.from({length:L(v.getFullYear(),v.getMonth())}).map((o,M)=>{const J=M+1,se=d(J);return e.jsx("button",{onClick:()=>u(J),className:`h-8 w-8 rounded-full text-xs font-medium transition-all ${se==="start"||se==="end"?"bg-brand-500 text-white shadow-lg":se==="range"?"bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 rounded-none":"hover:bg-slate-100 dark:hover:bg-white/10"}`,children:J},J)})]})]})]})]})]}),Z&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Classificação"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(tt,{options:ee,selectedValues:t.status,onChange:o=>I("status",o),placeholder:"Todos Status",label:"Status"}),e.jsx(tt,{options:xe,selectedValues:t.priority,onChange:o=>I("priority",o),placeholder:"Todas Prioridades",label:"Prioridade"}),e.jsx(tt,{options:A,selectedValues:t.level,onChange:o=>I("level",o),placeholder:"Todas Esferas",label:"Esfera"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Contexto"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:"Responsável"}),e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:"w-4 h-4 text-slate-400 absolute left-3 top-3 pointer-events-none"}),e.jsxs("select",{value:t.responsibleId||"",onChange:o=>I("responsibleId",o.target.value||void 0),className:"w-full pl-9 pr-8 py-2.5 bg-slate-50 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-xl text-sm outline-none focus:border-brand-500 font-bold text-slate-700 dark:text-white appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"Todos os Responsáveis"}),c.map(o=>e.jsxs("option",{value:o.id,children:[o.nome," (",K(o.perfil),")"]},o.id))]}),e.jsx("div",{className:"absolute right-3 top-3 pointer-events-none text-slate-400 text-xs",children:"▼"})]})]}),e.jsx(tt,{options:ie,selectedValues:t.tags||[],onChange:o=>I("tags",o),placeholder:"Filtrar por Tags",label:"Etiquetas (Tags)"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5 flex justify-end gap-3",children:[e.jsx("button",{onClick:B,className:"px-4 py-2 text-xs font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-xl transition-colors",children:"Limpar Tudo"}),e.jsx("button",{onClick:()=>f(!1),className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold text-sm shadow-lg shadow-brand-500/20 transition-all active:scale-95",children:"Aplicar Filtros"})]})]})]})]})},Kt=({status:t,setStatus:s,priority:l,setPriority:c,timeRange:b,setTimeRange:n,scope:h,setScope:N,showScope:f=!0,className:y=""})=>e.jsxs("div",{className:`glass-panel p-3 rounded-3xl flex flex-col md:flex-row gap-4 items-center border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md shadow-sm ${y}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-white/50 text-xs font-bold uppercase tracking-wider shrink-0",children:[e.jsx(wt,{className:"w-4 h-4 text-brand-500"})," Filtros"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto overflow-x-auto scrollbar-none items-start sm:items-center flex-1",children:[f&&h&&N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-w-[200px]",children:e.jsx(Me,{value:h,onChange:N,options:[{value:"demands",label:"Demandas",icon:Ke},{value:"citizens",label:"Cidadãos",icon:Pe}]})}),e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"})]}),e.jsx("div",{className:"min-w-[280px]",children:e.jsx(Me,{value:b,onChange:n,options:[{value:"7",label:"7d"},{value:"30",label:"30d"},{value:"90",label:"90d"},{value:"365",label:"Ano"},{value:"all",label:"Tudo"}]})}),(!f||h==="demands")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:t,onChange:k=>s(k.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Status: Todos"}),e.jsx("option",{value:H.PENDING,children:"Pendentes"}),e.jsx("option",{value:H.IN_PROGRESS,children:"Em Andamento"}),e.jsx("option",{value:H.COMPLETED,children:"Concluídos"})]}),e.jsx(lt,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]}),e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:l,onChange:k=>c(k.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Prioridade: Todas"}),e.jsx("option",{value:X.HIGH,children:"Alta"}),e.jsx("option",{value:X.MEDIUM,children:"Média"}),e.jsx("option",{value:X.LOW,children:"Baixa"})]}),e.jsx(lt,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]})]})]})]}),(t!=="all"||l!=="all"||b!=="30")&&e.jsxs("button",{onClick:()=>{s("all"),c("all"),n("30")},className:"ml-auto p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-slate-400 hover:text-red-500 rounded-xl transition-colors flex items-center gap-1 text-[10px] font-bold uppercase",title:"Limpar Filtros",children:[e.jsx(Ee,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden md:inline",children:"Limpar"})]})]}),De=ye.memo(({title:t,value:s,icon:l,colorClass:c,textClass:b,trend:n,subValue:h})=>e.jsxs("div",{className:"glass-panel p-3 md:p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex flex-col justify-between hover:bg-white/60 dark:hover:bg-white/5 transition-colors group min-h-[100px] will-change-transform",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:`p-2 rounded-xl ${c} bg-opacity-10 shrink-0`,children:e.jsx(l,{className:`w-4 h-4 ${b}`})}),n&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-bold text-emerald-600 bg-emerald-100 dark:bg-emerald-500/20 px-1.5 py-0.5 rounded-full border border-emerald-200 dark:border-emerald-500/10",children:[e.jsx(fa,{className:"w-3 h-3"})," ",n]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-800 dark:text-white tracking-tight block",children:h||s}),e.jsx("span",{className:`block text-[10px] font-bold uppercase tracking-wider opacity-70 ${b} mt-1`,children:t})]})]})),ds=Se.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41]}),is=({demandId:t,lat:s,lon:l,address:c,onClick:b,onLocationUpdate:n})=>{const[h,N]=a.useState(null),[f,y]=a.useState(!1);return a.useEffect(()=>{if(s&&l){N({lat:s,lon:l});return}if(c&&(!s||!l)){y(!0);const v=setTimeout(async()=>{try{const m=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(c)}&limit=1`,j=await fetch(m,{headers:{"User-Agent":"GabineteDigitalApp/1.0"}});if(!j.ok)throw new Error("Falha na requisição de geocodificação");const S=await j.json();if(S&&S.length>0){const I=parseFloat(S[0].lat),B=parseFloat(S[0].lon);if(N({lat:I,lon:B}),le()&&R&&t){const{error:E}=await R.from("demands").update({lat:I,lon:B}).eq("id",t);!E&&n&&n()}}}catch(m){console.error("Geocoding error:",m)}finally{y(!1)}},1500);return()=>clearTimeout(v)}},[s,l,c,t]),!h&&!f?e.jsxs("div",{className:"w-full h-full bg-slate-100 dark:bg-white/5 flex flex-col items-center justify-center text-slate-400",children:[e.jsx(fe,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("span",{className:"text-xs",children:"Sem localização GPS"})]}):e.jsxs("div",{className:"relative w-full h-48 rounded-xl overflow-hidden border border-slate-200 dark:border-white/10 group cursor-pointer",onClick:b,children:[f?e.jsxs("div",{className:"w-full h-full bg-slate-50 dark:bg-white/5 flex flex-col items-center justify-center text-slate-400",children:[e.jsx(be,{className:"w-6 h-6 animate-spin mb-2 text-brand-500"}),e.jsx("span",{className:"text-xs",children:"Buscando endereço..."})]}):h?e.jsxs(Gt,{center:[h.lat,h.lon],zoom:15,scrollWheelZoom:!1,zoomControl:!1,dragging:!1,doubleClickZoom:!1,attributionControl:!1,style:{width:"100%",height:"100%"},children:[e.jsx(Ht,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(Vt,{position:[h.lat,h.lon],icon:ds})]},`${h.lat}-${h.lon}`):null,e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors z-[400] flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"bg-white/90 dark:bg-black/80 backdrop-blur-sm px-3 py-1.5 rounded-full text-xs font-bold text-slate-900 dark:text-white opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-2 transform translate-y-2 group-hover:translate-y-0 duration-200",children:[e.jsx(wa,{className:"w-3 h-3"})," Expandir Mapa"]})})]})},cs=({demand:t,citizen:s,onClose:l,onEdit:c,onUpdateStatus:b,onInteractionUpdate:n,onNavigate:h,canNavigatePrev:N,canNavigateNext:f,onNotification:y,onViewCitizen:k})=>{const[v,m]=a.useState([]),[j,S]=a.useState(!1),[I,B]=a.useState([]),[E,g]=a.useState(""),[P,O]=a.useState(""),[K,z]=a.useState(""),[C,L]=a.useState(!1),[T,u]=a.useState(t.tags||[]),[D,w]=a.useState(""),[d,$]=a.useState(!1),q=a.useRef(null),[ae,A]=a.useState(!1),[ee,xe]=a.useState(new Date),ie=a.useRef(null),Z=a.useMemo(()=>{const p=localStorage.getItem("geo_user");return p?JSON.parse(p):{name:"Usuário"}},[]);a.useEffect(()=>{re(),B([]),u(t.tags||[])},[t.id]),a.useEffect(()=>{const p=F=>{ie.current&&!ie.current.contains(F.target)&&A(!1),d&&q.current&&!q.current.contains(F.target)&&F.target.tagName!=="BUTTON"&&$(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[d]);const re=async()=>{S(!0);try{if(le()&&R){const{data:p,error:F}=await R.from("demand_interactions").select("*").eq("demanda_id",t.id).order("created_at",{ascending:!0});if(F)throw F;p&&m(p.map(Q=>({id:Q.id,demandId:Q.demanda_id,type:Q.tipo,text:Q.texto,isCompleted:Q.concluido,deadline:Q.prazo,user:Q.usuario,createdAt:Q.created_at})))}}catch(p){console.error("Erro ao carregar interações",p)}finally{S(!1)}},_=async p=>{const F=p==="comentario"?E:P;if(!F.trim())return;const Q=crypto.randomUUID(),ne={id:Q,demandId:t.id,type:p,text:F,isCompleted:!1,deadline:p==="checklist"&&K?K:void 0,user:Z.name,createdAt:new Date().toISOString()};m(te=>[...te,ne]),B(te=>[...te,Q]),p==="comentario"&&g(""),p==="checklist"&&(O(""),z(""),L(!1));try{if(le()&&R){const te={demanda_id:t.id,tipo:p,texto:F,usuario:Z.name};p==="checklist"&&(te.concluido=!1,te.prazo=K||null);const{data:oe,error:V}=await R.from("demand_interactions").insert(te).select().single();if(V)throw V;oe&&(m(ke=>ke.map(he=>he.id===Q?{...he,id:oe.id,createdAt:oe.created_at}:he)),B(ke=>[...ke.filter(he=>he!==Q),oe.id]),setTimeout(()=>{B(ke=>ke.filter(he=>he!==oe.id))},3e3),n&&n())}}catch(te){console.error("Erro ao salvar interação",te),y&&y("error","Erro ao salvar interação"),m(oe=>oe.filter(V=>V.id!==Q)),B(oe=>oe.filter(V=>V!==Q))}},o=async(p,F)=>{m(Q=>Q.map(ne=>ne.id===p?{...ne,isCompleted:!F}:ne));try{le()&&R&&(await R.from("demand_interactions").update({concluido:!F}).eq("id",p),n&&n())}catch(Q){console.error("Erro ao atualizar checklist",Q),y&&y("error","Erro ao atualizar checklist"),m(ne=>ne.map(te=>te.id===p?{...te,isCompleted:F}:te))}},M=async p=>{m(F=>F.filter(Q=>Q.id!==p));try{le()&&R&&(await R.from("demand_interactions").delete().eq("id",p),n&&n())}catch(F){console.error(F)}},J=async()=>{if(!D.trim())return;const p=[...T,D.trim()];u(p),w(""),$(!1);try{le()&&R&&(await R.from("demands").update({tags:p}).eq("id",t.id),n&&n())}catch(F){console.error(F)}},se=async p=>{const F=T.filter(Q=>Q!==p);u(F);try{le()&&R&&(await R.from("demands").update({tags:F}).eq("id",t.id),n&&n())}catch(Q){console.error(Q)}},Ie=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],ve=(p,F)=>new Date(p,F+1,0).getDate(),Ae=(p,F)=>new Date(p,F,1).getDay(),ue=p=>{const F=new Date(ee.getFullYear(),ee.getMonth(),p),Q=F.getFullYear(),ne=String(F.getMonth()+1).padStart(2,"0"),te=String(F.getDate()).padStart(2,"0");z(`${Q}-${ne}-${te}`),A(!1)},me=v.filter(p=>p.type==="checklist"),ge=v.filter(p=>p.type==="comentario").reverse(),Ce=a.useMemo(()=>{if(me.length===0)return 0;const p=me.filter(F=>F.isCompleted).length;return Math.round(p/me.length*100)},[me]),Te=[{value:H.PENDING,label:"Pendente",icon:pe},{value:H.IN_PROGRESS,label:"Em Andamento",icon:pe},{value:H.COMPLETED,label:"Concluído",icon:pe}],Oe=p=>{const F=p.replace(/\D/g,"");window.open(`https://wa.me/55${F}`,"_blank")},ce=p=>{window.open(`mailto:${p}`,"_blank")},Re=()=>{const p=new CustomEvent("navigate-to-map",{detail:{demandId:t.id}});window.dispatchEvent(p),l()},je=s?`${s.logradouro}, ${s.numero} - ${s.bairro}, ${s.cidade} - ${s.estado}`:void 0;return e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-end md:items-center justify-center sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity duration-300",onClick:l}),e.jsxs("div",{className:"relative w-full h-full md:h-[90vh] md:max-w-6xl bg-white dark:bg-[#0b1121] md:rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in slide-in-from-bottom-10 md:zoom-in-95 duration-300 border-t md:border border-slate-200 dark:border-white/10",children:[e.jsxs("div",{className:"px-4 py-3 md:px-8 md:py-5 border-b border-slate-200 dark:border-white/10 flex items-start justify-between bg-white/90 dark:bg-[#0b1121]/90 backdrop-blur-md z-20 shrink-0 sticky top-0",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 flex-wrap",children:[e.jsx("button",{onClick:l,className:"mr-2 p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors md:hidden",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-white/40 font-mono",children:["#",t.id.slice(0,8)]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold uppercase border ${t.priority===X.HIGH?"bg-red-50 text-red-600 border-red-100 dark:bg-red-500/10 dark:text-red-300 dark:border-red-500/20":t.priority===X.MEDIUM?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-300 dark:border-amber-500/20":"bg-green-50 text-green-600 border-green-100 dark:bg-green-500/10 dark:text-green-300 dark:border-green-500/20"}`,children:t.priority})]}),e.jsx("h2",{className:"text-lg md:text-2xl font-bold text-slate-900 dark:text-white leading-tight line-clamp-1",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsxs("div",{className:"hidden md:flex items-center bg-slate-100 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10 mr-2",children:[e.jsx("button",{onClick:()=>h("prev"),disabled:!N,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors border-r border-slate-200 dark:border-white/10",title:"Demanda Anterior",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>h("next"),disabled:!f,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors",title:"Próxima Demanda",children:e.jsx(Je,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>{c(t),l()},className:"p-2 md:p-2.5 text-slate-500 hover:text-brand-600 hover:bg-slate-100 rounded-xl transition-colors dark:text-white/50 dark:hover:text-white dark:hover:bg-white/10",title:"Editar",children:e.jsx(va,{className:"w-5 h-5"})}),e.jsx("button",{onClick:l,className:"p-2 md:p-2.5 text-slate-400 hover:text-slate-800 hover:bg-slate-100 rounded-full transition-colors dark:text-white/40 dark:hover:text-white dark:hover:bg-white/10",children:e.jsx(Ee,{className:"w-6 h-6"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50/30 dark:bg-black/20 custom-scrollbar overscroll-contain flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 p-4 md:p-8 space-y-6 md:space-y-8 min-w-0",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(jt,{className:"w-4 h-4"})," Descrição"]}),e.jsx("div",{className:"md:hidden",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${t.status===H.COMPLETED?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:t.status})})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 md:p-6 shadow-sm",children:[e.jsx("p",{className:"text-sm md:text-base text-slate-700 dark:text-slate-200 leading-relaxed whitespace-pre-line",children:t.description}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-white/5 flex flex-wrap gap-2 items-center",children:[e.jsx(ja,{className:"w-4 h-4 text-slate-400"}),T.map(p=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1 group",children:[p,e.jsx(Ee,{onClick:()=>se(p),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500 hidden group-hover:block"})]},p)),d?e.jsxs("div",{className:"flex items-center gap-2",ref:ie,children:[e.jsx("input",{ref:q,autoFocus:!0,type:"text",value:D,onChange:p=>w(p.target.value),className:"w-24 px-2 py-1 text-xs border rounded-lg outline-none",placeholder:"Nova tag...",onKeyDown:p=>{p.key==="Enter"&&J(),p.key==="Escape"&&$(!1)}}),e.jsx("button",{onClick:J,className:"text-xs font-bold text-brand-600",children:"OK"})]}):e.jsxs("button",{onClick:()=>$(!0),className:"text-xs text-slate-400 hover:text-brand-600 flex items-center gap-1 px-2 py-1 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(nt,{className:"w-3 h-3"})," Adicionar"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(fe,{className:"w-4 h-4"})," Localização"]}),e.jsx(is,{demandId:t.id,lat:t.lat,lon:t.lon,address:je,onClick:Re,onLocationUpdate:n})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Rt,{className:"w-4 h-4"})," Checklist"]}),me.length>0&&e.jsxs("span",{className:"text-xs font-mono text-slate-400 dark:text-white/40",children:[Math.round(Ce),"%"]})]}),me.length>0&&e.jsx("div",{className:"h-1.5 w-full bg-slate-200 dark:bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-500",style:{width:`${Ce}%`}})}),e.jsxs("div",{className:"space-y-2",children:[me.map(p=>e.jsxs("div",{className:"flex items-start gap-3 group bg-white dark:bg-white/5 p-3 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 dark:hover:border-white/10 transition-colors",children:[e.jsx("button",{onClick:()=>o(p.id,p.isCompleted||!1),className:`mt-0.5 w-5 h-5 rounded-lg border flex items-center justify-center transition-all ${p.isCompleted?"bg-green-500 border-green-500 text-white":"bg-white dark:bg-transparent border-slate-300 dark:border-white/20 hover:border-brand-500 text-transparent hover:text-brand-500/20"}`,children:e.jsx(ct,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm transition-all font-medium ${p.isCompleted?"text-slate-400 line-through dark:text-white/30":"text-slate-800 dark:text-white"}`,children:p.text}),(p.deadline||p.isCompleted)&&e.jsx("div",{className:"flex items-center gap-2 mt-1.5",children:p.deadline&&e.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold uppercase flex items-center gap-1 ${p.isCompleted?"bg-slate-100 text-slate-400 dark:bg-white/5":new Date(p.deadline)<new Date?"bg-red-100 text-red-600 dark:bg-red-500/20 dark:text-red-300":"bg-slate-100 text-slate-500 dark:bg-white/10 dark:text-white/60"}`,children:[e.jsx(we,{className:"w-3 h-3"})," ",Be(p.deadline)]})})]}),e.jsx("button",{onClick:()=>M(p.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",children:e.jsx(Ct,{className:"w-4 h-4"})})]},p.id)),C?e.jsxs("div",{className:"bg-white dark:bg-white/5 p-4 rounded-xl border border-brand-500/30 shadow-lg ring-1 ring-brand-500/10 animate-in fade-in zoom-in-95",children:[e.jsx("input",{type:"text",autoFocus:!0,value:P,onChange:p=>O(p.target.value),placeholder:"Descreva a tarefa...",className:"w-full bg-transparent border-none outline-none text-sm text-slate-900 dark:text-white placeholder:text-slate-400 mb-4 font-medium",onKeyDown:p=>p.key==="Enter"&&_("checklist")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 border-t border-slate-100 dark:border-white/5 pt-3",children:[e.jsxs("div",{className:"relative w-full sm:w-auto",ref:ie,children:[e.jsxs("button",{onClick:()=>A(!ae),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all border ${K?"bg-brand-50 text-brand-700 border-brand-200 dark:bg-brand-500/20 dark:text-brand-300 dark:border-brand-500/30":"bg-slate-50 text-slate-500 border-slate-200 dark:bg-white/5 dark:text-white/50 dark:border-white/10 hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(we,{className:"w-3.5 h-3.5"}),K?Be(K):"Definir Prazo"]}),ae&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-64 glass-panel bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 p-3 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:()=>xe(new Date(ee.getFullYear(),ee.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Fe,{className:"w-4 h-4 text-slate-600 dark:text-white"})}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white text-xs",children:[Ie[ee.getMonth()]," ",ee.getFullYear()]}),e.jsx("button",{onClick:()=>xe(new Date(ee.getFullYear(),ee.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Je,{className:"w-4 h-4 text-slate-600 dark:text-white"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-1",children:["D","S","T","Q","Q","S","S"].map(p=>e.jsx("span",{className:"text-[9px] font-bold text-slate-400 dark:text-white/40",children:p},p))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:Ae(ee.getFullYear(),ee.getMonth())}).map((p,F)=>e.jsx("div",{},`empty-${F}`)),Array.from({length:ve(ee.getFullYear(),ee.getMonth())}).map((p,F)=>{const Q=F+1,ne=K&&new Date(K).getDate()===Q&&new Date(K).getMonth()===ee.getMonth();return e.jsx("button",{onClick:()=>ue(Q),className:`h-6 w-6 rounded-full text-[10px] font-medium flex items-center justify-center transition-all ${ne?"bg-brand-500 text-white":"text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:Q},Q)})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-end",children:[e.jsx("button",{onClick:()=>L(!1),className:"px-3 py-1.5 text-xs font-bold text-slate-500 hover:text-slate-700 dark:text-white/60 dark:hover:text-white",children:"Cancelar"}),e.jsx("button",{onClick:()=>_("checklist"),className:"px-4 py-1.5 bg-brand-600 text-white text-xs font-bold rounded-lg hover:bg-brand-500 shadow-sm",children:"Salvar Item"})]})]})]}):e.jsxs("button",{onClick:()=>L(!0),className:"flex items-center justify-center gap-2 text-sm text-slate-500 dark:text-white/50 hover:text-brand-600 dark:hover:text-brand-400 transition-colors px-4 py-3 rounded-xl border border-dashed border-slate-300 dark:border-white/10 hover:border-brand-300 dark:hover:border-brand-500/30 hover:bg-slate-50 dark:hover:bg-white/5 w-full group",children:[e.jsx(nt,{className:"w-4 h-4 group-hover:scale-110 transition-transform"})," Adicionar item ao checklist"]})]})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(ka,{className:"w-4 h-4"})," Comentários"]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-3 md:p-4 bg-slate-50 dark:bg-white/5 border-b border-slate-200 dark:border-white/10 flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold text-xs shrink-0",children:Z.name.charAt(0)}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:E,onChange:p=>g(p.target.value),placeholder:"Escreva um comentário...",className:"w-full bg-white dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl pl-4 pr-10 py-2.5 text-sm outline-none focus:border-brand-500 transition-all text-slate-900 dark:text-white shadow-sm",onKeyDown:p=>p.key==="Enter"&&_("comentario")}),e.jsx("button",{onClick:()=>_("comentario"),disabled:!E.trim(),className:"absolute right-2 top-2 p-1 text-slate-400 hover:text-brand-600 disabled:opacity-30 transition-colors",children:e.jsx(Na,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-white/5 max-h-[300px] overflow-y-auto custom-scrollbar",children:ge.length===0?e.jsx("div",{className:"p-6 text-center text-slate-400 dark:text-white/30 text-sm italic",children:"Nenhum comentário registrado."}):ge.map(p=>e.jsxs("div",{className:`p-4 flex gap-3 hover:bg-slate-50 dark:hover:bg-white/5 transition-colors group ${I.includes(p.id)?"bg-amber-50 dark:bg-amber-500/10 animate-pulse duration-1000":""}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs shrink-0 border border-slate-300 dark:border-white/10",children:p.user.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-slate-900 dark:text-white",children:p.user}),e.jsx("span",{className:"text-[10px] text-slate-400",children:new Date(p.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed break-words bg-slate-50 dark:bg-white/5 p-3 rounded-tr-xl rounded-br-xl rounded-bl-xl border border-slate-100 dark:border-white/5",children:p.text})]}),e.jsx("button",{onClick:()=>M(p.id),className:"opacity-0 group-hover:opacity-100 self-start p-2 text-slate-300 hover:text-red-500 transition-all",children:e.jsx(Ct,{className:"w-4 h-4"})})]},p.id))})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white/50 dark:bg-black/20 border-t md:border-t-0 md:border-l border-slate-200 dark:border-white/10 p-4 md:p-6 space-y-6 md:h-auto overflow-y-auto",children:[e.jsxs("div",{className:"hidden md:block",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 mb-3 block",children:"Status"}),e.jsx("div",{className:"bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex flex-col relative border border-slate-200 dark:border-white/5 gap-1",children:Te.map(p=>{const F=t.status===p.value;return e.jsxs("button",{onClick:()=>b(t.id,p.value),className:`
                                                w-full py-2.5 px-3 text-sm font-bold rounded-lg transition-all duration-300 flex items-center gap-3
                                                ${F?"bg-white dark:bg-white/10 text-brand-600 dark:text-white shadow-sm ring-1 ring-slate-200 dark:ring-white/10":"text-slate-500 dark:text-white/40 hover:bg-slate-200 dark:hover:bg-white/5"}
                                            `,children:[e.jsx(p.icon,{className:`w-4 h-4 ${F?"text-brand-500 dark:text-brand-400":"opacity-50"}`}),p.label]},p.value)})})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4 space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40 mb-2",children:"Datas"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-500 dark:text-white/50",children:e.jsx(we,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Criado em"}),e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white",children:new Date(t.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${t.deadline?"bg-brand-100 dark:bg-brand-500/20 text-brand-600 dark:text-brand-400":"bg-slate-100 dark:bg-white/10 text-slate-500"}`,children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Prazo Demanda"}),e.jsx("p",{className:`text-sm font-bold ${t.deadline?"text-slate-800 dark:text-white":"text-slate-400 italic"}`,children:Be(t.deadline)||"Sem prazo"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40",children:"Solicitante"})}),s?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-white/5 p-2 -ml-2 rounded-xl transition-colors group",onClick:()=>k&&k(s.id),children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-sm shadow-inner shrink-0",children:s.name.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-bold text-slate-900 dark:text-white truncate group-hover:text-brand-600 transition-colors flex items-center gap-1",children:[s.name,e.jsx(ya,{className:"w-3 h-3 opacity-0 group-hover:opacity-100"})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:_e(s.phone)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.phone&&e.jsxs("button",{onClick:()=>Oe(s.phone),className:"flex-1 py-1.5 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Conversar no WhatsApp",children:[e.jsx(Ca,{className:"w-3.5 h-3.5"})," WhatsApp"]}),s.email&&e.jsxs("button",{onClick:()=>ce(s.email),className:"flex-1 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Enviar Email",children:[e.jsx(Mt,{className:"w-3.5 h-3.5"})," Email"]})]})]}):e.jsx("div",{className:"text-center py-4 text-slate-400 text-xs italic",children:"Nenhum solicitante vinculado."})]})]})]})]})]})},Pt=({demands:t,citizens:s,interactions:l=[],onViewDemand:c,onEditDemand:b,onCreateDemand:n,onUpdateStatus:h,onInteractionUpdate:N,initialSelectionId:f,clearSelection:y,initialViewMode:k="list",filters:v,setFilters:m,users:j=[],onNotification:S,defaultLocation:I,onViewCitizen:B,mapMarkers:E})=>{const[g,P]=a.useState(k),[O,K]=a.useState("demands"),[z,C]=a.useState([]),[L,T]=a.useState("30"),[u,D]=a.useState(null),w=k==="map",d=a.useMemo(()=>{const _=t.length;let o=0,M=0,J=0;for(const se of t)se.status===H.PENDING?o++:se.status===H.COMPLETED&&M++,se.priority===X.HIGH&&J++;return{total:_,pending:o,completed:M,highPriority:J}},[t]);a.useEffect(()=>{f&&D(f)},[f,w]),a.useEffect(()=>{k&&!w&&P(k)},[k,w]),a.useEffect(()=>{(async()=>{if(le()&&R){const{data:o}=await R.from("app_config").select("value").eq("key","dashboard_notices").maybeSingle();o&&C(o.value)}else{const o=localStorage.getItem("geo_notices");o&&C(JSON.parse(o))}})()},[]);const $=_=>{if(T(_),!m)return;if(_==="all"){m(ve=>({...ve,startDate:"",endDate:""}));return}const o=parseInt(_),M=new Date,J=new Date;_==="365"?(J.setMonth(0,1),J.setHours(0,0,0,0)):J.setDate(M.getDate()-o);const se=J.toLocaleDateString("en-CA"),Ie=M.toLocaleDateString("en-CA");m(ve=>({...ve,startDate:se,endDate:Ie}))};a.useEffect(()=>{m&&!(v!=null&&v.startDate)&&!w&&$("30")},[]);const q=_=>{m&&m(_==="all"?o=>({...o,status:[]}):o=>({...o,status:[_]}))},ae=_=>{m&&m(_==="all"?o=>({...o,priority:[]}):o=>({...o,priority:[_]}))},A=_=>{if(!u)return;const o=t.findIndex(M=>M.id===u);o!==-1&&(_==="prev"&&o>0?D(t[o-1].id):_==="next"&&o<t.length-1&&D(t[o+1].id))},ee=u?t.findIndex(_=>_.id===u):-1,xe=ee>0,ie=ee!==-1&&ee<t.length-1,Z=v!=null&&v.status&&v.status.length===1?v.status[0]:"all",re=v!=null&&v.priority&&v.priority.length===1?v.priority[0]:"all";return e.jsxs("div",{className:`flex flex-col animate-in slide-in-from-right duration-500 ${w?"h-full":"gap-4"}`,children:[!w&&e.jsxs("div",{className:"shrink-0 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-3",children:[e.jsx(Ke,{className:"w-8 h-8 text-brand-600 dark:text-brand-400"}),"Gestão de Demandas"]}),e.jsx("p",{className:"text-slate-500 dark:text-blue-200/50 mt-1 font-medium hidden sm:block",children:g==="list"?"Controle detalhado e histórico de ocorrências.":g==="board"?"Fluxo de trabalho visual por status.":"Calendário de prazos e vencimentos."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsx("div",{className:"hidden md:flex w-[280px]",children:e.jsx(Me,{value:g,onChange:P,options:[{value:"list",label:"Lista",icon:St},{value:"board",label:"Quadro",icon:Dt},{value:"calendar",label:"Data",icon:Et}]})}),e.jsxs("button",{onClick:n,className:"w-full sm:w-auto px-5 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 transition-all flex items-center justify-center gap-2 active:scale-95 h-11",children:[e.jsx(_t,{className:"w-5 h-5"})," ",e.jsx("span",{className:"whitespace-nowrap",children:"Nova Demanda"})]})]})]}),e.jsx("div",{className:"md:hidden flex overflow-x-auto gap-2 pb-2 scrollbar-none snap-x -mx-4 px-4 bg-slate-50 dark:bg-[#020617] z-20 pt-2 border-b border-slate-200 dark:border-white/5",children:[{id:"list",label:"Lista",icon:St},{id:"board",label:"Quadro",icon:Dt},{id:"calendar",label:"Calendário",icon:Et}].map(_=>{const o=g===_.id,M=_.icon;return e.jsxs("button",{onClick:()=>P(_.id),className:`
                                flex items-center gap-2 px-4 py-2.5 rounded-full text-xs font-bold whitespace-nowrap transition-all snap-start
                                ${o?"bg-brand-600 text-white shadow-md shadow-brand-500/30":"bg-white dark:bg-white/5 text-slate-500 dark:text-white/60 border border-slate-200 dark:border-white/10"}
                            `,children:[e.jsx(M,{className:"w-3.5 h-3.5"}),_.label]},_.id)})})]}),v&&m&&!w&&e.jsx("div",{className:"mb-2",children:e.jsx(Kt,{status:Z,setStatus:q,priority:re,setPriority:ae,timeRange:L,setTimeRange:$,scope:"demands",setScope:()=>{},showScope:!1})}),!w&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 shrink-0",children:[e.jsx(De,{title:"Total Filtrado",value:d.total,icon:Ut,colorClass:"bg-blue-500",textClass:"text-blue-600 dark:text-blue-400"}),e.jsx(De,{title:"Pendentes",value:d.pending,icon:pe,colorClass:"bg-slate-500",textClass:"text-slate-600 dark:text-slate-400"}),e.jsx(De,{title:"Em Andamento",value:d.total-d.pending-d.completed,icon:We,colorClass:"bg-amber-500",textClass:"text-amber-600 dark:text-amber-400"}),e.jsx(De,{title:"Concluídos",value:d.completed,icon:$e,colorClass:"bg-green-500",textClass:"text-green-600 dark:text-green-400"})]}),w&&v&&m&&e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 pt-12 pointer-events-none z-30",children:e.jsx("div",{className:"pointer-events-auto max-w-2xl mx-auto",children:e.jsx(os,{filters:v,setFilters:m,users:j,isMapMode:!0,mapViewMode:O})})}),e.jsxs("div",{className:`flex-1 flex flex-col min-w-0 w-full relative ${w?"h-full":""}`,children:[g==="list"&&e.jsx(Xa,{demands:t,citizens:s,onUpdateStatus:h||(()=>{}),onEdit:_=>{b(_)},onInteractionUpdate:N,onViewDemand:_=>D(_.id),onNotification:S,onViewCitizen:B}),g==="board"&&e.jsx(Ya,{demands:t,citizens:s,onViewDemand:_=>{D(_.id)},onUpdateStatus:h||(()=>{})}),g==="calendar"&&e.jsx(Ka,{demands:t,interactions:l,notices:z,onEditDemand:_=>{D(_.id)}}),g==="map"&&e.jsx(ns,{demands:t,citizens:s,defaultCenter:I,preloadedMarkers:E,onViewDemand:_=>{D(_)},currentViewMode:O,onChangeViewMode:K})]}),u&&e.jsx(cs,{demand:t.find(_=>_.id===u),citizen:s.find(_=>{var o;return _.id===((o=t.find(M=>M.id===u))==null?void 0:o.citizenId)})||null,onClose:()=>{D(null),y&&y()},onEdit:_=>{D(null),b(_)},onUpdateStatus:(_,o)=>{h&&h(_,o)},onInteractionUpdate:N,onNavigate:_=>A(_),canNavigatePrev:xe,canNavigateNext:ie,onNotification:S,onViewCitizen:B})]})},xs=({locations:t})=>{const[s,l]=a.useState(null),[c,b]=a.useState(!1),n=t.length>0?t[0]:null;a.useEffect(()=>{(async()=>{if(!n){b(!1);return}const k=`weather_cache_${n.lat}_${n.lon}`,v=localStorage.getItem(k),m=new Date().toISOString().slice(0,13);if(v){const j=JSON.parse(v);if(j.hour===m){l(j.data);return}}b(!0);try{const S=await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${n.lat}&longitude=${n.lon}&current=temperature_2m,weather_code&timezone=auto`)).json();l(S),localStorage.setItem(k,JSON.stringify({hour:m,data:S}))}catch(j){console.error("Failed to fetch weather",j)}finally{b(!1)}})()},[n]);const h=y=>y===0?e.jsx(ft,{className:"w-6 h-6 text-amber-500"}):y>=1&&y<=3?e.jsx(Sa,{className:"w-6 h-6 text-slate-400"}):y>=51&&y<=67?e.jsx(Da,{className:"w-6 h-6 text-blue-400"}):y>=71&&y<=77?e.jsx(Ea,{className:"w-6 h-6 text-cyan-300"}):e.jsx(ft,{className:"w-6 h-6 text-amber-500"});if(c&&n)return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-slate-200/50 dark:bg-white/5 animate-pulse min-w-[140px] h-[46px]",children:[e.jsx(be,{className:"w-4 h-4 animate-spin text-slate-400"}),e.jsx("div",{className:"h-3 w-16 bg-slate-300 dark:bg-white/10 rounded"})]});if(!n||!s)return null;const N=Math.round(s.current.temperature_2m),f=s.current.weather_code;return e.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 rounded-xl bg-white/60 dark:bg-white/5 backdrop-blur-md border border-slate-200 dark:border-white/10 shadow-sm transition-all hover:bg-white/80 dark:hover:bg-white/10 cursor-default",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h(f),e.jsxs("span",{className:"text-xl font-bold text-slate-900 dark:text-white",children:[N,"°"]})]}),e.jsxs("div",{className:"flex flex-col border-l border-slate-300 dark:border-white/10 pl-4 h-8 justify-center",children:[e.jsxs("span",{className:"text-xs font-bold text-slate-700 dark:text-white uppercase tracking-wide flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3 text-brand-600 dark:text-brand-400"}),n.name]}),e.jsx("span",{className:"text-[10px] text-slate-500 dark:text-white/50",children:"Tempo Agora"})]})]})},hs=({onBack:t,onSuccess:s})=>{const[l,c]=a.useState(""),[b,n]=a.useState("search"),[h,N]=a.useState([]),[f,y]=a.useState(!1),[k,v]=a.useState(""),[m,j]=a.useState(""),[S,I]=a.useState(""),[B,E]=a.useState(!1);a.useEffect(()=>{const P=setTimeout(()=>v(l),500);return()=>clearTimeout(P)},[l]),a.useEffect(()=>{if(!k||k.length<3){N([]);return}(async()=>{if(y(!0),le()&&R){const O=Ue(k),{data:K}=await R.from("citizens").select("*").or(`telefone.ilike.%${O}%,nome.ilike.%${k}%`).limit(5);K&&N(K.map(z=>({id:z.id,name:`${z.nome} ${z.sobrenome}`,phone:z.telefone,bairro:z.bairro,email:z.email||"",createdAt:z.created_at})))}y(!1)})()},[k]);const g=async()=>{if(!m||!l)return;E(!0);const P=Ue(l),O=m.trim().split(" "),K=O[0],z=O.slice(1).join(" ")||".";try{if(le()&&R){const{data:C,error:L}=await R.from("citizens").insert({nome:K,sobrenome:z,telefone:P,bairro:S,origem:"fast_track_mobile"}).select().single();if(L)throw L;C&&s(C.id)}}catch(C){console.error(C),alert("Erro ao criar cidadão rápido.")}finally{E(!1)}};return e.jsxs("div",{className:"fixed inset-0 bg-slate-50 dark:bg-[#020617] z-[100] flex flex-col animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"p-4 flex items-center gap-4 border-b border-slate-200 dark:border-white/10 bg-white dark:bg-[#0b1121]",children:[e.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-white/10",children:e.jsx(vt,{className:"w-6 h-6 text-slate-600 dark:text-white"})}),e.jsx("h1",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Nova Solicitação"})]}),b==="search"&&e.jsxs("div",{className:"flex-1 p-6 flex flex-col",children:[e.jsx("label",{className:"text-sm font-bold text-slate-500 dark:text-white/50 mb-2 uppercase",children:"Quem está solicitando?"}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("input",{autoFocus:!0,type:"text",value:l,onChange:P=>c(P.target.value),placeholder:"Telefone ou Nome...",className:"w-full text-2xl font-bold bg-transparent border-b-2 border-slate-300 dark:border-white/20 py-2 outline-none focus:border-brand-500 text-slate-900 dark:text-white placeholder:text-slate-300"}),f&&e.jsx(be,{className:"absolute right-0 top-3 w-6 h-6 animate-spin text-brand-500"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3",children:[h.map(P=>e.jsxs("button",{onClick:()=>s(P.id),className:"w-full text-left p-4 bg-white dark:bg-white/5 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex items-center justify-between active:scale-95 transition-transform",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 dark:bg-brand-500/20 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold",children:P.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:P.name}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:_e(P.phone)})]})]}),e.jsx("div",{className:"bg-brand-600 text-white p-2 rounded-xl",children:e.jsx(nt,{className:"w-5 h-5"})})]},P.id)),k.length>3&&e.jsxs("button",{onClick:()=>n("create-citizen"),className:"w-full p-4 mt-4 bg-slate-100 dark:bg-white/5 rounded-2xl border-2 border-dashed border-slate-300 dark:border-white/10 flex items-center justify-center gap-2 text-slate-500 dark:text-white/60 font-bold active:scale-95 transition-transform",children:[e.jsx(Ft,{className:"w-5 h-5"}),'Cadastrar "',l,'"']})]})]}),b==="create-citizen"&&e.jsx("div",{className:"flex-1 p-6 flex flex-col",children:e.jsxs("div",{className:"bg-white dark:bg-white/5 p-6 rounded-3xl border border-slate-200 dark:border-white/10 shadow-lg space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Telefone"}),e.jsx("p",{className:"text-xl font-mono font-bold text-slate-900 dark:text-white border-b border-slate-100 pb-2",children:_e(l)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Nome Completo"}),e.jsx("input",{autoFocus:!0,type:"text",value:m,onChange:P=>j(P.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: João da Silva"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Bairro (Opcional)"}),e.jsx("input",{type:"text",value:S,onChange:P=>I(P.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: Centro"})]}),e.jsxs("button",{onClick:g,disabled:B||!m,className:"w-full py-4 bg-brand-600 text-white rounded-xl font-bold text-lg shadow-xl shadow-brand-500/20 flex items-center justify-center gap-2 active:scale-95 transition-transform disabled:opacity-50",children:[B?e.jsx(be,{className:"w-6 h-6 animate-spin"}):e.jsx(ct,{className:"w-6 h-6"}),"Salvar e Criar Demanda"]})]})})]})},ms=t=>{const[s,l]=a.useState(navigator.onLine),[c,b]=a.useState(!0),[n,h]=a.useState([]),[N,f]=a.useState([]),[y,k]=a.useState([]),[v,m]=a.useState([]),[j,S]=a.useState([]),[I,B]=a.useState(null),[E,g]=a.useState(null),[P,O]=a.useState(0),K=a.useCallback((L,T)=>{try{const u=localStorage.getItem("geo_map_cache"),D=u?JSON.parse(u):{};let w=!1;T.forEach(d=>{d.lat&&d.lon&&!D[d.id]&&(D[d.id]={lat:d.lat,lon:d.lon},w=!0)}),L.forEach(d=>{d.lat&&d.lon&&!D[d.id]&&(D[d.id]={lat:d.lat,lon:d.lon},w=!0)}),w&&localStorage.setItem("geo_map_cache",JSON.stringify(D))}catch(u){console.error("Error preloading map cache",u)}},[]),z=a.useCallback(async()=>{if(b(!0),!navigator.onLine){console.log("Offline mode: Loading from cache");const L=localStorage.getItem("cache_demands"),T=localStorage.getItem("cache_citizens"),u=localStorage.getItem("offline_demands_queue");let D=L?JSON.parse(L):[];const w=T?JSON.parse(T):[];u&&(D=[...JSON.parse(u),...D]),h(D),f(w),b(!1);return}if(le()&&R)try{const[{data:L},{data:T},{data:u},{data:D},{data:w},{data:d},{data:$}]=await Promise.all([R.from("demands").select("*").order("created_at",{ascending:!1}).limit(2e3),R.from("citizens").select("*").limit(3e3),R.from("system_users").select("*"),R.from("demand_interactions").select("*").order("created_at",{ascending:!1}).limit(1e3),R.from("app_config").select("*").eq("key","weather_locations").maybeSingle(),R.from("app_config").select("*").eq("key","global_theme_mode").maybeSingle(),R.from("dashboard_stats").select("*").maybeSingle()]),q=L?L.map(A=>({...A,citizenId:A.citizen_id,createdAt:A.created_at})):[],ae=T?T.map(A=>({id:A.id,cpf:A.cpf,name:`${A.nome} ${A.sobrenome}`,email:A.email,phone:A.telefone,createdAt:A.created_at,logradouro:A.logradouro,numero:A.numero,bairro:A.bairro,cidade:A.cidade,estado:A.estado,cep:A.cep,lat:A.lat,lon:A.lon})):[];localStorage.setItem("cache_demands",JSON.stringify(q)),localStorage.setItem("cache_citizens",JSON.stringify(ae)),L&&h(q),T&&f(ae),u&&k(u),D&&m(D.map(A=>({id:A.id,demandId:A.demanda_id,type:A.tipo,text:A.texto,isCompleted:A.concluido,deadline:A.prazo,user:A.usuario,createdAt:A.created_at}))),w&&S(w.value),$&&B($),d&&d.value&&g(d.value),K(q,ae)}catch(L){console.error("Error fetching data, trying cache...",L);const T=localStorage.getItem("cache_demands"),u=localStorage.getItem("cache_citizens");T&&h(JSON.parse(T)),u&&f(JSON.parse(u))}finally{b(!1)}else h([]),b(!1)},[K]),C=a.useCallback(async()=>{const L=localStorage.getItem("offline_demands_queue");if(!L)return 0;const T=JSON.parse(L);if(T.length===0)return 0;if(le()&&R){console.log(`Syncing ${T.length} offline demands...`);let u=0;for(const D of T)try{const{error:w}=await R.from("demands").insert({id:D.id,title:D.title,description:D.description,level:D.level,status:D.status,priority:D.priority,type:D.type,deadline:D.deadline,citizen_id:D.citizenId,tags:D.tags});w?console.error("Failed to sync item",D.id,w):u++}catch(w){console.error("Error syncing item",w)}return localStorage.removeItem("offline_demands_queue"),O(u),z(),u}return 0},[z]);return a.useEffect(()=>{const L=()=>{l(!0),C(),z()},T=()=>{l(!1)};return window.addEventListener("online",L),window.addEventListener("offline",T),()=>{window.removeEventListener("online",L),window.removeEventListener("offline",T)}},[z,C]),a.useEffect(()=>{t?(z(),setTimeout(()=>{navigator.onLine&&C()},2e3)):h([])},[t,z,C]),{isOnline:s,isLoading:c,demands:n,setDemands:h,citizens:N,setCitizens:f,users:y,interactions:v,weatherLocations:j,setWeatherLocations:S,dbStats:I,themePreference:E,fetchData:z,processOfflineQueue:C,syncCount:P,setSyncCount:O}},bs=ye.lazy(()=>Yt(()=>import("./PeopleManager-DNLUlquc.js"),__vite__mapDeps([0,1,2,3]))),us=ye.lazy(()=>Yt(()=>import("./AdminScreen-LtJjAJhn.js"),__vite__mapDeps([4,1,2,3]))),ut={administrador:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","admin_panel","map"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!0,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},chefe_de_gabinete:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},assessor:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!1,showPending:!0,showInProgress:!0,showCompleted:!1,showHighPriority:!0,showAnalytics:!1,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0}},ps=ye.memo(({data:t,title:s})=>{const l=t.reduce((b,n)=>b+n.value,0);let c=0;return l===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados"}):e.jsxs("div",{className:"flex items-center gap-6 h-full justify-center",children:[e.jsxs("div",{className:"relative w-32 h-32 shrink-0",children:[e.jsx("svg",{viewBox:"0 0 100 100",className:"transform -rotate-90 w-full h-full",children:t.map((b,n)=>{const h=b.value/l,N=40,f=2*Math.PI*N,y=`${h*f} ${f}`;return c+=h*100,e.jsx("circle",{cx:"50",cy:"50",r:N,fill:"transparent",stroke:b.color,strokeWidth:"12",strokeDasharray:y,strokeDashoffset:-(c-h*100)/100*f,className:"transition-all duration-1000 ease-out"},n)})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-xl font-bold text-slate-800 dark:text-white",children:l}),e.jsx("span",{className:"text-[9px] uppercase font-bold text-slate-400",children:"Total"})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:t.map((b,n)=>e.jsxs("div",{className:"flex items-center justify-between text-xs gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:b.color}}),e.jsx("span",{className:"font-medium text-slate-600 dark:text-white/80",children:b.label})]}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white",children:[Math.round(b.value/l*100),"%"]})]},n))})]})}),gs=ye.memo(({data:t,unit:s=""})=>{const l=Math.max(...t.map(c=>c.value),1);return t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados geográficos"}):e.jsx("div",{className:"h-full w-full flex items-end justify-between gap-2 px-2 pb-2 pt-4",children:t.slice(0,7).map((c,b)=>{const n=c.value/l*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1 group h-full justify-end",children:[e.jsxs("div",{className:"text-[10px] font-bold text-slate-600 dark:text-slate-300 mb-0.5",children:[c.value,s]}),e.jsx("div",{style:{height:`${n}%`},className:"w-full bg-brand-200 dark:bg-brand-500/30 rounded-t-sm group-hover:bg-brand-50 dark:group-hover:bg-brand-500 transition-colors min-h-[4px]"}),e.jsx("div",{className:"text-[9px] text-slate-400 truncate w-full text-center",title:c.label,children:c.label.slice(0,6)})]},b)})})}),Qt=()=>{const[t,s]=a.useState(()=>{if(typeof window<"u"){const r=localStorage.getItem("geo_user");return r?JSON.parse(r):null}return null}),[l,c]=a.useState("dashboard"),[b,n]=a.useState(!0),h=a.useRef(0),N=a.useRef(null),[f,y]=a.useState("list"),[k,v]=a.useState(()=>typeof window<"u"&&localStorage.getItem("geo_theme_pref")||"auto"),[m,j]=a.useState(!1),[S,I]=a.useState("all"),[B,E]=a.useState("all"),[g,P]=a.useState("30"),[O,K]=a.useState("demands"),[z,C]=a.useState("activity"),[L,T]=a.useState(ut),[u,D]=a.useState({search:"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[]}),[w,d]=a.useState(null),[$,q]=a.useState(null),[ae,A]=a.useState(null),[ee,xe]=a.useState(null),[ie,Z]=a.useState("list"),{demands:re,setDemands:_,citizens:o,users:M,interactions:J,weatherLocations:se,setWeatherLocations:Ie,isOnline:ve,themePreference:Ae,fetchData:ue,syncCount:me}=ms(t);a.useEffect(()=>{Ae&&v(Ae)},[Ae]);const ge=a.useMemo(()=>{let r=null,x=null;if(u.startDate){const[U,W,Y]=u.startDate.split("-").map(Number);if(r=new Date(U,W-1,Y,0,0,0,0).getTime(),u.endDate){const[Ne,He,kt]=u.endDate.split("-").map(Number);x=new Date(Ne,He-1,kt,23,59,59,999).getTime()}else x=new Date(U,W-1,Y,23,59,59,999).getTime()}const G=u.search.toLowerCase();return re.filter(U=>{if(u.search){const W=U.id.toLowerCase().includes(G),Y=U.title.toLowerCase().includes(G),de=U.description.toLowerCase().includes(G);if(!W&&!Y&&!de)return!1}if(u.status.length>0&&!u.status.includes(U.status)||u.priority.length>0&&!u.priority.includes(U.priority)||u.level.length>0&&!u.level.includes(U.level)||u.responsibleId&&U.responsibleId!==u.responsibleId||u.tags&&u.tags.length>0&&(!U.tags||!u.tags.some(W=>U.tags.includes(W))))return!1;if(r!==null&&x!==null){let W;if(u.dateType==="deadline"?W=U.deadline:u.dateType==="updatedAt"?W=U.updatedAt:W=U.createdAt,!W)return!1;let Y;if(/^\d{4}-\d{2}-\d{2}$/.test(W)){const[de,Ne,He]=W.split("-").map(Number);Y=new Date(de,Ne-1,He,12,0,0).getTime()}else Y=new Date(W).getTime();if(Y<r||Y>x)return!1}return!0})},[re,u]),Ce=a.useMemo(()=>{const r=u.search.toLowerCase();return u.search?o.filter(x=>{var Y,de;const G=x.name.toLowerCase().includes(r),U=(Y=x.email)==null?void 0:Y.toLowerCase().includes(r),W=(de=x.phone)==null?void 0:de.includes(r);return G||U||W}):o},[o,u.search]),Te=a.useMemo(()=>{const r=[];return ge.length>0&&ge.forEach(x=>{x.lat&&x.lon&&r.push({id:x.id,type:"demand",lat:x.lat,lon:x.lon,title:x.title,status:x.status,priority:x.priority})}),Ce.length>0&&Ce.forEach(x=>{x.lat&&x.lon&&r.push({id:x.id,type:"citizen",lat:x.lat,lon:x.lon,name:x.name,bairro:x.bairro})}),r},[ge,Ce]);a.useEffect(()=>{const r=x=>{var G;(G=x.detail)!=null&&G.demandId&&c("map")};return window.addEventListener("navigate-to-map",r),()=>window.removeEventListener("navigate-to-map",r)},[]),a.useEffect(()=>{me>0&&ce("success",`${me} itens sincronizados.`)},[me]),a.useEffect(()=>{N.current&&(N.current.scrollTo(0,0),n(!0))},[l]);const Oe=r=>{const x=r.currentTarget.scrollTop;Math.abs(x-h.current)>5&&(x>h.current&&x>50?n(!1):n(!0),h.current=x)};a.useEffect(()=>{const r=()=>{let G=!1;if(k==="dark")G=!0;else if(k==="light")G=!1;else{const U=new Date().getHours();G=U<6||U>=18}j(G),G?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};r();const x=setInterval(r,6e4);return()=>clearInterval(x)},[k]);const ce=a.useCallback((r,x)=>{xe({type:r,message:x}),setTimeout(()=>xe(null),4e3)},[]),Re=r=>{s(r)},je=()=>{s(null),localStorage.removeItem("geo_user"),_([])},p=()=>{const r=m?"light":"dark";v(r),localStorage.setItem("geo_theme_pref",r)},F=r=>{q(r),c("people")},Q=async(r,x)=>{const G=re.find(W=>W.id===r),U=G==null?void 0:G.status;if(_(W=>W.map(Y=>Y.id===r?{...Y,status:x}:Y)),le()&&R){if(await R.from("demands").update({status:x}).eq("id",r),U&&U!==x&&t){const W=t.name,Y=`Status alterado de "${U}" para "${x}" por ${W}.`;await R.from("demand_interactions").insert({demanda_id:r,tipo:"comentario",texto:Y,usuario:"Sistema",created_at:new Date().toISOString()}),ue()}ce("success","Status atualizado!")}},ne=()=>{const r=new Date,x=new Date;if(g!=="all"){const G=parseInt(g);G===365?(x.setMonth(0,1),x.setHours(0,0,0,0)):x.setDate(r.getDate()-G)}else x.setFullYear(1970);return x},te=a.useMemo(()=>{const r=ne();return re.filter(x=>{const U=new Date(x.createdAt)>=r,W=S==="all"||x.status===S,Y=B==="all"||x.priority===B;return U&&W&&Y})},[re,S,B,g]),oe=a.useMemo(()=>{const r=ne();return o.filter(x=>x.createdAt?new Date(x.createdAt)>=r:!0)},[o,g]),V=a.useMemo(()=>{if(O==="demands"){const r=te.length;let x=0,G=0,U=0;for(const W of te)W.status===H.PENDING?x++:W.status===H.COMPLETED&&G++,W.priority===X.HIGH&&U++;return{stat1:{label:"Filtradas",value:r,icon:Ut,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Pendentes",value:x,icon:pe,color:"bg-slate-500",text:"text-slate-600 dark:text-slate-400"},stat3:{label:"Concluídos",value:G,icon:$e,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat4:{label:"Alta Prioridade",value:U,icon:it,color:"bg-red-500",text:"text-red-600 dark:text-red-400"}}}else{const r=o.length,x=new Date().toDateString(),G=o.filter(Y=>Y.createdAt&&new Date(Y.createdAt).toDateString()===x).length,U={};for(const Y of o)Y.bairro&&(U[Y.bairro]=(U[Y.bairro]||0)+1);const W=Object.entries(U).sort((Y,de)=>de[1]-Y[1])[0];return{stat1:{label:"Total Cidadãos",value:r,icon:Pe,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Novos Hoje",value:G,icon:Ft,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat3:{label:"Top Bairro",value:W?W[0]:"N/A",icon:fe,color:"bg-brand-500",text:"text-brand-600 dark:text-brand-400"},stat4:{label:"Cadastros (Bairro)",value:W?W[1]:0,icon:Ot,color:"bg-purple-500",text:"text-purple-600 dark:text-purple-400"}}}},[te,oe,o,O]),ke=a.useMemo(()=>{if(O==="demands"){const r={[H.PENDING]:0,[H.IN_PROGRESS]:0,[H.COMPLETED]:0};return te.forEach(x=>{r[x.status]!==void 0&&r[x.status]++}),[{label:"Pendente",value:r[H.PENDING],color:"#64748b"},{label:"Em Andamento",value:r[H.IN_PROGRESS],color:"#f59e0b"},{label:"Concluído",value:r[H.COMPLETED],color:"#10b981"}].filter(x=>x.value>0)}else{const r={};oe.forEach(Y=>{const de=Y.createdAt?new Date(Y.createdAt):new Date,Ne=`${de.getFullYear()}-${String(de.getMonth()+1).padStart(2,"0")}`;r[Ne]=(r[Ne]||0)+1});const x=Object.keys(r).sort().reverse(),G=["#0ea5e9","#6366f1","#8b5cf6","#ec4899","#64748b"],U=x.slice(0,4).map((Y,de)=>{const[Ne,He]=Y.split("-"),ht=new Date(parseInt(Ne),parseInt(He)-1).toLocaleString("pt-BR",{month:"short",year:"2-digit"});return{label:ht.charAt(0).toUpperCase()+ht.slice(1),value:r[Y],color:G[de%G.length]}}),W=x.slice(4).reduce((Y,de)=>Y+r[de],0);return W>0&&U.push({label:"Antigos",value:W,color:"#94a3b8"}),U}},[te,oe,O]),he=a.useMemo(()=>{const r={};return O==="demands"?te.forEach(x=>{const G=o.find(U=>U.id===x.citizenId);G&&G.bairro&&(r[G.bairro]=(r[G.bairro]||0)+1)}):oe.forEach(x=>{x.bairro&&(r[x.bairro]=(r[x.bairro]||0)+1)}),Object.entries(r).sort((x,G)=>G[1]-x[1]).slice(0,7).map(([x,G])=>({label:x,value:G}))},[te,oe,o,O]),Qe=a.useMemo(()=>[...te].sort((r,x)=>new Date(x.createdAt).getTime()-new Date(r.createdAt).getTime()).slice(0,5),[te]),Ze=a.useMemo(()=>[...oe].sort((r,x)=>new Date(x.createdAt||0).getTime()-new Date(r.createdAt||0).getTime()).slice(0,5),[oe]),Xe=a.useMemo(()=>{const r=new Date;return r.setHours(0,0,0,0),te.filter(x=>x.deadline&&x.status!==H.COMPLETED).map(x=>({...x,date:new Date(x.deadline)})).filter(x=>x.date>=r).sort((x,G)=>x.date.getTime()-G.date.getTime()).slice(0,5)},[te]),Ge=t?L[t.role]||ut.assessor:ut.administrador,et=()=>e.jsx("div",{className:"space-y-2",children:O==="demands"?Qe.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Ta,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):Qe.map(r=>e.jsxs("div",{onClick:()=>{t&&(A(r.id),c("demands"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-brand-50 dark:bg-brand-500/10 flex flex-col items-center justify-center text-brand-600 dark:text-brand-400 font-bold shrink-0 border border-brand-100 dark:border-brand-500/20",children:[e.jsx("span",{className:"text-xs",children:new Date(r.createdAt).getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:new Date(r.createdAt).toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:r.title}),e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${r.status==="Concluído"?"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300":r.status==="Em Andamento"?"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300":"bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300"}`,children:r.status})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:r.description})]})]},r.id)):Ze.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Pe,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):Ze.map(r=>e.jsxs("div",{onClick:()=>{F(r.id)},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-blue-50 dark:bg-blue-500/10 flex flex-col items-center justify-center text-blue-600 dark:text-blue-400 font-bold shrink-0 border border-blue-100 dark:border-blue-500/20",children:[e.jsx("span",{className:"text-xs",children:new Date(r.createdAt||Date.now()).getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:new Date(r.createdAt||Date.now()).toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:r.name}),e.jsx("span",{className:"shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300",children:r.phone?_e(r.phone):"Sem Tel"})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1 flex items-center gap-1",children:r.bairro&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-2.5 h-2.5"})," ",r.bairro]})})]})]},r.id))}),i=()=>e.jsx("div",{className:"space-y-2",children:O==="demands"?Xe.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx($e,{className:"w-6 h-6 mb-2 opacity-20"}),"Tudo em dia!"]}):Xe.map(r=>{const x=Math.ceil((r.date.getTime()-new Date().getTime())/864e5);return e.jsxs("div",{onClick:()=>{t&&(A(r.id),c("demands"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-amber-50 dark:bg-amber-500/10 flex flex-col items-center justify-center text-amber-600 dark:text-amber-400 font-bold shrink-0 border border-amber-100 dark:border-amber-500/20",children:[e.jsx("span",{className:"text-xs",children:r.date.getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:r.date.toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:r.title}),e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${x<=2?"bg-red-100 text-red-600 dark:bg-red-500/20":"bg-slate-100 text-slate-600 dark:bg-white/10"}`,children:x<0?"Exp.":`${x}d`})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:r.description})]})]},r.id)}):he.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(fe,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):he.slice(0,5).map((r,x)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs font-bold text-slate-400 w-4",children:x+1}),e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-white",children:r.label})]}),e.jsx("span",{className:"text-[10px] font-bold bg-purple-100 text-purple-600 dark:bg-purple-500/20 dark:text-purple-300 px-2 py-1 rounded-full",children:r.value})]},x))});return e.jsxs("div",{className:`flex h-screen bg-slate-50 dark:bg-[#020617] transition-colors duration-500 overflow-hidden ${m?"dark":""}`,children:[!t&&e.jsx("div",{className:"absolute inset-0 z-[100]",children:e.jsx(Ja,{onLogin:Re})}),e.jsxs("div",{className:`dashboard-root flex h-full w-full transition-all duration-700 ease-in-out ${t?"filter-none scale-100 opacity-100":"blur-[5px] scale-[1.02] pointer-events-none grayscale-[0.2]"}`,children:[e.jsx(Ga,{currentView:l==="fast-track"?"demands":l,setView:c,user:t,onLogout:je,toggleTheme:p,isDarkMode:m,systemConfig:L,showMobileDock:b}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 transition-all duration-300 relative lg:my-4 lg:mr-4 lg:ml-4",children:[!ve&&e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-[1000] bg-amber-500/90 backdrop-blur-sm text-white text-xs font-bold text-center py-1.5 flex items-center justify-center gap-2 lg:rounded-t-[2.5rem]",children:[e.jsx(Ia,{className:"w-3 h-3"})," Modo Offline. As alterações serão salvas localmente."]}),e.jsxs("div",{className:`
                        flex-1 relative overflow-hidden flex flex-col glass-container
                        ${l==="map"?"rounded-none md:rounded-[2.5rem] lg:border-0":"rounded-[2.5rem]"}
                    `,children:[ee&&e.jsxs("div",{className:`fixed top-6 right-6 z-[1000] px-4 py-3 rounded-xl shadow-2xl border flex items-center gap-3 animate-in slide-in-from-right duration-300 ${ee.type==="success"?"bg-green-500 text-white border-green-600":"bg-red-500 text-white border-red-600"}`,children:[ee.type==="success"?e.jsx($e,{className:"w-5 h-5"}):e.jsx(zt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-sm",children:ee.message})]}),e.jsxs(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(be,{className:"w-8 h-8 animate-spin text-brand-500"})}),children:[["dashboard","new-demand","edit-demand","admin_panel","demands","people"].includes(l)&&e.jsxs("div",{className:"absolute inset-0 overflow-y-auto custom-scrollbar p-4 lg:p-6 pb-32 lg:pb-6",onScroll:Oe,ref:N,children:[e.jsx("div",{className:"lg:hidden h-2 w-full"}),l==="dashboard"&&e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 shrink-0",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white tracking-tight",children:["Olá, ",t?t.name.split(" ")[0]:"Bem-vindo"]})}),e.jsx(xs,{locations:se})]}),e.jsx(Kt,{status:S,setStatus:I,priority:B,setPriority:E,timeRange:g,setTimeRange:P,scope:O,setScope:K,className:"sticky top-0 z-30"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 shrink-0",children:[e.jsx(De,{title:V.stat1.label,value:typeof V.stat1.value=="string"?0:V.stat1.value,subValue:typeof V.stat1.value=="string"?V.stat1.value:void 0,icon:V.stat1.icon,colorClass:V.stat1.color,textClass:V.stat1.text}),e.jsx(De,{title:V.stat2.label,value:typeof V.stat2.value=="string"?0:V.stat2.value,subValue:typeof V.stat2.value=="string"?V.stat2.value:void 0,icon:V.stat2.icon,colorClass:V.stat2.color,textClass:V.stat2.text}),e.jsx(De,{title:V.stat3.label,value:typeof V.stat3.value=="string"?0:V.stat3.value,subValue:typeof V.stat3.value=="string"?V.stat3.value:void 0,icon:V.stat3.icon,colorClass:V.stat3.color,textClass:V.stat3.text}),e.jsx(De,{title:V.stat4.label,value:typeof V.stat4.value=="string"?0:V.stat4.value,subValue:typeof V.stat4.value=="string"?V.stat4.value:void 0,icon:V.stat4.icon,colorClass:V.stat4.color,textClass:V.stat4.text})]}),Ge.dashboardWidgets.showAnalytics&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-auto shrink-0",children:[e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(Aa,{className:"w-3 h-3"})," ",O==="demands"?"Distribuição por Status":"Cadastros por Mês"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(ps,{data:ke,title:O==="demands"?"Demandas":"Cidadãos"})})]}),e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(fe,{className:"w-3 h-3"})," ",O==="demands"?"Top Bairros (Demandas)":"Top Bairros (Residentes)"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(gs,{data:he})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 min-h-0",children:[e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${z!=="activity"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(Me,{value:z,onChange:r=>C(r),options:[{value:"activity",label:"Atividade Recente",icon:st},{value:"upcoming",label:"Próx. Prazos",icon:mt}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(st,{className:"w-4 h-4"})," Atividades Recentes"]}),e.jsxs("button",{onClick:()=>c(O==="demands"?"demands":"people"),className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(Ve,{className:"w-3 h-3"})]})]}),et()]}),e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${z!=="upcoming"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(Me,{value:z,onChange:r=>C(r),options:[{value:"activity",label:"Atividade Recente",icon:st},{value:"upcoming",label:"Próx. Prazos",icon:mt}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(mt,{className:"w-4 h-4"})," ",O==="demands"?"Próximos Prazos":"Top Bairros"]}),e.jsxs("button",{onClick:()=>{O==="demands"?(Z("calendar"),c("demands")):c("map")},className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(Ve,{className:"w-3 h-3"})]})]}),i()]})]})]}),l==="new-demand"&&e.jsx(qa,{initialSearchTerm:$||void 0,onSuccess:r=>{ue(),c("demands"),q(null)},onCancel:()=>{c("demands"),q(null)},onNotification:ce}),l==="edit-demand"&&w&&e.jsx(Va,{demand:w,onSuccess:r=>{ue(),c("demands"),d(null)},onCancel:()=>{c("demands"),d(null)},onNotification:ce}),l==="admin_panel"&&t&&e.jsx(us,{currentUser:t,systemConfig:L,onUpdateConfig:T,onUpdateLocation:Ie,onNotification:ce,onLogout:je,toggleTheme:p,isDarkMode:m}),l==="demands"&&e.jsx(Pt,{demands:ge,citizens:o,interactions:J,users:M,onViewDemand:()=>{},onEditDemand:r=>{d(r),c("edit-demand")},onCreateDemand:()=>c("new-demand"),onUpdateStatus:Q,onInteractionUpdate:ue,filters:u,setFilters:D,onNotification:ce,defaultLocation:se.length>0?se[0]:null,onViewCitizen:F,initialViewMode:ie,mapMarkers:Te,initialSelectionId:ae,clearSelection:()=>A(null)}),l==="people"&&e.jsx(bs,{initialSearchTerm:$||void 0,onCreateDemand:r=>{q(r),c("new-demand")},onEditDemand:r=>{d(r),c("edit-demand")},onNotification:ce,onPersonUpdate:ue,permissions:Ge,onModeChange:y,demands:re})]}),l==="fast-track"&&e.jsx(hs,{onBack:()=>c("demands"),onSuccess:r=>{q(r),c("new-demand")}}),l==="map"&&e.jsx("div",{className:"absolute inset-0 z-0 flex flex-col overflow-hidden pb-[76px] md:pb-0",children:e.jsx(Pt,{demands:ge,citizens:o,interactions:J,users:M,onViewDemand:()=>{},onEditDemand:r=>{d(r),c("edit-demand")},onCreateDemand:()=>c("new-demand"),onUpdateStatus:Q,onInteractionUpdate:ue,filters:u,setFilters:D,onNotification:ce,initialViewMode:"map",defaultLocation:se.length>0?se[0]:null,onViewCitizen:F,mapMarkers:Te,initialSelectionId:ae,clearSelection:()=>A(null)})})]})]})]})]})]})};console.log("Iniciando Gabinete Digital (Main)...");const pt=document.getElementById("root");if(!pt)console.error("ERRO CRÍTICO: Elemento 'root' não encontrado no HTML.");else try{ot.createRoot(pt).render(e.jsx(ye.StrictMode,{children:e.jsx(Qt,{})})),console.log("React montado com sucesso via src/main.tsx")}catch(t){console.error("Erro ao montar React:",t),pt.innerHTML='<div style="color:red; padding: 20px;">Erro ao carregar a aplicação. Verifique o console.</div>'}console.log("Iniciando Gabinete Digital...");const gt=document.getElementById("root");if(!gt)console.error("ERRO CRÍTICO: Elemento 'root' não encontrado no HTML.");else try{ot.createRoot(gt).render(e.jsx(ye.StrictMode,{children:e.jsx(Qt,{})})),console.log("React montado com sucesso.")}catch(t){console.error("Erro ao montar React:",t),gt.innerHTML='<div style="color:red; padding: 20px;">Erro ao carregar a aplicação. Verifique o console.</div>'}export{cs as D,Qa as P,De as S,Ue as a,Me as b,_e as f,le as i,e as j,R as s};
