const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PeopleManager-BdCezEYe.js","assets/vendor-CEvWhIr7.js","assets/db-DxEMLo30.js","assets/maps-DmXjGBAC.js","assets/AdminScreen-2JVMuwkF.js"])))=>i.map(i=>d[i]);
import{r as a,a as ia,R as Le,H as ca,L as et,U as We,M as $t,b as xa,P as ha,d as ma,S as At,e as ba,f as zt,h as ua,i as dt,A as Pt,j as lt,k as we,l as ft,m as ve,F as Lt,X as Ie,n as _t,C as ye,o as bt,p as pa,q as Wt,s as mt,B as ga,t as Ot,u as fa,E as Nt,v as yt,w as wa,x as nt,y as Mt,z as va,D as it,G as Ce,Z as Ze,I as Me,J as Re,K as Xe,N as Jt,O as ja,Q as Yt,T as ut,V as ka,W as Na,Y as ya,_ as pt,$ as Ca,a0 as Ft,a1 as Sa,a2 as Tt,a3 as Da,a4 as Ea,a5 as Ia,a6 as Kt,a7 as Aa,a8 as Ut,a9 as Ta,aa as $a,ab as Pa,ac as La,ad as _a,ae as Qt,af as Oa,ag as Ma,ah as Ra,ai as za,aj as Fa,ak as Ua,al as Zt,am as Ga,an as Ha,ao as Ba,ap as Ct,aq as qa}from"./vendor-CEvWhIr7.js";import{c as Va}from"./db-DxEMLo30.js";import{l as _e,M as Xt,T as ea,u as wt,C as ta,P as aa,a as sa}from"./maps-DmXjGBAC.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))o(m);new MutationObserver(m=>{for(const r of m)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function l(m){const r={};return m.integrity&&(r.integrity=m.integrity),m.referrerPolicy&&(r.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?r.credentials="include":m.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(m){if(m.ep)return;m.ep=!0;const r=l(m);fetch(m.href,r)}})();var ra={exports:{}},vt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wa=a,Ja=Symbol.for("react.element"),Ya=Symbol.for("react.fragment"),Ka=Object.prototype.hasOwnProperty,Qa=Wa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Za={key:!0,ref:!0,__self:!0,__source:!0};function la(t,s,l){var o,m={},r=null,i=null;l!==void 0&&(r=""+l),s.key!==void 0&&(r=""+s.key),s.ref!==void 0&&(i=s.ref);for(o in s)Ka.call(s,o)&&!Za.hasOwnProperty(o)&&(m[o]=s[o]);if(t&&t.defaultProps)for(o in s=t.defaultProps,s)m[o]===void 0&&(m[o]=s[o]);return{$$typeof:Ja,type:t,key:r,ref:i,props:m,_owner:Qa.current}}vt.Fragment=Ya;vt.jsx=la;vt.jsxs=la;ra.exports=vt;var e=ra.exports,gt={},Gt=ia;gt.createRoot=Gt.createRoot,gt.hydrateRoot=Gt.hydrateRoot;const Xa="modulepreload",es=function(t){return"/Gabinete-Digital/"+t},Ht={},na=function(s,l,o){let m=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),w=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));m=Promise.allSettled(l.map(k=>{if(k=es(k),k in Ht)return;Ht[k]=!0;const j=k.endsWith(".css"),N=j?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${k}"]${N}`))return;const H=document.createElement("link");if(H.rel=j?"stylesheet":Xa,j||(H.as="script"),H.crossOrigin="",H.href=k,w&&H.setAttribute("nonce",w),document.head.appendChild(H),j)return new Promise((x,f)=>{H.addEventListener("load",x),H.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${k}`)))})}))}function r(i){const w=new Event("vite:preloadError",{cancelable:!0});if(w.payload=i,window.dispatchEvent(w),!w.defaultPrevented)throw i}return m.then(i=>{for(const w of i||[])w.status==="rejected"&&r(w.reason);return s().catch(r)})},ts=Le.memo(({currentView:t,setView:s,user:l,onLogout:o,toggleTheme:m,isDarkMode:r,systemConfig:i,showMobileDock:w=!0})=>{const[k,j]=a.useState(!0),[N,H]=a.useState(!1),x=k||N,f=l&&i[l.role]?i[l.role]:{allowedViews:[]},P=[{id:"dashboard",label:"Home",icon:ca},{id:"demands",label:"Demandas",icon:et},{id:"people",label:"Cidadãos",icon:We},{id:"map",label:"Mapa",icon:$t}].filter(u=>f.allowedViews.includes(u.id)),$=u=>u.split("_").map(A=>A.charAt(0).toUpperCase()+A.slice(1)).join(" "),E=u=>{s(u)};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`
          hidden lg:flex
          transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]
          flex-col will-change-transform group z-40 overflow-hidden
          static h-auto
          my-4 ml-4 mr-0
          rounded-[2.5rem] border border-white/60 dark:border-white/5
          bg-white/80 dark:bg-[#020617]/80 backdrop-blur-2xl
          shadow-xl shadow-slate-200/50 dark:shadow-black/20
          ${x?"w-72":"w-24"}
        `,onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1),children:[e.jsxs("div",{className:`p-6 flex items-center ${x?"justify-between":"justify-center"} border-b border-slate-100 dark:border-white/5 h-28 shrink-0 relative`,children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden whitespace-nowrap",children:[e.jsx("div",{className:`w-12 h-12 min-w-[3rem] bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30 ring-1 ring-white/20 transition-transform duration-300 ${!x&&!k?"scale-110":""}`,children:e.jsx(xa,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:`transition-all duration-300 origin-left ${x?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight text-slate-900 dark:text-white leading-none",children:"Gabinete"}),e.jsx("span",{className:"text-[10px] text-brand-600 dark:text-brand-400 font-bold tracking-[0.2em] uppercase",children:"Digital"})]})]}),e.jsx("button",{onClick:()=>j(!k),className:`
                flex absolute right-6 top-1/2 -translate-y-1/2 text-slate-400 dark:text-white/30 hover:text-brand-600 dark:hover:text-white transition-all duration-300
                ${x?"opacity-0 group-hover:opacity-100 delay-100":"opacity-0 pointer-events-none"}
            `,title:k?"Desafixar menu":"Fixar menu",children:k?e.jsx(ha,{className:"w-4 h-4"}):e.jsx(ma,{className:"w-4 h-4"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-x-hidden overflow-y-auto custom-scrollbar flex flex-col",children:P.map(u=>{const A=u.icon,q=t===u.id;return e.jsxs("button",{onClick:()=>E(u.id),disabled:!l,className:`
                  w-full flex items-center gap-4 px-4 py-3.5 rounded-2xl text-sm font-bold transition-all duration-300 relative group/item
                  ${l?"":"opacity-30 cursor-not-allowed"}
                  ${q?"bg-brand-500/10 dark:bg-white/10 text-brand-700 dark:text-white shadow-sm ring-1 ring-brand-500/20 dark:ring-white/10":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white"}
                  ${x?"":"justify-center"}
                `,children:[e.jsx(A,{className:`w-6 h-6 min-w-[1.5rem] transition-transform duration-300 ${q?"scale-110":"group-hover/item:scale-110"}`}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${x?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:u.label}),q&&x&&e.jsx("div",{className:"absolute right-4 w-1.5 h-1.5 rounded-full bg-brand-500 shadow-[0_0_8px_currentColor]"})]},u.id)})}),e.jsxs("div",{className:"p-4 border-t border-slate-100 dark:border-white/5 shrink-0 space-y-2",children:[e.jsxs("button",{onClick:m,className:`
                  lg:hidden w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5
                  ${x?"":"justify-center"}
                `,children:[r?e.jsx(At,{className:"w-5 h-5 min-w-[1.25rem] text-amber-400"}):e.jsx(ba,{className:"w-5 h-5 min-w-[1.25rem] text-slate-600"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${x?"opacity-100":"opacity-0 w-0 hidden"}`,children:r?"Modo Claro":"Modo Escuro"})]}),l&&e.jsxs("button",{onClick:()=>E("admin_panel"),className:`
                  w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  ${t==="admin_panel"?"bg-slate-100 dark:bg-white/10 text-brand-700 dark:text-brand-300":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5"}
                  ${x?"":"justify-center"}
                `,children:[e.jsx(zt,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${x?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Configurações"})]}),e.jsxs("button",{onClick:o,disabled:!l,className:`
                w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors
                ${x?"":"justify-center"}
                `,children:[e.jsx(ua,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${x?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Sair"})]}),e.jsxs("div",{className:`mt-2 flex items-center gap-3 p-2 rounded-2xl border transition-all duration-300 
                ${x?"bg-slate-50/50 dark:bg-white/5 border-slate-100 dark:border-white/5":"bg-transparent border-transparent justify-center"}
            `,children:[e.jsx("div",{className:"w-9 h-9 min-w-[2.25rem] rounded-full bg-slate-200 dark:bg-slate-800 flex items-center justify-center overflow-hidden border border-white dark:border-white/10 shadow-sm",children:l!=null&&l.avatar?e.jsx("img",{src:l.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(dt,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"})}),e.jsxs("div",{className:`flex-1 min-w-0 overflow-hidden transition-all duration-300 ${x?"opacity-100":"opacity-0 w-0 hidden"}`,children:[e.jsx("p",{className:"text-xs font-bold truncate text-slate-800 dark:text-white",children:l?l.name.split(" ")[0]:"..."}),e.jsx("p",{className:"text-[9px] text-brand-600 dark:text-brand-400 font-bold uppercase truncate tracking-wider",children:l?$(l.role):""})]})]})]})]}),e.jsx("nav",{className:`
            lg:hidden fixed bottom-0 left-0 right-0 z-[3000] 
            bg-white/95 dark:bg-[#0f172a]/95 backdrop-blur-xl 
            border-t border-slate-200 dark:border-white/10 
            pb-safe-area shadow-[0_-4px_20px_rgba(0,0,0,0.05)]
            transition-transform duration-300 ease-in-out
            ${w?"translate-y-0":"translate-y-full"}
        `,children:e.jsxs("div",{className:"flex items-center justify-around h-[76px] px-2 pb-2",children:[P.map(u=>{const A=t===u.id,q=u.icon;return e.jsxs("button",{onClick:()=>E(u.id),className:`
                    flex flex-col items-center justify-center gap-1.5 w-full h-full transition-all duration-200 active:scale-95
                    ${A?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`
                    relative p-2 rounded-2xl transition-all duration-300
                    ${A?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}
                `,children:e.jsx(q,{className:`w-6 h-6 transition-all ${A?"stroke-[2.5px] scale-110":"stroke-2"}`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide transition-opacity ${A?"opacity-100":"opacity-60"}`,children:u.label})]},u.id)}),e.jsxs("button",{onClick:()=>E("admin_panel"),className:`
                flex flex-col items-center justify-center gap-1.5 w-full h-full transition-all duration-200 active:scale-95
                ${t==="admin_panel"?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`relative p-2 rounded-2xl transition-all duration-300 ${t==="admin_panel"?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}`,children:e.jsx(zt,{className:`w-6 h-6 ${t==="admin_panel"?"stroke-[2.5px]":"stroke-2"}`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide ${t==="admin_panel"?"opacity-100":"opacity-60"}`,children:"Configurações"})]})]})})]})});var Je=(t=>(t.MUNICIPAL="Municipal",t.ESTADUAL="Estadual",t.FEDERAL="Federal",t))(Je||{}),B=(t=>(t.PENDING="Pendente",t.IN_PROGRESS="Em Andamento",t.COMPLETED="Concluído",t))(B||{}),te=(t=>(t.LOW="Baixa",t.MEDIUM="Média",t.HIGH="Alta",t))(te||{}),ot=(t=>(t.SOLICITACAO="Solicitação",t.RECLAMACAO="Reclamação",t.ELOGIO="Elogio",t.DENUNCIA="Denúncia",t.SUGESTAO="Sugestão",t))(ot||{});const as="yioefhebxsohutdypxqd",Bt=`https://${as}.supabase.co`,qt="sb_publishable_ltKmfB3EreWKb757l0c6mw__0FBPSeR",F=Bt&&qt?Va(Bt,qt):null,de=()=>!!F,ze=t=>{const s=t.replace(/\D/g,"");return s.length>11?t.slice(0,15):s.length>10?s.replace(/^(\d\d)(\d{5})(\d{4}).*/,"($1) $2-$3"):s.length>5?s.replace(/^(\d\d)(\d{4})(\d{0,4}).*/,"($1) $2-$3"):s.length>2?s.replace(/^(\d\d)(\d{0,5})/,"($1) $2"):s},Vt=t=>{const s=t.replace(/\D/g,"");return s.length>5?s.replace(/^(\d{5})(\d{1,3})/,"$1-$2"):s},Ve=t=>t.replace(/\D/g,""),ss=t=>{if(!t)return new Date;if(t.length===10&&t.includes("-")){const[s,l,o]=t.split("-").map(Number);return new Date(s,l-1,o)}return new Date(t)},rt=t=>t?ss(t).toLocaleDateString("pt-BR"):"",rs=async t=>{try{if(!t||t.length<5)return null;const s=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}&limit=1`,l=await fetch(s,{headers:{"User-Agent":"GabineteDigitalApp/1.0"}});if(!l.ok)return null;const o=await l.json();return o&&o.length>0?{lat:parseFloat(o[0].lat),lon:parseFloat(o[0].lon)}:null}catch(s){return console.error("Geocoding error:",s),null}},ls=({initialSearchTerm:t,onSuccess:s,onCancel:l,onNotification:o})=>{const[m,r]=a.useState(""),[i,w]=a.useState([]),[k,j]=a.useState(!1),[N,H]=a.useState(!1),[x,f]=a.useState(null),[v,P]=a.useState(!1),$=a.useRef(null),[E,u]=a.useState(""),[A,q]=a.useState(""),[W,L]=a.useState(""),[y,D]=a.useState(""),[O,h]=a.useState(""),[M,K]=a.useState(!1),[_,g]=a.useState(""),[U,Q]=a.useState(""),[I,S]=a.useState(""),[V,ae]=a.useState(""),[re,J]=a.useState(""),[ie,ge]=a.useState(""),[b,C]=a.useState(""),[G,se]=a.useState(Je.MUNICIPAL),[je,ce]=a.useState(B.PENDING),[Ue,tt]=a.useState(te.MEDIUM),[be,Ye]=a.useState(ot.SOLICITACAO),[Ge,Se]=a.useState(""),[ke,De]=a.useState([]),[Ee,Ae]=a.useState(""),[He,Ke]=a.useState(!1),[c,z]=a.useState(!1);a.useEffect(()=>{const n=new Date;n.setDate(n.getDate()+7),Se(n.toISOString().split("T")[0]),t&&(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)?le(t):(r(t),he(t)))},[]),a.useEffect(()=>{const n=T=>{$.current&&!$.current.contains(T.target)&&j(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const R=n=>({id:n.id||"temp-id",cpf:n.cpf,name:`${n.nome} ${n.sobrenome}`,email:n.email||"",phone:n.telefone||"",logradouro:n.logradouro,numero:n.numero,complemento:n.complemento||void 0,bairro:n.bairro,cep:n.cep,cidade:n.cidade,estado:n.estado,lat:n.lat,lon:n.lon}),ne=n=>{n.cep&&h(Vt(n.cep)),n.logradouro&&g(n.logradouro),n.numero&&Q(n.numero),n.bairro&&S(n.bairro),n.cidade&&ae(n.cidade),n.estado&&J(n.estado)},le=async n=>{if(de()&&F){const{data:T}=await F.from("citizens").select("*").eq("id",n).maybeSingle();if(T){const xe=R(T);f(xe),r(xe.name),ne(xe),P(!1)}}},he=async n=>{if(!(!n||n.length<2)){H(!0),j(!0),w([]);try{if(de()&&F){const T=Ve(n);let xe=F.from("citizens").select("*").limit(10);T.length>3?xe=xe.or(`telefone.ilike.%${T}%,nome.ilike.%${n}%,sobrenome.ilike.%${n}%`):xe=xe.or(`nome.ilike.%${n}%,sobrenome.ilike.%${n}%`);const{data:fe}=await xe;fe&&w(fe.map(Be=>R(Be)))}}catch(T){console.error(T)}finally{H(!1)}}},me=n=>{f(n),r(n.name),j(!1),P(!1),ne(n)},Te=()=>{f(null),P(!0),j(!1);const n=Ve(m);if(n.length>=8)L(n);else{const T=m.split(" ");T.length>0&&u(T[0]),T.length>1&&q(T.slice(1).join(" "))}},Ne=async()=>{const n=O.replace(/\D/g,"");if(n.length===8){K(!0);try{const xe=await(await fetch(`https://viacep.com.br/ws/${n}/json/`)).json();xe.erro||(g(xe.logradouro),S(xe.bairro),ae(xe.localidade),J(xe.uf))}catch(T){console.error(T)}finally{K(!1)}}},at=async n=>{if(n.preventDefault(),!ie||!b){o&&o("error","Preencha título e descrição.");return}if(v&&!x){if(!E){o&&o("error","Nome é obrigatório.");return}if(!W){o&&o("error","Telefone é obrigatório.");return}}z(!0);try{let T=x==null?void 0:x.id;const xe=`${_}, ${U} - ${I}, ${V} - ${re}`;let fe={lat:0,lon:0};if(x&&x.lat&&x.lon)fe={lat:x.lat,lon:x.lon};else{const pe=await rs(xe);pe&&(fe=pe)}if(v&&!T){const pe=Ve(W),qe=O?Ve(O):null;if(!navigator.onLine)T=crypto.randomUUID();else if(de()&&F){const{data:ct}=await F.from("citizens").select("id").eq("telefone",pe).maybeSingle();if(ct)T=ct.id;else{const{data:jt,error:d}=await F.from("citizens").insert({nome:E,sobrenome:A||".",telefone:pe,email:y||null,cep:qe,logradouro:_||null,numero:U||null,bairro:I||null,cidade:V||null,estado:re||null,lat:fe.lat||null,lon:fe.lon||null}).select().single();if(d)throw d;T=jt.id}}}const Be=crypto.randomUUID(),st={id:Be,title:ie,description:b,level:G,status:je,priority:Ue,type:be,deadline:Ge||null,citizen_id:T,tags:ke,created_at:new Date().toISOString(),lat:fe.lat||null,lon:fe.lon||null};if(navigator.onLine){if(de()&&F){const{error:pe}=await F.from("demands").insert(st);if(pe)throw pe;o&&o("success","Demanda criada com sucesso!")}}else{const pe=localStorage.getItem("offline_demands_queue"),qe=pe?JSON.parse(pe):[];qe.push(st),localStorage.setItem("offline_demands_queue",JSON.stringify(qe)),o&&o("success","Salvo Offline! Será sincronizado quando online.")}setTimeout(()=>s(Be),1e3)}catch(T){o&&o("error",`Erro: ${T.message}`),z(!1)}},ue=()=>{Ee.trim()&&!ke.includes(Ee.trim())&&(De([...ke,Ee.trim()]),Ae(""),Ke(!1))};return e.jsxs("div",{className:"h-full flex flex-col relative animate-in fade-in slide-in-from-right duration-500 pb-20",children:[e.jsx("div",{className:"shrink-0 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:l,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:e.jsx(Pt,{className:"w-6 h-6"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-2",children:"Nova Demanda"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar pb-6 -mr-2 pr-2",children:e.jsx("div",{className:"max-w-none mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 items-start",children:[e.jsxs("div",{className:"lg:col-span-7 space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-visible z-20",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[e.jsx(dt,{className:"w-4 h-4"})," Solicitante"]})}),e.jsxs("div",{className:"relative",ref:$,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m,onChange:n=>r(n.target.value),onKeyDown:n=>n.key==="Enter"&&he(m),placeholder:"Buscar por Nome ou Telefone (Enter)",className:`w-full pl-10 pr-10 py-3 glass-input border rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium transition-all ${v?"border-blue-300 dark:border-blue-500/50":"border-slate-300 dark:border-white/10"}`,autoComplete:"off"}),e.jsx(lt,{className:"w-5 h-5 text-slate-400 absolute left-3 top-3.5"}),N&&e.jsx(we,{className:"absolute right-3 top-3.5 w-5 h-5 text-brand-500 animate-spin"})]}),k&&!x&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden max-h-60 overflow-y-auto z-50",children:i.length>0?i.map(n=>e.jsxs("button",{onClick:()=>me(n),className:"w-full text-left p-3 hover:bg-slate-50 dark:hover:bg-white/5 border-b border-slate-100 dark:border-white/5 flex flex-col",children:[e.jsx("span",{className:"font-bold text-slate-800 dark:text-white text-sm",children:n.name}),e.jsxs("div",{className:"flex gap-2 text-xs text-slate-500",children:[n.phone&&e.jsx("span",{children:ze(n.phone)}),n.bairro&&e.jsxs("span",{children:["• ",n.bairro]})]})]},n.id)):!N&&m.length>2&&e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Nenhum resultado."}),e.jsx("button",{onClick:Te,className:"text-sm font-bold text-brand-600 hover:underline",children:"Cadastrar Novo"})]})})]}),x&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-slate-50 dark:bg-white/5 p-4 rounded-2xl border border-slate-100 dark:border-white/5 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white dark:bg-slate-800 rounded-full border border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 font-bold text-brand-600",children:x.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-slate-900 dark:text-white",children:x.name}),e.jsx("p",{className:"text-xs text-slate-500",children:ze(x.phone)})]})]}),e.jsx("button",{onClick:()=>{f(null),r("")},className:"text-xs text-red-500 hover:underline",children:"Trocar"})]}),v&&!x&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl border border-blue-100 dark:border-blue-500/20 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300 text-xs font-bold uppercase",children:[e.jsx(ft,{className:"w-4 h-4"})," Novo Cadastro"]}),e.jsx("button",{onClick:()=>P(!1),className:"text-xs text-slate-400 hover:text-slate-600",children:"Cancelar"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Nome",value:E,onChange:n=>u(n.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"text",placeholder:"Sobrenome",value:A,onChange:n=>q(n.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"}),e.jsx("input",{type:"tel",placeholder:"Telefone (Só números)",value:W,onChange:n=>L(Ve(n.target.value)),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"email",placeholder:"Email (Opcional)",value:y,onChange:n=>D(n.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx(ve,{className:"w-4 h-4"})," Endereço da Ocorrência"]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"CEP"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:O,onChange:n=>h(Vt(n.target.value)),onBlur:Ne,className:"w-full pl-9 pr-8 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm",placeholder:"00000-000"}),e.jsx(lt,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400"}),M&&e.jsx(we,{className:"absolute right-3 top-3 w-4 h-4 text-brand-500 animate-spin"})]})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Cidade"}),e.jsx("input",{type:"text",value:V,onChange:n=>ae(n.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-9",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Logradouro"}),e.jsx("input",{type:"text",value:_,onChange:n=>g(n.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-3",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Número"}),e.jsx("input",{type:"text",value:U,onChange:n=>Q(n.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Bairro"}),e.jsx("input",{type:"text",value:I,onChange:n=>S(n.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"UF"}),e.jsx("input",{type:"text",value:re,onChange:n=>J(n.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm uppercase",maxLength:2})]})]})]})]}),e.jsx("div",{className:"lg:col-span-5 space-y-6",children:e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx(Lt,{className:"w-4 h-4"})," Detalhes da Solicitação"]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:be,onChange:n=>Ye(n.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(ot).map(n=>e.jsx("option",{value:n,children:n},n))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título"}),e.jsx("input",{type:"text",value:ie,onChange:n=>ge(n.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base font-bold text-slate-900 dark:text-white",placeholder:"Ex: Buraco na via"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição"}),e.jsx("textarea",{value:b,onChange:n=>C(n.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none",placeholder:"Descreva a situação em detalhes..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Etiquetas (Tags)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:ke.map(n=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1",children:[n,e.jsx(Ie,{onClick:()=>De(ke.filter(T=>T!==n)),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500"})]},n))}),He?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text",value:Ee,onChange:n=>Ae(n.target.value),className:"flex-1 px-3 py-2 rounded-xl border border-slate-300 dark:border-white/10 glass-input text-sm",placeholder:"Nova tag...",onKeyDown:n=>{n.key==="Enter"&&ue()}}),e.jsx("button",{type:"button",onClick:ue,className:"px-3 py-2 bg-brand-600 text-white rounded-xl text-xs font-bold",children:"Add"})]}):e.jsxs("button",{type:"button",onClick:()=>Ke(!0),className:"text-xs text-brand-600 font-bold flex items-center gap-1 hover:underline",children:[e.jsx(_t,{className:"w-3 h-3"})," Adicionar Tag"]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Inicial"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:je,onChange:n=>ce(n.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(B).map(n=>e.jsx("option",{value:n,children:n},n))})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:G,onChange:n=>se(n.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(Je).map(n=>e.jsx("option",{value:n,children:n},n))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:Ge,onChange:n=>Se(n.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"}),e.jsx(ye,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.values(te).map(n=>e.jsxs("label",{className:`flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition-all ${Ue===n?n==="Alta"?"text-red-600 bg-red-100":n==="Média"?"text-amber-600 bg-amber-100":"text-green-600 bg-green-100":"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[e.jsx("input",{type:"radio",name:"priority",value:n,checked:Ue===n,onChange:()=>tt(n),className:"hidden"}),e.jsx("span",{className:"font-bold text-sm uppercase",children:n})]},n))})]})]})]})]})})]})})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-[60] flex gap-3 md:hidden",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:at,disabled:c,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[c?e.jsx(we,{className:"w-5 h-5 animate-spin"}):navigator.onLine?e.jsx(bt,{className:"w-5 h-5"}):e.jsx(pa,{className:"w-5 h-5"}),c?"Salvando...":navigator.onLine?"Criar":"Salvar Offline"]})]}),e.jsxs("div",{className:"hidden md:flex fixed bottom-6 right-6 z-50 gap-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-3 rounded-xl font-bold text-slate-500 bg-white shadow-lg border border-slate-200 hover:bg-slate-50 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:at,disabled:c,className:"px-8 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-xl flex items-center gap-2 disabled:opacity-70 transition-all",children:[c?e.jsx(we,{className:"w-5 h-5 animate-spin"}):e.jsx(bt,{className:"w-5 h-5"}),c?"Salvando...":"Criar Demanda"]})]})]})},ns=({demand:t,onSuccess:s,onCancel:l,onNotification:o})=>{const[m,r]=a.useState(t.title),[i,w]=a.useState(t.description),[k,j]=a.useState(t.level),[N,H]=a.useState(t.status),[x,f]=a.useState(t.priority),[v,P]=a.useState(t.type||ot.SOLICITACAO),[$,E]=a.useState(t.deadline?t.deadline.split("T")[0]:""),[u,A]=a.useState(null),[q,W]=a.useState(!1),[L,y]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!(!t.citizenId||!de()||!F)){W(!0);try{const{data:M,error:K}=await F.from("citizens").select("*").eq("id",t.citizenId).maybeSingle();if(M)A(M);else{const{data:_}=await F.from("citizens").select("*").eq("cpf",t.citizenId).maybeSingle();_&&A(_)}}catch(M){console.error("Error fetching citizen details:",M.message||M)}finally{W(!1)}}})()},[t.citizenId]);const D=async h=>{h.preventDefault(),y(!0);try{if(!de()||!F)throw new Error("Supabase não configurado.");const{error:M}=await F.from("demands").update({title:m,description:i,level:k,status:N,priority:x,type:v,deadline:$||null}).eq("id",t.id);if(M)throw M;o&&o("success","Alterações salvas com sucesso!"),setTimeout(()=>s(t.id),1e3)}catch(M){o&&o("error",M.message||"Erro ao atualizar demanda."),y(!1)}},O=h=>{switch(h){case te.HIGH:return"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-500/10 border-red-200 dark:border-red-500/20";case te.MEDIUM:return"text-amber-600 dark:text-amber-400 bg-amber-100 dark:bg-amber-500/10 border-amber-200 dark:border-amber-500/20";case te.LOW:return"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-500/10 border-green-200 dark:border-green-500/20"}};return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 md:pb-0 animate-in fade-in slide-in-from-right duration-500 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-slate-50/95 dark:bg-[#020617]/95 backdrop-blur-sm z-20 py-2 md:static md:bg-transparent md:py-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:l,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:[" ",e.jsx(Pt,{className:"w-6 h-6"})," "]}),e.jsxs("div",{children:[" ",e.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white tracking-tight flex flex-col md:flex-row md:items-center gap-1 md:gap-2",children:[" Edição de Demanda ",e.jsxs("span",{className:"text-xs md:text-sm font-normal text-slate-400 dark:text-white/40 border border-slate-200 dark:border-white/10 px-2 py-0.5 rounded-md font-mono w-fit",children:["#",t.id.slice(0,8)]})," "]})," "]})]}),e.jsxs("div",{className:"hidden md:flex gap-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 dark:text-white/60 hover:bg-slate-100 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white transition-colors border border-transparent",children:" Cancelar "}),e.jsxs("button",{onClick:D,disabled:L,className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-[0_0_20px_rgba(14,165,233,0.3)] transition-all flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[" ",L?e.jsx(we,{className:"w-5 h-5 animate-spin"}):e.jsx(bt,{className:"w-5 h-5"})," ",L?"Salvando...":"Salvar Alterações"," "]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-500 via-blue-500 to-brand-500"}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[" ",e.jsx(dt,{className:"w-4 h-4"})," Solicitante Vinculado "]}),q?e.jsxs("div",{className:"flex items-center gap-4 animate-pulse",children:[" ",e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-200 dark:bg-white/10 rounded-full"})," ",e.jsxs("div",{className:"space-y-2 flex-1",children:[" ",e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-white/10 rounded w-1/3"})," ",e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-white/10 rounded w-1/4"})," "]})," "]}):u?e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 md:gap-6",children:[" ",e.jsxs("div",{className:"flex items-center gap-4 md:gap-5",children:[" ",e.jsxs("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-100 dark:bg-slate-900 rounded-full border-2 border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 shadow-inner",children:[" ",e.jsx("span",{className:"text-xl md:text-2xl font-bold text-brand-600 dark:text-brand-400",children:u.nome.charAt(0)})," "]})," ",e.jsxs("div",{children:[" ",e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-slate-900 dark:text-white",children:[u.nome," ",u.sobrenome]})," ",u.telefone&&e.jsxs("p",{className:"text-slate-500 dark:text-white/50 font-mono text-xs md:text-sm mt-1 flex items-center gap-2",children:[" ",e.jsx(Wt,{className:"w-3 h-3"})," ",ze(u.telefone)," "]})," "]})," "]})," ",e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 text-xs md:text-sm",children:[" ",e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-white/80 bg-slate-50 dark:bg-white/5 px-3 py-1.5 rounded-lg border border-slate-200 dark:border-white/5",children:[" ",e.jsx(ve,{className:"w-4 h-4 text-brand-500"})," ",u.cidade," - ",u.estado," "]})," "]})," "]}):e.jsx("div",{className:"text-slate-500 dark:text-white/50 italic text-sm",children:"Cidadão não encontrado."})]}),e.jsxs("div",{className:"glass-panel p-4 md:p-8 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx(Lt,{className:"w-4 h-4"})," Detalhes da Solicitação "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:v,onChange:h=>P(h.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(ot).map(h=>e.jsx("option",{value:h,children:h},h))," "]})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título da Ocorrência"})," ",e.jsx("input",{type:"text",value:m,onChange:h=>r(h.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base md:text-lg font-bold text-slate-900 dark:text-white"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição Detalhada"})," ",e.jsx("textarea",{value:i,onChange:h=>w(h.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none"})," "]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/5",children:[" ",e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/40 uppercase mb-2",children:"Localização Registrada"})," ",e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-white",children:[" ",e.jsx(ve,{className:"w-5 h-5 text-red-500 shrink-0"})," ",e.jsxs("span",{className:"font-medium text-sm",children:[" ",u==null?void 0:u.logradouro,", ",u==null?void 0:u.numero," - ",u==null?void 0:u.bairro,", ",u==null?void 0:u.cidade,"/",u==null?void 0:u.estado," "]})," "]})," "]})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 lg:sticky lg:top-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx(mt,{className:"w-4 h-4"})," Controle de Gestão "]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Atual"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:N,onChange:h=>H(h.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(B).map(h=>e.jsx("option",{value:h,children:h},h))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"})," ",e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[" ",Object.values(te).map(h=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${x===h?O(h):"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[" ",e.jsx("input",{type:"radio",name:"priority",value:h,checked:x===h,onChange:()=>f(h),className:"accent-current"})," ",e.jsx("span",{className:"font-bold text-sm uppercase",children:h})," "]},h))," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível de Governo"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:k,onChange:h=>j(h.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(Je).map(h=>e.jsx("option",{value:h,children:h},h))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo Limite"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsx("input",{type:"date",value:$,onChange:h=>E(h.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"})," ",e.jsx(ye,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})," "]})," "]})]})]})})]}),e.jsxs("div",{className:"md:hidden fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-30 flex gap-3 pb-6",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:" Cancelar "}),e.jsxs("button",{onClick:D,disabled:L,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[" ",L?e.jsx(we,{className:"w-5 h-5 animate-spin"}):e.jsx(bt,{className:"w-5 h-5"})," ",L?"Salvando...":"Salvar"," "]})]})]})},os=()=>e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none select-none p-4 lg:p-8 flex gap-6 bg-slate-100 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"hidden lg:flex w-72 h-full flex-col gap-8 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-8 opacity-40 blur-[2px] shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-5 w-32 bg-slate-200 dark:bg-white/10 rounded-lg"})]}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-12 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"},t))}),e.jsx("div",{className:"mt-auto h-14 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6 opacity-30 lg:opacity-50 blur-[3px] lg:blur-[1px]",children:[e.jsxs("div",{className:"h-24 w-full bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 flex items-center justify-between px-10 shadow-sm",children:[e.jsx("div",{className:"h-8 w-64 bg-slate-200 dark:bg-white/10 rounded-xl"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"})]})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"h-40 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-6 flex flex-col justify-between shadow-sm",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-100 dark:bg-white/5"}),e.jsx("div",{className:"h-5 w-24 bg-slate-200 dark:bg-white/10 rounded-lg"})]},t))}),e.jsx("div",{className:"flex-1 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-10 flex items-end justify-between gap-6 shadow-sm",children:[40,70,50,90,60,80,50,75,45,65,85,55,70,40,60].map((t,s)=>e.jsx("div",{className:"w-full bg-slate-200 dark:bg-white/5 rounded-t-xl",style:{height:`${t}%`}},s))})]})]}),ds=({onLogin:t})=>{const[s,l]=a.useState("login"),[o,m]=a.useState(!1),[r,i]=a.useState(!1),[w,k]=a.useState(""),[j,N]=a.useState(""),[H,x]=a.useState(!1),[f,v]=a.useState(""),[P,$]=a.useState(""),[E,u]=a.useState(!1),[A,q]=a.useState(!1),[W,L]=a.useState(null),[y,D]=a.useState(!1),[O,h]=a.useState(null);a.useEffect(()=>{i(!0)},[]);const M=a.useMemo(()=>async S=>{const V=new TextEncoder().encode(S),ae=await crypto.subtle.digest("SHA-256",V);return Array.from(new Uint8Array(ae)).map(J=>J.toString(16).padStart(2,"0")).join("")},[]),K=a.useMemo(()=>{const S=f;return{length:S.length>=8&&S.length<=12,hasUpper:/[A-Z]/.test(S),isAlphanumeric:/[a-zA-Z]/.test(S)&&/[0-9]/.test(S),match:S===P&&S.length>0}},[f,P]),_=Object.values(K).every(Boolean),g=async S=>{S.preventDefault(),D(!0),h(null);try{if(de()&&F){const V=await M(j),{data:ae,error:re}=await F.from("system_users").select("*").eq("email",w).maybeSingle();if(re)throw re;if(!ae||ae.senha_hash!==V){h("Credenciais inválidas."),D(!1);return}if(!ae.ativo){h("Conta desativada."),D(!1);return}if(!ae.last_login){L(ae),l("new_password"),D(!1);return}await Q(ae,!1,!1)}else await new Promise(V=>setTimeout(V,800)),w==="admin@admin"&&j==="admin"?await Q({id:"demo-admin",email:"admin@admin",name:"Administrador Demo",role:"administrador",avatar:"https://ui-avatars.com/api/?name=Admin&background=0284c7&color=fff",firstLogin:!0},!0,!0):(h("Credenciais inválidas."),D(!1))}catch{h("Erro ao processar login."),D(!1)}},U=async S=>{if(S.preventDefault(),!(!_||!W)){if(D(!0),h(null),f==="Senha4321"){h("A nova senha não pode ser igual à senha padrão."),D(!1);return}try{if(de()&&F){const V=await M(f),{error:ae}=await F.from("system_users").update({senha_hash:V,last_login:new Date().toISOString()}).eq("id",W.id);if(ae)throw ae;const re={...W,last_login:new Date().toISOString()};await Q(re,!1,!0)}}catch(V){h("Erro ao salvar nova senha: "+V.message),D(!1)}}},Q=async(S,V=!1,ae=!1)=>{!V&&de()&&F&&s==="login"&&await F.from("system_users").update({last_login:new Date().toISOString()}).eq("id",S.id);const re=V?S:{id:S.id,email:S.email,name:S.nome,role:S.perfil,avatar:`https://ui-avatars.com/api/?name=${S.nome}&background=0284c7&color=fff`,firstLogin:ae};m(!0),setTimeout(()=>{localStorage.setItem("geo_user",JSON.stringify(re)),t(re)},400)},I=({fulfilled:S,label:V})=>e.jsxs("div",{className:`flex items-center gap-2 text-xs transition-colors duration-200 ${S?"text-emerald-600 font-bold":"text-slate-400"}`,children:[e.jsx("div",{className:`w-3.5 h-3.5 rounded-full flex items-center justify-center border ${S?"bg-emerald-500 border-emerald-500 text-white":"border-slate-300 bg-transparent"}`,children:S&&e.jsx(it,{className:"w-2.5 h-2.5"})}),e.jsx("span",{children:V})]});return e.jsxs("div",{className:`fixed inset-0 z-[100] bg-slate-50 dark:bg-[#020617] transition-all duration-700 overflow-hidden ${o?"opacity-0 scale-105 pointer-events-none":"opacity-100"}`,children:[e.jsx(os,{}),e.jsx("div",{className:"absolute inset-0 bg-white/40 dark:bg-black/60 backdrop-blur-[4px] z-10 transition-colors duration-700"}),e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col lg:flex-row w-full h-full",children:[e.jsx("div",{className:"w-full lg:w-1/2 h-full flex items-center justify-center p-6 relative",children:e.jsxs("div",{className:`
                  w-full max-w-[440px]
                  bg-white/80 dark:bg-[#0f172a]/70 backdrop-blur-2xl 
                  border border-white/50 dark:border-white/10 
                  shadow-[0_8px_40px_-12px_rgba(0,0,0,0.1)] dark:shadow-black/50
                  rounded-[2.5rem] p-8 md:p-12
                  transform transition-all duration-700 ease-out flex flex-col
                  ${r?"translate-y-0 opacity-100 scale-100":"translate-y-12 opacity-0 scale-95"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-4 mb-10",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-600 to-brand-700 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-600/20 text-white ring-4 ring-white/50 dark:ring-white/5",children:e.jsx(ga,{className:"w-7 h-7"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-extrabold text-slate-900 dark:text-white tracking-tight leading-none",children:["Gabinete",e.jsx("br",{}),"Digital"]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:s==="login"?"Acesso ao Painel":"Configuração Inicial"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1 font-medium",children:s==="login"?"Gerencie seu mandato com eficiência.":"Defina sua senha de segurança."})]}),O&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-500/20 text-red-600 dark:text-red-300 text-sm font-bold rounded-2xl flex items-center gap-3 animate-in slide-in-from-left-2 shadow-sm",children:[e.jsx(ft,{className:"w-5 h-5 flex-shrink-0"}),O]}),s==="login"?e.jsxs("form",{onSubmit:g,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(Ot,{className:"w-5 h-5"})}),e.jsx("input",{type:"email",value:w,onChange:S=>k(S.target.value),className:"block w-full pl-11 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Email",required:!0,autoComplete:"email"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(fa,{className:"w-5 h-5"})}),e.jsx("input",{type:H?"text":"password",value:j,onChange:S=>N(S.target.value),className:"block w-full pl-11 pr-12 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Senha",required:!0,autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>x(!H),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors cursor-pointer",children:H?e.jsx(Nt,{className:"w-5 h-5"}):e.jsx(yt,{className:"w-5 h-5"})})]})]}),e.jsxs("button",{type:"submit",disabled:y,className:"w-full py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-base transition-all transform active:scale-[0.98] shadow-lg shadow-brand-600/20 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed group relative overflow-hidden",children:[y?e.jsx(we,{className:"w-5 h-5 animate-spin"}):e.jsx(wa,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"}),y?"Conectando...":"Entrar"]})]}):e.jsxs("form",{onSubmit:U,className:"space-y-6 animate-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:E?"text":"password",value:f,onChange:S=>v(S.target.value),className:"block w-full pl-5 pr-12 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Nova Senha",maxLength:12,autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>u(!E),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors cursor-pointer",children:E?e.jsx(Nt,{className:"w-5 h-5"}):e.jsx(yt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:A?"text":"password",value:P,onChange:S=>$(S.target.value),className:"block w-full pl-5 pr-12 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Confirmar Senha",maxLength:12,autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>q(!A),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors cursor-pointer",children:A?e.jsx(Nt,{className:"w-5 h-5"}):e.jsx(yt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-2xl border border-slate-100 dark:border-white/5 grid grid-cols-2 gap-3",children:[e.jsx(I,{fulfilled:K.length,label:"8-12 dígitos"}),e.jsx(I,{fulfilled:K.isAlphanumeric,label:"Letras/Números"}),e.jsx(I,{fulfilled:K.hasUpper,label:"Maiúscula"}),e.jsx(I,{fulfilled:K.match,label:"Senhas Iguais"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{l("login"),v(""),$(""),L(null)},className:"flex-1 py-4 bg-white dark:bg-white/5 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-white/10 rounded-2xl font-bold text-sm border border-slate-200 dark:border-white/10 transition-colors",children:"Voltar"}),e.jsxs("button",{type:"submit",disabled:y||!_,className:"flex-[2] py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 disabled:opacity-50 transition-all",children:[y?e.jsx(we,{className:"w-5 h-5 animate-spin"}):e.jsx(nt,{className:"w-5 h-5"})," Confirmar"]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-200/50 dark:border-white/5 text-center",children:e.jsxs("p",{className:"text-[10px] uppercase font-bold text-slate-400 dark:text-slate-500 tracking-widest",children:["Desenvolvido por ",e.jsx("a",{href:"mailto:leowaltrick@gmail.com?subject=App Gabinete Digital",title:"Entrar em contato",className:"text-brand-600 dark:text-brand-400 hover:opacity-80 transition-opacity",children:"LW Consulting"})]})})]})}),e.jsx("div",{className:"hidden lg:flex w-1/2 h-full items-center justify-center p-12 xl:p-20 relative pointer-events-none",children:e.jsxs("div",{className:`
                  w-full max-w-xl pointer-events-auto
                  transform transition-all duration-1000 delay-200 flex flex-col gap-10
                  ${r?"translate-x-0 opacity-100":"translate-x-20 opacity-0"}
              `,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-extrabold text-slate-900 dark:text-white leading-tight mb-4 drop-shadow-sm",children:["Gestão inteligente",e.jsx("br",{}),"para mandatos modernos."]}),e.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-300 font-medium leading-relaxed",children:"Centralize demandas, acompanhe solicitações e tome decisões estratégicas baseadas em dados."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{title:"Gestão de Demandas",icon:et,desc:"Controle via Lista, Kanban e Calendário."},{title:"Base de Cidadãos",icon:We,desc:"Cadastro completo com histórico e mapa."},{title:"Mapa Interativo",icon:$t,desc:"Visualização geoespacial de ocorrências."},{title:"Agenda e Prazos",icon:ye,desc:"Monitoramento de tarefas e vencimentos."},{title:"Dashboard e KPIs",icon:Mt,desc:"Métricas de desempenho em tempo real."},{title:"Segurança e Acesso",icon:va,desc:"Controle granular de permissões."}].map((S,V)=>e.jsxs("div",{className:"bg-white/60 dark:bg-black/40 backdrop-blur-md border border-white/40 dark:border-white/10 p-4 rounded-2xl shadow-sm hover:bg-white/80 dark:hover:bg-white/10 transition-colors duration-300",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 mb-3",children:e.jsx(S.icon,{className:"w-5 h-5"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white text-sm mb-1",children:S.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-snug",children:S.desc})]},V))})]})})]})]})},Fe=({options:t,value:s,onChange:l,size:o="md"})=>{const m=t.findIndex(r=>r.value===s);return e.jsxs("div",{className:`bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex relative border border-slate-200 dark:border-white/5 shadow-inner min-w-max ${o==="sm"?"h-9":"h-11"}`,children:[e.jsx("div",{className:"absolute top-1 bottom-1 rounded-lg bg-white dark:bg-slate-600 shadow-sm transition-all duration-300 ease-out z-0",style:{width:`calc(${100/t.length}% - 0.35rem)`,left:`calc(${m*(100/t.length)}% + 0.18rem)`}}),t.map(r=>{const i=s===r.value,w=r.icon;return e.jsxs("button",{onClick:()=>l(r.value),className:`
                flex-1 px-3 text-xs font-bold rounded-lg transition-all duration-300 relative z-10 flex items-center justify-center gap-1.5 whitespace-nowrap
                ${i?"text-brand-600 dark:text-white":"text-slate-500 dark:text-white/40 hover:text-slate-700"}
            `,children:[w&&e.jsx(w,{className:o==="sm"?"w-3 h-3":"w-4 h-4"}),r.label]},r.value)})]})},is=({demands:t,citizens:s,onViewDemand:l,onUpdateStatus:o})=>{const[m,r]=a.useState(null),[i,w]=a.useState(B.PENDING),k=[{id:B.PENDING,label:"Pendente",icon:Ce,color:"text-slate-500",bg:"bg-slate-100 dark:bg-slate-900/50",border:"border-slate-300 dark:border-slate-700"},{id:B.IN_PROGRESS,label:"Em Andamento",icon:Ze,color:"text-amber-500",bg:"bg-amber-50 dark:bg-amber-900/10",border:"border-amber-300 dark:border-amber-700"},{id:B.COMPLETED,label:"Concluído",icon:Me,color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/10",border:"border-green-300 dark:border-green-700"}],j=(x,f)=>{r(f),x.dataTransfer.setData("demandId",f),x.dataTransfer.effectAllowed="move"},N=x=>{x.preventDefault(),x.dataTransfer.dropEffect="move"},H=(x,f)=>{x.preventDefault();const v=x.dataTransfer.getData("demandId");v&&o(v,f),r(null)};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500",children:[e.jsx("div",{className:"md:hidden landscape:hidden px-1 pb-3 shrink-0",children:e.jsx(Fe,{value:i,onChange:x=>w(x),options:[{value:B.PENDING,label:"Pendente",icon:Ce},{value:B.IN_PROGRESS,label:"Andamento",icon:Ze},{value:B.COMPLETED,label:"Concluído",icon:Me}]})}),e.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-auto md:overflow-visible custom-scrollbar",children:e.jsx("div",{className:"flex flex-col landscape:flex-row md:flex-row h-full landscape:gap-4 md:gap-6 pb-4",children:k.map(x=>{const f=t.filter(E=>E.status===x.id),v=x.icon,$=i===x.id?"flex":"hidden landscape:flex md:flex";return e.jsxs("div",{className:`${$} flex-1 flex-col min-w-0 md:min-w-[320px] md:max-w-md h-full transition-all duration-300`,onDragOver:N,onDrop:E=>H(E,x.id),children:[e.jsxs("div",{className:`p-3 md:p-4 rounded-t-3xl border-x border-t border-slate-200 dark:border-white/10 ${x.bg} backdrop-blur-sm flex justify-between items-center relative md:sticky top-0 z-10 shrink-0`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:`w-5 h-5 ${x.color}`}),e.jsx("h3",{className:"font-bold text-slate-700 dark:text-white text-sm md:text-base",children:x.label})]}),e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-white dark:bg-white/10 text-xs font-bold text-slate-600 dark:text-white shadow-sm border border-slate-100 dark:border-white/5",children:f.length})]}),e.jsx("div",{className:`flex-1 overflow-y-auto p-2 landscape:p-2 md:p-3 space-y-3 border-x border-b border-slate-200 dark:border-white/10 rounded-b-3xl bg-white/30 dark:bg-white/5 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/10 transition-colors ${m?"bg-slate-50/50 dark:bg-white/10":""}`,children:f.length===0?e.jsx("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 dark:text-white/20 border-2 border-dashed border-slate-300 dark:border-white/10 rounded-xl m-2",children:e.jsx("p",{className:"text-sm",children:"Vazio"})}):f.map(E=>{const u=s.find(A=>A.id===E.citizenId);return e.jsxs("div",{draggable:!0,onDragStart:A=>j(A,E.id),onClick:()=>l(E),className:`
                                                    bg-white dark:bg-[#1e293b] rounded-xl border border-slate-200 dark:border-white/5 shadow-sm 
                                                    hover:shadow-md hover:border-brand-500/50 dark:hover:border-brand-500/50 
                                                    transition-all cursor-pointer group relative overflow-hidden active:cursor-grabbing
                                                    p-4 landscape:p-2.5 
                                                `,children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${E.priority===te.HIGH?"bg-red-500":E.priority===te.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-2 landscape:mb-1",children:[e.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-white/40 font-mono",children:["#",E.id.slice(0,6)]}),e.jsxs("div",{className:"flex gap-1",children:[E.level===Je.FEDERAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500",title:"Federal"}),E.level===Je.ESTADUAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500",title:"Estadual"})]})]}),e.jsx("h4",{className:"font-bold text-slate-800 dark:text-white text-sm leading-snug mb-2 pl-2 group-hover:text-brand-600 dark:group-hover:text-brand-400 transition-colors landscape:mb-1 landscape:line-clamp-2",children:E.title}),e.jsxs("div",{className:"flex items-center gap-2 pl-2 mb-3 landscape:mb-1",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-[10px] font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:(u==null?void 0:u.name.charAt(0))||"?"}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 truncate max-w-[120px] landscape:hidden",children:(u==null?void 0:u.name)||"Não identificado"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100 dark:border-white/5 pl-2 landscape:hidden",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 dark:text-white/40",children:[e.jsx(ye,{className:"w-3 h-3"})," ",new Date(E.createdAt).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"})]}),E.deadline&&e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${new Date(E.deadline)<new Date?"bg-red-100 text-red-600":"bg-slate-100 text-slate-500"} dark:bg-white/10 dark:text-white/60`,children:rt(E.deadline)})]})]},E.id)})})]},x.id)})})})]})},cs=({demands:t,interactions:s=[],notices:l=[],onEditDemand:o})=>{const[m,r]=a.useState(new Date),[i,w]=a.useState(null),[k,j]=a.useState(!0),[N,H]=a.useState(!0),[x,f]=a.useState(!0),v=m.getFullYear(),P=m.getMonth(),$=new Date(v,P+1,0).getDate(),E=new Date(v,P,1).getDay(),u=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],A=()=>{r(new Date(v,P-1,1)),w(null)},q=()=>{r(new Date(v,P+1,1)),w(null)},W=()=>{const g=new Date;r(g),w(g.getDate())},L=(g,U)=>{const Q=g.split("T")[0].split("-").map(Number);return Q[2]===U&&Q[1]-1===P&&Q[0]===v},y=g=>{const U=k?t.filter(S=>S.deadline&&L(S.deadline,g)):[],Q=N?s.filter(S=>S.type==="checklist"&&S.deadline&&!S.isCompleted&&L(S.deadline,g)):[],I=x?l.filter(S=>L(S.date,g)):[];return{demands:U,checklists:Q,notices:I}},D=new Date(v,P,1),O=[...k?t.filter(g=>g.deadline&&g.status!==B.COMPLETED).map(g=>({type:"demand",data:g,date:new Date(g.deadline)})):[],...N?s.filter(g=>g.type==="checklist"&&g.deadline&&!g.isCompleted).map(g=>({type:"checklist",data:g,date:new Date(g.deadline)})):[],...x?l.filter(g=>new Date(g.date)).map(g=>({type:"notice",data:g,date:new Date(g.date)})):[]].filter(g=>g.date>=D).sort((g,U)=>g.date.getTime()-U.date.getTime()).slice(0,15),h=i?y(i):{demands:[],checklists:[],notices:[]},M=g=>{switch(g){case te.HIGH:return"bg-red-100 text-red-700 dark:bg-red-500/20 dark:text-red-300 border-l-2 border-red-500";case te.MEDIUM:return"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300 border-l-2 border-amber-500";case te.LOW:return"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300 border-l-2 border-green-500"}},K=g=>{switch(g){case"alert":return e.jsx(Yt,{className:"w-3 h-3 text-red-500"});case"event":return e.jsx(ye,{className:"w-3 h-3 text-blue-500"});default:return e.jsx(ja,{className:"w-3 h-3 text-slate-500"})}},_=()=>{const g=[];for(let U=0;U<E;U++)g.push(e.jsx("div",{className:"min-h-[80px] bg-slate-50/30 dark:bg-slate-900/20 border-r border-b border-slate-200 dark:border-white/5"},`empty-${U}`));for(let U=1;U<=$;U++){const{demands:Q,checklists:I,notices:S}=y(U),V=Q.length+I.length+S.length,ae=U===new Date().getDate()&&P===new Date().getMonth()&&v===new Date().getFullYear(),re=U===i;g.push(e.jsxs("div",{onClick:()=>w(U),className:`
                min-h-[80px] md:min-h-[120px] h-auto flex flex-col
                border-r border-b border-slate-200 dark:border-white/5 p-1 md:p-2 relative group hover:bg-slate-50 dark:hover:bg-white/5 transition-colors cursor-pointer
                ${re?"bg-brand-50 dark:bg-brand-900/10 shadow-[inset_0_0_0_2px_rgba(14,165,233,0.5)]":ae?"bg-brand-500/5":"bg-transparent"}
            `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`text-xs md:text-sm font-bold w-6 h-6 md:w-7 md:h-7 flex items-center justify-center rounded-full transition-all
                ${ae?"bg-brand-500 text-white shadow-lg shadow-brand-500/30":re?"bg-slate-900 dark:bg-white text-white dark:text-slate-900":"text-slate-500 dark:text-white/50"}
            `,children:U}),V>0&&e.jsx("span",{className:"text-[9px] bg-slate-200 dark:bg-white/10 text-slate-600 dark:text-white/70 px-1.5 py-0.5 rounded-full font-bold",children:V})]}),e.jsxs("div",{className:"space-y-1 overflow-y-hidden flex-1",children:[e.jsxs("div",{className:"hidden md:block space-y-1",children:[S.map(J=>e.jsxs("div",{className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 ${J.type==="alert"?"border-red-400 bg-red-50 dark:bg-red-500/10":"border-blue-400 bg-blue-50 dark:bg-blue-500/10"}`,children:[K(J.type)," ",J.title]},J.id)),Q.slice(0,3-S.length).map(J=>e.jsx("div",{onClick:ie=>{ie.stopPropagation(),o(J)},className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 cursor-pointer hover:brightness-95 active:scale-95 transition-all ${M(J.priority)}`,children:J.title},J.id)),I.slice(0,Math.max(0,3-(Q.length+S.length))).map(J=>e.jsxs("div",{className:"w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 border-l-slate-400 bg-slate-100 dark:bg-white/5 text-slate-600 dark:text-white/60",children:[e.jsx(Jt,{className:"w-2 h-2"})," ",J.text]},J.id)),Q.length+I.length+S.length>3&&e.jsxs("div",{className:"text-[9px] text-slate-400 pl-1",children:["+ ",V-3," mais"]})]}),e.jsxs("div",{className:"md:hidden flex flex-wrap justify-center content-end h-full pb-1 gap-1",children:[S.map((J,ie)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"},`n-${ie}`)),Q.map((J,ie)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-500"},`d-${ie}`)),I.map((J,ie)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"},`c-${ie}`))]})]})]},U))}return g};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 shrink-0",children:[e.jsxs("button",{onClick:()=>j(!k),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${k?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-500/20 dark:border-brand-500/30 dark:text-brand-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${k?"bg-brand-500":"bg-slate-300"}`})," Demandas"]}),e.jsxs("button",{onClick:()=>H(!N),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${N?"bg-slate-100 border-slate-300 text-slate-700 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${N?"bg-slate-500":"bg-slate-300"}`})," Checklists"]}),e.jsxs("button",{onClick:()=>f(!x),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${x?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-500/20 dark:border-blue-500/30 dark:text-blue-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${x?"bg-blue-500":"bg-slate-300"}`})," Avisos"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-6 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 glass-panel rounded-3xl shadow-sm border border-slate-200 dark:border-white/10 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 md:p-6 border-b border-slate-200 dark:border-white/10 flex items-center justify-between bg-white/50 dark:bg-white/5 backdrop-blur-sm shrink-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white capitalize flex items-center gap-2",children:[e.jsx(ye,{className:"w-6 h-6 text-brand-600 dark:text-brand-400"}),u[P]," ",e.jsx("span",{className:"text-slate-400 dark:text-white/40 font-normal",children:v})]}),e.jsxs("div",{className:"flex bg-white dark:bg-white/10 rounded-xl border border-slate-200 dark:border-white/10 shadow-sm",children:[e.jsx("button",{onClick:A,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-l-xl border-r border-slate-200 dark:border-white/10",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsx("button",{onClick:W,className:"px-4 text-xs font-bold text-slate-600 dark:text-white/70 hover:bg-slate-50 dark:hover:bg-white/10",children:"Hoje"}),e.jsx("button",{onClick:q,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-r-xl border-l border-slate-200 dark:border-white/10",children:e.jsx(Xe,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"grid grid-cols-7 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(g=>e.jsx("div",{className:"py-2 text-center text-[10px] md:text-xs font-bold text-slate-500 dark:text-white/30 uppercase tracking-wider",children:g},g))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"grid grid-cols-7 bg-transparent min-h-full",children:_()})})]}),e.jsx("div",{className:"w-full lg:w-80 glass-panel rounded-3xl border border-slate-200 dark:border-white/10 flex flex-col shrink-0 overflow-hidden h-[300px] lg:h-auto",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:[i," de ",u[P]]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-white/50",children:[h.demands.length+h.checklists.length+h.notices.length," eventos"]})]}),e.jsx("button",{onClick:()=>w(null),className:"text-xs text-brand-600 hover:underline",children:"Ver Geral"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar",children:[[...h.notices,...h.demands,...h.checklists].map((g,U)=>e.jsxs("div",{onClick:()=>g.type==="demand"&&o(g),className:`p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10 ${g.type==="demand"?"cursor-pointer hover:border-brand-200 hover:shadow-sm transition-all":""}`,children:[e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white line-clamp-2",children:g.title||g.text}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 capitalize",children:g.type==="checklist"?"Tarefa":g.type||"Demanda"})]},U)),h.demands.length===0&&h.notices.length===0&&h.checklists.length===0&&e.jsx("p",{className:"text-center text-xs text-slate-400 mt-4",children:"Nada para este dia."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-brand-600 dark:text-brand-400"}),"Próximos Prazos"]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-white/50",children:["A partir de ",u[P]]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:O.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-slate-400 dark:text-white/30 text-center",children:[e.jsx(Ce,{className:"w-10 h-10 mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Nenhum evento futuro."})]}):O.map((g,U)=>{const Q=g.date.getDate()===new Date().getDate()&&g.date.getMonth()===new Date().getMonth(),I=g.type==="notice"?"bg-blue-50 text-blue-600 border-blue-100 dark:bg-blue-500/10 dark:text-blue-400":g.type==="demand"?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400":"bg-slate-50 text-slate-600 border-slate-100 dark:bg-white/5 dark:text-slate-400";return e.jsxs("div",{onClick:()=>g.type==="demand"&&o(g.data),className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:`w-10 h-10 rounded-lg flex flex-col items-center justify-center font-bold shrink-0 border ${I}`,children:[e.jsx("span",{className:"text-xs",children:g.date.getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:g.date.toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:g.type==="notice"||g.type==="demand"?g.data.title:g.data.text}),g.type==="demand"&&e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${Q?"bg-red-100 text-red-600":"bg-slate-100 text-slate-600"} dark:bg-white/10`,children:Q?"HOJE":g.data.status})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:g.type==="notice"?"Aviso Mural":g.type==="demand"?g.data.description:"Tarefa Checklist"})]})]},`${g.type}-${g.data.id}-${U}`)})})]})})]})]})},xs=({currentPage:t,totalPages:s,onPageChange:l,totalItems:o,itemsPerPage:m})=>{if(s<=1)return null;const r=(t-1)*m+1,i=Math.min(t*m,o);return e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 py-4 px-2 border-t border-slate-200 dark:border-white/10 mt-auto",children:[e.jsxs("div",{className:"text-xs text-slate-500 dark:text-white/50 font-medium order-2 sm:order-1",children:["Mostrando ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:r})," a ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:i})," de ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:o})," registros"]}),e.jsxs("div",{className:"flex items-center gap-2 order-1 sm:order-2",children:[e.jsx("button",{onClick:()=>l(t-1),disabled:t===1,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Página anterior",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-1 px-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700 dark:text-white",children:t}),e.jsx("span",{className:"text-sm text-slate-400 dark:text-white/40",children:"/"}),e.jsx("span",{className:"text-sm text-slate-500 dark:text-white/50 font-medium",children:s})]}),e.jsx("button",{onClick:()=>l(t+1),disabled:t===s,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Próxima página",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})},hs=Le.memo(({demand:t,onUpdateStatus:s})=>{const l=r=>{s(t.id,r.target.value)},o=r=>r.stopPropagation(),m=r=>{switch(r){case B.COMPLETED:return"bg-green-50 text-green-700 border-green-200 dark:bg-green-500/10 dark:text-green-400 dark:border-green-500/20";case B.IN_PROGRESS:return"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";default:return"bg-slate-100 text-slate-600 border-slate-200 dark:bg-white/5 dark:text-slate-400 dark:border-white/10"}};return e.jsxs("div",{className:"relative inline-block group/status",onClick:o,children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg border transition-colors shadow-sm ${m(t.status)}`,children:[t.status===B.COMPLETED&&e.jsx(Me,{className:"w-3.5 h-3.5"}),t.status===B.IN_PROGRESS&&e.jsx(Ze,{className:"w-3.5 h-3.5"}),t.status===B.PENDING&&e.jsx(Ce,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:t.status}),e.jsx("div",{className:"ml-1 pl-1 border-l border-current/20 opacity-50",children:e.jsx(ut,{className:"w-3 h-3"})})]}),e.jsx("select",{value:t.status,onChange:l,onClick:o,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer font-bold text-sm appearance-none",children:Object.values(B).map(r=>e.jsx("option",{value:r,children:r},r))})]})}),ms=({demands:t,citizens:s,onUpdateStatus:l,onEdit:o,onViewDemand:m,initialSelectionId:r,clearSelection:i,onInteractionUpdate:w,onNotification:k,onViewCitizen:j})=>{const[N,H]=a.useState("createdAt"),[x,f]=a.useState("desc"),[v,P]=a.useState(1),$=10,E=y=>{N===y?f(D=>D==="asc"?"desc":"asc"):(H(y),f("desc"))},u=y=>N!==y?e.jsx(ka,{className:"w-3 h-3 text-slate-300"}):x==="asc"?e.jsx(Na,{className:"w-3 h-3 text-brand-600"}):e.jsx(ya,{className:"w-3 h-3 text-brand-600"}),A=a.useMemo(()=>[...t].sort((y,D)=>{let O=0;switch(N){case"createdAt":O=new Date(y.createdAt).getTime()-new Date(D.createdAt).getTime();break;case"deadline":const h=y.deadline?new Date(y.deadline).getTime():0,M=D.deadline?new Date(D.deadline).getTime():0;O=h-M;break;case"priority":const K={[te.LOW]:1,[te.MEDIUM]:2,[te.HIGH]:3};O=K[y.priority]-K[D.priority];break;case"status":const _={[B.PENDING]:1,[B.IN_PROGRESS]:2,[B.COMPLETED]:3};O=_[y.status]-_[D.status];break;default:O=0}return x==="asc"?O:-O}),[t,N,x]);a.useEffect(()=>{P(1)},[t]);const q=Math.ceil(A.length/$),W=A.slice((v-1)*$,v*$),L=y=>{switch(y){case te.HIGH:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-red-100 text-red-600 dark:bg-red-500/10 dark:text-red-300 border border-red-200 dark:border-red-500/20",children:"Alta"});case te.MEDIUM:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-amber-100 text-amber-600 dark:bg-amber-500/10 dark:text-amber-300 border border-amber-200 dark:border-amber-500/20",children:"Média"});case te.LOW:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-green-100 text-green-600 dark:bg-green-500/10 dark:text-green-300 border border-green-200 dark:border-green-500/20",children:"Baixa"})}};return e.jsx("div",{className:"flex flex-col w-full gap-2 relative",children:e.jsx("div",{className:"glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-slate-900/50 shadow-sm relative w-full flex flex-col min-h-0",children:A.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 dark:text-white/30 text-sm py-20",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-4",children:e.jsx(lt,{className:"w-6 h-6 opacity-30"})}),e.jsx("p",{children:"Nenhuma demanda encontrada."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full relative",children:[e.jsxs("table",{className:"w-full text-left border-collapse hidden md:table",children:[e.jsx("thead",{className:"bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-sm border-b border-slate-200 dark:border-white/10",children:e.jsxs("tr",{className:"text-xs font-bold text-slate-500 dark:text-blue-200/50 uppercase tracking-wider",children:[e.jsx("th",{className:"p-4 first:pl-6 w-[35%] min-w-[200px]",children:"Título"}),e.jsx("th",{className:"p-4 w-[20%] min-w-[150px]",children:"Solicitante"}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>E("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",u("status")]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>E("priority"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prioridade ",u("priority")]})}),e.jsx("th",{className:"p-4 hidden lg:table-cell cursor-pointer",onClick:()=>E("createdAt"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Criação ",u("createdAt")]})}),e.jsx("th",{className:"p-4 hidden xl:table-cell cursor-pointer",onClick:()=>E("deadline"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prazo ",u("deadline")]})}),e.jsx("th",{className:"p-4 text-right last:pr-6 w-[80px]",children:"Ação"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-white/5 text-sm",children:W.map(y=>{const D=s.find(O=>O.id===y.citizenId);return e.jsxs("tr",{onClick:()=>m(y),className:"hover:bg-white/60 dark:hover:bg-white/5 transition-colors cursor-pointer group",children:[e.jsxs("td",{className:"p-4 first:pl-6",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white truncate max-w-[250px]",title:y.title,children:y.title}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-white/50 truncate mt-0.5 max-w-[250px]",children:y.description})]}),e.jsx("td",{className:"p-4",children:D?e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group/citizen p-1 -ml-1 rounded-lg hover:bg-brand-50 dark:hover:bg-white/10 transition-colors",onClick:O=>{O.stopPropagation(),j&&j(D.id)},children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs border border-slate-200 dark:border-white/10 shrink-0",children:D.name.charAt(0)}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"font-medium text-slate-900 dark:text-white truncate max-w-[150px] group-hover/citizen:text-brand-600 transition-colors",children:D.name})})]}):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"Não vinculado"})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:e.jsx(hs,{demand:y,onUpdateStatus:l})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:L(y.priority)}),e.jsx("td",{className:"p-4 hidden lg:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:new Date(y.createdAt).toLocaleDateString()}),e.jsx("td",{className:"p-4 hidden xl:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:y.deadline?rt(y.deadline):"-"}),e.jsx("td",{className:"p-4 text-right last:pr-6",children:e.jsx("div",{className:"p-2 text-slate-400 group-hover:text-brand-600 transition-colors inline-flex bg-slate-100 dark:bg-white/5 rounded-lg group-hover:bg-brand-50 dark:group-hover:bg-brand-500/10",children:e.jsx(nt,{className:"w-4 h-4"})})})]},y.id)})})]}),e.jsx("div",{className:"md:hidden space-y-3 p-3",children:W.map(y=>{const D=s.find(O=>O.id===y.citizenId);return e.jsxs("div",{onClick:()=>m(y),className:"glass-panel p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm active:scale-[0.98] transition-all cursor-pointer relative overflow-hidden group",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${y.priority===te.HIGH?"bg-red-500":y.priority===te.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-xs font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:D?D.name.charAt(0):"?"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-bold text-slate-900 dark:text-white truncate",children:D?D.name.split(" ")[0]:"S/ Solicitante"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-white/50",children:new Date(y.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase border ${y.status===B.COMPLETED?"bg-green-50 text-green-700 border-green-200":"bg-slate-50 text-slate-600 border-slate-200"}`,children:y.status})]}),e.jsxs("div",{className:"pl-3",children:[e.jsx("h4",{className:"font-bold text-sm text-slate-800 dark:text-white mb-1 leading-snug",children:y.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/60 line-clamp-2 mb-3",children:y.description}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-100 dark:border-white/5 pt-2",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 font-bold uppercase",children:[e.jsx(ve,{className:"w-3 h-3"})," ",y.level]}),e.jsxs("div",{className:"flex items-center gap-1 text-brand-600 text-xs font-bold",children:["Detalhes ",e.jsx(nt,{className:"w-3 h-3"})]})]})]})]},y.id)})})]}),e.jsx("div",{className:"bg-slate-50/50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-white/5 rounded-b-3xl",children:e.jsx(xs,{currentPage:v,totalPages:q,onPageChange:P,totalItems:A.length,itemsPerPage:$})})]})})})};_e.Icon&&_e.Icon.Default&&(delete _e.Icon.Default.prototype._getIconUrl,_e.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}));const St={},bs=(t,s,l)=>t==="citizen"?"blue":s===B.COMPLETED?"green":l===te.HIGH?"red":s===B.IN_PROGRESS?"orange":l===te.MEDIUM?"gold":"blue",us=(t,s,l)=>{const o=bs(t,s,l),m=`${t}-${o}`;if(St[m])return St[m];const r=new _e.Icon({iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${o}.png`,shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:t==="citizen"?"custom-citizen-icon":""});return St[m]=r,r},ps=({markers:t})=>{const s=wt();return a.useEffect(()=>{const l=setTimeout(()=>{s.invalidateSize()},100);return()=>clearTimeout(l)},[s]),null},gs=({markers:t})=>{const s=wt(),[l,o]=a.useState([]),m=a.useCallback(()=>{s&&s.whenReady(()=>{const i=s.getBounds().pad(.1),w=t.filter(k=>i.contains(_e.latLng(k.lat,k.lon)));o(w.slice(0,1e3))})},[s,t]);return a.useEffect(()=>{m();const r=()=>{requestAnimationFrame(m)};return s.on("moveend",r),s.on("zoomend",r),()=>{s.off("moveend",r),s.off("zoomend",r)}},[s,m,t]),e.jsx(e.Fragment,{children:l.map(r=>e.jsx(ta,{center:[r.lat,r.lon],radius:5,pathOptions:{fillColor:"#0ea5e9",fillOpacity:.6,color:"#0284c7",weight:1,opacity:.5},eventHandlers:{click:()=>{const i=new CustomEvent("navigate-to-map",{detail:{citizenId:r.id}});window.dispatchEvent(i)}},children:e.jsx(aa,{children:e.jsxs("div",{className:"p-1 min-w-[150px]",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-900",children:r.name}),e.jsx("p",{className:"text-xs text-slate-500",children:r.bairro||"Sem Bairro"})]})})},`dot-${r.id}`))})},fs=({markers:t,onViewDemand:s})=>{const l=wt(),[o,m]=a.useState([]),r=a.useCallback(()=>{l&&l.whenReady(()=>{const w=l.getBounds().pad(.2),k=t.filter(j=>w.contains(_e.latLng(j.lat,j.lon)));m(k.slice(0,200))})},[l,t]);return a.useEffect(()=>{r();const i=()=>{requestAnimationFrame(r)};return l.on("moveend",i),l.on("zoomend",i),()=>{l.off("moveend",i),l.off("zoomend",i)}},[l,r,t]),e.jsx(e.Fragment,{children:o.map(i=>e.jsx(sa,{position:[i.lat,i.lon],icon:us(i.type,i.status,i.priority),eventHandlers:{click:()=>{window.innerWidth<768&&l.flyTo([i.lat,i.lon],16,{duration:.5})}},children:e.jsx(aa,{children:e.jsx("div",{className:"p-1 min-w-[200px]",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-800 leading-tight",children:i.title}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full ${i.status==="Concluído"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:i.status}),i.priority===te.HIGH&&e.jsx("span",{className:"text-red-600 font-bold",children:"ALTA"})]}),e.jsx("button",{onClick:w=>{w.stopPropagation(),s&&s(i.id)},className:"mt-1 w-full bg-brand-600 text-white text-xs font-bold py-1.5 rounded hover:bg-brand-700 transition-colors",children:"Ver Detalhes"})]})})})},`m-${i.type}-${i.id}`))})},ws=({zoomIn:t,zoomOut:s})=>e.jsxs("div",{className:"flex flex-col gap-2 pointer-events-auto shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-white/10",children:[e.jsx("button",{onClick:t,className:"w-12 h-12 md:w-10 md:h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors border-b border-slate-100 dark:border-white/10 active:bg-slate-100",children:e.jsx(pt,{className:"w-6 h-6 md:w-5 md:h-5"})}),e.jsx("button",{onClick:s,className:"w-12 h-12 md:w-10 md:h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors active:bg-slate-100",children:e.jsx(Ca,{className:"w-6 h-6 md:w-5 md:h-5"})})]}),vs=({focus:t,markers:s})=>{const l=wt();return a.useEffect(()=>{t&&l.flyTo([t.lat,t.lon],18,{duration:1.5})},[t,l]),a.useEffect(()=>{if(s.length===1){const o=s[0];l.flyTo([o.lat,o.lon],18,{duration:1.5})}},[s,l]),null},js=({defaultCenter:t,onViewDemand:s,preloadedMarkers:l,currentViewMode:o,onChangeViewMode:m,mapFocus:r})=>{const i=a.useRef(null),[w,k]=a.useState(!1),j=t?[t.lat,t.lon]:[-23.5505,-46.6333],N=a.useMemo(()=>l?l.filter(f=>f.type===(o==="demands"?"demand":"citizen")):[],[o,l]);a.useEffect(()=>{k(!0);const f=setTimeout(()=>{k(!1)},500);return()=>clearTimeout(f)},[N,o,l]);const H=()=>{var f;return(f=i.current)==null?void 0:f.zoomIn()},x=()=>{var f;return(f=i.current)==null?void 0:f.zoomOut()};return e.jsxs("div",{className:"transition-all duration-300 ease-in-out border-slate-200 dark:border-white/10 shadow-sm bg-slate-100 dark:bg-slate-900 overflow-hidden h-full w-full relative",children:[w&&e.jsx("div",{className:"absolute top-20 md:top-4 left-1/2 -translate-x-1/2 z-[1000] animate-in fade-in zoom-in-95 duration-200 pointer-events-none",children:e.jsxs("div",{className:"bg-white/90 dark:bg-slate-800/90 backdrop-blur-md px-4 py-2 rounded-full shadow-xl border border-brand-100 dark:border-white/10 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 animate-spin text-brand-600"}),e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-white",children:"Atualizando mapa..."})]})}),e.jsx("div",{className:"absolute right-4 bottom-24 md:bottom-8 z-[400] flex flex-col gap-3 pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",children:e.jsx(ws,{zoomIn:H,zoomOut:x})})}),e.jsxs(Xt,{ref:i,center:j,zoom:13,style:{width:"100%",height:"100%"},zoomControl:!1,scrollWheelZoom:!0,dragging:!0,preferCanvas:!0,children:[e.jsx(ps,{markers:N}),e.jsx(ea,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'© <a href="https://carto.com/attributions">CARTO</a>'}),o==="citizens"?e.jsx(gs,{markers:N}):e.jsx(fs,{markers:N,onViewDemand:s}),e.jsx(vs,{focus:r||null,markers:N})]})]})},xt=({options:t,selectedValues:s,onChange:l,placeholder:o,label:m})=>{const[r,i]=a.useState(!1),[w,k]=a.useState(""),j=a.useRef(null);a.useEffect(()=>{const f=v=>{j.current&&!j.current.contains(v.target)&&(i(!1),k(""))};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]);const N=a.useMemo(()=>t.filter(f=>f.label.toLowerCase().includes(w.toLowerCase())),[t,w]),H=f=>{s.includes(f)?l(s.filter(v=>v!==f)):l([...s,f])},x=(f,v)=>{v.stopPropagation(),l(s.filter(P=>P!==f))};return e.jsxs("div",{className:"relative min-w-[200px]",ref:j,children:[m&&e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:m}),e.jsxs("div",{onClick:()=>i(!r),className:`
            w-full min-h-[46px] px-3 py-2 glass-input border border-slate-300 dark:border-white/10 rounded-2xl 
            focus:border-brand-500 outline-none font-bold text-slate-700 dark:text-white cursor-pointer shadow-sm
            flex items-center justify-between transition-all hover:bg-slate-50 dark:hover:bg-white/5
            ${r?"ring-2 ring-brand-500/20 border-brand-500":""}
        `,children:[e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.length===0?e.jsx("span",{className:"text-slate-400 dark:text-white/40 text-sm font-medium py-1",children:o}):s.map(f=>{const v=t.find(P=>P.value===f);return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 text-xs font-bold border border-brand-200 dark:border-brand-500/30",children:[(v==null?void 0:v.label)||f,e.jsx("div",{onClick:P=>x(f,P),className:"hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-full p-0.5 cursor-pointer",children:e.jsx(Ie,{className:"w-3 h-3"})})]},f)})}),e.jsx(ut,{className:`w-4 h-4 text-slate-400 transition-transform duration-300 ${r?"rotate-180":""}`})]}),r&&e.jsxs("div",{className:"absolute top-full left-0 w-full mt-2 glass-panel bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden z-50 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"p-2 border-b border-slate-100 dark:border-white/5",children:e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"w-4 h-4 text-slate-400 absolute left-3 top-2.5"}),e.jsx("input",{type:"text",value:w,onChange:f=>k(f.target.value),placeholder:"Filtrar opções...",className:"w-full pl-9 pr-3 py-2 text-sm bg-slate-50 dark:bg-white/5 rounded-lg border-none outline-none text-slate-900 dark:text-white placeholder:text-slate-400",autoFocus:!0,onClick:f=>f.stopPropagation()})]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/20",children:N.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-slate-400 dark:text-white/40 italic",children:"Nenhuma opção encontrada."}):N.map(f=>{const v=s.includes(f.value);return e.jsxs("div",{onClick:()=>H(f.value),className:`
                                    flex items-center justify-between px-3 py-2.5 rounded-lg cursor-pointer text-sm font-medium transition-colors
                                    ${v?"bg-brand-50 dark:bg-brand-500/10 text-brand-700 dark:text-brand-300":"text-slate-700 dark:text-white hover:bg-slate-50 dark:hover:bg-white/5"}
                                `,children:[e.jsx("span",{children:f.label}),v&&e.jsx(it,{className:"w-4 h-4 text-brand-500"})]},f.value)})}),e.jsxs("div",{className:"p-2 border-t border-slate-100 dark:border-white/5 bg-slate-50/50 dark:bg-white/5 flex justify-between",children:[e.jsx("button",{onClick:()=>l([]),className:"text-xs text-slate-500 hover:text-red-500 px-2 py-1 transition-colors",children:"Limpar"}),e.jsx("button",{onClick:()=>i(!1),className:"text-xs font-bold text-brand-600 dark:text-brand-400 px-2 py-1 hover:bg-brand-50 dark:hover:bg-white/5 rounded transition-colors",children:"Pronto"})]})]})]})},Qe=({label:t,onRemove:s})=>e.jsxs("div",{className:"flex items-center gap-1 pl-3 pr-1 py-1 bg-brand-50 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 border border-brand-100 dark:border-brand-500/30 rounded-lg text-xs font-bold animate-in zoom-in-95 shadow-sm whitespace-nowrap",children:[e.jsx("span",{children:t}),e.jsx("button",{onClick:l=>{l.stopPropagation(),s()},className:"p-0.5 hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-md transition-colors text-brand-600 dark:text-brand-400",children:e.jsx(Ie,{className:"w-3 h-3"})})]}),ht=({label:t,icon:s,isActive:l,onClick:o})=>e.jsxs("button",{onClick:o,className:`
            flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold transition-all shadow-sm whitespace-nowrap border
            ${l?"bg-brand-600 text-white border-brand-600":"bg-white dark:bg-slate-800 text-slate-600 dark:text-white border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}
        `,children:[s&&e.jsx(s,{className:`w-3.5 h-3.5 ${l?"text-white":"text-slate-400"}`}),t]}),ks=({filters:t,setFilters:s,onExport:l,users:o=[],availableTags:m=[],isMapMode:r=!1,mapViewMode:i,onMapViewModeChange:w})=>{var ie,ge;const[k,j]=a.useState(!1),[N,H]=a.useState(!1),[x,f]=a.useState(new Date),v=a.useRef(null),P=a.useRef(null),$=(b,C)=>{s(G=>({...G,[b]:C}))},E=()=>{s({search:t.search,level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",responsibleId:void 0,tags:[]})},u=(b,C)=>{Array.isArray(t[b])&&C?s(G=>({...G,[b]:G[b].filter(se=>se!==C)})):s(b==="startDate"||b==="endDate"?G=>({...G,startDate:"",endDate:""}):G=>({...G,[b]:void 0}))},A=b=>{const C=t.status;C.includes(b)?$("status",C.filter(G=>G!==b)):$("status",[...C,b])},q=b=>{const C=t.priority;C.includes(b)?$("priority",C.filter(G=>G!==b)):$("priority",[...C,b])},W=()=>{if(t.startDate)$("startDate",""),$("endDate","");else{const b=new Date().toLocaleDateString("en-CA");$("startDate",b),$("endDate",b)}},L=b=>b?b.split("_").map(C=>C.charAt(0).toUpperCase()+C.slice(1)).join(" "):"",y=b=>{const C=o.find(G=>G.id===b);return C?C.nome:"Usuário"},D=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],O=(b,C)=>new Date(b,C+1,0).getDate(),h=(b,C)=>new Date(b,C,1).getDay(),M=b=>{const G=new Date(x.getFullYear(),x.getMonth(),b).toLocaleDateString("en-CA");!t.startDate||t.startDate&&t.endDate?s(se=>({...se,startDate:G,endDate:""})):G<t.startDate?s(se=>({...se,startDate:G,endDate:t.startDate})):(s(se=>({...se,endDate:G})),setTimeout(()=>H(!1),300))},K=t.startDate?new Date(t.startDate+"T00:00:00").getTime():null,_=t.endDate?new Date(t.endDate+"T00:00:00").getTime():null,g=b=>{if(!K)return!1;const C=new Date(x.getFullYear(),x.getMonth(),b).getTime();return C===K?"start":_&&C===_?"end":_&&C>K&&C<_?"range":!1};a.useEffect(()=>{const b=C=>{v.current&&!v.current.contains(C.target)&&H(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]);const U=t.level.length+t.status.length+t.priority.length+(((ie=t.tags)==null?void 0:ie.length)||0)+(t.startDate?1:0)+(t.responsibleId?1:0),Q=t.startDate?`${new Date(t.startDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})} ${t.endDate?" - "+new Date(t.endDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}):""}`:"Selecionar Período",I={createdAt:"Criação",updatedAt:"Atualização",deadline:"Prazo"},S=Object.values(Je).map(b=>({value:b,label:b})),V=Object.values(B).map(b=>({value:b,label:b})),ae=Object.values(te).map(b=>({value:b,label:b})),re=m.map(b=>({value:b,label:b})),J=!r||i==="demands";return e.jsxs("div",{className:"flex flex-col relative z-30 space-y-3",children:[e.jsxs("div",{className:`
          flex flex-col md:flex-row gap-3 items-center relative z-20 
          ${r?"bg-transparent":"glass-panel p-2 md:p-3 rounded-2xl shadow-sm border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md"}
      `,children:[e.jsxs("div",{className:`flex-1 w-full relative group ${r?"shadow-lg rounded-2xl":""}`,children:[e.jsx("input",{type:"text",value:t.search,onChange:b=>$("search",b.target.value),placeholder:r?"Buscar locais ou demandas...":"Buscar por título, nome ou celular...",className:`
                    w-full pl-11 pr-4 py-3 outline-none transition-all font-medium text-slate-700 dark:text-white placeholder:text-slate-400
                    ${r?"bg-white/95 dark:bg-[#1e293b]/95 border-0 rounded-2xl shadow-md focus:ring-2 ring-brand-500/50":"bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl focus:border-brand-500 focus:bg-white dark:focus:bg-black/20"}
                `}),e.jsx(lt,{className:"w-5 h-5 text-slate-400 absolute left-3.5 top-3.5 group-focus-within:text-brand-500 transition-colors"}),t.search&&e.jsx("button",{onClick:()=>$("search",""),className:"absolute right-3 top-3.5 text-slate-400 hover:text-slate-600 dark:hover:text-white",children:e.jsx(Ie,{className:"w-5 h-5"})})]}),r&&w&&i&&e.jsx("div",{className:"w-full md:w-auto min-w-[200px] shadow-lg rounded-xl",children:e.jsx(Fe,{value:i,onChange:b=>w(b),options:[{value:"demands",label:"Demandas",icon:et},{value:"citizens",label:"Cidadãos",icon:We}]})}),r?e.jsx("div",{className:"hidden md:flex",children:e.jsx("button",{onClick:()=>j(!k),className:"w-12 h-12 bg-white dark:bg-slate-800 text-slate-600 dark:text-white rounded-2xl shadow-lg flex items-center justify-center hover:bg-slate-50 transition-transform active:scale-95",children:e.jsx(Ft,{className:"w-5 h-5"})})}):e.jsxs("div",{className:"flex w-full md:w-auto gap-2",children:[e.jsxs("button",{onClick:()=>j(!k),className:`flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-3 rounded-xl font-bold transition-all border ${k||U>0?"bg-brand-500 text-white border-brand-500 shadow-lg shadow-brand-500/20":"bg-white dark:bg-white/5 text-slate-600 dark:text-white/70 border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}`,children:[e.jsx(Ft,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Filtros"}),U>0&&e.jsx("span",{className:"bg-white text-brand-600 text-[10px] w-5 h-5 flex items-center justify-center rounded-full ml-1 shadow-sm",children:U})]}),l&&e.jsx("button",{onClick:l,className:"w-[46px] h-[46px] bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 rounded-xl flex items-center justify-center shrink-0 transition-all",title:"Exportar Dados",children:e.jsx(Sa,{className:"w-5 h-5"})})]})]}),r&&i!=="citizens"&&e.jsxs("div",{className:"flex overflow-x-auto gap-2 pb-2 -mx-4 px-4 md:mx-0 md:px-0 scrollbar-none snap-x",children:[e.jsx(ht,{label:"Pendentes",icon:Ce,isActive:t.status.includes(B.PENDING),onClick:()=>A(B.PENDING)}),e.jsx(ht,{label:"Alta Prioridade",icon:ft,isActive:t.priority.includes(te.HIGH),onClick:()=>q(te.HIGH)}),e.jsx(ht,{label:"Em Andamento",icon:Ze,isActive:t.status.includes(B.IN_PROGRESS),onClick:()=>A(B.IN_PROGRESS)}),e.jsx(ht,{label:"Hoje",icon:ye,isActive:!!t.startDate,onClick:W})]}),(!r||r&&window.innerWidth>=768)&&U>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center px-1",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase text-slate-400 dark:text-white/40 mr-1 flex items-center gap-1",children:[e.jsx(Tt,{className:"w-3 h-3"})," Ativos:"]}),J&&t.status.map(b=>e.jsx(Qe,{label:`Status: ${b}`,onRemove:()=>u("status",b)},`status-${b}`)),J&&t.priority.map(b=>e.jsx(Qe,{label:`Prioridade: ${b}`,onRemove:()=>u("priority",b)},`prio-${b}`)),J&&t.level.map(b=>e.jsx(Qe,{label:`Esfera: ${b}`,onRemove:()=>u("level",b)},`lvl-${b}`)),J&&((ge=t.tags)==null?void 0:ge.map(b=>e.jsx(Qe,{label:`Tag: ${b}`,onRemove:()=>u("tags",b)},`tag-${b}`))),J&&t.responsibleId&&e.jsx(Qe,{label:`Resp: ${y(t.responsibleId)}`,onRemove:()=>u("responsibleId")}),t.startDate&&e.jsx(Qe,{label:`${I[t.dateType]}: ${Q}`,onRemove:()=>u("startDate")}),e.jsxs("button",{onClick:E,className:"text-[10px] font-bold text-red-500 hover:text-red-600 ml-auto hover:bg-red-50 dark:hover:bg-red-900/20 px-2 py-1 rounded transition-colors flex items-center gap-1",children:[e.jsx(Da,{className:"w-3 h-3"})," Limpar"]})]}),k&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10 bg-slate-900/30 backdrop-blur-sm transition-opacity",onClick:()=>j(!1)}),e.jsxs("div",{ref:P,className:`
                    absolute z-[60] glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white dark:bg-[#0f172a] shadow-2xl animate-in slide-in-from-top-2 duration-200 overflow-hidden
                    w-full md:w-[800px] md:right-0 md:left-auto
                    ${r?"top-[70px]":"top-[calc(100%+12px)]"}
                `,children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2 text-sm",children:[e.jsx(Tt,{className:"w-4 h-4 text-brand-500"})," Filtros Avançados"]}),e.jsx("button",{onClick:()=>j(!1),className:"p-1.5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Ie,{className:"w-4 h-4 text-slate-500 dark:text-white/60"})})]}),e.jsxs("div",{className:`p-6 grid gap-8 max-h-[70vh] overflow-y-auto custom-scrollbar ${J?"grid-cols-1 md:grid-cols-3":"grid-cols-1"}`,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Período"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Fe,{options:["createdAt","updatedAt","deadline"].map(b=>({value:b,label:I[b]})),value:t.dateType,onChange:b=>$("dateType",b),size:"sm"}),e.jsxs("div",{className:"relative",ref:v,children:[e.jsx("button",{onClick:()=>H(!N),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl text-sm font-bold transition-all border ${t.startDate?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-900/20 dark:border-brand-500/30 dark:text-brand-300":"bg-slate-50 dark:bg-white/5 border-slate-200 dark:border-white/10 text-slate-600 dark:text-white/70 hover:bg-slate-100"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 opacity-70"})," ",Q]})}),N&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-72 bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 p-4 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>f(new Date(x.getFullYear(),x.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-bold text-sm",children:[D[x.getMonth()]," ",x.getFullYear()]}),e.jsx("button",{onClick:()=>f(new Date(x.getFullYear(),x.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Xe,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["D","S","T","Q","Q","S","S"].map(b=>e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:b},b))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:h(x.getFullYear(),x.getMonth())}).map((b,C)=>e.jsx("div",{},`empty-${C}`)),Array.from({length:O(x.getFullYear(),x.getMonth())}).map((b,C)=>{const G=C+1,se=g(G);return e.jsx("button",{onClick:()=>M(G),className:`h-8 w-8 rounded-full text-xs font-medium transition-all ${se==="start"||se==="end"?"bg-brand-500 text-white shadow-lg":se==="range"?"bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 rounded-none":"hover:bg-slate-100 dark:hover:bg-white/10"}`,children:G},G)})]})]})]})]})]}),J&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Classificação"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(xt,{options:V,selectedValues:t.status,onChange:b=>$("status",b),placeholder:"Todos Status",label:"Status"}),e.jsx(xt,{options:ae,selectedValues:t.priority,onChange:b=>$("priority",b),placeholder:"Todas Prioridades",label:"Prioridade"}),e.jsx(xt,{options:S,selectedValues:t.level,onChange:b=>$("level",b),placeholder:"Todas Esferas",label:"Esfera"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Contexto"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:"Responsável"}),e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:"w-4 h-4 text-slate-400 absolute left-3 top-3 pointer-events-none"}),e.jsxs("select",{value:t.responsibleId||"",onChange:b=>$("responsibleId",b.target.value||void 0),className:"w-full pl-9 pr-8 py-2.5 bg-slate-50 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-xl text-sm outline-none focus:border-brand-500 font-bold text-slate-700 dark:text-white appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"Todos os Responsáveis"}),o.map(b=>e.jsxs("option",{value:b.id,children:[b.nome," (",L(b.perfil),")"]},b.id))]}),e.jsx("div",{className:"absolute right-3 top-3 pointer-events-none text-slate-400 text-xs",children:"▼"})]})]}),e.jsx(xt,{options:re,selectedValues:t.tags||[],onChange:b=>$("tags",b),placeholder:"Filtrar por Tags",label:"Etiquetas (Tags)"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5 flex justify-end gap-3",children:[e.jsx("button",{onClick:E,className:"px-4 py-2 text-xs font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-xl transition-colors",children:"Limpar Tudo"}),e.jsx("button",{onClick:()=>j(!1),className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold text-sm shadow-lg shadow-brand-500/20 transition-all active:scale-95",children:"Aplicar Filtros"})]})]})]})]})},Oe=Le.memo(({title:t,value:s,icon:l,colorClass:o,textClass:m,trend:r,subValue:i,isLoading:w=!1})=>e.jsx("div",{className:"glass-panel p-3 md:p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex flex-col justify-between hover:bg-white/60 dark:hover:bg-white/5 transition-colors group min-h-[100px] will-change-transform relative overflow-hidden",children:w?e.jsxs("div",{className:"animate-pulse flex flex-col justify-between h-full w-full",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx("div",{className:"w-8 h-8 rounded-xl bg-slate-200 dark:bg-white/10"})}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-6 w-16 bg-slate-200 dark:bg-white/10 rounded"}),e.jsx("div",{className:"h-3 w-24 bg-slate-200 dark:bg-white/10 rounded"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:`p-2 rounded-xl ${o} bg-opacity-10 shrink-0`,children:e.jsx(l,{className:`w-4 h-4 ${m}`})}),r&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-bold text-emerald-600 bg-emerald-100 dark:bg-emerald-500/20 px-1.5 py-0.5 rounded-full border border-emerald-200 dark:border-emerald-500/10",children:[e.jsx(Ea,{className:"w-3 h-3"})," ",r]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-800 dark:text-white tracking-tight block",children:i||s}),e.jsx("span",{className:`block text-[10px] font-bold uppercase tracking-wider opacity-70 ${m} mt-1`,children:t})]})]})})),oa=({lat:t,lon:s,tableName:l="demands",onClick:o,status:m,priority:r})=>{const i=t!==void 0&&s!==void 0&&t!==null&&s!==null&&t!==0&&s!==0,w=()=>m===B.COMPLETED?"green":r===te.HIGH?"red":m===B.IN_PROGRESS?"orange":r===te.MEDIUM?"gold":"blue",k=new _e.Icon({iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${w()}.png`,shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),j=N=>{N.stopPropagation(),N.preventDefault(),i&&o(t,s)};return i?e.jsxs("div",{className:"relative w-full h-48 rounded-xl overflow-hidden border border-slate-200 dark:border-white/10 group bg-slate-50 dark:bg-white/5",children:[e.jsxs("button",{type:"button",onClick:j,className:"absolute top-3 right-3 z-[1000] flex items-center gap-2 bg-white/90 dark:bg-slate-900/90 backdrop-blur-sm border border-slate-200 dark:border-white/10 px-3 py-1.5 rounded-lg shadow-md hover:scale-105 transition-all cursor-pointer pointer-events-auto",children:[e.jsx("span",{className:"text-[10px] font-bold text-brand-600 dark:text-brand-400 uppercase tracking-wider",children:"Expandir"}),e.jsx(Ia,{className:"w-3.5 h-3.5 text-brand-600 dark:text-brand-400"})]}),e.jsx("div",{className:"h-full w-full z-0 pointer-events-none select-none",children:e.jsxs(Xt,{center:[t,s],zoom:15,scrollWheelZoom:!1,zoomControl:!1,dragging:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1,attributionControl:!1,style:{width:"100%",height:"100%"},children:[e.jsx(ea,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"}),l==="citizens"?e.jsx(ta,{center:[t,s],radius:8,pathOptions:{fillColor:"#3b82f6",fillOpacity:1,color:"#ffffff",weight:2}}):e.jsx(sa,{position:[t,s],icon:k})]},`${t}-${s}-${l}`)})]}):e.jsxs("div",{className:"w-full h-48 rounded-xl bg-slate-100 dark:bg-white/5 flex flex-col items-center justify-center text-slate-400 border border-slate-200 dark:border-white/10",children:[e.jsx(ve,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("span",{className:"text-xs font-bold",children:"Localização não definida"})]})},Ns=({demand:t,citizen:s,onClose:l,onEdit:o,onUpdateStatus:m,onInteractionUpdate:r,onNavigate:i,canNavigatePrev:w,canNavigateNext:k,onNotification:j,onViewCitizen:N,onMapFocus:H})=>{const[x,f]=a.useState([]),[v,P]=a.useState(!1),[$,E]=a.useState([]),[u,A]=a.useState(""),[q,W]=a.useState(""),[L,y]=a.useState(""),[D,O]=a.useState(!1),[h,M]=a.useState(t.tags||[]),[K,_]=a.useState(""),[g,U]=a.useState(!1),Q=a.useRef(null),[I,S]=a.useState(!1),[V,ae]=a.useState(new Date),re=a.useRef(null),J=a.useMemo(()=>{const c=localStorage.getItem("geo_user");return c?JSON.parse(c):{name:"Usuário"}},[]);a.useEffect(()=>{ie(),E([]),M(t.tags||[])},[t.id,t.status]),a.useEffect(()=>{const c=z=>{re.current&&!re.current.contains(z.target)&&S(!1),g&&Q.current&&!Q.current.contains(z.target)&&z.target.tagName!=="BUTTON"&&U(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[g]);const ie=async()=>{P(!0);try{if(de()&&F){const{data:c,error:z}=await F.from("demand_interactions").select("*").eq("demanda_id",t.id).order("created_at",{ascending:!1});if(z)throw z;c&&f(c.map(R=>({id:R.id,demandId:R.demanda_id,type:R.tipo,text:R.texto,isCompleted:R.concluido,deadline:R.prazo,user:R.usuario,createdAt:R.created_at})))}}catch(c){console.error("Erro ao carregar interações",c)}finally{P(!1)}},ge=async c=>{const z=c==="comentario"?u:q;if(!z.trim())return;const R=crypto.randomUUID(),ne={id:R,demandId:t.id,type:c,text:z,isCompleted:!1,deadline:c==="checklist"&&L?L:void 0,user:J.name,createdAt:new Date().toISOString()};f(le=>[ne,...le]),E(le=>[...le,R]),c==="comentario"&&A(""),c==="checklist"&&(W(""),y(""),O(!1));try{if(de()&&F){const le={demanda_id:t.id,tipo:c,texto:z,usuario:J.name};c==="checklist"&&(le.concluido=!1,le.prazo=L||null);const{data:he,error:me}=await F.from("demand_interactions").insert(le).select().single();if(me)throw me;he&&(f(Te=>Te.map(Ne=>Ne.id===R?{...Ne,id:he.id,createdAt:he.created_at}:Ne)),E(Te=>[...Te.filter(Ne=>Ne!==R),he.id]),setTimeout(()=>{E(Te=>Te.filter(Ne=>Ne!==he.id))},3e3),r&&r())}}catch(le){console.error("Erro ao salvar interação",le),j&&j("error","Erro ao salvar interação"),f(he=>he.filter(me=>me.id!==R)),E(he=>he.filter(me=>me!==R))}},b=async(c,z)=>{f(R=>R.map(ne=>ne.id===c?{...ne,isCompleted:!z}:ne));try{de()&&F&&(await F.from("demand_interactions").update({concluido:!z}).eq("id",c),r&&r())}catch(R){console.error("Erro ao atualizar checklist",R),j&&j("error","Erro ao atualizar checklist"),f(ne=>ne.map(le=>le.id===c?{...le,isCompleted:z}:le))}},C=async c=>{f(z=>z.filter(R=>R.id!==c));try{de()&&F&&(await F.from("demand_interactions").delete().eq("id",c),r&&r())}catch(z){console.error(z)}},G=async()=>{if(!K.trim())return;const c=[...h,K.trim()];M(c),_(""),U(!1);try{de()&&F&&(await F.from("demands").update({tags:c}).eq("id",t.id),r&&r())}catch(z){console.error(z)}},se=async c=>{const z=h.filter(R=>R!==c);M(z);try{de()&&F&&(await F.from("demands").update({tags:z}).eq("id",t.id),r&&r())}catch(R){console.error(R)}},je=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],ce=(c,z)=>new Date(c,z+1,0).getDate(),Ue=(c,z)=>new Date(c,z,1).getDay(),tt=c=>{const z=new Date(V.getFullYear(),V.getMonth(),c),R=z.getFullYear(),ne=String(z.getMonth()+1).padStart(2,"0"),le=String(z.getDate()).padStart(2,"0");y(`${R}-${ne}-${le}`),S(!1)},be=x.filter(c=>c.type==="checklist"),Ye=x.filter(c=>c.type==="comentario"||c.type==="status_change"),Ge=a.useMemo(()=>{if(be.length===0)return 0;const c=be.filter(z=>z.isCompleted).length;return Math.round(c/be.length*100)},[be]),Se=[{value:B.PENDING,label:"Pendente",icon:Ce},{value:B.IN_PROGRESS,label:"Em Andamento",icon:Ze},{value:B.COMPLETED,label:"Concluído",icon:Me}],ke=c=>{switch(c){case B.PENDING:return 1;case B.IN_PROGRESS:return 2;case B.COMPLETED:return 3;default:return 1}},De=c=>{if(c===B.PENDING)return new Date(t.createdAt);const z=x.find(R=>R.type==="status_change"&&(R.text.includes(`para "${c}"`)||R.text.includes(`para ${c}`)));return z?new Date(z.createdAt):null},Ee=c=>{const z=c.replace(/\D/g,"");window.open(`https://wa.me/55${z}`,"_blank")},Ae=c=>{window.open(`mailto:${c}`,"_blank")},He=(c,z)=>{const R=c??t.lat,ne=z??t.lon,le=R!=null&&ne!==null&&ne!==void 0;le&&H?(l(),H(R,ne,"demands",t.id)):j&&!le&&j("error","Localização não disponível para navegação.")},Ke=s?`${s.logradouro}, ${s.numero} - ${s.bairro}, ${s.cidade} - ${s.estado}`:void 0;return e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-end md:items-center justify-center sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity duration-300",onClick:l}),e.jsxs("div",{className:"relative w-full h-full md:h-[90vh] md:max-w-6xl bg-white dark:bg-[#0b1121] md:rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in slide-in-from-bottom-10 md:zoom-in-95 duration-300 md:border border-slate-200 dark:border-white/10",children:[e.jsxs("div",{className:"px-4 py-3 md:px-8 md:py-5 border-b border-slate-200 dark:border-white/10 flex items-start justify-between bg-white/90 dark:bg-[#0b1121]/90 backdrop-blur-md z-20 shrink-0 sticky top-0 rounded-t-3xl",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 flex-wrap",children:[e.jsx("button",{onClick:l,className:"mr-2 p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors md:hidden",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-white/40 font-mono",children:["#",t.id.slice(0,8)]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold uppercase border ${t.priority===te.HIGH?"bg-red-50 text-red-600 border-red-100 dark:bg-red-500/10 dark:text-red-300 dark:border-red-500/20":t.priority===te.MEDIUM?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-300 dark:border-amber-500/20":"bg-green-50 text-green-600 border-green-100 dark:bg-green-500/10 dark:text-green-300 dark:border-green-500/20"}`,children:t.priority})]}),e.jsx("h2",{className:"text-lg md:text-2xl font-bold text-slate-900 dark:text-white leading-tight line-clamp-1",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsxs("div",{className:"hidden md:flex items-center bg-slate-100 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10 mr-2",children:[e.jsx("button",{onClick:()=>i("prev"),disabled:!w,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors border-r border-slate-200 dark:border-white/10",title:"Demanda Anterior",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>i("next"),disabled:!k,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors",title:"Próxima Demanda",children:e.jsx(Xe,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>{o(t),l()},className:"p-2 md:p-2.5 text-slate-500 hover:text-brand-600 hover:bg-slate-100 rounded-xl transition-colors dark:text-white/50 dark:hover:text-white dark:hover:bg-white/10",title:"Editar",children:e.jsx(Kt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:l,className:"p-2 md:p-2.5 text-slate-400 hover:text-slate-800 hover:bg-slate-100 rounded-full transition-colors dark:text-white/40 dark:hover:text-white dark:hover:bg-white/10",children:e.jsx(Ie,{className:"w-6 h-6"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50/30 dark:bg-black/20 custom-scrollbar overscroll-contain flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 p-4 md:p-8 space-y-6 md:space-y-8 min-w-0",children:[e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex justify-between items-start relative px-4 md:px-12 mb-8 mt-2",children:[e.jsx("div",{className:"absolute top-3 left-4 right-4 md:left-12 md:right-12 h-0.5 bg-slate-200 dark:bg-white/10 -z-10"}),Se.map((c,z)=>{const R=ke(t.status),ne=z+1,le=ne<=R,he=ne===R,me=De(c.value);return e.jsxs("div",{className:"flex flex-col items-center gap-2 group bg-transparent",children:[e.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center border-4 transition-all duration-500 z-10 bg-white dark:bg-slate-900 ${le?"border-brand-500":"border-slate-300 dark:border-white/20"} ${he?"ring-4 ring-brand-100 dark:ring-brand-500/20 scale-110":""}`,children:e.jsx("div",{className:`w-2.5 h-2.5 rounded-full transition-colors duration-500 ${le?"bg-brand-500":"bg-slate-300 dark:bg-white/20"}`})}),e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${he?"text-brand-600 dark:text-brand-400":"text-slate-500 dark:text-white/40"}`,children:c.label}),me&&e.jsxs("span",{className:"text-[9px] text-slate-400 dark:text-white/30 font-medium h-3 mt-0.5",children:[me.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})," ",me.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]})]},c.value)})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Lt,{className:"w-4 h-4"})," Descrição"]})}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 md:p-6 shadow-sm",children:[e.jsx("p",{className:"text-sm md:text-base text-slate-700 dark:text-slate-200 leading-relaxed whitespace-pre-line",children:t.description}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-white/5 flex flex-wrap gap-2 items-center",children:[e.jsx(Aa,{className:"w-4 h-4 text-slate-400"}),h.map(c=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1 group",children:[c,e.jsx(Ie,{onClick:()=>se(c),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500 hidden group-hover:block"})]},c)),g?e.jsxs("div",{className:"flex items-center gap-2",ref:re,children:[e.jsx("input",{ref:Q,autoFocus:!0,type:"text",value:K,onChange:c=>_(c.target.value),className:"w-24 px-2 py-1 text-xs border rounded-lg outline-none",placeholder:"Nova tag...",onKeyDown:c=>{c.key==="Enter"&&G(),c.key==="Escape"&&U(!1)}}),e.jsx("button",{onClick:G,className:"text-xs font-bold text-brand-600",children:"OK"})]}):e.jsxs("button",{onClick:()=>U(!0),className:"text-xs text-slate-400 hover:text-brand-600 flex items-center gap-1 px-2 py-1 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(pt,{className:"w-3 h-3"})," Adicionar"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(ve,{className:"w-4 h-4"})," Localização"]}),e.jsx(oa,{demandId:t.id,lat:t.lat,lon:t.lon,address:Ke,onClick:He,onLocationUpdate:r,status:t.status,priority:t.priority})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Jt,{className:"w-4 h-4"})," Checklist"]}),be.length>0&&e.jsxs("span",{className:"text-xs font-mono text-slate-400 dark:text-white/40",children:[Math.round(Ge),"%"]})]}),be.length>0&&e.jsx("div",{className:"h-1.5 w-full bg-slate-200 dark:bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-500",style:{width:`${Ge}%`}})}),e.jsxs("div",{className:"space-y-2",children:[be.map(c=>e.jsxs("div",{className:"flex items-start gap-3 group bg-white dark:bg-white/5 p-3 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 dark:hover:border-white/10 transition-colors",children:[e.jsx("button",{onClick:()=>b(c.id,c.isCompleted||!1),className:`mt-0.5 w-5 h-5 rounded-lg border flex items-center justify-center transition-all ${c.isCompleted?"bg-green-500 border-green-500 text-white":"bg-white dark:bg-transparent border-slate-300 dark:border-white/20 hover:border-brand-500 text-transparent hover:text-brand-500/20"}`,children:e.jsx(it,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm transition-all font-medium ${c.isCompleted?"text-slate-400 line-through dark:text-white/30":"text-slate-800 dark:text-white"}`,children:c.text}),(c.deadline||c.isCompleted)&&e.jsx("div",{className:"flex items-center gap-2 mt-1.5",children:c.deadline&&e.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold uppercase flex items-center gap-1 ${c.isCompleted?"bg-slate-100 text-slate-400 dark:bg-white/5":new Date(c.deadline)<new Date?"bg-red-100 text-red-600 dark:bg-red-500/20 dark:text-red-300":"bg-slate-100 text-slate-500 dark:bg-white/10 dark:text-white/60"}`,children:[e.jsx(ye,{className:"w-3 h-3"})," ",rt(c.deadline)]})})]}),e.jsx("button",{onClick:()=>C(c.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",children:e.jsx(Ut,{className:"w-4 h-4"})})]},c.id)),D?e.jsxs("div",{className:"bg-white dark:bg-white/5 p-4 rounded-xl border border-brand-500/30 shadow-lg ring-1 ring-brand-500/10 animate-in fade-in zoom-in-95",children:[e.jsx("input",{type:"text",autoFocus:!0,value:q,onChange:c=>W(c.target.value),placeholder:"Descreva a tarefa...",className:"w-full bg-transparent border-none outline-none text-sm text-slate-900 dark:text-white placeholder:text-slate-400 mb-4 font-medium",onKeyDown:c=>c.key==="Enter"&&ge("checklist")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 border-t border-slate-100 dark:border-white/5 pt-3",children:[e.jsxs("div",{className:"relative w-full sm:w-auto",ref:re,children:[e.jsxs("button",{onClick:()=>S(!I),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all border ${L?"bg-brand-50 text-brand-700 border-brand-200 dark:bg-brand-500/20 dark:text-brand-300 dark:border-brand-500/30":"bg-slate-50 text-slate-500 border-slate-200 dark:bg-white/5 dark:text-white/50 dark:border-white/10 hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(ye,{className:"w-3.5 h-3.5"}),L?rt(L):"Definir Prazo"]}),I&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-64 glass-panel bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 p-3 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:()=>ae(new Date(V.getFullYear(),V.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Re,{className:"w-4 h-4 text-slate-600 dark:text-white"})}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white text-xs",children:[je[V.getMonth()]," ",V.getFullYear()]}),e.jsx("button",{onClick:()=>ae(new Date(V.getFullYear(),V.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Xe,{className:"w-4 h-4 text-slate-600 dark:text-white"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-1",children:["D","S","T","Q","Q","S","S"].map(c=>e.jsx("span",{className:"text-[9px] font-bold text-slate-400 dark:text-white/40",children:c},c))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:Ue(V.getFullYear(),V.getMonth())}).map((c,z)=>e.jsx("div",{},`empty-${z}`)),Array.from({length:ce(V.getFullYear(),V.getMonth())}).map((c,z)=>{const R=z+1,ne=L&&new Date(L).getDate()===R&&new Date(L).getMonth()===V.getMonth();return e.jsx("button",{onClick:()=>tt(R),className:`h-6 w-6 rounded-full text-[10px] font-medium flex items-center justify-center transition-all ${ne?"bg-brand-500 text-white":"text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:R},R)})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-end",children:[e.jsx("button",{onClick:()=>O(!1),className:"px-3 py-1.5 text-xs font-bold text-slate-500 hover:text-slate-700 dark:text-white/60 dark:hover:text-white",children:"Cancelar"}),e.jsx("button",{onClick:()=>ge("checklist"),className:"px-4 py-1.5 bg-brand-600 text-white text-xs font-bold rounded-lg hover:bg-brand-500 shadow-sm",children:"Salvar Item"})]})]})]}):e.jsxs("button",{onClick:()=>O(!0),className:"flex items-center justify-center gap-2 text-sm text-slate-500 dark:text-white/50 hover:text-brand-600 dark:hover:text-brand-400 transition-colors px-4 py-3 rounded-xl border border-dashed border-slate-300 dark:border-white/10 hover:border-brand-300 dark:hover:border-brand-500/30 hover:bg-slate-50 dark:hover:bg-white/5 w-full group",children:[e.jsx(pt,{className:"w-4 h-4 group-hover:scale-110 transition-transform"})," Adicionar item ao checklist"]})]})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Ta,{className:"w-4 h-4"})," Comentários e Histórico"]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-3 md:p-4 bg-slate-50 dark:bg-white/5 border-b border-slate-200 dark:border-white/10 flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold text-xs shrink-0",children:J.name.charAt(0)}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:u,onChange:c=>A(c.target.value),placeholder:"Escreva um comentário...",className:"w-full bg-white dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl pl-4 pr-10 py-2.5 text-sm outline-none focus:border-brand-500 transition-all text-slate-900 dark:text-white shadow-sm",onKeyDown:c=>c.key==="Enter"&&ge("comentario")}),e.jsx("button",{onClick:()=>ge("comentario"),disabled:!u.trim(),className:"absolute right-2 top-2 p-1 text-slate-400 hover:text-brand-600 disabled:opacity-30 transition-colors",children:e.jsx($a,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-white/5 max-h-[300px] overflow-y-auto custom-scrollbar",children:Ye.length===0?e.jsx("div",{className:"p-6 text-center text-slate-400 dark:text-white/30 text-sm italic",children:"Nenhum comentário ou registro de atividade."}):Ye.map(c=>e.jsxs("div",{className:`p-4 flex gap-3 hover:bg-slate-50 dark:hover:bg-white/5 transition-colors group ${$.includes(c.id)?"bg-amber-50 dark:bg-amber-500/10 animate-pulse duration-1000":""}`,children:[c.type==="status_change"?e.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-100 dark:bg-amber-500/20 flex items-center justify-center text-amber-600 dark:text-amber-400 font-bold text-xs shrink-0 border border-amber-200 dark:border-amber-500/20",children:e.jsx(Ce,{className:"w-4 h-4"})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs shrink-0 border border-slate-300 dark:border-white/10",children:c.user.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-slate-900 dark:text-white",children:c.user}),e.jsx("span",{className:"text-[10px] text-slate-400",children:new Date(c.createdAt).toLocaleString()})]}),e.jsx("p",{className:`text-sm leading-relaxed break-words p-3 rounded-tr-xl rounded-br-xl rounded-bl-xl border ${c.type==="status_change"?"bg-amber-50/50 dark:bg-amber-900/10 text-slate-600 dark:text-slate-300 border-amber-100 dark:border-amber-500/10 italic":"bg-slate-50 dark:bg-white/5 text-slate-600 dark:text-slate-300 border-slate-100 dark:border-white/5"}`,children:c.text})]}),c.type==="comentario"&&e.jsx("button",{onClick:()=>C(c.id),className:"opacity-0 group-hover:opacity-100 self-start p-2 text-slate-300 hover:text-red-500 transition-all",children:e.jsx(Ut,{className:"w-4 h-4"})})]},c.id))})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white/50 dark:bg-black/20 border-t md:border-t-0 md:border-l border-slate-200 dark:border-white/10 p-4 md:p-6 space-y-6 md:h-auto overflow-y-auto",children:[e.jsxs("div",{className:"hidden md:block",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 mb-3 block",children:"Status"}),e.jsx("div",{className:"bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex flex-col relative border border-slate-200 dark:border-white/5 gap-1",children:Se.map(c=>{const z=t.status===c.value;return e.jsxs("button",{onClick:()=>m(t.id,c.value),className:`
                                                w-full py-2.5 px-3 text-sm font-bold rounded-lg transition-all duration-300 flex items-center gap-3
                                                ${z?"bg-white dark:bg-white/10 text-brand-600 dark:text-white shadow-sm ring-1 ring-slate-200 dark:ring-white/10":"text-slate-500 dark:text-white/40 hover:bg-slate-200 dark:hover:bg-white/5"}
                                            `,children:[e.jsx(c.icon,{className:`w-4 h-4 ${z?"text-brand-500 dark:text-brand-400":"opacity-50"}`}),c.label]},c.value)})})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4 space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40 mb-2",children:"Datas"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-500 dark:text-white/50",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Criado em"}),e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white",children:new Date(t.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${t.deadline?"bg-brand-100 dark:bg-brand-500/20 text-brand-600 dark:text-brand-400":"bg-slate-100 dark:bg-white/10 text-slate-500"}`,children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Prazo Demanda"}),e.jsx("p",{className:`text-sm font-bold ${t.deadline?"text-slate-800 dark:text-white":"text-slate-400 italic"}`,children:rt(t.deadline)||"Sem prazo"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40",children:"Solicitante"})}),s?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-white/5 p-2 -ml-2 rounded-xl transition-colors group",onClick:()=>N&&N(s.id),title:"Ver perfil do cidadão",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-sm shadow-inner shrink-0",children:s.name.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-bold text-slate-900 dark:text-white truncate group-hover:text-brand-600 transition-colors flex items-center gap-1",children:[s.name,e.jsx(Pa,{className:"w-3 h-3 opacity-0 group-hover:opacity-100"})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:ze(s.phone)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.phone&&e.jsxs("button",{onClick:()=>Ee(s.phone),className:"flex-1 py-1.5 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Conversar no WhatsApp",children:[e.jsx(La,{className:"w-3.5 h-3.5"})," WhatsApp"]}),s.email&&e.jsxs("button",{onClick:()=>Ae(s.email),className:"flex-1 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Enviar Email",children:[e.jsx(Ot,{className:"w-3.5 h-3.5"})," Email"]})]})]}):e.jsx("div",{className:"text-center py-4 text-slate-400 text-xs italic",children:"Nenhum solicitante vinculado."})]})]})]})]})]})},ys=({citizen:t,onClose:s,onEdit:l,onCreateDemand:o,onNotification:m,onSelectDemand:r,onMapFocus:i})=>{const[w,k]=a.useState([]),[j,N]=a.useState(!1);a.useEffect(()=>{(async()=>{N(!0);try{if(de()&&F){const{data:P,error:$}=await F.from("demands").select("*").eq("citizen_id",t.id).order("created_at",{ascending:!1});if(P){const E=P.map(u=>({id:u.id,title:u.title,description:u.description,level:u.level,status:u.status,priority:u.priority,type:u.type,deadline:u.deadline,citizenId:u.citizen_id,createdAt:u.created_at,tags:u.tags}));k(E)}}}catch(P){console.error(P)}finally{N(!1)}})()},[t.id]);const H=(v,P)=>{const $=v??t.lat,E=P??t.lon,u=$!=null&&E!==null&&E!==void 0;u&&i?(s(),i($,E,"citizens",t.id)):m&&!u&&m("error","Localização não disponível para navegação.")},x=v=>{const P=v.replace(/\D/g,"");window.open(`https://wa.me/55${P}`,"_blank")},f=()=>[t.logradouro,t.numero?`Nº ${t.numero}`:null,t.bairro,t.cidade&&t.estado?`${t.cidade} - ${t.estado}`:t.cidade].filter(Boolean).join(", ")||"Endereço não informado";return e.jsxs("div",{className:"fixed inset-0 z-[80] flex items-end md:items-center justify-center sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity duration-300",onClick:s}),e.jsxs("div",{className:"relative w-full h-full md:h-[90vh] md:max-w-5xl bg-white dark:bg-[#0b1121] md:rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in slide-in-from-bottom-10 md:zoom-in-95 duration-300 md:border border-slate-200 dark:border-white/10",children:[e.jsxs("div",{className:"px-4 py-3 md:px-8 md:py-5 border-b border-slate-200 dark:border-white/10 flex items-center justify-between bg-white/90 dark:bg-[#0b1121]/90 backdrop-blur-md z-20 shrink-0 sticky top-0 rounded-t-3xl",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4 flex items-center gap-3",children:[e.jsx("button",{onClick:s,className:"p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors md:hidden",children:e.jsx(Re,{className:"w-6 h-6"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 dark:bg-brand-500/20 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold text-lg border border-brand-200 dark:border-brand-500/30",children:t.name.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-bold text-slate-900 dark:text-white leading-tight truncate",children:t.name}),t.bairro&&e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50 truncate",children:t.bairro})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{l()},className:"p-2 md:p-2.5 text-slate-500 hover:text-brand-600 hover:bg-slate-100 rounded-xl transition-colors dark:text-white/50 dark:hover:text-white dark:hover:bg-white/10",title:"Editar",children:e.jsx(Kt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:s,className:"hidden md:block p-2 md:p-2.5 text-slate-400 hover:text-slate-800 hover:bg-slate-100 rounded-full transition-colors dark:text-white/40 dark:hover:text-white dark:hover:bg-white/10",children:e.jsx(Ie,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-slate-50/30 dark:bg-black/20 custom-scrollbar p-4 md:p-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-5xl mx-auto",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 shadow-sm space-y-4",children:[e.jsxs("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 flex items-center gap-2",children:[e.jsx(dt,{className:"w-4 h-4"})," Contato"]}),e.jsxs("div",{className:"space-y-3",children:[t.phone?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-white/5 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-500/20 text-green-600 dark:text-green-400 rounded-lg",children:e.jsx(Wt,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-mono text-sm font-bold text-slate-700 dark:text-white",children:ze(t.phone)})]}),e.jsx("button",{onClick:()=>x(t.phone),className:"text-xs font-bold text-green-600 hover:underline",children:"WhatsApp"})]}):e.jsx("p",{className:"text-sm text-slate-400 italic",children:"Sem telefone cadastrado."}),t.email&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 dark:bg-white/5 rounded-xl",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400 rounded-lg",children:e.jsx(Ot,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-white truncate",children:t.email})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 shadow-sm space-y-3",children:[e.jsxs("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 flex items-center gap-2",children:[e.jsx(_a,{className:"w-4 h-4"})," Observações"]}),e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-xl min-h-[80px]",children:t.observacoes?e.jsx("p",{className:"text-sm text-slate-700 dark:text-white leading-relaxed whitespace-pre-wrap",children:t.observacoes}):e.jsx("p",{className:"text-sm text-slate-400 italic",children:"Nenhuma observação registrada."})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"})," Endereço & Mapa"]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-1 shadow-sm",children:[e.jsx("div",{className:"p-4 pb-2",children:e.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-white leading-relaxed",children:f()})}),e.jsx("div",{className:"p-1",children:e.jsx(oa,{entityId:t.id,tableName:"citizens",lat:t.lat,lon:t.lon,address:f(),onClick:H})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:o,className:"w-full py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold shadow-lg shadow-brand-500/20 flex items-center justify-center gap-2 active:scale-95 transition-all",children:[e.jsx(_t,{className:"w-5 h-5"})," Nova Demanda"]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 shadow-sm flex flex-col h-[400px]",children:[e.jsxs("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 flex items-center gap-2 mb-4",children:[e.jsx(Mt,{className:"w-4 h-4"})," Histórico (",w.length,")"]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-3 pr-2",children:w.length>0?w.map(v=>e.jsxs("div",{onClick:()=>r&&r(v),className:"p-3 rounded-xl bg-slate-50 dark:bg-white/5 border border-slate-100 dark:border-white/5 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/10 hover:border-brand-200 transition-all group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("span",{className:"text-[10px] font-bold text-slate-400 group-hover:text-brand-500 transition-colors",children:["#",v.id.slice(0,6)]}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold uppercase ${v.status==="Concluído"?"bg-green-100 text-green-700":"bg-slate-200 text-slate-600"}`,children:v.status})]}),e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white line-clamp-1 group-hover:text-brand-600 transition-colors",children:v.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50 mt-1",children:new Date(v.createdAt).toLocaleDateString()})]},v.id)):e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:e.jsx("p",{className:"text-sm italic",children:"Nenhuma demanda registrada."})})})]})]})]})})]})]})},Cs=({demands:t,citizens:s,interactions:l=[],onViewDemand:o,onEditDemand:m,onCreateDemand:r,onUpdateStatus:i,onInteractionUpdate:w,initialSelectionId:k,clearSelection:j,initialViewMode:N="list",filters:H,setFilters:x,users:f=[],onNotification:v,defaultLocation:P,onViewCitizen:$,mapMarkers:E,mapFocus:u,initialMapViewMode:A="demands",onMapFocus:q})=>{const[W,L]=a.useState(N),[y,D]=a.useState("demands"),[O,h]=a.useState([]),[M,K]=a.useState("all"),[_,g]=a.useState(null),[U,Q]=a.useState(null),I=a.useMemo(()=>{const C=t.length;let G=0,se=0,je=0;for(const ce of t)ce.status===B.PENDING?G++:ce.status===B.COMPLETED&&se++,ce.priority===te.HIGH&&je++;return{total:C,pending:G,completed:se,highPriority:je}},[t]),S=a.useMemo(()=>s.find(C=>C.id===U),[s,U]);a.useEffect(()=>{k&&g(k)},[k]),a.useEffect(()=>{N&&L(N)},[N]),a.useEffect(()=>{A&&D(A)},[A]),a.useEffect(()=>{(async()=>{if(de()&&F){const{data:G}=await F.from("app_config").select("value").eq("key","dashboard_notices").maybeSingle();G&&h(G.value)}else{const G=localStorage.getItem("geo_notices");G&&h(JSON.parse(G))}})()},[]);const V=C=>{if(K(C),!!x){x(G=>({...G,startDate:"",endDate:""}));return}};a.useEffect(()=>{W==="map"&&x&&V("all")},[W]);const ae=C=>{if(!_)return;const G=t.findIndex(se=>se.id===_);G!==-1&&(C==="prev"&&G>0?g(t[G-1].id):C==="next"&&G<t.length-1&&g(t[G+1].id))},re=C=>{Q(C)},J=_?t.findIndex(C=>C.id===_):-1,ie=J>0,ge=J!==-1&&J<t.length-1,b=()=>W==="map"?null:e.jsx("div",{className:"shrink-0 flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-3",children:[e.jsx(et,{className:"w-8 h-8 text-brand-600 dark:text-brand-400"}),"Gestão de Demandas"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsx("div",{className:"w-full md:w-[280px]",children:e.jsx(Fe,{value:W,onChange:C=>L(C),options:[{value:"list",label:"Lista",icon:Oa},{value:"board",label:"Quadro",icon:Ma},{value:"calendar",label:"Calendário",icon:Ra}]})}),e.jsxs("button",{onClick:r,className:"w-full sm:w-auto px-5 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 transition-all flex items-center justify-center gap-2 active:scale-95 h-11 shrink-0",children:[e.jsx(_t,{className:"w-5 h-5"}),e.jsx("span",{className:"whitespace-nowrap",children:"Nova Demanda"})]})]})]})});return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500 relative",children:[e.jsxs("div",{className:`flex flex-col gap-4 h-full mx-auto w-full ${W==="map"?"":"max-w-[1600px]"}`,children:[b(),H&&x&&e.jsx("div",{className:"shrink-0",children:e.jsx(ks,{filters:H,setFilters:x,users:f,isMapMode:W==="map",mapViewMode:y,onMapViewModeChange:D})}),e.jsxs("div",{className:"flex flex-col min-h-0 w-full relative h-full",children:[W!=="calendar"&&W!=="map"&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-4 shrink-0",children:[e.jsx(Oe,{title:"Total",value:I.total,icon:Qt,colorClass:"bg-blue-500",textClass:"text-blue-600 dark:text-blue-400"}),e.jsx(Oe,{title:"Pendentes",value:I.pending,icon:Ce,colorClass:"bg-slate-500",textClass:"text-slate-600 dark:text-slate-400"}),e.jsx(Oe,{title:"Concluídas",value:I.completed,icon:Me,colorClass:"bg-green-500",textClass:"text-green-600 dark:text-green-400"}),e.jsx(Oe,{title:"Alta Prioridade",value:I.highPriority,icon:Ze,colorClass:"bg-red-500",textClass:"text-red-600 dark:text-red-400"})]}),e.jsxs("div",{className:"flex-1 min-h-0 w-full relative",children:[W==="list"&&e.jsx(ms,{demands:t,citizens:s,onUpdateStatus:i||(()=>{}),onEdit:m,onViewDemand:C=>g(C.id),initialSelectionId:k,clearSelection:j,onInteractionUpdate:w,onNotification:v,onViewCitizen:re}),W==="board"&&e.jsx(is,{demands:t,citizens:s,onViewDemand:C=>g(C.id),onUpdateStatus:i||(()=>{})}),W==="calendar"&&e.jsx(cs,{demands:t,interactions:l,notices:O,onEditDemand:C=>g(C.id)}),W==="map"&&e.jsx("div",{className:"h-[600px] md:h-full w-full rounded-3xl overflow-hidden border border-slate-200 dark:border-white/10 shadow-sm relative",children:e.jsx(js,{defaultCenter:P,onViewDemand:C=>g(C),preloadedMarkers:E,currentViewMode:y,onChangeViewMode:D,mapFocus:u})})]})]})]}),_&&e.jsx(Ns,{demand:t.find(C=>C.id===_),citizen:s.find(C=>{var G;return C.id===((G=t.find(se=>se.id===_))==null?void 0:G.citizenId)})||null,onClose:()=>{g(null),j&&j()},onEdit:m,onUpdateStatus:i||(()=>{}),onInteractionUpdate:w,onNavigate:ae,canNavigatePrev:ie,canNavigateNext:ge,onNotification:v,onViewCitizen:re,onMapFocus:q}),S&&e.jsx(ys,{citizen:S,onClose:()=>Q(null),onEdit:()=>{Q(null),$&&$(S.id)},onCreateDemand:()=>{Q(null),r()},onNotification:v,onSelectDemand:C=>{Q(null),g(C.id)},onMapFocus:q})]})},Ss=({locations:t})=>{const[s,l]=a.useState(null),[o,m]=a.useState(!1),r=t.length>0?t[0]:null;a.useEffect(()=>{(async()=>{if(!r){m(!1);return}const N=`weather_cache_${r.lat}_${r.lon}`,H=localStorage.getItem(N),x=new Date().toISOString().slice(0,13);if(H){const f=JSON.parse(H);if(f.hour===x){l(f.data);return}}m(!0);try{const v=await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${r.lat}&longitude=${r.lon}&current=temperature_2m,weather_code&timezone=auto`)).json();l(v),localStorage.setItem(N,JSON.stringify({hour:x,data:v}))}catch(f){console.error("Failed to fetch weather",f)}finally{m(!1)}})()},[r]);const i=j=>j===0?e.jsx(At,{className:"w-6 h-6 text-amber-500"}):j>=1&&j<=3?e.jsx(za,{className:"w-6 h-6 text-slate-400"}):j>=51&&j<=67?e.jsx(Fa,{className:"w-6 h-6 text-blue-400"}):j>=71&&j<=77?e.jsx(Ua,{className:"w-6 h-6 text-cyan-300"}):e.jsx(At,{className:"w-6 h-6 text-amber-500"});if(o&&r)return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-slate-200/50 dark:bg-white/5 animate-pulse min-w-[140px] h-[46px]",children:[e.jsx(we,{className:"w-4 h-4 animate-spin text-slate-400"}),e.jsx("div",{className:"h-3 w-16 bg-slate-300 dark:bg-white/10 rounded"})]});if(!r||!s)return null;const w=Math.round(s.current.temperature_2m),k=s.current.weather_code;return e.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 rounded-xl bg-white/60 dark:bg-white/5 backdrop-blur-md border border-slate-200 dark:border-white/10 shadow-sm transition-all hover:bg-white/80 dark:hover:bg-white/10 cursor-default",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i(k),e.jsxs("span",{className:"text-xl font-bold text-slate-900 dark:text-white",children:[w,"°"]})]}),e.jsxs("div",{className:"flex flex-col border-l border-slate-300 dark:border-white/10 pl-4 h-8 justify-center",children:[e.jsxs("span",{className:"text-xs font-bold text-slate-700 dark:text-white uppercase tracking-wide flex items-center gap-1",children:[e.jsx(ve,{className:"w-3 h-3 text-brand-600 dark:text-brand-400"}),r.name]}),e.jsx("span",{className:"text-[10px] text-slate-500 dark:text-white/50",children:"Tempo Agora"})]})]})},Ds=({onBack:t,onSuccess:s})=>{const[l,o]=a.useState(""),[m,r]=a.useState("search"),[i,w]=a.useState([]),[k,j]=a.useState(!1),[N,H]=a.useState(""),[x,f]=a.useState(""),[v,P]=a.useState(""),[$,E]=a.useState(!1);a.useEffect(()=>{const A=setTimeout(()=>H(l),500);return()=>clearTimeout(A)},[l]),a.useEffect(()=>{if(!N||N.length<3){w([]);return}(async()=>{if(j(!0),de()&&F){const q=Ve(N),{data:W}=await F.from("citizens").select("*").or(`telefone.ilike.%${q}%,nome.ilike.%${N}%`).limit(5);W&&w(W.map(L=>({id:L.id,name:`${L.nome} ${L.sobrenome}`,phone:L.telefone,bairro:L.bairro,email:L.email||"",createdAt:L.created_at})))}j(!1)})()},[N]);const u=async()=>{if(!x||!l)return;E(!0);const A=Ve(l),q=x.trim().split(" "),W=q[0],L=q.slice(1).join(" ")||".";try{if(de()&&F){const{data:y,error:D}=await F.from("citizens").insert({nome:W,sobrenome:L,telefone:A,bairro:v,origem:"fast_track_mobile"}).select().single();if(D)throw D;y&&s(y.id)}}catch(y){console.error(y),alert("Erro ao criar cidadão rápido.")}finally{E(!1)}};return e.jsxs("div",{className:"fixed inset-0 bg-slate-50 dark:bg-[#020617] z-[100] flex flex-col animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"p-4 flex items-center gap-4 border-b border-slate-200 dark:border-white/10 bg-white dark:bg-[#0b1121]",children:[e.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-white/10",children:e.jsx(Pt,{className:"w-6 h-6 text-slate-600 dark:text-white"})}),e.jsx("h1",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Nova Solicitação"})]}),m==="search"&&e.jsxs("div",{className:"flex-1 p-6 flex flex-col",children:[e.jsx("label",{className:"text-sm font-bold text-slate-500 dark:text-white/50 mb-2 uppercase",children:"Quem está solicitando?"}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("input",{autoFocus:!0,type:"text",value:l,onChange:A=>o(A.target.value),placeholder:"Telefone ou Nome...",className:"w-full text-2xl font-bold bg-transparent border-b-2 border-slate-300 dark:border-white/20 py-2 outline-none focus:border-brand-500 text-slate-900 dark:text-white placeholder:text-slate-300"}),k&&e.jsx(we,{className:"absolute right-0 top-3 w-6 h-6 animate-spin text-brand-500"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3",children:[i.map(A=>e.jsxs("button",{onClick:()=>s(A.id),className:"w-full text-left p-4 bg-white dark:bg-white/5 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex items-center justify-between active:scale-95 transition-transform",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 dark:bg-brand-500/20 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold",children:A.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:A.name}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:ze(A.phone)})]})]}),e.jsx("div",{className:"bg-brand-600 text-white p-2 rounded-xl",children:e.jsx(pt,{className:"w-5 h-5"})})]},A.id)),N.length>3&&e.jsxs("button",{onClick:()=>r("create-citizen"),className:"w-full p-4 mt-4 bg-slate-100 dark:bg-white/5 rounded-2xl border-2 border-dashed border-slate-300 dark:border-white/10 flex items-center justify-center gap-2 text-slate-500 dark:text-white/60 font-bold active:scale-95 transition-transform",children:[e.jsx(Zt,{className:"w-5 h-5"}),'Cadastrar "',l,'"']})]})]}),m==="create-citizen"&&e.jsx("div",{className:"flex-1 p-6 flex flex-col",children:e.jsxs("div",{className:"bg-white dark:bg-white/5 p-6 rounded-3xl border border-slate-200 dark:border-white/10 shadow-lg space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Telefone"}),e.jsx("p",{className:"text-xl font-mono font-bold text-slate-900 dark:text-white border-b border-slate-100 pb-2",children:ze(l)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Nome Completo"}),e.jsx("input",{autoFocus:!0,type:"text",value:x,onChange:A=>f(A.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: João da Silva"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Bairro (Opcional)"}),e.jsx("input",{type:"text",value:v,onChange:A=>P(A.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: Centro"})]}),e.jsxs("button",{onClick:u,disabled:$||!x,className:"w-full py-4 bg-brand-600 text-white rounded-xl font-bold text-lg shadow-xl shadow-brand-500/20 flex items-center justify-center gap-2 active:scale-95 transition-transform disabled:opacity-50",children:[$?e.jsx(we,{className:"w-6 h-6 animate-spin"}):e.jsx(it,{className:"w-6 h-6"}),"Salvar e Criar Demanda"]})]})})]})},Pe=[{title:"Bem-vindo ao Gabinete Digital",description:"Sua plataforma completa para gestão de mandato. Centralize demandas, cidadãos e inteligência geográfica em um só lugar.",icon:Ga,color:"bg-blue-500"},{title:"Gestão de Demandas",description:"Acompanhe solicitações em tempo real. Visualize por Lista, Kanban ou Calendário e nunca perca um prazo.",icon:et,color:"bg-brand-500"},{title:"Base de Cidadãos",description:"Conheça seu eleitorado. Mantenha um histórico completo de interações e localização de cada cidadão.",icon:We,color:"bg-green-500"},{title:"Mapa Interativo",description:"Inteligência espacial. Identifique problemas por região e tome decisões estratégicas baseadas em dados.",icon:$t,color:"bg-purple-500"}],Es=({onFinish:t})=>{const[s,l]=a.useState(0),[o,m]=a.useState("next"),r=()=>{s<Pe.length-1?(m("next"),l(j=>j+1)):w()},i=()=>{s>0&&(m("prev"),l(j=>j-1))},w=()=>{localStorage.setItem("geo_onboarding_completed","true"),t()},k=Pe[s].icon;return e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-[#0f172a] rounded-3xl shadow-2xl overflow-hidden border border-white/20 relative flex flex-col",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1.5 bg-slate-100 dark:bg-white/10 z-10",children:e.jsx("div",{className:"h-full bg-brand-500 transition-all duration-500 ease-out",style:{width:`${(s+1)/Pe.length*100}%`}})}),e.jsxs("button",{onClick:w,className:"absolute top-4 right-4 p-2 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors z-20 hover:bg-slate-100 dark:hover:bg-white/10 rounded-full",title:"Pular Tutorial",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider mr-1",children:"Pular"}),e.jsx(Ie,{className:"w-4 h-4 inline-block"})]}),e.jsxs("div",{className:"p-8 flex flex-col items-center text-center flex-1",children:[e.jsxs("div",{className:`flex flex-col items-center animate-in ${o==="next"?"slide-in-from-right-8":"slide-in-from-left-8"} fade-in duration-300 fill-mode-both`,children:[e.jsx("div",{className:`w-24 h-24 rounded-3xl ${Pe[s].color} flex items-center justify-center shadow-xl shadow-brand-500/10 mb-8 transform transition-transform duration-500 hover:scale-105`,children:e.jsx(k,{className:"w-12 h-12 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-4 leading-tight",children:Pe[s].title}),e.jsx("p",{className:"text-slate-500 dark:text-white/60 mb-8 leading-relaxed text-sm md:text-base min-h-[80px]",children:Pe[s].description})]},s),e.jsxs("div",{className:"mt-auto w-full",children:[e.jsx("div",{className:"flex justify-center gap-2 mb-8",children:Pe.map((j,N)=>e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${N===s?"bg-brand-600 w-8":"bg-slate-200 dark:bg-white/10 w-2"}`},N))}),e.jsxs("div",{className:"flex gap-3 items-center",children:[s>0&&e.jsx("button",{onClick:i,className:"p-3.5 rounded-xl border border-slate-200 dark:border-white/10 text-slate-500 dark:text-white hover:bg-slate-50 dark:hover:bg-white/5 transition-colors active:scale-95",children:e.jsx(Re,{className:"w-6 h-6"})}),e.jsxs("button",{onClick:r,className:"flex-1 py-3.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 flex items-center justify-center gap-2 transition-all active:scale-[0.98] group",children:[s===Pe.length-1?"Começar Agora":"Próximo",s===Pe.length-1?e.jsx(it,{className:"w-5 h-5"}):e.jsx(Xe,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})]})]})]})})},Is=t=>{const[s,l]=a.useState(navigator.onLine),[o,m]=a.useState(!0),[r,i]=a.useState([]),[w,k]=a.useState([]),[j,N]=a.useState([]),[H,x]=a.useState([]),[f,v]=a.useState([]),[P,$]=a.useState(null),[E,u]=a.useState(null),[A,q]=a.useState(0),W=a.useCallback((D,O)=>{try{const h=localStorage.getItem("geo_map_cache"),M=h?JSON.parse(h):{};let K=!1;O.forEach(_=>{_.lat&&_.lon&&!M[_.id]&&(M[_.id]={lat:_.lat,lon:_.lon},K=!0)}),D.forEach(_=>{_.lat&&_.lon&&!M[_.id]&&(M[_.id]={lat:_.lat,lon:_.lon},K=!0)}),K&&localStorage.setItem("geo_map_cache",JSON.stringify(M))}catch(h){console.error("Error preloading map cache",h)}},[]),L=a.useCallback(async()=>{if(m(!0),!navigator.onLine){console.log("Offline mode: Loading from cache");const D=localStorage.getItem("cache_demands"),O=localStorage.getItem("cache_citizens"),h=localStorage.getItem("offline_demands_queue");let M=D?JSON.parse(D):[];const K=O?JSON.parse(O):[];h&&(M=[...JSON.parse(h),...M]),i(M),k(K),m(!1);return}if(de()&&F)try{const[{data:D},{data:O},{data:h},{data:M},{data:K},{data:_},{data:g}]=await Promise.all([F.from("demands").select("*").order("created_at",{ascending:!1}).limit(2e3),F.from("citizens").select("*").limit(3e3),F.from("system_users").select("*"),F.from("demand_interactions").select("*").order("created_at",{ascending:!1}).limit(1e3),F.from("app_config").select("*").eq("key","weather_locations").maybeSingle(),F.from("app_config").select("*").eq("key","global_theme_mode").maybeSingle(),F.from("dashboard_stats").select("*").maybeSingle()]),U=D?D.map(I=>({...I,citizenId:I.citizen_id,createdAt:I.created_at})):[],Q=O?O.map(I=>({id:I.id,cpf:I.cpf,name:`${I.nome} ${I.sobrenome}`,email:I.email,phone:I.telefone,createdAt:I.created_at,logradouro:I.logradouro,numero:I.numero,bairro:I.bairro,cidade:I.cidade,estado:I.estado,cep:I.cep,lat:I.lat,lon:I.lon})):[];localStorage.setItem("cache_demands",JSON.stringify(U)),localStorage.setItem("cache_citizens",JSON.stringify(Q)),D&&i(U),O&&k(Q),h&&N(h),M&&x(M.map(I=>({id:I.id,demandId:I.demanda_id,type:I.tipo,text:I.texto,isCompleted:I.concluido,deadline:I.prazo,user:I.usuario,createdAt:I.created_at}))),K&&v(K.value),g&&$(g),_&&_.value&&u(_.value),W(U,Q)}catch(D){console.error("Error fetching data, trying cache...",D);const O=localStorage.getItem("cache_demands"),h=localStorage.getItem("cache_citizens");O&&i(JSON.parse(O)),h&&k(JSON.parse(h))}finally{m(!1)}else i([]),m(!1)},[W]),y=a.useCallback(async()=>{const D=localStorage.getItem("offline_demands_queue");if(!D)return 0;const O=JSON.parse(D);if(O.length===0)return 0;if(de()&&F){console.log(`Syncing ${O.length} offline demands...`);let h=0;for(const M of O)try{const{error:K}=await F.from("demands").insert({id:M.id,title:M.title,description:M.description,level:M.level,status:M.status,priority:M.priority,type:M.type,deadline:M.deadline,citizen_id:M.citizenId,tags:M.tags});K?console.error("Failed to sync item",M.id,K):h++}catch(K){console.error("Error syncing item",K)}return localStorage.removeItem("offline_demands_queue"),q(h),L(),h}return 0},[L]);return a.useEffect(()=>{const D=()=>{l(!0),y(),L()},O=()=>{l(!1)};return window.addEventListener("online",D),window.addEventListener("offline",O),()=>{window.removeEventListener("online",D),window.removeEventListener("offline",O)}},[L,y]),a.useEffect(()=>{t?(L(),setTimeout(()=>{navigator.onLine&&y()},2e3)):i([])},[t,L,y]),{isOnline:s,isLoading:o,demands:r,setDemands:i,citizens:w,setCitizens:k,users:j,interactions:H,weatherLocations:f,setWeatherLocations:v,dbStats:P,themePreference:E,fetchData:L,processOfflineQueue:y,syncCount:A,setSyncCount:q}},As=({status:t,setStatus:s,priority:l,setPriority:o,timeRange:m,setTimeRange:r,scope:i,setScope:w,showScope:k=!0,className:j=""})=>e.jsxs("div",{className:`glass-panel p-3 rounded-3xl flex flex-col md:flex-row gap-4 items-center border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md shadow-sm ${j}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-white/50 text-xs font-bold uppercase tracking-wider shrink-0",children:[e.jsx(Tt,{className:"w-4 h-4 text-brand-500"})," Filtros"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto overflow-x-auto scrollbar-none items-start sm:items-center flex-1",children:[k&&i&&w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-w-[200px]",children:e.jsx(Fe,{value:i,onChange:w,options:[{value:"demands",label:"Demandas",icon:et},{value:"citizens",label:"Cidadãos",icon:We}]})}),e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"})]}),e.jsx("div",{className:"min-w-[280px]",children:e.jsx(Fe,{value:m,onChange:r,options:[{value:"7",label:"7d"},{value:"30",label:"30d"},{value:"90",label:"90d"},{value:"365",label:"Ano"},{value:"all",label:"Tudo"}]})}),(!k||i==="demands")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:t,onChange:N=>s(N.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Status: Todos"}),e.jsx("option",{value:B.PENDING,children:"Pendentes"}),e.jsx("option",{value:B.IN_PROGRESS,children:"Em Andamento"}),e.jsx("option",{value:B.COMPLETED,children:"Concluídos"})]}),e.jsx(ut,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]}),e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:l,onChange:N=>o(N.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Prioridade: Todas"}),e.jsx("option",{value:te.HIGH,children:"Alta"}),e.jsx("option",{value:te.MEDIUM,children:"Média"}),e.jsx("option",{value:te.LOW,children:"Baixa"})]}),e.jsx(ut,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]})]})]})]}),(t!=="all"||l!=="all"||m!=="30")&&e.jsxs("button",{onClick:()=>{s("all"),o("all"),r("30")},className:"ml-auto p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-slate-400 hover:text-red-500 rounded-xl transition-colors flex items-center gap-1 text-[10px] font-bold uppercase",title:"Limpar Filtros",children:[e.jsx(Ie,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden md:inline",children:"Limpar"})]})]}),Ts=Le.lazy(()=>na(()=>import("./PeopleManager-BdCezEYe.js"),__vite__mapDeps([0,1,2,3]))),$s=Le.lazy(()=>na(()=>import("./AdminScreen-2JVMuwkF.js"),__vite__mapDeps([4,1,2,3]))),Dt={administrador:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","admin_panel","map"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!0,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},chefe_de_gabinete:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},assessor:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!1,showPending:!0,showInProgress:!0,showCompleted:!1,showHighPriority:!0,showAnalytics:!1,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0}},Ps=Le.memo(({data:t,title:s})=>{const l=t.reduce((m,r)=>m+r.value,0);let o=0;return l===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados"}):e.jsxs("div",{className:"flex items-center gap-6 h-full justify-center",children:[e.jsxs("div",{className:"relative w-32 h-32 shrink-0",children:[e.jsx("svg",{viewBox:"0 0 100 100",className:"transform -rotate-90 w-full h-full",children:t.map((m,r)=>{const i=m.value/l,w=40,k=2*Math.PI*w,j=`${i*k} ${k}`;return o+=i*100,e.jsx("circle",{cx:"50",cy:"50",r:w,fill:"transparent",stroke:m.color,strokeWidth:"12",strokeDasharray:j,strokeDashoffset:-(o-i*100)/100*k,className:"transition-all duration-1000 ease-out"},r)})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-xl font-bold text-slate-800 dark:text-white",children:l}),e.jsx("span",{className:"text-[9px] uppercase font-bold text-slate-400",children:"Total"})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:t.map((m,r)=>e.jsxs("div",{className:"flex items-center justify-between text-xs gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:m.color}}),e.jsx("span",{className:"font-medium text-slate-600 dark:text-white/80",children:m.label})]}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white",children:[Math.round(m.value/l*100),"%"]})]},r))})]})}),Ls=Le.memo(({data:t,unit:s=""})=>{const l=Math.max(...t.map(o=>o.value),1);return t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados geográficos"}):e.jsx("div",{className:"h-full w-full flex items-end justify-between gap-2 px-2 pb-2 pt-4",children:t.slice(0,7).map((o,m)=>{const r=o.value/l*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1 group h-full justify-end",children:[e.jsxs("div",{className:"text-[10px] font-bold text-slate-600 dark:text-slate-300 mb-0.5",children:[o.value,s]}),e.jsx("div",{style:{height:`${r}%`},className:"w-full bg-brand-200 dark:bg-brand-500/30 rounded-t-sm group-hover:bg-brand-50 dark:group-hover:bg-brand-500 transition-colors min-h-[4px]"}),e.jsx("div",{className:"text-[9px] text-slate-400 truncate w-full text-center",title:o.label,children:o.label.slice(0,6)})]},m)})})}),da=()=>{const[t,s]=a.useState(()=>{if(typeof window<"u"){const d=localStorage.getItem("geo_user");return d?JSON.parse(d):null}return null}),[l,o]=a.useState("dashboard"),[m,r]=a.useState(!0),i=a.useRef(0),w=a.useRef(null),[k,j]=a.useState("list"),[N,H]=a.useState(()=>typeof window<"u"&&localStorage.getItem("geo_theme_pref")||"auto"),[x,f]=a.useState(!1),[v,P]=a.useState("all"),[$,E]=a.useState("all"),[u,A]=a.useState("30"),[q,W]=a.useState("demands"),[L,y]=a.useState("activity"),[D,O]=a.useState(Dt),[h,M]=a.useState({search:"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[],responsibleId:void 0}),[K,_]=a.useState(null),[g,U]=a.useState(null),[Q,I]=a.useState(null),[S,V]=a.useState(null),[ae,re]=a.useState("demands"),[J,ie]=a.useState(null),[ge,b]=a.useState("list"),[C,G]=a.useState(!1),{demands:se,setDemands:je,citizens:ce,users:Ue,interactions:tt,weatherLocations:be,setWeatherLocations:Ye,isOnline:Ge,isLoading:Se,themePreference:ke,fetchData:De,syncCount:Ee}=Is(t);a.useEffect(()=>{t&&t.firstLogin&&(localStorage.getItem("geo_onboarding_completed")||G(!0))},[t]),a.useEffect(()=>{ke&&H(ke)},[ke]);const Ae=a.useMemo(()=>{let d=null,p=null;h.startDate&&(d=new Date(h.startDate+"T00:00:00").getTime(),h.endDate?p=new Date(h.endDate+"T23:59:59.999").getTime():p=new Date(h.startDate+"T23:59:59.999").getTime());const Y=h.search.toLowerCase();return se.filter(X=>{if(h.search){const Z=X.id.toLowerCase().includes(Y),ee=X.title.toLowerCase().includes(Y),oe=X.description.toLowerCase().includes(Y);if(!Z&&!ee&&!oe)return!1}if(h.status.length>0&&!h.status.includes(X.status)||h.priority.length>0&&!h.priority.includes(X.priority)||h.level.length>0&&!h.level.includes(X.level)||h.responsibleId&&X.responsibleId!==h.responsibleId||h.tags&&h.tags.length>0&&(!X.tags||!h.tags.some(Z=>X.tags.includes(Z))))return!1;if(d!==null&&p!==null){let Z;if(h.dateType==="deadline"?Z=X.deadline:h.dateType==="updatedAt"?Z=X.updatedAt:Z=X.createdAt,!Z)return!1;let ee;if(/^\d{4}-\d{2}-\d{2}$/.test(Z)){const[oe,$e,kt]=Z.split("-").map(Number);ee=new Date(oe,$e-1,kt,12,0,0).getTime()}else ee=new Date(Z).getTime();if(ee<d||ee>p)return!1}return!0})},[se,h]),He=a.useMemo(()=>{const d=h.search.toLowerCase();return h.search?ce.filter(p=>{var oe,$e;const Y=p.id.toLowerCase()===d,X=p.name.toLowerCase().includes(d),Z=(oe=p.email)==null?void 0:oe.toLowerCase().includes(d),ee=($e=p.phone)==null?void 0:$e.includes(d);return Y||X||Z||ee}):ce},[ce,h.search]),Ke=a.useMemo(()=>{const d=[];return Ae.length>0&&Ae.forEach(p=>{p.lat&&p.lon&&d.push({id:p.id,type:"demand",lat:p.lat,lon:p.lon,title:p.title,status:p.status,priority:p.priority})}),He.length>0&&He.forEach(p=>{p.lat&&p.lon&&d.push({id:p.id,type:"citizen",lat:p.lat,lon:p.lon,name:p.name,bairro:p.bairro})}),d},[Ae,He]),c=a.useCallback((d,p,Y,X)=>{I(null),U(null),_(null),r(!0),M({search:X||"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[],responsibleId:void 0}),A("all"),V({lat:d,lon:p}),re(Y),o("map")},[]);a.useEffect(()=>{Ee>0&&R("success",`${Ee} itens sincronizados.`)},[Ee]),a.useEffect(()=>{r(!0),w.current&&w.current.scrollTo(0,0)},[l]);const z=d=>{const p=d.currentTarget.scrollTop;Math.abs(p-i.current)>5&&(p>i.current&&p>50?r(!1):r(!0),i.current=p)};a.useEffect(()=>{const d=()=>{let Y=!1;if(N==="dark")Y=!0;else if(N==="light")Y=!1;else{const X=new Date().getHours();Y=X<6||X>=18}f(Y),Y?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};d();const p=setInterval(d,6e4);return()=>clearInterval(p)},[N]);const R=a.useCallback((d,p)=>{ie({type:d,message:p}),setTimeout(()=>ie(null),4e3)},[]),ne=d=>{s(d),o("dashboard")},le=()=>{s(null),localStorage.removeItem("geo_user"),je([]),o("dashboard")},he=()=>{const d=x?"light":"dark";H(d),localStorage.setItem("geo_theme_pref",d)},me=d=>{U(d),o("people")},Te=d=>{U(null),_(null),I(null),V(null),re("demands"),M({search:"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[],responsibleId:void 0}),o(d)},Ne=async(d,p)=>{const Y=se.find(Z=>Z.id===d),X=Y==null?void 0:Y.status;if(!(!Y||X===p)&&(je(Z=>Z.map(ee=>ee.id===d?{...ee,status:p}:ee)),de()&&F))try{const{error:Z}=await F.from("demands").update({status:p}).eq("id",d);if(Z)throw Z;const ee=JSON.parse(localStorage.getItem("geo_user")||"{}"),{error:oe}=await F.from("demand_interactions").insert({demanda_id:d,tipo:"status_change",texto:`Status alterado de "${X}" para "${p}"`,usuario:ee.name||"Sistema",created_at:new Date().toISOString()});if(oe)throw oe;De(),R("success","Status atualizado com sucesso!")}catch(Z){console.error("Error updating status:",Z),R("error","Erro ao atualizar status: "+Z.message),je(ee=>ee.map(oe=>oe.id===d?{...oe,status:X}:oe))}},at=()=>{const d=new Date,p=new Date;if(u!=="all"){const Y=parseInt(u);Y===365?(p.setMonth(0,1),p.setHours(0,0,0,0)):p.setDate(d.getDate()-Y)}else p.setFullYear(1970);return p},ue=a.useMemo(()=>{const d=at();return se.filter(p=>{const X=new Date(p.createdAt)>=d,Z=v==="all"||p.status===v,ee=$==="all"||p.priority===$;return X&&Z&&ee})},[se,v,$,u]),n=a.useMemo(()=>{const d=at();return ce.filter(p=>p.createdAt?new Date(p.createdAt)>=d:!0)},[ce,u]),T=a.useMemo(()=>{if(q==="demands"){const d=ue.length;let p=0,Y=0,X=0;for(const Z of ue)Z.status===B.PENDING?p++:Z.status===B.COMPLETED&&Y++,Z.priority===te.HIGH&&X++;return{stat1:{label:"Filtradas",value:d,icon:Qt,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Pendentes",value:p,icon:Ce,color:"bg-slate-500",text:"text-slate-600 dark:text-slate-400"},stat3:{label:"Concluídos",value:Y,icon:Me,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat4:{label:"Alta Prioridade",value:X,icon:ft,color:"bg-red-500",text:"text-red-600 dark:text-red-400"}}}else{const d=ce.length,p=new Date().toDateString(),Y=ce.filter(ee=>ee.createdAt&&new Date(ee.createdAt).toDateString()===p).length,X={};for(const ee of ce)ee.bairro&&(X[ee.bairro]=(X[ee.bairro]||0)+1);const Z=Object.entries(X).sort((ee,oe)=>oe[1]-ee[1])[0];return{stat1:{label:"Total Cidadãos",value:d,icon:We,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Novos Hoje",value:Y,icon:Zt,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat3:{label:"Top Bairro",value:Z?Z[0]:"N/A",icon:ve,color:"bg-brand-500",text:"text-brand-600 dark:text-brand-400"},stat4:{label:"Cadastros (Bairro)",value:Z?Z[1]:0,icon:Mt,color:"bg-purple-500",text:"text-purple-600 dark:text-purple-400"}}}},[ue,n,ce,q]),xe=a.useMemo(()=>{if(q==="demands"){const d={[B.PENDING]:0,[B.IN_PROGRESS]:0,[B.COMPLETED]:0};return ue.forEach(p=>{d[p.status]!==void 0&&d[p.status]++}),[{label:"Pendente",value:d[B.PENDING],color:"#64748b"},{label:"Em Andamento",value:d[B.IN_PROGRESS],color:"#f59e0b"},{label:"Concluído",value:d[B.COMPLETED],color:"#10b981"}].filter(p=>p.value>0)}else{const d={};n.forEach(ee=>{const oe=ee.createdAt?new Date(ee.createdAt):new Date,$e=`${oe.getFullYear()}-${String(oe.getMonth()+1).padStart(2,"0")}`;d[$e]=(d[$e]||0)+1});const p=Object.keys(d).sort().reverse(),Y=["#0ea5e9","#6366f1","#8b5cf6","#ec4899","#64748b"],X=p.slice(0,4).map((ee,oe)=>{const[$e,kt]=ee.split("-"),Rt=new Date(parseInt($e),parseInt(kt)-1).toLocaleString("pt-BR",{month:"short",year:"2-digit"});return{label:Rt.charAt(0).toUpperCase()+Rt.slice(1),value:d[ee],color:Y[oe%Y.length]}}),Z=p.slice(4).reduce((ee,oe)=>ee+d[oe],0);return Z>0&&X.push({label:"Antigos",value:Z,color:"#94a3b8"}),X}},[ue,n,q]),fe=a.useMemo(()=>{const d={};return q==="demands"?ue.forEach(p=>{const Y=ce.find(X=>X.id===p.citizenId);Y&&Y.bairro&&(d[Y.bairro]=(d[Y.bairro]||0)+1)}):n.forEach(p=>{p.bairro&&(d[p.bairro]=(d[p.bairro]||0)+1)}),Object.entries(d).sort((p,Y)=>Y[1]-p[1]).slice(0,7).map(([p,Y])=>({label:p,value:Y}))},[ue,n,ce,q]),Be=a.useMemo(()=>[...ue].sort((d,p)=>new Date(p.createdAt).getTime()-new Date(d.createdAt).getTime()).slice(0,5),[ue]),st=a.useMemo(()=>[...n].sort((d,p)=>new Date(p.createdAt||0).getTime()-new Date(d.createdAt||0).getTime()).slice(0,5),[n]),pe=a.useMemo(()=>{const d=new Date;return d.setHours(0,0,0,0),ue.filter(p=>p.deadline&&p.status!==B.COMPLETED).map(p=>({...p,date:new Date(p.deadline)})).filter(p=>p.date>=d).sort((p,Y)=>p.date.getTime()-Y.date.getTime()).slice(0,5)},[ue]),qe=t?D[t.role]||Dt.assessor:Dt.administrador,ct=()=>e.jsxs("div",{className:"space-y-2",children:[" ",q==="demands"?Be.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(qa,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):Be.map(d=>e.jsxs("div",{onClick:()=>{t&&(I(d.id),o("demands"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[" ",e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-brand-50 dark:bg-brand-500/10 flex flex-col items-center justify-center text-brand-600 dark:text-brand-400 font-bold shrink-0 border border-brand-100 dark:border-brand-500/20",children:[" ",e.jsx("span",{className:"text-xs",children:new Date(d.createdAt).getDate()})," ",e.jsx("span",{className:"text-[8px] uppercase",children:new Date(d.createdAt).toLocaleString("default",{month:"short"}).slice(0,3)})," "]})," ",e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsxs("div",{className:"flex justify-between items-start",children:[" ",e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:d.title})," ",e.jsxs("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${d.status==="Concluído"?"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300":d.status==="Em Andamento"?"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300":"bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300"}`,children:[" ",d.status," "]})," "]})," ",e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:d.description})," "]})," "]},d.id)):st.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(We,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):st.map(d=>e.jsxs("div",{onClick:()=>{me(d.id)},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[" ",e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-blue-50 dark:bg-blue-500/10 flex flex-col items-center justify-center text-blue-600 dark:text-blue-400 font-bold shrink-0 border border-blue-100 dark:border-blue-500/20",children:[" ",e.jsx("span",{className:"text-xs",children:new Date(d.createdAt||Date.now()).getDate()})," ",e.jsx("span",{className:"text-[8px] uppercase",children:new Date(d.createdAt||Date.now()).toLocaleString("default",{month:"short"}).slice(0,3)})," "]})," ",e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsxs("div",{className:"flex justify-between items-start",children:[" ",e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:d.name})," ",e.jsxs("span",{className:"shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300",children:[" ",d.phone?ze(d.phone):"Sem Tel"," "]})," "]})," ",e.jsxs("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1 flex items-center gap-1",children:[" ",d.bairro&&e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-2.5 h-2.5"})," ",d.bairro]})," "]})," "]})," "]},d.id))," "]}),jt=()=>e.jsxs("div",{className:"space-y-2",children:[" ",q==="demands"?pe.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Me,{className:"w-6 h-6 mb-2 opacity-20"}),"Tudo em dia!"]}):pe.map(d=>{const p=Math.ceil((d.date.getTime()-new Date().getTime())/864e5);return e.jsxs("div",{onClick:()=>{t&&(I(d.id),o("demands"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[" ",e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-amber-50 dark:bg-amber-500/10 flex flex-col items-center justify-center text-amber-600 dark:text-amber-400 font-bold shrink-0 border border-amber-100 dark:border-amber-500/20",children:[" ",e.jsx("span",{className:"text-xs",children:d.date.getDate()})," ",e.jsx("span",{className:"text-[8px] uppercase",children:d.date.toLocaleString("default",{month:"short"}).slice(0,3)})," "]})," ",e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsxs("div",{className:"flex justify-between items-start",children:[" ",e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:d.title})," ",e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${p<=2?"bg-red-100 text-red-600 dark:bg-red-500/20":"bg-slate-100 text-slate-600 dark:bg-white/10"}`,children:p<0?"Exp.":`${p}d`})," "]})," ",e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:d.description})," "]})," "]},d.id)}):fe.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(ve,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):fe.slice(0,5).map((d,p)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5",children:[" ",e.jsxs("div",{className:"flex items-center gap-3",children:[" ",e.jsx("span",{className:"text-xs font-bold text-slate-400 w-4",children:p+1})," ",e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-white",children:d.label})," "]})," ",e.jsx("span",{className:"text-[10px] font-bold bg-purple-100 text-purple-600 dark:bg-purple-500/20 dark:text-purple-300 px-2 py-1 rounded-full",children:d.value})," "]},p))," "]});return e.jsxs("div",{className:`flex h-screen bg-slate-50 dark:bg-[#020617] transition-colors duration-500 overflow-hidden ${x?"dark":""}`,children:[!t&&e.jsx("div",{className:"absolute inset-0 z-[100]",children:e.jsx(ds,{onLogin:ne})}),C&&t&&e.jsx(Es,{onFinish:()=>G(!1)}),e.jsxs("div",{className:`dashboard-root flex h-full w-full transition-all duration-700 ease-in-out ${t?"filter-none scale-100 opacity-100":"blur-[5px] scale-[1.02] pointer-events-none grayscale-[0.2]"}`,children:[e.jsx(ts,{currentView:l==="fast-track"?"demands":l,setView:Te,user:t,onLogout:le,toggleTheme:he,isDarkMode:x,systemConfig:D,showMobileDock:m}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 transition-all duration-300 relative lg:my-4 lg:mr-4 lg:ml-4",children:[!Ge&&e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-[1000] bg-amber-500/90 backdrop-blur-sm text-white text-xs font-bold text-center py-1.5 flex items-center justify-center gap-2 lg:rounded-t-[2.5rem]",children:[e.jsx(Ha,{className:"w-3 h-3"})," Modo Offline. As alterações serão salvas localmente."]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden flex flex-col glass-container rounded-[2.5rem]",children:[J&&e.jsxs("div",{className:`fixed top-6 right-6 z-[1000] px-4 py-3 rounded-xl shadow-2xl border flex items-center gap-3 animate-in slide-in-from-right duration-300 ${J.type==="success"?"bg-green-500 text-white border-green-600":"bg-red-500 text-white border-red-600"}`,children:[J.type==="success"?e.jsx(Me,{className:"w-5 h-5"}):e.jsx(Yt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-sm",children:J.message})]}),e.jsxs(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(we,{className:"w-8 h-8 animate-spin text-brand-500"})}),children:[["dashboard","new-demand","edit-demand","admin_panel","demands","people","map"].includes(l)&&e.jsxs("div",{className:"absolute inset-0 overflow-y-auto custom-scrollbar p-4 lg:p-6 pb-32 lg:pb-6",onScroll:z,ref:w,children:[e.jsx("div",{className:"lg:hidden h-2 w-full"}),l==="dashboard"&&e.jsxs("div",{className:"flex flex-col gap-6 max-w-[1600px] mx-auto w-full",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 shrink-0",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold tracking-tight text-slate-900 dark:text-white",children:["Olá, ",t?t.name.split(" ")[0]:"Bem-vindo"]})}),e.jsx(Ss,{locations:be})]}),e.jsx(As,{status:v,setStatus:P,priority:$,setPriority:E,timeRange:u,setTimeRange:A,scope:q,setScope:W,className:"sticky top-0 z-30"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 shrink-0",children:[e.jsx(Oe,{isLoading:Se,title:T.stat1.label,value:typeof T.stat1.value=="string"?0:T.stat1.value,subValue:typeof T.stat1.value=="string"?T.stat1.value:void 0,icon:T.stat1.icon,colorClass:T.stat1.color,textClass:T.stat1.text}),e.jsx(Oe,{isLoading:Se,title:T.stat2.label,value:typeof T.stat2.value=="string"?0:T.stat2.value,subValue:typeof T.stat2.value=="string"?T.stat2.value:void 0,icon:T.stat2.icon,colorClass:T.stat2.color,textClass:T.stat2.text}),e.jsx(Oe,{isLoading:Se,title:T.stat3.label,value:typeof T.stat3.value=="string"?0:T.stat3.value,subValue:typeof T.stat3.value=="string"?T.stat3.value:void 0,icon:T.stat3.icon,colorClass:T.stat3.color,textClass:T.stat3.text}),e.jsx(Oe,{isLoading:Se,title:T.stat4.label,value:typeof T.stat4.value=="string"?0:T.stat4.value,subValue:typeof T.stat4.value=="string"?T.stat4.value:void 0,icon:T.stat4.icon,colorClass:T.stat4.color,textClass:T.stat4.text})]}),qe.dashboardWidgets.showAnalytics&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-auto shrink-0",children:[e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(Ba,{className:"w-3 h-3"})," ",q==="demands"?"Distribuição por Status":"Cadastros por Mês"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Ps,{data:xe,title:q==="demands"?"Demandas":"Cidadãos"})})]}),e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(ve,{className:"w-3 h-3"})," ",q==="demands"?"Top Bairros (Demandas)":"Top Bairros (Residentes)"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Ls,{data:fe})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 min-h-0",children:[e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${L!=="activity"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(Fe,{value:L,onChange:d=>y(d),options:[{value:"activity",label:"Atividade Recente",icon:mt},{value:"upcoming",label:"Próx. Prazos",icon:Ct}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(mt,{className:"w-4 h-4"})," Atividades Recentes"]}),e.jsxs("button",{onClick:()=>o(q==="demands"?"demands":"people"),className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(nt,{className:"w-3 h-3"})]})]}),ct()]}),e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${L!=="upcoming"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(Fe,{value:L,onChange:d=>y(d),options:[{value:"activity",label:"Atividade Recente",icon:mt},{value:"upcoming",label:"Próx. Prazos",icon:Ct}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Ct,{className:"w-4 h-4"})," ",q==="demands"?"Próximos Prazos":"Top Bairros"]}),e.jsxs("button",{onClick:()=>{q==="demands"?(b("calendar"),o("demands")):o("map")},className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(nt,{className:"w-3 h-3"})]})]}),jt()]})]})]}),l==="new-demand"&&e.jsx("div",{className:"max-w-[1600px] mx-auto w-full h-full",children:e.jsx(ls,{initialSearchTerm:g||void 0,onSuccess:d=>{De(),o("demands"),U(null)},onCancel:()=>{o("demands"),U(null)},onNotification:R})}),l==="edit-demand"&&K&&e.jsx("div",{className:"max-w-[1600px] mx-auto w-full h-full",children:e.jsx(ns,{demand:K,onSuccess:d=>{De(),o("demands"),_(null)},onCancel:()=>{o("demands"),_(null)},onNotification:R})}),l==="admin_panel"&&t&&e.jsx($s,{currentUser:t,systemConfig:D,onUpdateConfig:O,onUpdateLocation:Ye,onNotification:R,onLogout:le,toggleTheme:he,isDarkMode:x}),(l==="demands"||l==="map")&&e.jsx(Cs,{demands:Ae,citizens:ce,interactions:tt,users:Ue,onViewDemand:()=>{},onEditDemand:d=>{_(d),o("edit-demand")},onCreateDemand:()=>o("new-demand"),onUpdateStatus:Ne,onInteractionUpdate:De,filters:h,setFilters:M,onNotification:R,defaultLocation:be.length>0?be[0]:null,onViewCitizen:me,initialViewMode:l==="map"?"map":ge,mapMarkers:Ke,initialSelectionId:Q,clearSelection:()=>I(null),mapFocus:S,initialMapViewMode:ae,onMapFocus:c}),l==="people"&&e.jsx(Ts,{initialSearchTerm:g||void 0,onCreateDemand:d=>{U(d),o("new-demand")},onEditDemand:d=>{_(d),o("edit-demand")},onNotification:R,onPersonUpdate:De,permissions:qe,onModeChange:j,demands:se,onMapFocus:c})]}),l==="fast-track"&&e.jsx(Ds,{onBack:()=>o("demands"),onSuccess:d=>{U(d),o("new-demand")}})]})]})]})]})]})};console.log("Iniciando Gabinete Digital (Main)...");const Et=document.getElementById("root");if(!Et)console.error("ERRO CRÍTICO: Elemento 'root' não encontrado no HTML.");else try{gt.createRoot(Et).render(e.jsx(Le.StrictMode,{children:e.jsx(da,{})})),console.log("React montado com sucesso via src/main.tsx")}catch(t){console.error("Erro ao montar React:",t),Et.innerHTML='<div style="color:red; padding: 20px;">Erro ao carregar a aplicação. Verifique o console.</div>'}console.log("Iniciando Gabinete Digital...");const It=document.getElementById("root");if(!It)console.error("ERRO CRÍTICO: Elemento 'root' não encontrado no HTML.");else try{gt.createRoot(It).render(e.jsx(Le.StrictMode,{children:e.jsx(da,{})})),console.log("React montado com sucesso.")}catch(t){console.error("Erro ao montar React:",t),It.innerHTML='<div style="color:red; padding: 20px;">Erro ao carregar a aplicação. Verifique o console.</div>'}export{ys as C,xs as P,Oe as S,Vt as a,Ve as b,Fe as c,ze as f,rs as g,de as i,e as j,F as s};
