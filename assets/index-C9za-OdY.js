const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PeopleManager-BuCRwscc.js","assets/vendor-CC2eIyRy.js","assets/db-DxBk-dGO.js","assets/maps-BiYucuft.js","assets/AdminScreen-BNKRXR4B.js"])))=>i.map(i=>d[i]);
import{r as a,a as sa,R as Ae,H as ra,L as rt,U as He,M as Ft,b as la,P as na,d as oa,S as Nt,e as da,f as It,h as ia,i as mt,A as Ct,j as Xe,k as we,l as bt,m as Ce,F as St,X as Re,n as Ut,C as Se,o as it,p as ca,q as xa,s as dt,B as ha,t as Gt,u as ma,v as ba,w as et,x as Ht,y as ua,z as ut,D as je,Z as tt,E as Ge,G as Ke,I as at,J as Bt,K as pa,N as qt,O as ct,Q as ga,T as fa,V as wa,W as xt,Y as va,_ as Tt,$ as ja,a0 as yt,a1 as ka,a2 as Na,a3 as ya,a4 as Ca,a5 as Sa,a6 as At,a7 as Da,a8 as Ea,a9 as Ia,aa as Ta,ab as $t,ac as Pt,ad as Lt,ae as Vt,af as Aa,ag as $a,ah as Pa,ai as Wt,aj as La,ak as _a,al as ft,am as Ma}from"./vendor-CC2eIyRy.js";import{c as Oa}from"./db-DxBk-dGO.js";import{l as Oe,M as Jt,T as Yt,u as Dt,C as za,P as Kt,a as Qt}from"./maps-BiYucuft.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))d(x);new MutationObserver(x=>{for(const r of x)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&d(h)}).observe(document,{childList:!0,subtree:!0});function l(x){const r={};return x.integrity&&(r.integrity=x.integrity),x.referrerPolicy&&(r.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?r.credentials="include":x.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(x){if(x.ep)return;x.ep=!0;const r=l(x);fetch(x.href,r)}})();var Zt={exports:{}},pt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ra=a,Fa=Symbol.for("react.element"),Ua=Symbol.for("react.fragment"),Ga=Object.prototype.hasOwnProperty,Ha=Ra.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ba={key:!0,ref:!0,__self:!0,__source:!0};function Xt(t,s,l){var d,x={},r=null,h=null;l!==void 0&&(r=""+l),s.key!==void 0&&(r=""+s.key),s.ref!==void 0&&(h=s.ref);for(d in s)Ga.call(s,d)&&!Ba.hasOwnProperty(d)&&(x[d]=s[d]);if(t&&t.defaultProps)for(d in s=t.defaultProps,s)x[d]===void 0&&(x[d]=s[d]);return{$$typeof:Fa,type:t,key:r,ref:h,props:x,_owner:Ha.current}}pt.Fragment=Ua;pt.jsx=Xt;pt.jsxs=Xt;Zt.exports=pt;var e=Zt.exports,ht={},_t=sa;ht.createRoot=_t.createRoot,ht.hydrateRoot=_t.hydrateRoot;const qa="modulepreload",Va=function(t){return"/Gabinete-Digital/"+t},Mt={},ea=function(s,l,d){let x=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),N=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));x=Promise.allSettled(l.map(g=>{if(g=Va(g),g in Mt)return;Mt[g]=!0;const C=g.endsWith(".css"),y=C?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${y}`))return;const w=document.createElement("link");if(w.rel=C?"stylesheet":qa,C||(w.as="script"),w.crossOrigin="",w.href=g,N&&w.setAttribute("nonce",N),document.head.appendChild(w),C)return new Promise((c,k)=>{w.addEventListener("load",c),w.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${g}`)))})}))}function r(h){const N=new Event("vite:preloadError",{cancelable:!0});if(N.payload=h,window.dispatchEvent(N),!N.defaultPrevented)throw h}return x.then(h=>{for(const N of h||[])N.status==="rejected"&&r(N.reason);return s().catch(r)})},Wa=Ae.memo(({currentView:t,setView:s,user:l,onLogout:d,toggleTheme:x,isDarkMode:r,systemConfig:h,showMobileDock:N=!0})=>{const[g,C]=a.useState(!0),[y,w]=a.useState(!1),c=g||y,k=l&&h[l.role]?h[l.role]:{allowedViews:[]},A=[{id:"dashboard",label:"Home",icon:ra},{id:"demands",label:"Demandas",icon:rt},{id:"people",label:"Cidadãos",icon:He},{id:"map",label:"Mapa",icon:Ft}].filter(f=>k.allowedViews.includes(f.id)),H=f=>f.split("_").map($=>$.charAt(0).toUpperCase()+$.slice(1)).join(" "),I=f=>{s(f)};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`
          hidden lg:flex
          transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]
          flex-col will-change-transform group z-40 overflow-hidden
          static h-auto
          my-4 ml-4 mr-0
          rounded-[2.5rem] border border-white/60 dark:border-white/5
          bg-white/80 dark:bg-[#020617]/80 backdrop-blur-2xl
          shadow-xl shadow-slate-200/50 dark:shadow-black/20
          ${c?"w-72":"w-24"}
        `,onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),children:[e.jsxs("div",{className:`p-6 flex items-center ${c?"justify-between":"justify-center"} border-b border-slate-100 dark:border-white/5 h-28 shrink-0 relative`,children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden whitespace-nowrap",children:[e.jsx("div",{className:`w-12 h-12 min-w-[3rem] bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30 ring-1 ring-white/20 transition-transform duration-300 ${!c&&!g?"scale-110":""}`,children:e.jsx(la,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:`transition-all duration-300 origin-left ${c?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight text-slate-900 dark:text-white leading-none",children:"Gabinete"}),e.jsx("span",{className:"text-[10px] text-brand-600 dark:text-brand-400 font-bold tracking-[0.2em] uppercase",children:"Digital"})]})]}),e.jsx("button",{onClick:()=>C(!g),className:`
                flex absolute right-6 top-1/2 -translate-y-1/2 text-slate-400 dark:text-white/30 hover:text-brand-600 dark:hover:text-white transition-all duration-300
                ${c?"opacity-0 group-hover:opacity-100 delay-100":"opacity-0 pointer-events-none"}
            `,title:g?"Desafixar menu":"Fixar menu",children:g?e.jsx(na,{className:"w-4 h-4"}):e.jsx(oa,{className:"w-4 h-4"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-x-hidden overflow-y-auto custom-scrollbar flex flex-col",children:A.map(f=>{const $=f.icon,P=t===f.id;return e.jsxs("button",{onClick:()=>I(f.id),disabled:!l,className:`
                  w-full flex items-center gap-4 px-4 py-3.5 rounded-2xl text-sm font-bold transition-all duration-300 relative group/item
                  ${l?"":"opacity-30 cursor-not-allowed"}
                  ${P?"bg-brand-500/10 dark:bg-white/10 text-brand-700 dark:text-white shadow-sm ring-1 ring-brand-500/20 dark:ring-white/10":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white"}
                  ${c?"":"justify-center"}
                `,children:[e.jsx($,{className:`w-6 h-6 min-w-[1.5rem] transition-transform duration-300 ${P?"scale-110":"group-hover/item:scale-110"}`}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${c?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:f.label}),P&&c&&e.jsx("div",{className:"absolute right-4 w-1.5 h-1.5 rounded-full bg-brand-500 shadow-[0_0_8px_currentColor]"})]},f.id)})}),e.jsxs("div",{className:"p-4 border-t border-slate-100 dark:border-white/5 shrink-0 space-y-2",children:[e.jsxs("button",{onClick:x,className:`
                  lg:hidden w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5
                  ${c?"":"justify-center"}
                `,children:[r?e.jsx(Nt,{className:"w-5 h-5 min-w-[1.25rem] text-amber-400"}):e.jsx(da,{className:"w-5 h-5 min-w-[1.25rem] text-slate-600"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${c?"opacity-100":"opacity-0 w-0 hidden"}`,children:r?"Modo Claro":"Modo Escuro"})]}),l&&e.jsxs("button",{onClick:()=>I("admin_panel"),className:`
                  w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  ${t==="admin_panel"?"bg-slate-100 dark:bg-white/10 text-brand-700 dark:text-brand-300":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5"}
                  ${c?"":"justify-center"}
                `,children:[e.jsx(It,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${c?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Configurações"})]}),e.jsxs("button",{onClick:d,disabled:!l,className:`
                w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors
                ${c?"":"justify-center"}
                `,children:[e.jsx(ia,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${c?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Sair"})]}),e.jsxs("div",{className:`mt-2 flex items-center gap-3 p-2 rounded-2xl border transition-all duration-300 
                ${c?"bg-slate-50/50 dark:bg-white/5 border-slate-100 dark:border-white/5":"bg-transparent border-transparent justify-center"}
            `,children:[e.jsx("div",{className:"w-9 h-9 min-w-[2.25rem] rounded-full bg-slate-200 dark:bg-slate-800 flex items-center justify-center overflow-hidden border border-white dark:border-white/10 shadow-sm",children:l!=null&&l.avatar?e.jsx("img",{src:l.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(mt,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"})}),e.jsxs("div",{className:`flex-1 min-w-0 overflow-hidden transition-all duration-300 ${c?"opacity-100":"opacity-0 w-0 hidden"}`,children:[e.jsx("p",{className:"text-xs font-bold truncate text-slate-800 dark:text-white",children:l?l.name.split(" ")[0]:"..."}),e.jsx("p",{className:"text-[9px] text-brand-600 dark:text-brand-400 font-bold uppercase truncate tracking-wider",children:l?H(l.role):""})]})]})]})]}),e.jsx("nav",{className:`
            lg:hidden fixed bottom-0 left-0 right-0 z-[900] 
            bg-white/95 dark:bg-[#0f172a]/95 backdrop-blur-xl 
            border-t border-slate-200 dark:border-white/10 
            pb-safe-area shadow-[0_-4px_20px_rgba(0,0,0,0.05)]
            transition-transform duration-300 ease-in-out
            ${N?"translate-y-0":"translate-y-full"}
        `,children:e.jsxs("div",{className:"flex items-center justify-around h-[76px] px-2 pb-2",children:[A.map(f=>{const $=t===f.id,P=f.icon;return e.jsxs("button",{onClick:()=>I(f.id),className:`
                    flex flex-col items-center justify-center gap-1.5 w-full h-full transition-all duration-200 active:scale-95
                    ${$?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`
                    relative p-2 rounded-2xl transition-all duration-300
                    ${$?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}
                `,children:e.jsx(P,{className:`w-6 h-6 transition-all ${$?"stroke-[2.5px] scale-110":"stroke-2"}`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide transition-opacity ${$?"opacity-100":"opacity-60"}`,children:f.label})]},f.id)}),e.jsxs("button",{onClick:()=>I("admin_panel"),className:`
                flex flex-col items-center justify-center gap-1.5 w-full h-full transition-all duration-200 active:scale-95
                ${t==="admin_panel"?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`relative p-2 rounded-2xl transition-all duration-300 ${t==="admin_panel"?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}`,children:e.jsx(It,{className:`w-6 h-6 ${t==="admin_panel"?"stroke-[2.5px]":"stroke-2"}`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide ${t==="admin_panel"?"opacity-100":"opacity-60"}`,children:"Configurações"})]})]})})]})});var Be=(t=>(t.MUNICIPAL="Municipal",t.ESTADUAL="Estadual",t.FEDERAL="Federal",t))(Be||{}),G=(t=>(t.PENDING="Pendente",t.IN_PROGRESS="Em Andamento",t.COMPLETED="Concluído",t))(G||{}),Z=(t=>(t.LOW="Baixa",t.MEDIUM="Média",t.HIGH="Alta",t))(Z||{}),st=(t=>(t.SOLICITACAO="Solicitação",t.RECLAMACAO="Reclamação",t.ELOGIO="Elogio",t.DENUNCIA="Denúncia",t.SUGESTAO="Sugestão",t))(st||{});const Ja="yioefhebxsohutdypxqd",Ot=`https://${Ja}.supabase.co`,zt="sb_publishable_ltKmfB3EreWKb757l0c6mw__0FBPSeR",z=Ot&&zt?Oa(Ot,zt):null,re=()=>!!z,qe=t=>{const s=t.replace(/\D/g,"");return s.length>11?t.slice(0,15):s.length>10?s.replace(/^(\d\d)(\d{5})(\d{4}).*/,"($1) $2-$3"):s.length>5?s.replace(/^(\d\d)(\d{4})(\d{0,4}).*/,"($1) $2-$3"):s.length>2?s.replace(/^(\d\d)(\d{0,5})/,"($1) $2"):s},Ye=t=>t.replace(/\D/g,""),Ya=t=>{if(!t)return new Date;if(t.length===10&&t.includes("-")){const[s,l,d]=t.split("-").map(Number);return new Date(s,l-1,d)}return new Date(t)},Ze=t=>t?Ya(t).toLocaleDateString("pt-BR"):"",Ka=({initialSearchTerm:t,onSuccess:s,onCancel:l,onNotification:d})=>{const[x,r]=a.useState(""),[h,N]=a.useState([]),[g,C]=a.useState(!1),[y,w]=a.useState(!1),[c,k]=a.useState(null),[T,A]=a.useState(!1),H=a.useRef(null),[I,f]=a.useState(""),[$,P]=a.useState(""),[V,F]=a.useState(""),[D,O]=a.useState(""),[_,u]=a.useState(""),[M,j]=a.useState(!1),[n,S]=a.useState(""),[U,te]=a.useState(""),[L,ae]=a.useState(""),[me,ie]=a.useState(""),[K,le]=a.useState(""),[ce,p]=a.useState(""),[v,E]=a.useState(""),[X,se]=a.useState(Be.MUNICIPAL),[ue,$e]=a.useState(G.PENDING),[be,ke]=a.useState(Z.MEDIUM),[Fe,Pe]=a.useState(st.SOLICITACAO),[Ne,Le]=a.useState(""),[pe,_e]=a.useState([]),[Ee,b]=a.useState(""),[R,W]=a.useState(!1),[ne,oe]=a.useState(!1);a.useEffect(()=>{const o=new Date;o.setDate(o.getDate()+7),Le(o.toISOString().split("T")[0]),t&&(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)?De(t):(r(t),ge(t)))},[]),a.useEffect(()=>{const o=ee=>{H.current&&!H.current.contains(ee.target)&&C(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const xe=o=>({id:o.id||"temp-id",cpf:o.cpf,name:`${o.nome} ${o.sobrenome}`,email:o.email||"",phone:o.telefone||"",logradouro:o.logradouro,numero:o.numero,complemento:o.complemento||void 0,bairro:o.bairro,cep:o.cep,cidade:o.cidade,estado:o.estado}),ye=o=>{o.cep&&u(o.cep),o.logradouro&&S(o.logradouro),o.numero&&te(o.numero),o.bairro&&ae(o.bairro),o.cidade&&ie(o.cidade),o.estado&&le(o.estado)},De=async o=>{if(re()&&z){const{data:ee}=await z.from("citizens").select("*").eq("id",o).maybeSingle();if(ee){const de=xe(ee);k(de),r(de.name),ye(de),A(!1)}}},ge=async o=>{if(!(!o||o.length<2)){w(!0),C(!0),N([]);try{if(re()&&z){const ee=Ye(o);let de=z.from("citizens").select("*").limit(10);ee.length>3?de=de.or(`telefone.ilike.%${ee}%,nome.ilike.%${o}%,sobrenome.ilike.%${o}%`):de=de.or(`nome.ilike.%${o}%,sobrenome.ilike.%${o}%`);const{data:Me}=await de;Me&&N(Me.map(ve=>xe(ve)))}}catch(ee){console.error(ee)}finally{w(!1)}}},fe=o=>{k(o),r(o.name),C(!1),A(!1),ye(o)},Ie=()=>{k(null),A(!0),C(!1);const o=Ye(x);if(o.length>=8)F(o);else{const ee=x.split(" ");ee.length>0&&f(ee[0]),ee.length>1&&P(ee.slice(1).join(" "))}},Q=async()=>{const o=_.replace(/\D/g,"");if(o.length===8){j(!0);try{const de=await(await fetch(`https://viacep.com.br/ws/${o}/json/`)).json();de.erro||(S(de.logradouro),ae(de.bairro),ie(de.localidade),le(de.uf))}catch(ee){console.error(ee)}finally{j(!1)}}},lt=async o=>{if(o.preventDefault(),!ce||!v){d&&d("error","Preencha título e descrição.");return}if(T&&!c){if(!I){d&&d("error","Nome é obrigatório.");return}if(!V){d&&d("error","Telefone é obrigatório.");return}}oe(!0);try{let ee=c==null?void 0:c.id;if(T&&!ee){const ve=Ye(V);if(!navigator.onLine)ee=crypto.randomUUID();else if(re()&&z){const{data:Ue}=await z.from("citizens").select("id").eq("telefone",ve).maybeSingle();if(Ue)ee=Ue.id;else{const{data:i,error:m}=await z.from("citizens").insert({nome:I,sobrenome:$||".",telefone:ve,email:D||null,cep:_||null,logradouro:n||null,numero:U||null,bairro:L||null,cidade:me||null,estado:K||null}).select().single();if(m)throw m;ee=i.id}}}const de=crypto.randomUUID(),Me={id:de,title:ce,description:v,level:X,status:ue,priority:be,type:Fe,deadline:Ne||null,citizen_id:ee,tags:pe,created_at:new Date().toISOString()};if(navigator.onLine){if(re()&&z){const{error:ve}=await z.from("demands").insert(Me);if(ve)throw ve;d&&d("success","Demanda criada com sucesso!")}}else{const ve=localStorage.getItem("offline_demands_queue"),Ue=ve?JSON.parse(ve):[];Ue.push(Me),localStorage.setItem("offline_demands_queue",JSON.stringify(Ue)),d&&d("success","Salvo Offline! Será sincronizado quando online.")}setTimeout(()=>s(de),1e3)}catch(ee){d&&d("error",`Erro: ${ee.message}`),oe(!1)}},We=()=>{Ee.trim()&&!pe.includes(Ee.trim())&&(_e([...pe,Ee.trim()]),b(""),W(!1))};return e.jsxs("div",{className:"h-full flex flex-col relative animate-in fade-in slide-in-from-right duration-500 pb-20",children:[e.jsx("div",{className:"shrink-0 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:l,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:e.jsx(Ct,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-2",children:"Nova Demanda"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50 font-medium",children:"Preencha os dados da solicitação."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar pb-6 -mr-2 pr-2",children:e.jsx("div",{className:"max-w-none mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 items-start",children:[e.jsxs("div",{className:"lg:col-span-7 space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-visible z-20",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[e.jsx(mt,{className:"w-4 h-4"})," Solicitante"]})}),e.jsxs("div",{className:"relative",ref:H,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:x,onChange:o=>r(o.target.value),onKeyDown:o=>o.key==="Enter"&&ge(x),placeholder:"Buscar por Nome ou Telefone (Enter)",className:`w-full pl-10 pr-10 py-3 glass-input border rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium transition-all ${T?"border-blue-300 dark:border-blue-500/50":"border-slate-300 dark:border-white/10"}`,autoComplete:"off"}),e.jsx(Xe,{className:"w-5 h-5 text-slate-400 absolute left-3 top-3.5"}),y&&e.jsx(we,{className:"absolute right-3 top-3.5 w-5 h-5 text-brand-500 animate-spin"})]}),g&&!c&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden max-h-60 overflow-y-auto z-50",children:h.length>0?h.map(o=>e.jsxs("button",{onClick:()=>fe(o),className:"w-full text-left p-3 hover:bg-slate-50 dark:hover:bg-white/5 border-b border-slate-100 dark:border-white/5 flex flex-col",children:[e.jsx("span",{className:"font-bold text-slate-800 dark:text-white text-sm",children:o.name}),e.jsxs("div",{className:"flex gap-2 text-xs text-slate-500",children:[o.phone&&e.jsx("span",{children:qe(o.phone)}),o.bairro&&e.jsxs("span",{children:["• ",o.bairro]})]})]},o.id)):!y&&x.length>2&&e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Nenhum resultado."}),e.jsx("button",{onClick:Ie,className:"text-sm font-bold text-brand-600 hover:underline",children:"Cadastrar Novo"})]})})]}),c&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-slate-50 dark:bg-white/5 p-4 rounded-2xl border border-slate-100 dark:border-white/5 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white dark:bg-slate-800 rounded-full border border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 font-bold text-brand-600",children:c.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-slate-900 dark:text-white",children:c.name}),e.jsx("p",{className:"text-xs text-slate-500",children:qe(c.phone)})]})]}),e.jsx("button",{onClick:()=>{k(null),r("")},className:"text-xs text-red-500 hover:underline",children:"Trocar"})]}),T&&!c&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl border border-blue-100 dark:border-blue-500/20 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300 text-xs font-bold uppercase",children:[e.jsx(bt,{className:"w-4 h-4"})," Novo Cadastro"]}),e.jsx("button",{onClick:()=>A(!1),className:"text-xs text-slate-400 hover:text-slate-600",children:"Cancelar"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Nome",value:I,onChange:o=>f(o.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"text",placeholder:"Sobrenome",value:$,onChange:o=>P(o.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"}),e.jsx("input",{type:"tel",placeholder:"Telefone (Só números)",value:V,onChange:o=>F(Ye(o.target.value)),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"email",placeholder:"Email (Opcional)",value:D,onChange:o=>O(o.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx(Ce,{className:"w-4 h-4"})," Endereço da Ocorrência"]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"CEP"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:_,onChange:o=>u(o.target.value),onBlur:Q,className:"w-full pl-9 pr-8 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm",placeholder:"00000-000"}),e.jsx(Xe,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400"}),M&&e.jsx(we,{className:"absolute right-3 top-3 w-4 h-4 text-brand-500 animate-spin"})]})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Cidade"}),e.jsx("input",{type:"text",value:me,onChange:o=>ie(o.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-9",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Logradouro"}),e.jsx("input",{type:"text",value:n,onChange:o=>S(o.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-3",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Número"}),e.jsx("input",{type:"text",value:U,onChange:o=>te(o.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Bairro"}),e.jsx("input",{type:"text",value:L,onChange:o=>ae(o.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"UF"}),e.jsx("input",{type:"text",value:K,onChange:o=>le(o.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm uppercase",maxLength:2})]})]})]})]}),e.jsx("div",{className:"lg:col-span-5 space-y-6",children:e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx(St,{className:"w-4 h-4"})," Detalhes da Solicitação"]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:Fe,onChange:o=>Pe(o.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(st).map(o=>e.jsx("option",{value:o,children:o},o))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título"}),e.jsx("input",{type:"text",value:ce,onChange:o=>p(o.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base font-bold text-slate-900 dark:text-white",placeholder:"Ex: Buraco na via"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição"}),e.jsx("textarea",{value:v,onChange:o=>E(o.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none",placeholder:"Descreva a situação em detalhes..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Etiquetas (Tags)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:pe.map(o=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1",children:[o,e.jsx(Re,{onClick:()=>_e(pe.filter(ee=>ee!==o)),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500"})]},o))}),R?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text",value:Ee,onChange:o=>b(o.target.value),className:"flex-1 px-3 py-2 rounded-xl border border-slate-300 dark:border-white/10 glass-input text-sm",placeholder:"Nova tag...",onKeyDown:o=>{o.key==="Enter"&&We()}}),e.jsx("button",{type:"button",onClick:We,className:"px-3 py-2 bg-brand-600 text-white rounded-xl text-xs font-bold",children:"Add"})]}):e.jsxs("button",{type:"button",onClick:()=>W(!0),className:"text-xs text-brand-600 font-bold flex items-center gap-1 hover:underline",children:[e.jsx(Ut,{className:"w-3 h-3"})," Adicionar Tag"]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Inicial"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:ue,onChange:o=>$e(o.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(G).map(o=>e.jsx("option",{value:o,children:o},o))})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:X,onChange:o=>se(o.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(Be).map(o=>e.jsx("option",{value:o,children:o},o))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:Ne,onChange:o=>Le(o.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"}),e.jsx(Se,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.values(Z).map(o=>e.jsxs("label",{className:`flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition-all ${be===o?o==="Alta"?"text-red-600 bg-red-100":o==="Média"?"text-amber-600 bg-amber-100":"text-green-600 bg-green-100":"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[e.jsx("input",{type:"radio",name:"priority",value:o,checked:be===o,onChange:()=>ke(o),className:"hidden"}),e.jsx("span",{className:"font-bold text-sm uppercase",children:o})]},o))})]})]})]})]})})]})})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-[60] flex gap-3 md:hidden",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:lt,disabled:ne,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[ne?e.jsx(we,{className:"w-5 h-5 animate-spin"}):navigator.onLine?e.jsx(it,{className:"w-5 h-5"}):e.jsx(ca,{className:"w-5 h-5"}),ne?"Salvando...":navigator.onLine?"Criar":"Salvar Offline"]})]}),e.jsxs("div",{className:"hidden md:flex fixed bottom-6 right-6 z-50 gap-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-3 rounded-xl font-bold text-slate-500 bg-white shadow-lg border border-slate-200 hover:bg-slate-50 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:lt,disabled:ne,className:"px-8 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-xl flex items-center gap-2 disabled:opacity-70 transition-all",children:[ne?e.jsx(we,{className:"w-5 h-5 animate-spin"}):e.jsx(it,{className:"w-5 h-5"}),ne?"Salvando...":"Criar Demanda"]})]})]})},Qa=({demand:t,onSuccess:s,onCancel:l,onNotification:d})=>{const[x,r]=a.useState(t.title),[h,N]=a.useState(t.description),[g,C]=a.useState(t.level),[y,w]=a.useState(t.status),[c,k]=a.useState(t.priority),[T,A]=a.useState(t.type||st.SOLICITACAO),[H,I]=a.useState(t.deadline?t.deadline.split("T")[0]:""),[f,$]=a.useState(null),[P,V]=a.useState(!1),[F,D]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!(!t.citizenId||!re()||!z)){V(!0);try{const{data:M,error:j}=await z.from("citizens").select("*").eq("id",t.citizenId).maybeSingle();if(M)$(M);else{const{data:n}=await z.from("citizens").select("*").eq("cpf",t.citizenId).maybeSingle();n&&$(n)}}catch(M){console.error("Error fetching citizen details:",M.message||M)}finally{V(!1)}}})()},[t.citizenId]);const O=async u=>{u.preventDefault(),D(!0);try{if(!re()||!z)throw new Error("Supabase não configurado.");const{error:M}=await z.from("demands").update({title:x,description:h,level:g,status:y,priority:c,type:T,deadline:H||null}).eq("id",t.id);if(M)throw M;d&&d("success","Alterações salvas com sucesso!"),setTimeout(()=>s(t.id),1e3)}catch(M){d&&d("error",M.message||"Erro ao atualizar demanda."),D(!1)}},_=u=>{switch(u){case Z.HIGH:return"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-500/10 border-red-200 dark:border-red-500/20";case Z.MEDIUM:return"text-amber-600 dark:text-amber-400 bg-amber-100 dark:bg-amber-500/10 border-amber-200 dark:border-amber-500/20";case Z.LOW:return"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-500/10 border-green-200 dark:border-green-500/20"}};return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 md:pb-0 animate-in fade-in slide-in-from-right duration-500 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-slate-50/95 dark:bg-[#020617]/95 backdrop-blur-sm z-20 py-2 md:static md:bg-transparent md:py-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:l,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:[" ",e.jsx(Ct,{className:"w-6 h-6"})," "]}),e.jsxs("div",{children:[" ",e.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white tracking-tight flex flex-col md:flex-row md:items-center gap-1 md:gap-2",children:[" Edição de Demanda ",e.jsxs("span",{className:"text-xs md:text-sm font-normal text-slate-400 dark:text-white/40 border border-slate-200 dark:border-white/10 px-2 py-0.5 rounded-md font-mono w-fit",children:["#",t.id.slice(0,8)]})," "]})," "]})]}),e.jsxs("div",{className:"hidden md:flex gap-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 dark:text-white/60 hover:bg-slate-100 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white transition-colors border border-transparent",children:" Cancelar "}),e.jsxs("button",{onClick:O,disabled:F,className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-[0_0_20px_rgba(14,165,233,0.3)] transition-all flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[" ",F?e.jsx(we,{className:"w-5 h-5 animate-spin"}):e.jsx(it,{className:"w-5 h-5"})," ",F?"Salvando...":"Salvar Alterações"," "]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-500 via-blue-500 to-brand-500"}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[" ",e.jsx(mt,{className:"w-4 h-4"})," Solicitante Vinculado "]}),P?e.jsxs("div",{className:"flex items-center gap-4 animate-pulse",children:[" ",e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-200 dark:bg-white/10 rounded-full"})," ",e.jsxs("div",{className:"space-y-2 flex-1",children:[" ",e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-white/10 rounded w-1/3"})," ",e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-white/10 rounded w-1/4"})," "]})," "]}):f?e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 md:gap-6",children:[" ",e.jsxs("div",{className:"flex items-center gap-4 md:gap-5",children:[" ",e.jsxs("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-100 dark:bg-slate-900 rounded-full border-2 border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 shadow-inner",children:[" ",e.jsx("span",{className:"text-xl md:text-2xl font-bold text-brand-600 dark:text-brand-400",children:f.nome.charAt(0)})," "]})," ",e.jsxs("div",{children:[" ",e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-slate-900 dark:text-white",children:[f.nome," ",f.sobrenome]})," ",f.telefone&&e.jsxs("p",{className:"text-slate-500 dark:text-white/50 font-mono text-xs md:text-sm mt-1 flex items-center gap-2",children:[" ",e.jsx(xa,{className:"w-3 h-3"})," ",qe(f.telefone)," "]})," "]})," "]})," ",e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 text-xs md:text-sm",children:[" ",e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-white/80 bg-slate-50 dark:bg-white/5 px-3 py-1.5 rounded-lg border border-slate-200 dark:border-white/5",children:[" ",e.jsx(Ce,{className:"w-4 h-4 text-brand-500"})," ",f.cidade," - ",f.estado," "]})," "]})," "]}):e.jsx("div",{className:"text-slate-500 dark:text-white/50 italic text-sm",children:"Cidadão não encontrado."})]}),e.jsxs("div",{className:"glass-panel p-4 md:p-8 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx(St,{className:"w-4 h-4"})," Detalhes da Solicitação "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:T,onChange:u=>A(u.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(st).map(u=>e.jsx("option",{value:u,children:u},u))," "]})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título da Ocorrência"})," ",e.jsx("input",{type:"text",value:x,onChange:u=>r(u.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base md:text-lg font-bold text-slate-900 dark:text-white"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição Detalhada"})," ",e.jsx("textarea",{value:h,onChange:u=>N(u.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none"})," "]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/5",children:[" ",e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/40 uppercase mb-2",children:"Localização Registrada"})," ",e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-white",children:[" ",e.jsx(Ce,{className:"w-5 h-5 text-red-500 shrink-0"})," ",e.jsxs("span",{className:"font-medium text-sm",children:[" ",f==null?void 0:f.logradouro,", ",f==null?void 0:f.numero," - ",f==null?void 0:f.bairro,", ",f==null?void 0:f.cidade,"/",f==null?void 0:f.estado," "]})," "]})," "]})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 lg:sticky lg:top-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx(dt,{className:"w-4 h-4"})," Controle de Gestão "]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Atual"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:y,onChange:u=>w(u.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(G).map(u=>e.jsx("option",{value:u,children:u},u))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"})," ",e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[" ",Object.values(Z).map(u=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${c===u?_(u):"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[" ",e.jsx("input",{type:"radio",name:"priority",value:u,checked:c===u,onChange:()=>k(u),className:"accent-current"})," ",e.jsx("span",{className:"font-bold text-sm uppercase",children:u})," "]},u))," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível de Governo"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:g,onChange:u=>C(u.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(Be).map(u=>e.jsx("option",{value:u,children:u},u))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo Limite"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsx("input",{type:"date",value:H,onChange:u=>I(u.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"})," ",e.jsx(Se,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})," "]})," "]})]})]})})]}),e.jsxs("div",{className:"md:hidden fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-30 flex gap-3 pb-6",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:" Cancelar "}),e.jsxs("button",{onClick:O,disabled:F,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[" ",F?e.jsx(we,{className:"w-5 h-5 animate-spin"}):e.jsx(it,{className:"w-5 h-5"})," ",F?"Salvando...":"Salvar"," "]})]})]})},Za=()=>e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none select-none p-4 lg:p-8 flex gap-6 bg-slate-100 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"hidden lg:flex w-72 h-full flex-col gap-8 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-8 opacity-40 blur-[2px] shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-5 w-32 bg-slate-200 dark:bg-white/10 rounded-lg"})]}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-12 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"},t))}),e.jsx("div",{className:"mt-auto h-14 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6 opacity-30 lg:opacity-50 blur-[3px] lg:blur-[1px]",children:[e.jsxs("div",{className:"h-24 w-full bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 flex items-center justify-between px-10 shadow-sm",children:[e.jsx("div",{className:"h-8 w-64 bg-slate-200 dark:bg-white/10 rounded-xl"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"})]})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"h-40 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-6 flex flex-col justify-between shadow-sm",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-100 dark:bg-white/5"}),e.jsx("div",{className:"h-5 w-24 bg-slate-200 dark:bg-white/10 rounded-lg"})]},t))}),e.jsx("div",{className:"flex-1 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-10 flex items-end justify-between gap-6 shadow-sm",children:[40,70,50,90,60,80,50,75,45,65,85,55,70,40,60].map((t,s)=>e.jsx("div",{className:"w-full bg-slate-200 dark:bg-white/5 rounded-t-xl",style:{height:`${t}%`}},s))})]})]}),Xa=({onLogin:t})=>{const[s,l]=a.useState("login"),[d,x]=a.useState(!1),[r,h]=a.useState(!1),[N,g]=a.useState(""),[C,y]=a.useState(""),[w,c]=a.useState(""),[k,T]=a.useState(""),[A,H]=a.useState(null),[I,f]=a.useState(!1),[$,P]=a.useState(null);a.useEffect(()=>{h(!0)},[]);const V=a.useMemo(()=>async j=>{const n=new TextEncoder().encode(j),S=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(S)).map(te=>te.toString(16).padStart(2,"0")).join("")},[]),F=a.useMemo(()=>{const j=w;return{length:j.length>=8&&j.length<=12,hasUpper:/[A-Z]/.test(j),isAlphanumeric:/[a-zA-Z]/.test(j)&&/[0-9]/.test(j),match:j===k&&j.length>0}},[w,k]),D=Object.values(F).every(Boolean),O=async j=>{j.preventDefault(),f(!0),P(null);try{if(re()&&z){const n=await V(C),{data:S,error:U}=await z.from("system_users").select("*").eq("email",N).maybeSingle();if(U)throw U;if(!S||S.senha_hash!==n){P("Credenciais inválidas."),f(!1);return}if(!S.ativo){P("Conta desativada."),f(!1);return}if(!S.last_login){H(S),l("new_password"),f(!1);return}await u(S)}else await new Promise(n=>setTimeout(n,800)),N==="admin@admin"&&C==="admin"?await u({id:"demo-admin",email:"admin@admin",name:"Administrador Demo",role:"administrador",avatar:"https://ui-avatars.com/api/?name=Admin&background=0284c7&color=fff"},!0):(P("Credenciais inválidas."),f(!1))}catch{P("Erro ao processar login."),f(!1)}},_=async j=>{if(j.preventDefault(),!(!D||!A)){if(f(!0),P(null),w==="Senha4321"){P("A nova senha não pode ser igual à senha padrão."),f(!1);return}try{if(re()&&z){const n=await V(w),{error:S}=await z.from("system_users").update({senha_hash:n,last_login:new Date().toISOString()}).eq("id",A.id);if(S)throw S;const U={...A,last_login:new Date().toISOString()};await u(U)}}catch(n){P("Erro ao salvar nova senha: "+n.message),f(!1)}}},u=async(j,n=!1)=>{!n&&re()&&z&&s==="login"&&await z.from("system_users").update({last_login:new Date().toISOString()}).eq("id",j.id);const S=n?j:{id:j.id,email:j.email,name:j.nome,role:j.perfil,avatar:`https://ui-avatars.com/api/?name=${j.nome}&background=0284c7&color=fff`};x(!0),setTimeout(()=>{localStorage.setItem("geo_user",JSON.stringify(S)),t(S)},400)},M=({fulfilled:j,label:n})=>e.jsxs("div",{className:`flex items-center gap-2 text-xs transition-colors duration-200 ${j?"text-emerald-600 font-bold":"text-slate-400"}`,children:[e.jsx("div",{className:`w-3.5 h-3.5 rounded-full flex items-center justify-center border ${j?"bg-emerald-500 border-emerald-500 text-white":"border-slate-300 bg-transparent"}`,children:j&&e.jsx(ut,{className:"w-2.5 h-2.5"})}),e.jsx("span",{children:n})]});return e.jsxs("div",{className:`fixed inset-0 z-[100] bg-slate-50 dark:bg-[#020617] transition-all duration-700 overflow-hidden ${d?"opacity-0 scale-105 pointer-events-none":"opacity-100"}`,children:[e.jsx(Za,{}),e.jsx("div",{className:"absolute inset-0 bg-white/40 dark:bg-black/60 backdrop-blur-[4px] z-10 transition-colors duration-700"}),e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col lg:flex-row w-full h-full",children:[e.jsx("div",{className:"w-full lg:w-1/2 h-full flex items-center justify-center p-6 relative",children:e.jsxs("div",{className:`
                  w-full max-w-[440px]
                  bg-white/80 dark:bg-[#0f172a]/70 backdrop-blur-2xl 
                  border border-white/50 dark:border-white/10 
                  shadow-[0_8px_40px_-12px_rgba(0,0,0,0.1)] dark:shadow-black/50
                  rounded-[2.5rem] p-8 md:p-12
                  transform transition-all duration-700 ease-out flex flex-col
                  ${r?"translate-y-0 opacity-100 scale-100":"translate-y-12 opacity-0 scale-95"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-4 mb-10",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-600 to-brand-700 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-600/20 text-white ring-4 ring-white/50 dark:ring-white/5",children:e.jsx(ha,{className:"w-7 h-7"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-extrabold text-slate-900 dark:text-white tracking-tight leading-none",children:["Gabinete",e.jsx("br",{}),"Digital"]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:s==="login"?"Acesso ao Painel":"Configuração Inicial"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1 font-medium",children:s==="login"?"Gerencie seu mandato com eficiência.":"Defina sua senha de segurança."})]}),$&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-500/20 text-red-600 dark:text-red-300 text-sm font-bold rounded-2xl flex items-center gap-3 animate-in slide-in-from-left-2 shadow-sm",children:[e.jsx(bt,{className:"w-5 h-5 flex-shrink-0"}),$]}),s==="login"?e.jsxs("form",{onSubmit:O,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(Gt,{className:"w-5 h-5"})}),e.jsx("input",{type:"email",value:N,onChange:j=>g(j.target.value),className:"block w-full pl-11 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Email",required:!0,autoComplete:"email"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(ma,{className:"w-5 h-5"})}),e.jsx("input",{type:"password",value:C,onChange:j=>y(j.target.value),className:"block w-full pl-11 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Senha",required:!0,autoComplete:"current-password"})]})]}),e.jsxs("button",{type:"submit",disabled:I,className:"w-full py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-base transition-all transform active:scale-[0.98] shadow-lg shadow-brand-600/20 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed group relative overflow-hidden",children:[I?e.jsx(we,{className:"w-5 h-5 animate-spin"}):e.jsx(ba,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"}),I?"Conectando...":"Entrar"]})]}):e.jsxs("form",{onSubmit:_,className:"space-y-6 animate-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"password",value:w,onChange:j=>c(j.target.value),className:"block w-full pl-5 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Nova Senha",maxLength:12,autoComplete:"new-password"})}),e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"password",value:k,onChange:j=>T(j.target.value),className:"block w-full pl-5 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Confirmar Senha",maxLength:12,autoComplete:"new-password"})})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-2xl border border-slate-100 dark:border-white/5 grid grid-cols-2 gap-3",children:[e.jsx(M,{fulfilled:F.length,label:"8-12 dígitos"}),e.jsx(M,{fulfilled:F.isAlphanumeric,label:"Letras/Números"}),e.jsx(M,{fulfilled:F.hasUpper,label:"Maiúscula"}),e.jsx(M,{fulfilled:F.match,label:"Senhas Iguais"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{l("login"),c(""),T(""),H(null)},className:"flex-1 py-4 bg-white dark:bg-white/5 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-white/10 rounded-2xl font-bold text-sm border border-slate-200 dark:border-white/10 transition-colors",children:"Voltar"}),e.jsxs("button",{type:"submit",disabled:I||!D,className:"flex-[2] py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 disabled:opacity-50 transition-all",children:[I?e.jsx(we,{className:"w-5 h-5 animate-spin"}):e.jsx(et,{className:"w-5 h-5"})," Confirmar"]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-200/50 dark:border-white/5 text-center",children:e.jsxs("p",{className:"text-[10px] uppercase font-bold text-slate-400 dark:text-slate-500 tracking-widest",children:["Desenvolvido por ",e.jsx("a",{href:"mailto:leowaltrick@gmail.com?subject=App Gabinete Digital",title:"Entrar em contato",className:"text-brand-600 dark:text-brand-400 hover:opacity-80 transition-opacity",children:"LW Consulting"})]})})]})}),e.jsx("div",{className:"hidden lg:flex w-1/2 h-full items-center justify-center p-12 xl:p-20 relative pointer-events-none",children:e.jsxs("div",{className:`
                  w-full max-w-xl pointer-events-auto
                  transform transition-all duration-1000 delay-200 flex flex-col gap-10
                  ${r?"translate-x-0 opacity-100":"translate-x-20 opacity-0"}
              `,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-extrabold text-slate-900 dark:text-white leading-tight mb-4 drop-shadow-sm",children:["Gestão inteligente",e.jsx("br",{}),"para mandatos modernos."]}),e.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-300 font-medium leading-relaxed",children:"Centralize demandas, acompanhe solicitações e tome decisões estratégicas baseadas em dados."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{title:"Central de Demandas",icon:rt,desc:"Acompanhe solicitações em tempo real."},{title:"Base de Cidadãos",icon:He,desc:"Histórico completo de atendimentos."},{title:"Mapa de Calor",icon:Ft,desc:"Geolocalização de ocorrências."},{title:"Gestão de Prazos",icon:Se,desc:"Alertas automáticos de vencimento."},{title:"Analytics",icon:Ht,desc:"Indicadores de desempenho do gabinete."},{title:"Controle de Acesso",icon:ua,desc:"Permissões granulares por perfil."}].map((j,n)=>e.jsxs("div",{className:"bg-white/60 dark:bg-black/40 backdrop-blur-md border border-white/40 dark:border-white/10 p-4 rounded-2xl shadow-sm hover:bg-white/80 dark:hover:bg-white/10 transition-colors duration-300",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 mb-3",children:e.jsx(j.icon,{className:"w-5 h-5"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white text-sm mb-1",children:j.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-snug",children:j.desc})]},n))})]})})]})]})},Ve=({options:t,value:s,onChange:l,size:d="md"})=>{const x=t.findIndex(r=>r.value===s);return e.jsxs("div",{className:`bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex relative border border-slate-200 dark:border-white/5 shadow-inner min-w-max ${d==="sm"?"h-9":"h-11"}`,children:[e.jsx("div",{className:"absolute top-1 bottom-1 rounded-lg bg-white dark:bg-slate-600 shadow-sm transition-all duration-300 ease-out z-0",style:{width:`calc(${100/t.length}% - 0.35rem)`,left:`calc(${x*(100/t.length)}% + 0.18rem)`}}),t.map(r=>{const h=s===r.value,N=r.icon;return e.jsxs("button",{onClick:()=>l(r.value),className:`
                flex-1 px-3 text-xs font-bold rounded-lg transition-all duration-300 relative z-10 flex items-center justify-center gap-1.5 whitespace-nowrap
                ${h?"text-brand-600 dark:text-white":"text-slate-500 dark:text-white/40 hover:text-slate-700"}
            `,children:[N&&e.jsx(N,{className:d==="sm"?"w-3 h-3":"w-4 h-4"}),r.label]},r.value)})]})},es=({demands:t,citizens:s,onViewDemand:l,onUpdateStatus:d})=>{const[x,r]=a.useState(null),[h,N]=a.useState(G.PENDING),g=[{id:G.PENDING,label:"Pendente",icon:je,color:"text-slate-500",bg:"bg-slate-100 dark:bg-slate-900/50",border:"border-slate-300 dark:border-slate-700"},{id:G.IN_PROGRESS,label:"Em Andamento",icon:tt,color:"text-amber-500",bg:"bg-amber-50 dark:bg-amber-900/10",border:"border-amber-300 dark:border-amber-700"},{id:G.COMPLETED,label:"Concluído",icon:Ge,color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/10",border:"border-green-300 dark:border-green-700"}],C=(c,k)=>{r(k),c.dataTransfer.setData("demandId",k),c.dataTransfer.effectAllowed="move"},y=c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},w=(c,k)=>{c.preventDefault();const T=c.dataTransfer.getData("demandId");T&&d(T,k),r(null)};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500",children:[e.jsx("div",{className:"md:hidden landscape:hidden px-1 pb-3 shrink-0",children:e.jsx(Ve,{value:h,onChange:c=>N(c),options:[{value:G.PENDING,label:"Pendente",icon:je},{value:G.IN_PROGRESS,label:"Andamento",icon:tt},{value:G.COMPLETED,label:"Concluído",icon:Ge}]})}),e.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-auto md:overflow-visible custom-scrollbar",children:e.jsx("div",{className:"flex flex-col landscape:flex-row md:flex-row h-full landscape:gap-4 md:gap-6 pb-4",children:g.map(c=>{const k=t.filter(I=>I.status===c.id),T=c.icon,H=h===c.id?"flex":"hidden landscape:flex md:flex";return e.jsxs("div",{className:`${H} flex-1 flex-col min-w-0 md:min-w-[320px] md:max-w-md h-full transition-all duration-300`,onDragOver:y,onDrop:I=>w(I,c.id),children:[e.jsxs("div",{className:`p-3 md:p-4 rounded-t-3xl border-x border-t border-slate-200 dark:border-white/10 ${c.bg} backdrop-blur-sm flex justify-between items-center relative md:sticky top-0 z-10 shrink-0`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:`w-5 h-5 ${c.color}`}),e.jsx("h3",{className:"font-bold text-slate-700 dark:text-white text-sm md:text-base",children:c.label})]}),e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-white dark:bg-white/10 text-xs font-bold text-slate-600 dark:text-white shadow-sm border border-slate-100 dark:border-white/5",children:k.length})]}),e.jsx("div",{className:`flex-1 overflow-y-auto p-2 landscape:p-2 md:p-3 space-y-3 border-x border-b border-slate-200 dark:border-white/10 rounded-b-3xl bg-white/30 dark:bg-white/5 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/10 transition-colors ${x?"bg-slate-50/50 dark:bg-white/10":""}`,children:k.length===0?e.jsx("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 dark:text-white/20 border-2 border-dashed border-slate-300 dark:border-white/10 rounded-xl m-2",children:e.jsx("p",{className:"text-sm",children:"Vazio"})}):k.map(I=>{const f=s.find($=>$.id===I.citizenId);return e.jsxs("div",{draggable:!0,onDragStart:$=>C($,I.id),onClick:()=>l(I),className:`
                                                    bg-white dark:bg-[#1e293b] rounded-xl border border-slate-200 dark:border-white/5 shadow-sm 
                                                    hover:shadow-md hover:border-brand-500/50 dark:hover:border-brand-500/50 
                                                    transition-all cursor-pointer group relative overflow-hidden active:cursor-grabbing
                                                    p-4 landscape:p-2.5 
                                                `,children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${I.priority===Z.HIGH?"bg-red-500":I.priority===Z.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-2 landscape:mb-1",children:[e.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-white/40 font-mono",children:["#",I.id.slice(0,6)]}),e.jsxs("div",{className:"flex gap-1",children:[I.level===Be.FEDERAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500",title:"Federal"}),I.level===Be.ESTADUAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500",title:"Estadual"})]})]}),e.jsx("h4",{className:"font-bold text-slate-800 dark:text-white text-sm leading-snug mb-2 pl-2 group-hover:text-brand-600 dark:group-hover:text-brand-400 transition-colors landscape:mb-1 landscape:line-clamp-2",children:I.title}),e.jsxs("div",{className:"flex items-center gap-2 pl-2 mb-3 landscape:mb-1",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-[10px] font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:(f==null?void 0:f.name.charAt(0))||"?"}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 truncate max-w-[120px] landscape:hidden",children:(f==null?void 0:f.name)||"Não identificado"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100 dark:border-white/5 pl-2 landscape:hidden",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 dark:text-white/40",children:[e.jsx(Se,{className:"w-3 h-3"})," ",new Date(I.createdAt).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"})]}),I.deadline&&e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${new Date(I.deadline)<new Date?"bg-red-100 text-red-600":"bg-slate-100 text-slate-500"} dark:bg-white/10 dark:text-white/60`,children:Ze(I.deadline)})]})]},I.id)})})]},c.id)})})})]})},ts=({demands:t,interactions:s=[],notices:l=[],onEditDemand:d})=>{const[x,r]=a.useState(new Date),[h,N]=a.useState(null),[g,C]=a.useState(!0),[y,w]=a.useState(!0),[c,k]=a.useState(!0),T=x.getFullYear(),A=x.getMonth(),H=new Date(T,A+1,0).getDate(),I=new Date(T,A,1).getDay(),f=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],$=()=>{r(new Date(T,A-1,1)),N(null)},P=()=>{r(new Date(T,A+1,1)),N(null)},V=()=>{const n=new Date;r(n),N(n.getDate())},F=(n,S)=>{const U=n.split("T")[0].split("-").map(Number);return U[2]===S&&U[1]-1===A&&U[0]===T},D=n=>{const S=g?t.filter(L=>L.deadline&&F(L.deadline,n)):[],U=y?s.filter(L=>L.type==="checklist"&&L.deadline&&!L.isCompleted&&F(L.deadline,n)):[],te=c?l.filter(L=>F(L.date,n)):[];return{demands:S,checklists:U,notices:te}},O=[...g?t.filter(n=>n.deadline&&n.status!==G.COMPLETED).map(n=>({type:"demand",data:n,date:new Date(n.deadline)})):[],...y?s.filter(n=>n.type==="checklist"&&n.deadline&&!n.isCompleted).map(n=>({type:"checklist",data:n,date:new Date(n.deadline)})):[],...c?l.filter(n=>new Date(n.date)>=new Date).map(n=>({type:"notice",data:n,date:new Date(n.date)})):[]].sort((n,S)=>n.date.getTime()-S.date.getTime()).slice(0,15),_=h?D(h):{demands:[],checklists:[],notices:[]},u=n=>{switch(n){case Z.HIGH:return"bg-red-100 text-red-700 dark:bg-red-500/20 dark:text-red-300 border-l-2 border-red-500";case Z.MEDIUM:return"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300 border-l-2 border-amber-500";case Z.LOW:return"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300 border-l-2 border-green-500"}},M=n=>{switch(n){case"alert":return e.jsx(qt,{className:"w-3 h-3 text-red-500"});case"event":return e.jsx(Se,{className:"w-3 h-3 text-blue-500"});default:return e.jsx(pa,{className:"w-3 h-3 text-slate-500"})}},j=()=>{const n=[];for(let S=0;S<I;S++)n.push(e.jsx("div",{className:"min-h-[80px] bg-slate-50/30 dark:bg-slate-900/20 border-r border-b border-slate-200 dark:border-white/5"},`empty-${S}`));for(let S=1;S<=H;S++){const{demands:U,checklists:te,notices:L}=D(S),ae=U.length+te.length+L.length,me=S===new Date().getDate()&&A===new Date().getMonth()&&T===new Date().getFullYear(),ie=S===h;n.push(e.jsxs("div",{onClick:()=>N(S),className:`
                min-h-[80px] md:min-h-[120px] h-auto flex flex-col
                border-r border-b border-slate-200 dark:border-white/5 p-1 md:p-2 relative group hover:bg-slate-50 dark:hover:bg-white/5 transition-colors cursor-pointer
                ${ie?"bg-brand-50 dark:bg-brand-900/10 shadow-[inset_0_0_0_2px_rgba(14,165,233,0.5)]":me?"bg-brand-500/5":"bg-transparent"}
            `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`text-xs md:text-sm font-bold w-6 h-6 md:w-7 md:h-7 flex items-center justify-center rounded-full transition-all
                ${me?"bg-brand-500 text-white shadow-lg shadow-brand-500/30":ie?"bg-slate-900 dark:bg-white text-white dark:text-slate-900":"text-slate-500 dark:text-white/50"}
            `,children:S}),ae>0&&e.jsx("span",{className:"text-[9px] bg-slate-200 dark:bg-white/10 text-slate-600 dark:text-white/70 px-1.5 py-0.5 rounded-full font-bold",children:ae})]}),e.jsxs("div",{className:"space-y-1 overflow-y-hidden flex-1",children:[e.jsxs("div",{className:"hidden md:block space-y-1",children:[L.map(K=>e.jsxs("div",{className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 ${K.type==="alert"?"border-red-400 bg-red-50 dark:bg-red-500/10":"border-blue-400 bg-blue-50 dark:bg-blue-500/10"}`,children:[M(K.type)," ",K.title]},K.id)),U.slice(0,3-L.length).map(K=>e.jsx("div",{className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 ${u(K.priority)}`,children:K.title},K.id)),te.slice(0,Math.max(0,3-(U.length+L.length))).map(K=>e.jsxs("div",{className:"w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 border-l-slate-400 bg-slate-100 dark:bg-white/5 text-slate-600 dark:text-white/60",children:[e.jsx(Bt,{className:"w-2 h-2"})," ",K.text]},K.id)),U.length+te.length+L.length>3&&e.jsxs("div",{className:"text-[9px] text-slate-400 pl-1",children:["+ ",ae-3," mais"]})]}),e.jsxs("div",{className:"md:hidden flex flex-wrap justify-center content-end h-full pb-1 gap-1",children:[L.map((K,le)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"},`n-${le}`)),U.map((K,le)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-500"},`d-${le}`)),te.map((K,le)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"},`c-${le}`))]})]})]},S))}return n};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 shrink-0",children:[e.jsxs("button",{onClick:()=>C(!g),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${g?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-500/20 dark:border-brand-500/30 dark:text-brand-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${g?"bg-brand-500":"bg-slate-300"}`})," Demandas"]}),e.jsxs("button",{onClick:()=>w(!y),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${y?"bg-slate-100 border-slate-300 text-slate-700 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${y?"bg-slate-500":"bg-slate-300"}`})," Checklists"]}),e.jsxs("button",{onClick:()=>k(!c),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${c?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-500/20 dark:border-blue-500/30 dark:text-blue-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${c?"bg-blue-500":"bg-slate-300"}`})," Avisos"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-6 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 glass-panel rounded-3xl shadow-sm border border-slate-200 dark:border-white/10 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 md:p-6 border-b border-slate-200 dark:border-white/10 flex items-center justify-between bg-white/50 dark:bg-white/5 backdrop-blur-sm shrink-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white capitalize flex items-center gap-2",children:[e.jsx(Se,{className:"w-6 h-6 text-brand-600 dark:text-brand-400"}),f[A]," ",e.jsx("span",{className:"text-slate-400 dark:text-white/40 font-normal",children:T})]}),e.jsxs("div",{className:"flex bg-white dark:bg-white/10 rounded-xl border border-slate-200 dark:border-white/10 shadow-sm",children:[e.jsx("button",{onClick:$,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-l-xl border-r border-slate-200 dark:border-white/10",children:e.jsx(Ke,{className:"w-5 h-5"})}),e.jsx("button",{onClick:V,className:"px-4 text-xs font-bold text-slate-600 dark:text-white/70 hover:bg-slate-50 dark:hover:bg-white/10",children:"Hoje"}),e.jsx("button",{onClick:P,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-r-xl border-l border-slate-200 dark:border-white/10",children:e.jsx(at,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"grid grid-cols-7 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(n=>e.jsx("div",{className:"py-2 text-center text-[10px] md:text-xs font-bold text-slate-500 dark:text-white/30 uppercase tracking-wider",children:n},n))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"grid grid-cols-7 bg-transparent min-h-full",children:j()})})]}),e.jsx("div",{className:"w-full lg:w-80 glass-panel rounded-3xl border border-slate-200 dark:border-white/10 flex flex-col shrink-0 overflow-hidden h-[300px] lg:h-auto",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:[h," de ",f[A]]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-white/50",children:[_.demands.length+_.checklists.length+_.notices.length," eventos"]})]}),e.jsx("button",{onClick:()=>N(null),className:"text-xs text-brand-600 hover:underline",children:"Ver Geral"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar",children:[[..._.notices,..._.demands,..._.checklists].map((n,S)=>e.jsxs("div",{className:"p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10",children:[e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white line-clamp-2",children:n.title||n.text}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 capitalize",children:n.type==="checklist"?"Tarefa":n.type||"Demanda"})]},S)),_.demands.length===0&&_.notices.length===0&&_.checklists.length===0&&e.jsx("p",{className:"text-center text-xs text-slate-400 mt-4",children:"Nada para este dia."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-brand-600 dark:text-brand-400"}),"Próximos Prazos"]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-white/50",children:"Visão geral de urgências e avisos"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:O.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-slate-400 dark:text-white/30 text-center",children:[e.jsx(je,{className:"w-10 h-10 mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Nenhum evento futuro."})]}):O.map((n,S)=>{const U=n.date.getDate()===new Date().getDate(),te=n.type==="notice"?"bg-blue-50 text-blue-600 border-blue-100 dark:bg-blue-500/10 dark:text-blue-400":n.type==="demand"?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400":"bg-slate-50 text-slate-600 border-slate-100 dark:bg-white/5 dark:text-slate-400";return e.jsxs("div",{onClick:()=>n.type==="demand"&&d(n.data),className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:`w-10 h-10 rounded-lg flex flex-col items-center justify-center font-bold shrink-0 border ${te}`,children:[e.jsx("span",{className:"text-xs",children:n.date.getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:n.date.toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:n.type==="notice"||n.type==="demand"?n.data.title:n.data.text}),n.type==="demand"&&e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${U?"bg-red-100 text-red-600":"bg-slate-100 text-slate-600"} dark:bg-white/10`,children:U?"HOJE":n.data.status})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:n.type==="notice"?"Aviso Mural":n.type==="demand"?n.data.description:"Tarefa Checklist"})]})]},`${n.type}-${n.data.id}-${S}`)})})]})})]})]})},as=({currentPage:t,totalPages:s,onPageChange:l,totalItems:d,itemsPerPage:x})=>{if(s<=1)return null;const r=(t-1)*x+1,h=Math.min(t*x,d);return e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 py-4 px-2 border-t border-slate-200 dark:border-white/10 mt-auto",children:[e.jsxs("div",{className:"text-xs text-slate-500 dark:text-white/50 font-medium order-2 sm:order-1",children:["Mostrando ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:r})," a ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:h})," de ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:d})," registros"]}),e.jsxs("div",{className:"flex items-center gap-2 order-1 sm:order-2",children:[e.jsx("button",{onClick:()=>l(t-1),disabled:t===1,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Página anterior",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-1 px-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700 dark:text-white",children:t}),e.jsx("span",{className:"text-sm text-slate-400 dark:text-white/40",children:"/"}),e.jsx("span",{className:"text-sm text-slate-500 dark:text-white/50 font-medium",children:s})]}),e.jsx("button",{onClick:()=>l(t+1),disabled:t===s,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Próxima página",children:e.jsx(at,{className:"w-4 h-4"})})]})]})},ss=Ae.memo(({demand:t,onUpdateStatus:s})=>{const l=r=>{s(t.id,r.target.value)},d=r=>r.stopPropagation(),x=r=>{switch(r){case G.COMPLETED:return"bg-green-50 text-green-700 border-green-200 dark:bg-green-500/10 dark:text-green-400 dark:border-green-500/20";case G.IN_PROGRESS:return"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";default:return"bg-slate-100 text-slate-600 border-slate-200 dark:bg-white/5 dark:text-slate-400 dark:border-white/10"}};return e.jsxs("div",{className:"relative inline-block group/status",onClick:d,children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg border transition-colors shadow-sm ${x(t.status)}`,children:[t.status===G.COMPLETED&&e.jsx(Ge,{className:"w-3.5 h-3.5"}),t.status===G.IN_PROGRESS&&e.jsx(tt,{className:"w-3.5 h-3.5"}),t.status===G.PENDING&&e.jsx(je,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:t.status}),e.jsx("div",{className:"ml-1 pl-1 border-l border-current/20 opacity-50",children:e.jsx(ct,{className:"w-3 h-3"})})]}),e.jsx("select",{value:t.status,onChange:l,onClick:d,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer font-bold text-sm appearance-none",children:Object.values(G).map(r=>e.jsx("option",{value:r,children:r},r))})]})}),rs=({demands:t,citizens:s,onUpdateStatus:l,onEdit:d,onViewDemand:x,initialSelectionId:r,clearSelection:h,onInteractionUpdate:N,onNotification:g,onViewCitizen:C})=>{const[y,w]=a.useState("createdAt"),[c,k]=a.useState("desc"),[T,A]=a.useState(1),H=10,I=D=>{y===D?k(O=>O==="asc"?"desc":"asc"):(w(D),k("desc"))},f=D=>y!==D?e.jsx(ga,{className:"w-3 h-3 text-slate-300"}):c==="asc"?e.jsx(fa,{className:"w-3 h-3 text-brand-600"}):e.jsx(wa,{className:"w-3 h-3 text-brand-600"}),$=a.useMemo(()=>[...t].sort((D,O)=>{let _=0;switch(y){case"createdAt":_=new Date(D.createdAt).getTime()-new Date(O.createdAt).getTime();break;case"deadline":const u=D.deadline?new Date(D.deadline).getTime():0,M=O.deadline?new Date(O.deadline).getTime():0;_=u-M;break;case"priority":const j={[Z.LOW]:1,[Z.MEDIUM]:2,[Z.HIGH]:3};_=j[D.priority]-j[O.priority];break;case"status":const n={[G.PENDING]:1,[G.IN_PROGRESS]:2,[G.COMPLETED]:3};_=n[D.status]-n[O.status];break;default:_=0}return c==="asc"?_:-_}),[t,y,c]);a.useEffect(()=>{A(1)},[t]);const P=Math.ceil($.length/H),V=$.slice((T-1)*H,T*H),F=D=>{switch(D){case Z.HIGH:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-red-100 text-red-600 dark:bg-red-500/10 dark:text-red-300 border border-red-200 dark:border-red-500/20",children:"Alta"});case Z.MEDIUM:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-amber-100 text-amber-600 dark:bg-amber-500/10 dark:text-amber-300 border border-amber-200 dark:border-amber-500/20",children:"Média"});case Z.LOW:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-green-100 text-green-600 dark:bg-green-500/10 dark:text-green-300 border border-green-200 dark:border-green-500/20",children:"Baixa"})}};return e.jsx("div",{className:"flex flex-col w-full gap-2 relative",children:e.jsx("div",{className:"glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-slate-900/50 shadow-sm relative w-full flex flex-col min-h-0",children:$.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 dark:text-white/30 text-sm py-20",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-4",children:e.jsx(Xe,{className:"w-6 h-6 opacity-30"})}),e.jsx("p",{children:"Nenhuma demanda encontrada."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full relative",children:[e.jsxs("table",{className:"w-full text-left border-collapse hidden md:table",children:[e.jsx("thead",{className:"bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-sm border-b border-slate-200 dark:border-white/10",children:e.jsxs("tr",{className:"text-xs font-bold text-slate-500 dark:text-blue-200/50 uppercase tracking-wider",children:[e.jsx("th",{className:"p-4 first:pl-6 w-[35%] min-w-[200px]",children:"Título"}),e.jsx("th",{className:"p-4 w-[20%] min-w-[150px]",children:"Solicitante"}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>I("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",f("status")]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>I("priority"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prioridade ",f("priority")]})}),e.jsx("th",{className:"p-4 hidden lg:table-cell cursor-pointer",onClick:()=>I("createdAt"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Criação ",f("createdAt")]})}),e.jsx("th",{className:"p-4 hidden xl:table-cell cursor-pointer",onClick:()=>I("deadline"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prazo ",f("deadline")]})}),e.jsx("th",{className:"p-4 text-right last:pr-6 w-[80px]",children:"Ação"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-white/5 text-sm",children:V.map(D=>{const O=s.find(_=>_.id===D.citizenId);return e.jsxs("tr",{onClick:()=>x(D),className:"hover:bg-white/60 dark:hover:bg-white/5 transition-colors cursor-pointer group",children:[e.jsxs("td",{className:"p-4 first:pl-6",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white truncate max-w-[250px]",title:D.title,children:D.title}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-white/50 truncate mt-0.5 max-w-[250px]",children:D.description})]}),e.jsx("td",{className:"p-4",children:O?e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group/citizen p-1 -ml-1 rounded-lg hover:bg-brand-50 dark:hover:bg-white/10 transition-colors",onClick:_=>{_.stopPropagation(),C&&C(O.id)},children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs border border-slate-200 dark:border-white/10 shrink-0",children:O.name.charAt(0)}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"font-medium text-slate-900 dark:text-white truncate max-w-[150px] group-hover/citizen:text-brand-600 transition-colors",children:O.name})})]}):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"Não vinculado"})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:e.jsx(ss,{demand:D,onUpdateStatus:l})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:F(D.priority)}),e.jsx("td",{className:"p-4 hidden lg:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:new Date(D.createdAt).toLocaleDateString()}),e.jsx("td",{className:"p-4 hidden xl:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:D.deadline?Ze(D.deadline):"-"}),e.jsx("td",{className:"p-4 text-right last:pr-6",children:e.jsx("div",{className:"p-2 text-slate-400 group-hover:text-brand-600 transition-colors inline-flex bg-slate-100 dark:bg-white/5 rounded-lg group-hover:bg-brand-50 dark:group-hover:bg-brand-500/10",children:e.jsx(et,{className:"w-4 h-4"})})})]},D.id)})})]}),e.jsx("div",{className:"md:hidden space-y-3 p-3",children:V.map(D=>{const O=s.find(_=>_.id===D.citizenId);return e.jsxs("div",{onClick:()=>x(D),className:"glass-panel p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm active:scale-[0.98] transition-all cursor-pointer relative overflow-hidden group",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${D.priority===Z.HIGH?"bg-red-500":D.priority===Z.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-xs font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:O?O.name.charAt(0):"?"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-bold text-slate-900 dark:text-white truncate",children:O?O.name.split(" ")[0]:"S/ Solicitante"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-white/50",children:new Date(D.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase border ${D.status===G.COMPLETED?"bg-green-50 text-green-700 border-green-200":"bg-slate-50 text-slate-600 border-slate-200"}`,children:D.status})]}),e.jsxs("div",{className:"pl-3",children:[e.jsx("h4",{className:"font-bold text-sm text-slate-800 dark:text-white mb-1 leading-snug",children:D.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/60 line-clamp-2 mb-3",children:D.description}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-100 dark:border-white/5 pt-2",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 font-bold uppercase",children:[e.jsx(Ce,{className:"w-3 h-3"})," ",D.level]}),e.jsxs("div",{className:"flex items-center gap-1 text-brand-600 text-xs font-bold",children:["Detalhes ",e.jsx(et,{className:"w-3 h-3"})]})]})]})]},D.id)})})]}),e.jsx("div",{className:"bg-slate-50/50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-white/5 rounded-b-3xl",children:e.jsx(as,{currentPage:T,totalPages:P,onPageChange:A,totalItems:$.length,itemsPerPage:H})})]})})})};Oe.Icon&&Oe.Icon.Default&&(delete Oe.Icon.Default.prototype._getIconUrl,Oe.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}));const wt={},ls=(t,s,l)=>t==="citizen"?"blue":s===G.COMPLETED?"green":l===Z.HIGH?"red":s===G.IN_PROGRESS?"orange":l===Z.MEDIUM?"gold":"blue",ns=(t,s,l)=>{const d=ls(t,s,l),x=`${t}-${d}`;if(wt[x])return wt[x];const r=new Oe.Icon({iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${d}.png`,shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:t==="citizen"?"custom-citizen-icon":""});return wt[x]=r,r},os=({markers:t})=>{const s=Dt(),[l,d]=a.useState([]),x=a.useRef(null),r=a.useCallback(()=>{if(!s)return;const h=s.getBounds();let N=2e3;const g=h.pad(.2),C=t.filter(y=>g.contains(Oe.latLng(y.lat,y.lon)));d(C.slice(0,N))},[s,t]);return a.useEffect(()=>{r()},[t]),a.useEffect(()=>{if(!s)return;const h=()=>{x.current&&clearTimeout(x.current),x.current=setTimeout(r,200)};return s.on("moveend",h),s.on("zoomend",h),()=>{s.off("moveend",h),s.off("zoomend",h),x.current&&clearTimeout(x.current)}},[s,r]),e.jsx(e.Fragment,{children:l.map(h=>e.jsx(za,{center:[h.lat,h.lon],radius:5,pathOptions:{fillColor:"#0ea5e9",fillOpacity:.6,color:"#0284c7",weight:1,opacity:.5},children:e.jsx(Kt,{children:e.jsxs("div",{className:"p-1 min-w-[150px]",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-900",children:h.name}),e.jsx("p",{className:"text-xs text-slate-500",children:h.bairro})]})})},`dot-${h.id}`))})},ds=({markers:t,onViewDemand:s})=>{const l=Dt(),[d,x]=a.useState([]),r=a.useRef(null),h=typeof window<"u"&&window.innerWidth<768,N=a.useCallback(()=>{if(!l)return;const g=l.getBounds(),C=l.getZoom();let y=h?40:150;if(t.length<=y){d.length!==t.length&&x(t);return}C<15&&(y=Math.floor(y*.6));const w=g.pad(h?.1:.2),c=t.filter(k=>w.contains(Oe.latLng(k.lat,k.lon)));x(c.slice(0,y))},[l,t,h]);return a.useEffect(()=>{N()},[t]),a.useEffect(()=>{if(!l)return;const g=()=>{r.current&&clearTimeout(r.current),r.current=setTimeout(N,250)};return l.on("moveend",g),l.on("zoomend",g),()=>{l.off("moveend",g),l.off("zoomend",g),r.current&&clearTimeout(r.current)}},[l,N]),e.jsx(e.Fragment,{children:d.map(g=>e.jsx(Qt,{position:[g.lat,g.lon],icon:ns(g.type,g.status,g.priority),eventHandlers:{click:()=>{h&&l.flyTo([g.lat,g.lon],16,{duration:.5})}},children:e.jsx(Kt,{children:e.jsx("div",{className:"p-1 min-w-[200px]",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-800 leading-tight",children:g.title}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full ${g.status==="Concluído"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:g.status}),g.priority===Z.HIGH&&e.jsx("span",{className:"text-red-600 font-bold",children:"ALTA"})]}),e.jsx("button",{onClick:C=>{C.stopPropagation(),s&&s(g.id)},className:"mt-1 w-full bg-brand-600 text-white text-xs font-bold py-1.5 rounded hover:bg-brand-700 transition-colors",children:"Ver Detalhes"})]})})})},`m-${g.type}-${g.id}`))})},is=({zoomIn:t,zoomOut:s})=>e.jsxs("div",{className:"flex flex-col gap-2 pointer-events-auto shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-white/10",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors border-b border-slate-100 dark:border-white/10",children:e.jsx(xt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:s,className:"w-10 h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors",children:e.jsx(va,{className:"w-5 h-5"})})]}),cs=({markers:t,viewMode:s,onViewDemand:l})=>{var d;return s==="citizens"?e.jsx(os,{markers:t}):e.jsx(ds,{markers:t,onViewDemand:l},`ml-${t.length}-${((d=t[0])==null?void 0:d.id)||"empty"}`)},xs=({focus:t})=>{const s=Dt();return a.useEffect(()=>{t&&s.flyTo([t.lat,t.lon],18,{duration:1.5})},[t,s]),null},hs=({defaultCenter:t,onViewDemand:s,preloadedMarkers:l,currentViewMode:d,onChangeViewMode:x,mapFocus:r})=>{const h=a.useRef(null),N=t?[t.lat,t.lon]:[-23.5505,-46.6333],g=a.useMemo(()=>l?l.filter(w=>w.type===(d==="demands"?"demand":"citizen")):[],[d,l]),C=()=>{var w;return(w=h.current)==null?void 0:w.zoomIn()},y=()=>{var w;return(w=h.current)==null?void 0:w.zoomOut()};return e.jsxs("div",{className:"transition-all duration-300 ease-in-out border-slate-200 dark:border-white/10 shadow-sm bg-slate-100 dark:bg-slate-900 overflow-hidden h-full w-full relative",children:[e.jsx("div",{className:"absolute left-4 bottom-4 md:bottom-8 z-[400] pointer-events-none flex flex-col gap-2",children:e.jsxs("div",{className:"pointer-events-auto bg-white/90 dark:bg-black/80 backdrop-blur-md p-1.5 rounded-xl shadow-lg border border-slate-200 dark:border-white/10 flex gap-1",children:[e.jsxs("button",{onClick:()=>x("demands"),className:`px-3 py-2 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors ${d==="demands"?"bg-brand-600 text-white":"text-slate-600 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(rt,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Demandas"})]}),e.jsxs("button",{onClick:()=>x("citizens"),className:`px-3 py-2 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors ${d==="citizens"?"bg-brand-600 text-white":"text-slate-600 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(He,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Cidadãos"})]})]})}),e.jsx("div",{className:"absolute right-4 bottom-4 md:bottom-8 z-[400] flex flex-col gap-3 pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",children:e.jsx(is,{zoomIn:C,zoomOut:y})})}),e.jsxs(Jt,{ref:h,center:N,zoom:13,style:{width:"100%",height:"100%"},zoomControl:!1,scrollWheelZoom:!0,dragging:!0,preferCanvas:!0,children:[e.jsx(Yt,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors © <a href="https://carto.com/attributions">CARTO</a>'}),e.jsx(cs,{markers:g,viewMode:d,onViewDemand:s}),e.jsx(xs,{focus:r||null})]})]})},nt=({options:t,selectedValues:s,onChange:l,placeholder:d,label:x})=>{const[r,h]=a.useState(!1),[N,g]=a.useState(""),C=a.useRef(null);a.useEffect(()=>{const k=T=>{C.current&&!C.current.contains(T.target)&&(h(!1),g(""))};return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[]);const y=a.useMemo(()=>t.filter(k=>k.label.toLowerCase().includes(N.toLowerCase())),[t,N]),w=k=>{s.includes(k)?l(s.filter(T=>T!==k)):l([...s,k])},c=(k,T)=>{T.stopPropagation(),l(s.filter(A=>A!==k))};return e.jsxs("div",{className:"relative min-w-[200px]",ref:C,children:[x&&e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:x}),e.jsxs("div",{onClick:()=>h(!r),className:`
            w-full min-h-[46px] px-3 py-2 glass-input border border-slate-300 dark:border-white/10 rounded-2xl 
            focus:border-brand-500 outline-none font-bold text-slate-700 dark:text-white cursor-pointer shadow-sm
            flex items-center justify-between transition-all hover:bg-slate-50 dark:hover:bg-white/5
            ${r?"ring-2 ring-brand-500/20 border-brand-500":""}
        `,children:[e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.length===0?e.jsx("span",{className:"text-slate-400 dark:text-white/40 text-sm font-medium py-1",children:d}):s.map(k=>{const T=t.find(A=>A.value===k);return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 text-xs font-bold border border-brand-200 dark:border-brand-500/30",children:[(T==null?void 0:T.label)||k,e.jsx("div",{onClick:A=>c(k,A),className:"hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-full p-0.5 cursor-pointer",children:e.jsx(Re,{className:"w-3 h-3"})})]},k)})}),e.jsx(ct,{className:`w-4 h-4 text-slate-400 transition-transform duration-300 ${r?"rotate-180":""}`})]}),r&&e.jsxs("div",{className:"absolute top-full left-0 w-full mt-2 glass-panel bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden z-50 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"p-2 border-b border-slate-100 dark:border-white/5",children:e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"w-4 h-4 text-slate-400 absolute left-3 top-2.5"}),e.jsx("input",{type:"text",value:N,onChange:k=>g(k.target.value),placeholder:"Filtrar opções...",className:"w-full pl-9 pr-3 py-2 text-sm bg-slate-50 dark:bg-white/5 rounded-lg border-none outline-none text-slate-900 dark:text-white placeholder:text-slate-400",autoFocus:!0,onClick:k=>k.stopPropagation()})]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/20",children:y.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-slate-400 dark:text-white/40 italic",children:"Nenhuma opção encontrada."}):y.map(k=>{const T=s.includes(k.value);return e.jsxs("div",{onClick:()=>w(k.value),className:`
                                    flex items-center justify-between px-3 py-2.5 rounded-lg cursor-pointer text-sm font-medium transition-colors
                                    ${T?"bg-brand-50 dark:bg-brand-500/10 text-brand-700 dark:text-brand-300":"text-slate-700 dark:text-white hover:bg-slate-50 dark:hover:bg-white/5"}
                                `,children:[e.jsx("span",{children:k.label}),T&&e.jsx(ut,{className:"w-4 h-4 text-brand-500"})]},k.value)})}),e.jsxs("div",{className:"p-2 border-t border-slate-100 dark:border-white/5 bg-slate-50/50 dark:bg-white/5 flex justify-between",children:[e.jsx("button",{onClick:()=>l([]),className:"text-xs text-slate-500 hover:text-red-500 px-2 py-1 transition-colors",children:"Limpar"}),e.jsx("button",{onClick:()=>h(!1),className:"text-xs font-bold text-brand-600 dark:text-brand-400 px-2 py-1 hover:bg-brand-50 dark:hover:bg-white/5 rounded transition-colors",children:"Pronto"})]})]})]})},Je=({label:t,onRemove:s})=>e.jsxs("div",{className:"flex items-center gap-1 pl-3 pr-1 py-1 bg-brand-50 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 border border-brand-100 dark:border-brand-500/30 rounded-lg text-xs font-bold animate-in zoom-in-95 shadow-sm whitespace-nowrap",children:[e.jsx("span",{children:t}),e.jsx("button",{onClick:l=>{l.stopPropagation(),s()},className:"p-0.5 hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-md transition-colors text-brand-600 dark:text-brand-400",children:e.jsx(Re,{className:"w-3 h-3"})})]}),ot=({label:t,icon:s,isActive:l,onClick:d})=>e.jsxs("button",{onClick:d,className:`
            flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold transition-all shadow-sm whitespace-nowrap border
            ${l?"bg-brand-600 text-white border-brand-600":"bg-white dark:bg-slate-800 text-slate-600 dark:text-white border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}
        `,children:[s&&e.jsx(s,{className:`w-3.5 h-3.5 ${l?"text-white":"text-slate-400"}`}),t]}),ms=({filters:t,setFilters:s,onExport:l,users:d=[],availableTags:x=[],isMapMode:r=!1,mapViewMode:h})=>{var le,ce;const[N,g]=a.useState(!1),[C,y]=a.useState(!1),[w,c]=a.useState(new Date),k=a.useRef(null),T=a.useRef(null),A=(p,v)=>{s(E=>({...E,[p]:v}))},H=()=>{s({search:t.search,level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",responsibleId:void 0,tags:[]})},I=(p,v)=>{Array.isArray(t[p])&&v?s(E=>({...E,[p]:E[p].filter(X=>X!==v)})):s(p==="startDate"||p==="endDate"?E=>({...E,startDate:"",endDate:""}):E=>({...E,[p]:void 0}))},f=p=>{const v=t.status;v.includes(p)?A("status",v.filter(E=>E!==p)):A("status",[...v,p])},$=p=>{const v=t.priority;v.includes(p)?A("priority",v.filter(E=>E!==p)):A("priority",[...v,p])},P=()=>{if(t.startDate)A("startDate",""),A("endDate","");else{const p=new Date().toLocaleDateString("en-CA");A("startDate",p),A("endDate",p)}},V=p=>p?p.split("_").map(v=>v.charAt(0).toUpperCase()+v.slice(1)).join(" "):"",F=p=>{const v=d.find(E=>E.id===p);return v?v.nome:"Usuário"},D=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],O=(p,v)=>new Date(p,v+1,0).getDate(),_=(p,v)=>new Date(p,v,1).getDay(),u=p=>{const E=new Date(w.getFullYear(),w.getMonth(),p).toLocaleDateString("en-CA");!t.startDate||t.startDate&&t.endDate?s(X=>({...X,startDate:E,endDate:""})):E<t.startDate?s(X=>({...X,startDate:E,endDate:t.startDate})):(s(X=>({...X,endDate:E})),setTimeout(()=>y(!1),300))},M=t.startDate?new Date(t.startDate+"T00:00:00").getTime():null,j=t.endDate?new Date(t.endDate+"T00:00:00").getTime():null,n=p=>{if(!M)return!1;const v=new Date(w.getFullYear(),w.getMonth(),p).getTime();return v===M?"start":j&&v===j?"end":j&&v>M&&v<j?"range":!1};a.useEffect(()=>{const p=v=>{k.current&&!k.current.contains(v.target)&&y(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const S=t.level.length+t.status.length+t.priority.length+(((le=t.tags)==null?void 0:le.length)||0)+(t.startDate?1:0)+(t.responsibleId?1:0),U=t.startDate?`${new Date(t.startDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})} ${t.endDate?" - "+new Date(t.endDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}):""}`:"Selecionar Período",te={createdAt:"Criação",updatedAt:"Atualização",deadline:"Prazo"},L=Object.values(Be).map(p=>({value:p,label:p})),ae=Object.values(G).map(p=>({value:p,label:p})),me=Object.values(Z).map(p=>({value:p,label:p})),ie=x.map(p=>({value:p,label:p})),K=!r||h==="demands";return e.jsxs("div",{className:"flex flex-col relative z-30 space-y-3",children:[e.jsxs("div",{className:`
          flex flex-col md:flex-row gap-3 items-center relative z-20 
          ${r?"bg-transparent":"glass-panel p-2 md:p-3 rounded-2xl shadow-sm border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md"}
      `,children:[e.jsxs("div",{className:`flex-1 w-full relative group ${r?"shadow-lg rounded-2xl":""}`,children:[e.jsx("input",{type:"text",value:t.search,onChange:p=>A("search",p.target.value),placeholder:r?"Buscar locais ou demandas...":"Buscar por título, nome ou celular...",className:`
                    w-full pl-11 pr-4 py-3 outline-none transition-all font-medium text-slate-700 dark:text-white placeholder:text-slate-400
                    ${r?"bg-white/95 dark:bg-[#1e293b]/95 border-0 rounded-2xl shadow-md focus:ring-2 ring-brand-500/50":"bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl focus:border-brand-500 focus:bg-white dark:focus:bg-black/20"}
                `}),e.jsx(Xe,{className:"w-5 h-5 text-slate-400 absolute left-3.5 top-3.5 group-focus-within:text-brand-500 transition-colors"}),t.search&&e.jsx("button",{onClick:()=>A("search",""),className:"absolute right-3 top-3.5 text-slate-400 hover:text-slate-600 dark:hover:text-white",children:e.jsx(Re,{className:"w-5 h-5"})})]}),r?e.jsx("div",{className:"hidden md:flex",children:e.jsx("button",{onClick:()=>g(!N),className:"w-12 h-12 bg-white dark:bg-slate-800 text-slate-600 dark:text-white rounded-2xl shadow-lg flex items-center justify-center hover:bg-slate-50 transition-transform active:scale-95",children:e.jsx(Tt,{className:"w-5 h-5"})})}):e.jsxs("div",{className:"flex w-full md:w-auto gap-2",children:[e.jsxs("button",{onClick:()=>g(!N),className:`flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-3 rounded-xl font-bold transition-all border ${N||S>0?"bg-brand-500 text-white border-brand-500 shadow-lg shadow-brand-500/20":"bg-white dark:bg-white/5 text-slate-600 dark:text-white/70 border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}`,children:[e.jsx(Tt,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Filtros"}),S>0&&e.jsx("span",{className:"bg-white text-brand-600 text-[10px] w-5 h-5 flex items-center justify-center rounded-full ml-1 shadow-sm",children:S})]}),l&&e.jsx("button",{onClick:l,className:"w-[46px] h-[46px] bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 rounded-xl flex items-center justify-center shrink-0 transition-all",title:"Exportar Dados",children:e.jsx(ja,{className:"w-5 h-5"})})]})]}),r&&h!=="citizens"&&e.jsxs("div",{className:"flex overflow-x-auto gap-2 pb-2 -mx-4 px-4 md:mx-0 md:px-0 scrollbar-none snap-x",children:[e.jsx(ot,{label:"Pendentes",icon:je,isActive:t.status.includes(G.PENDING),onClick:()=>f(G.PENDING)}),e.jsx(ot,{label:"Alta Prioridade",icon:bt,isActive:t.priority.includes(Z.HIGH),onClick:()=>$(Z.HIGH)}),e.jsx(ot,{label:"Em Andamento",icon:tt,isActive:t.status.includes(G.IN_PROGRESS),onClick:()=>f(G.IN_PROGRESS)}),e.jsx(ot,{label:"Hoje",icon:Se,isActive:!!t.startDate,onClick:P})]}),r&&h==="citizens"&&e.jsx("div",{className:"flex overflow-x-auto gap-2 pb-2 -mx-4 px-4 md:mx-0 md:px-0 scrollbar-none",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold bg-brand-600 text-white shadow-sm whitespace-nowrap border border-brand-600",children:[e.jsx(He,{className:"w-3.5 h-3.5"})," Visualizando Mapa de Cidadãos"]})}),(!r||r&&window.innerWidth>=768)&&S>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center px-1",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase text-slate-400 dark:text-white/40 mr-1 flex items-center gap-1",children:[e.jsx(yt,{className:"w-3 h-3"})," Ativos:"]}),K&&t.status.map(p=>e.jsx(Je,{label:`Status: ${p}`,onRemove:()=>I("status",p)},`status-${p}`)),K&&t.priority.map(p=>e.jsx(Je,{label:`Prioridade: ${p}`,onRemove:()=>I("priority",p)},`prio-${p}`)),K&&t.level.map(p=>e.jsx(Je,{label:`Esfera: ${p}`,onRemove:()=>I("level",p)},`lvl-${p}`)),K&&((ce=t.tags)==null?void 0:ce.map(p=>e.jsx(Je,{label:`Tag: ${p}`,onRemove:()=>I("tags",p)},`tag-${p}`))),K&&t.responsibleId&&e.jsx(Je,{label:`Resp: ${F(t.responsibleId)}`,onRemove:()=>I("responsibleId")}),t.startDate&&e.jsx(Je,{label:`${te[t.dateType]}: ${U}`,onRemove:()=>I("startDate")}),e.jsxs("button",{onClick:H,className:"text-[10px] font-bold text-red-500 hover:text-red-600 ml-auto hover:bg-red-50 dark:hover:bg-red-900/20 px-2 py-1 rounded transition-colors flex items-center gap-1",children:[e.jsx(ka,{className:"w-3 h-3"})," Limpar"]})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10 bg-slate-900/30 backdrop-blur-sm transition-opacity",onClick:()=>g(!1)}),e.jsxs("div",{ref:T,className:`
                    absolute z-[60] glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white dark:bg-[#0f172a] shadow-2xl animate-in slide-in-from-top-2 duration-200 overflow-hidden
                    w-full md:w-[800px] md:right-0 md:left-auto
                    ${r?"top-[70px]":"top-[calc(100%+12px)]"}
                `,children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2 text-sm",children:[e.jsx(yt,{className:"w-4 h-4 text-brand-500"})," Filtros Avançados"]}),e.jsx("button",{onClick:()=>g(!1),className:"p-1.5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Re,{className:"w-4 h-4 text-slate-500 dark:text-white/60"})})]}),e.jsxs("div",{className:`p-6 grid gap-8 max-h-[70vh] overflow-y-auto custom-scrollbar ${K?"grid-cols-1 md:grid-cols-3":"grid-cols-1"}`,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Período"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ve,{options:["createdAt","updatedAt","deadline"].map(p=>({value:p,label:te[p]})),value:t.dateType,onChange:p=>A("dateType",p),size:"sm"}),e.jsxs("div",{className:"relative",ref:k,children:[e.jsx("button",{onClick:()=>y(!C),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl text-sm font-bold transition-all border ${t.startDate?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-900/20 dark:border-brand-500/30 dark:text-brand-300":"bg-slate-50 dark:bg-white/5 border-slate-200 dark:border-white/10 text-slate-600 dark:text-white/70 hover:bg-slate-100"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 opacity-70"})," ",U]})}),C&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-72 bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 p-4 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>c(new Date(w.getFullYear(),w.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-bold text-sm",children:[D[w.getMonth()]," ",w.getFullYear()]}),e.jsx("button",{onClick:()=>c(new Date(w.getFullYear(),w.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(at,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["D","S","T","Q","Q","S","S"].map(p=>e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:p},p))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:_(w.getFullYear(),w.getMonth())}).map((p,v)=>e.jsx("div",{},`empty-${v}`)),Array.from({length:O(w.getFullYear(),w.getMonth())}).map((p,v)=>{const E=v+1,X=n(E);return e.jsx("button",{onClick:()=>u(E),className:`h-8 w-8 rounded-full text-xs font-medium transition-all ${X==="start"||X==="end"?"bg-brand-500 text-white shadow-lg":X==="range"?"bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 rounded-none":"hover:bg-slate-100 dark:hover:bg-white/10"}`,children:E},E)})]})]})]})]})]}),K&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Classificação"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(nt,{options:ae,selectedValues:t.status,onChange:p=>A("status",p),placeholder:"Todos Status",label:"Status"}),e.jsx(nt,{options:me,selectedValues:t.priority,onChange:p=>A("priority",p),placeholder:"Todas Prioridades",label:"Prioridade"}),e.jsx(nt,{options:L,selectedValues:t.level,onChange:p=>A("level",p),placeholder:"Todas Esferas",label:"Esfera"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Contexto"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:"Responsável"}),e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"w-4 h-4 text-slate-400 absolute left-3 top-3 pointer-events-none"}),e.jsxs("select",{value:t.responsibleId||"",onChange:p=>A("responsibleId",p.target.value||void 0),className:"w-full pl-9 pr-8 py-2.5 bg-slate-50 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-xl text-sm outline-none focus:border-brand-500 font-bold text-slate-700 dark:text-white appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"Todos os Responsáveis"}),d.map(p=>e.jsxs("option",{value:p.id,children:[p.nome," (",V(p.perfil),")"]},p.id))]}),e.jsx("div",{className:"absolute right-3 top-3 pointer-events-none text-slate-400 text-xs",children:"▼"})]})]}),e.jsx(nt,{options:ie,selectedValues:t.tags||[],onChange:p=>A("tags",p),placeholder:"Filtrar por Tags",label:"Etiquetas (Tags)"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5 flex justify-end gap-3",children:[e.jsx("button",{onClick:H,className:"px-4 py-2 text-xs font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-xl transition-colors",children:"Limpar Tudo"}),e.jsx("button",{onClick:()=>g(!1),className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold text-sm shadow-lg shadow-brand-500/20 transition-all active:scale-95",children:"Aplicar Filtros"})]})]})]})]})},ta=({status:t,setStatus:s,priority:l,setPriority:d,timeRange:x,setTimeRange:r,scope:h,setScope:N,showScope:g=!0,className:C=""})=>e.jsxs("div",{className:`glass-panel p-3 rounded-3xl flex flex-col md:flex-row gap-4 items-center border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md shadow-sm ${C}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-white/50 text-xs font-bold uppercase tracking-wider shrink-0",children:[e.jsx(yt,{className:"w-4 h-4 text-brand-500"})," Filtros"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto overflow-x-auto scrollbar-none items-start sm:items-center flex-1",children:[g&&h&&N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-w-[200px]",children:e.jsx(Ve,{value:h,onChange:N,options:[{value:"demands",label:"Demandas",icon:rt},{value:"citizens",label:"Cidadãos",icon:He}]})}),e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"})]}),e.jsx("div",{className:"min-w-[280px]",children:e.jsx(Ve,{value:x,onChange:r,options:[{value:"7",label:"7d"},{value:"30",label:"30d"},{value:"90",label:"90d"},{value:"365",label:"Ano"},{value:"all",label:"Tudo"}]})}),(!g||h==="demands")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:t,onChange:y=>s(y.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Status: Todos"}),e.jsx("option",{value:G.PENDING,children:"Pendentes"}),e.jsx("option",{value:G.IN_PROGRESS,children:"Em Andamento"}),e.jsx("option",{value:G.COMPLETED,children:"Concluídos"})]}),e.jsx(ct,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]}),e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:l,onChange:y=>d(y.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Prioridade: Todas"}),e.jsx("option",{value:Z.HIGH,children:"Alta"}),e.jsx("option",{value:Z.MEDIUM,children:"Média"}),e.jsx("option",{value:Z.LOW,children:"Baixa"})]}),e.jsx(ct,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]})]})]})]}),(t!=="all"||l!=="all"||x!=="30")&&e.jsxs("button",{onClick:()=>{s("all"),d("all"),r("30")},className:"ml-auto p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-slate-400 hover:text-red-500 rounded-xl transition-colors flex items-center gap-1 text-[10px] font-bold uppercase",title:"Limpar Filtros",children:[e.jsx(Re,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden md:inline",children:"Limpar"})]})]}),ze=Ae.memo(({title:t,value:s,icon:l,colorClass:d,textClass:x,trend:r,subValue:h})=>e.jsxs("div",{className:"glass-panel p-3 md:p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex flex-col justify-between hover:bg-white/60 dark:hover:bg-white/5 transition-colors group min-h-[100px] will-change-transform",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:`p-2 rounded-xl ${d} bg-opacity-10 shrink-0`,children:e.jsx(l,{className:`w-4 h-4 ${x}`})}),r&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-bold text-emerald-600 bg-emerald-100 dark:bg-emerald-500/20 px-1.5 py-0.5 rounded-full border border-emerald-200 dark:border-emerald-500/10",children:[e.jsx(Na,{className:"w-3 h-3"})," ",r]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-800 dark:text-white tracking-tight block",children:h||s}),e.jsx("span",{className:`block text-[10px] font-bold uppercase tracking-wider opacity-70 ${x} mt-1`,children:t})]})]})),bs=Oe.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41]}),us=({demandId:t,entityId:s,tableName:l="demands",lat:d,lon:x,address:r,onClick:h,onLocationUpdate:N})=>{const[g,C]=a.useState(null),[y,w]=a.useState(!1),c=s||t;return a.useEffect(()=>{if(d&&x){C({lat:d,lon:x});return}if(r&&(!d||!x)){w(!0);const T=setTimeout(async()=>{try{const A=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(r)}&limit=1`,H=await fetch(A,{headers:{"User-Agent":"GabineteDigitalApp/1.0"}});if(!H.ok)throw new Error("Falha na requisição de geocodificação");const I=await H.json();if(I&&I.length>0){const f=parseFloat(I[0].lat),$=parseFloat(I[0].lon);if(C({lat:f,lon:$}),re()&&z&&c){const{error:P}=await z.from(l).update({lat:f,lon:$}).eq("id",c);!P&&N&&N(f,$)}}}catch(A){console.error("Geocoding error:",A)}finally{w(!1)}},1500);return()=>clearTimeout(T)}},[d,x,r,c,l]),!g&&!y?e.jsxs("div",{className:"w-full h-full bg-slate-100 dark:bg-white/5 flex flex-col items-center justify-center text-slate-400 rounded-xl border border-slate-200 dark:border-white/10 min-h-[150px]",children:[e.jsx(Ce,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("span",{className:"text-xs",children:"Sem localização GPS"})]}):e.jsxs("div",{className:"relative w-full h-48 rounded-xl overflow-hidden border border-slate-200 dark:border-white/10 group cursor-pointer",onClick:h,children:[y?e.jsxs("div",{className:"w-full h-full bg-slate-50 dark:bg-white/5 flex flex-col items-center justify-center text-slate-400",children:[e.jsx(we,{className:"w-6 h-6 animate-spin mb-2 text-brand-500"}),e.jsx("span",{className:"text-xs",children:"Buscando endereço..."})]}):g?e.jsxs(e.Fragment,{children:[e.jsxs(Jt,{center:[g.lat,g.lon],zoom:15,scrollWheelZoom:!1,zoomControl:!1,dragging:!1,doubleClickZoom:!1,attributionControl:!1,style:{width:"100%",height:"100%"},children:[e.jsx(Yt,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(Qt,{position:[g.lat,g.lon],icon:bs})]},`${g.lat}-${g.lon}`),e.jsx("div",{className:"absolute inset-0 z-[500] bg-transparent"})]}):null,e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors z-[600] flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"bg-white/90 dark:bg-black/80 backdrop-blur-sm px-3 py-1.5 rounded-full text-xs font-bold text-slate-900 dark:text-white opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-2 transform translate-y-2 group-hover:translate-y-0 duration-200",children:[e.jsx(ya,{className:"w-3 h-3"})," Ver no Mapa Global"]})})]})},ps=({demand:t,citizen:s,onClose:l,onEdit:d,onUpdateStatus:x,onInteractionUpdate:r,onNavigate:h,canNavigatePrev:N,canNavigateNext:g,onNotification:C,onViewCitizen:y})=>{const[w,c]=a.useState([]),[k,T]=a.useState(!1),[A,H]=a.useState([]),[I,f]=a.useState(""),[$,P]=a.useState(""),[V,F]=a.useState(""),[D,O]=a.useState(!1),[_,u]=a.useState(t.tags||[]),[M,j]=a.useState(""),[n,S]=a.useState(!1),U=a.useRef(null),[te,L]=a.useState(!1),[ae,me]=a.useState(new Date),ie=a.useRef(null),K=a.useMemo(()=>{const b=localStorage.getItem("geo_user");return b?JSON.parse(b):{name:"Usuário"}},[]);a.useEffect(()=>{le(),H([]),u(t.tags||[])},[t.id]),a.useEffect(()=>{const b=R=>{ie.current&&!ie.current.contains(R.target)&&L(!1),n&&U.current&&!U.current.contains(R.target)&&R.target.tagName!=="BUTTON"&&S(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[n]);const le=async()=>{T(!0);try{if(re()&&z){const{data:b,error:R}=await z.from("demand_interactions").select("*").eq("demanda_id",t.id).order("created_at",{ascending:!0});if(R)throw R;b&&c(b.map(W=>({id:W.id,demandId:W.demanda_id,type:W.tipo,text:W.texto,isCompleted:W.concluido,deadline:W.prazo,user:W.usuario,createdAt:W.created_at})))}}catch(b){console.error("Erro ao carregar interações",b)}finally{T(!1)}},ce=async b=>{const R=b==="comentario"?I:$;if(!R.trim())return;const W=crypto.randomUUID(),ne={id:W,demandId:t.id,type:b,text:R,isCompleted:!1,deadline:b==="checklist"&&V?V:void 0,user:K.name,createdAt:new Date().toISOString()};c(oe=>[...oe,ne]),H(oe=>[...oe,W]),b==="comentario"&&f(""),b==="checklist"&&(P(""),F(""),O(!1));try{if(re()&&z){const oe={demanda_id:t.id,tipo:b,texto:R,usuario:K.name};b==="checklist"&&(oe.concluido=!1,oe.prazo=V||null);const{data:xe,error:ye}=await z.from("demand_interactions").insert(oe).select().single();if(ye)throw ye;xe&&(c(De=>De.map(ge=>ge.id===W?{...ge,id:xe.id,createdAt:xe.created_at}:ge)),H(De=>[...De.filter(ge=>ge!==W),xe.id]),setTimeout(()=>{H(De=>De.filter(ge=>ge!==xe.id))},3e3),r&&r())}}catch(oe){console.error("Erro ao salvar interação",oe),C&&C("error","Erro ao salvar interação"),c(xe=>xe.filter(ye=>ye.id!==W)),H(xe=>xe.filter(ye=>ye!==W))}},p=async(b,R)=>{c(W=>W.map(ne=>ne.id===b?{...ne,isCompleted:!R}:ne));try{re()&&z&&(await z.from("demand_interactions").update({concluido:!R}).eq("id",b),r&&r())}catch(W){console.error("Erro ao atualizar checklist",W),C&&C("error","Erro ao atualizar checklist"),c(ne=>ne.map(oe=>oe.id===b?{...oe,isCompleted:R}:oe))}},v=async b=>{c(R=>R.filter(W=>W.id!==b));try{re()&&z&&(await z.from("demand_interactions").delete().eq("id",b),r&&r())}catch(R){console.error(R)}},E=async()=>{if(!M.trim())return;const b=[..._,M.trim()];u(b),j(""),S(!1);try{re()&&z&&(await z.from("demands").update({tags:b}).eq("id",t.id),r&&r())}catch(R){console.error(R)}},X=async b=>{const R=_.filter(W=>W!==b);u(R);try{re()&&z&&(await z.from("demands").update({tags:R}).eq("id",t.id),r&&r())}catch(W){console.error(W)}},se=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],ue=(b,R)=>new Date(b,R+1,0).getDate(),$e=(b,R)=>new Date(b,R,1).getDay(),be=b=>{const R=new Date(ae.getFullYear(),ae.getMonth(),b),W=R.getFullYear(),ne=String(R.getMonth()+1).padStart(2,"0"),oe=String(R.getDate()).padStart(2,"0");F(`${W}-${ne}-${oe}`),L(!1)},ke=w.filter(b=>b.type==="checklist"),Fe=w.filter(b=>b.type==="comentario").reverse(),Pe=a.useMemo(()=>{if(ke.length===0)return 0;const b=ke.filter(R=>R.isCompleted).length;return Math.round(b/ke.length*100)},[ke]),Ne=[{value:G.PENDING,label:"Pendente",icon:je},{value:G.IN_PROGRESS,label:"Em Andamento",icon:je},{value:G.COMPLETED,label:"Concluído",icon:je}],Le=b=>{const R=b.replace(/\D/g,"");window.open(`https://wa.me/55${R}`,"_blank")},pe=b=>{window.open(`mailto:${b}`,"_blank")},_e=()=>{const b=new CustomEvent("navigate-to-map",{detail:{demandId:t.id}});window.dispatchEvent(b),l()},Ee=s?`${s.logradouro}, ${s.numero} - ${s.bairro}, ${s.cidade} - ${s.estado}`:void 0;return e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-end md:items-center justify-center sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity duration-300",onClick:l}),e.jsxs("div",{className:"relative w-full h-full md:h-[90vh] md:max-w-6xl bg-white dark:bg-[#0b1121] md:rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in slide-in-from-bottom-10 md:zoom-in-95 duration-300 border-t md:border border-slate-200 dark:border-white/10",children:[e.jsxs("div",{className:"px-4 py-3 md:px-8 md:py-5 border-b border-slate-200 dark:border-white/10 flex items-start justify-between bg-white/90 dark:bg-[#0b1121]/90 backdrop-blur-md z-20 shrink-0 sticky top-0",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 flex-wrap",children:[e.jsx("button",{onClick:l,className:"mr-2 p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors md:hidden",children:e.jsx(Ke,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-white/40 font-mono",children:["#",t.id.slice(0,8)]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold uppercase border ${t.priority===Z.HIGH?"bg-red-50 text-red-600 border-red-100 dark:bg-red-500/10 dark:text-red-300 dark:border-red-500/20":t.priority===Z.MEDIUM?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-300 dark:border-amber-500/20":"bg-green-50 text-green-600 border-green-100 dark:bg-green-500/10 dark:text-green-300 dark:border-green-500/20"}`,children:t.priority})]}),e.jsx("h2",{className:"text-lg md:text-2xl font-bold text-slate-900 dark:text-white leading-tight line-clamp-1",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsxs("div",{className:"hidden md:flex items-center bg-slate-100 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10 mr-2",children:[e.jsx("button",{onClick:()=>h("prev"),disabled:!N,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors border-r border-slate-200 dark:border-white/10",title:"Demanda Anterior",children:e.jsx(Ke,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>h("next"),disabled:!g,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors",title:"Próxima Demanda",children:e.jsx(at,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>{d(t),l()},className:"p-2 md:p-2.5 text-slate-500 hover:text-brand-600 hover:bg-slate-100 rounded-xl transition-colors dark:text-white/50 dark:hover:text-white dark:hover:bg-white/10",title:"Editar",children:e.jsx(Ca,{className:"w-5 h-5"})}),e.jsx("button",{onClick:l,className:"p-2 md:p-2.5 text-slate-400 hover:text-slate-800 hover:bg-slate-100 rounded-full transition-colors dark:text-white/40 dark:hover:text-white dark:hover:bg-white/10",children:e.jsx(Re,{className:"w-6 h-6"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50/30 dark:bg-black/20 custom-scrollbar overscroll-contain flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 p-4 md:p-8 space-y-6 md:space-y-8 min-w-0",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(St,{className:"w-4 h-4"})," Descrição"]}),e.jsx("div",{className:"md:hidden",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${t.status===G.COMPLETED?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:t.status})})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 md:p-6 shadow-sm",children:[e.jsx("p",{className:"text-sm md:text-base text-slate-700 dark:text-slate-200 leading-relaxed whitespace-pre-line",children:t.description}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-white/5 flex flex-wrap gap-2 items-center",children:[e.jsx(Sa,{className:"w-4 h-4 text-slate-400"}),_.map(b=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1 group",children:[b,e.jsx(Re,{onClick:()=>X(b),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500 hidden group-hover:block"})]},b)),n?e.jsxs("div",{className:"flex items-center gap-2",ref:ie,children:[e.jsx("input",{ref:U,autoFocus:!0,type:"text",value:M,onChange:b=>j(b.target.value),className:"w-24 px-2 py-1 text-xs border rounded-lg outline-none",placeholder:"Nova tag...",onKeyDown:b=>{b.key==="Enter"&&E(),b.key==="Escape"&&S(!1)}}),e.jsx("button",{onClick:E,className:"text-xs font-bold text-brand-600",children:"OK"})]}):e.jsxs("button",{onClick:()=>S(!0),className:"text-xs text-slate-400 hover:text-brand-600 flex items-center gap-1 px-2 py-1 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(xt,{className:"w-3 h-3"})," Adicionar"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Ce,{className:"w-4 h-4"})," Localização"]}),e.jsx(us,{demandId:t.id,lat:t.lat,lon:t.lon,address:Ee,onClick:_e,onLocationUpdate:r})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Bt,{className:"w-4 h-4"})," Checklist"]}),ke.length>0&&e.jsxs("span",{className:"text-xs font-mono text-slate-400 dark:text-white/40",children:[Math.round(Pe),"%"]})]}),ke.length>0&&e.jsx("div",{className:"h-1.5 w-full bg-slate-200 dark:bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-500",style:{width:`${Pe}%`}})}),e.jsxs("div",{className:"space-y-2",children:[ke.map(b=>e.jsxs("div",{className:"flex items-start gap-3 group bg-white dark:bg-white/5 p-3 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 dark:hover:border-white/10 transition-colors",children:[e.jsx("button",{onClick:()=>p(b.id,b.isCompleted||!1),className:`mt-0.5 w-5 h-5 rounded-lg border flex items-center justify-center transition-all ${b.isCompleted?"bg-green-500 border-green-500 text-white":"bg-white dark:bg-transparent border-slate-300 dark:border-white/20 hover:border-brand-500 text-transparent hover:text-brand-500/20"}`,children:e.jsx(ut,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm transition-all font-medium ${b.isCompleted?"text-slate-400 line-through dark:text-white/30":"text-slate-800 dark:text-white"}`,children:b.text}),(b.deadline||b.isCompleted)&&e.jsx("div",{className:"flex items-center gap-2 mt-1.5",children:b.deadline&&e.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold uppercase flex items-center gap-1 ${b.isCompleted?"bg-slate-100 text-slate-400 dark:bg-white/5":new Date(b.deadline)<new Date?"bg-red-100 text-red-600 dark:bg-red-500/20 dark:text-red-300":"bg-slate-100 text-slate-500 dark:bg-white/10 dark:text-white/60"}`,children:[e.jsx(Se,{className:"w-3 h-3"})," ",Ze(b.deadline)]})})]}),e.jsx("button",{onClick:()=>v(b.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",children:e.jsx(At,{className:"w-4 h-4"})})]},b.id)),D?e.jsxs("div",{className:"bg-white dark:bg-white/5 p-4 rounded-xl border border-brand-500/30 shadow-lg ring-1 ring-brand-500/10 animate-in fade-in zoom-in-95",children:[e.jsx("input",{type:"text",autoFocus:!0,value:$,onChange:b=>P(b.target.value),placeholder:"Descreva a tarefa...",className:"w-full bg-transparent border-none outline-none text-sm text-slate-900 dark:text-white placeholder:text-slate-400 mb-4 font-medium",onKeyDown:b=>b.key==="Enter"&&ce("checklist")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 border-t border-slate-100 dark:border-white/5 pt-3",children:[e.jsxs("div",{className:"relative w-full sm:w-auto",ref:ie,children:[e.jsxs("button",{onClick:()=>L(!te),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all border ${V?"bg-brand-50 text-brand-700 border-brand-200 dark:bg-brand-500/20 dark:text-brand-300 dark:border-brand-500/30":"bg-slate-50 text-slate-500 border-slate-200 dark:bg-white/5 dark:text-white/50 dark:border-white/10 hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(Se,{className:"w-3.5 h-3.5"}),V?Ze(V):"Definir Prazo"]}),te&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-64 glass-panel bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 p-3 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:()=>me(new Date(ae.getFullYear(),ae.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Ke,{className:"w-4 h-4 text-slate-600 dark:text-white"})}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white text-xs",children:[se[ae.getMonth()]," ",ae.getFullYear()]}),e.jsx("button",{onClick:()=>me(new Date(ae.getFullYear(),ae.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(at,{className:"w-4 h-4 text-slate-600 dark:text-white"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-1",children:["D","S","T","Q","Q","S","S"].map(b=>e.jsx("span",{className:"text-[9px] font-bold text-slate-400 dark:text-white/40",children:b},b))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:$e(ae.getFullYear(),ae.getMonth())}).map((b,R)=>e.jsx("div",{},`empty-${R}`)),Array.from({length:ue(ae.getFullYear(),ae.getMonth())}).map((b,R)=>{const W=R+1,ne=V&&new Date(V).getDate()===W&&new Date(V).getMonth()===ae.getMonth();return e.jsx("button",{onClick:()=>be(W),className:`h-6 w-6 rounded-full text-[10px] font-medium flex items-center justify-center transition-all ${ne?"bg-brand-500 text-white":"text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:W},W)})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-end",children:[e.jsx("button",{onClick:()=>O(!1),className:"px-3 py-1.5 text-xs font-bold text-slate-500 hover:text-slate-700 dark:text-white/60 dark:hover:text-white",children:"Cancelar"}),e.jsx("button",{onClick:()=>ce("checklist"),className:"px-4 py-1.5 bg-brand-600 text-white text-xs font-bold rounded-lg hover:bg-brand-500 shadow-sm",children:"Salvar Item"})]})]})]}):e.jsxs("button",{onClick:()=>O(!0),className:"flex items-center justify-center gap-2 text-sm text-slate-500 dark:text-white/50 hover:text-brand-600 dark:hover:text-brand-400 transition-colors px-4 py-3 rounded-xl border border-dashed border-slate-300 dark:border-white/10 hover:border-brand-300 dark:hover:border-brand-500/30 hover:bg-slate-50 dark:hover:bg-white/5 w-full group",children:[e.jsx(xt,{className:"w-4 h-4 group-hover:scale-110 transition-transform"})," Adicionar item ao checklist"]})]})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Da,{className:"w-4 h-4"})," Comentários"]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-3 md:p-4 bg-slate-50 dark:bg-white/5 border-b border-slate-200 dark:border-white/10 flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold text-xs shrink-0",children:K.name.charAt(0)}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:I,onChange:b=>f(b.target.value),placeholder:"Escreva um comentário...",className:"w-full bg-white dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl pl-4 pr-10 py-2.5 text-sm outline-none focus:border-brand-500 transition-all text-slate-900 dark:text-white shadow-sm",onKeyDown:b=>b.key==="Enter"&&ce("comentario")}),e.jsx("button",{onClick:()=>ce("comentario"),disabled:!I.trim(),className:"absolute right-2 top-2 p-1 text-slate-400 hover:text-brand-600 disabled:opacity-30 transition-colors",children:e.jsx(Ea,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-white/5 max-h-[300px] overflow-y-auto custom-scrollbar",children:Fe.length===0?e.jsx("div",{className:"p-6 text-center text-slate-400 dark:text-white/30 text-sm italic",children:"Nenhum comentário registrado."}):Fe.map(b=>e.jsxs("div",{className:`p-4 flex gap-3 hover:bg-slate-50 dark:hover:bg-white/5 transition-colors group ${A.includes(b.id)?"bg-amber-50 dark:bg-amber-500/10 animate-pulse duration-1000":""}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs shrink-0 border border-slate-300 dark:border-white/10",children:b.user.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-slate-900 dark:text-white",children:b.user}),e.jsx("span",{className:"text-[10px] text-slate-400",children:new Date(b.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed break-words bg-slate-50 dark:bg-white/5 p-3 rounded-tr-xl rounded-br-xl rounded-bl-xl border border-slate-100 dark:border-white/5",children:b.text})]}),e.jsx("button",{onClick:()=>v(b.id),className:"opacity-0 group-hover:opacity-100 self-start p-2 text-slate-300 hover:text-red-500 transition-all",children:e.jsx(At,{className:"w-4 h-4"})})]},b.id))})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white/50 dark:bg-black/20 border-t md:border-t-0 md:border-l border-slate-200 dark:border-white/10 p-4 md:p-6 space-y-6 md:h-auto overflow-y-auto",children:[e.jsxs("div",{className:"hidden md:block",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 mb-3 block",children:"Status"}),e.jsx("div",{className:"bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex flex-col relative border border-slate-200 dark:border-white/5 gap-1",children:Ne.map(b=>{const R=t.status===b.value;return e.jsxs("button",{onClick:()=>x(t.id,b.value),className:`
                                                w-full py-2.5 px-3 text-sm font-bold rounded-lg transition-all duration-300 flex items-center gap-3
                                                ${R?"bg-white dark:bg-white/10 text-brand-600 dark:text-white shadow-sm ring-1 ring-slate-200 dark:ring-white/10":"text-slate-500 dark:text-white/40 hover:bg-slate-200 dark:hover:bg-white/5"}
                                            `,children:[e.jsx(b.icon,{className:`w-4 h-4 ${R?"text-brand-500 dark:text-brand-400":"opacity-50"}`}),b.label]},b.value)})})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4 space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40 mb-2",children:"Datas"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-500 dark:text-white/50",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Criado em"}),e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white",children:new Date(t.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${t.deadline?"bg-brand-100 dark:bg-brand-500/20 text-brand-600 dark:text-brand-400":"bg-slate-100 dark:bg-white/10 text-slate-500"}`,children:e.jsx(je,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Prazo Demanda"}),e.jsx("p",{className:`text-sm font-bold ${t.deadline?"text-slate-800 dark:text-white":"text-slate-400 italic"}`,children:Ze(t.deadline)||"Sem prazo"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40",children:"Solicitante"})}),s?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-white/5 p-2 -ml-2 rounded-xl transition-colors group",onClick:()=>y&&y(s.id),children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-sm shadow-inner shrink-0",children:s.name.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-bold text-slate-900 dark:text-white truncate group-hover:text-brand-600 transition-colors flex items-center gap-1",children:[s.name,e.jsx(Ia,{className:"w-3 h-3 opacity-0 group-hover:opacity-100"})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:qe(s.phone)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.phone&&e.jsxs("button",{onClick:()=>Le(s.phone),className:"flex-1 py-1.5 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Conversar no WhatsApp",children:[e.jsx(Ta,{className:"w-3.5 h-3.5"})," WhatsApp"]}),s.email&&e.jsxs("button",{onClick:()=>pe(s.email),className:"flex-1 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Enviar Email",children:[e.jsx(Gt,{className:"w-3.5 h-3.5"})," Email"]})]})]}):e.jsx("div",{className:"text-center py-4 text-slate-400 text-xs italic",children:"Nenhum solicitante vinculado."})]})]})]})]})]})},Rt=({demands:t,citizens:s,interactions:l=[],onViewDemand:d,onEditDemand:x,onCreateDemand:r,onUpdateStatus:h,onInteractionUpdate:N,initialSelectionId:g,clearSelection:C,initialViewMode:y="list",filters:w,setFilters:c,users:k=[],onNotification:T,defaultLocation:A,onViewCitizen:H,mapMarkers:I,mapFocus:f,initialMapViewMode:$="demands"})=>{const[P,V]=a.useState(y),[F,D]=a.useState("demands"),[O,_]=a.useState([]),[u,M]=a.useState("30"),[j,n]=a.useState(null),S=y==="map",U=a.useMemo(()=>{const v=t.length;let E=0,X=0,se=0;for(const ue of t)ue.status===G.PENDING?E++:ue.status===G.COMPLETED&&X++,ue.priority===Z.HIGH&&se++;return{total:v,pending:E,completed:X,highPriority:se}},[t]);a.useEffect(()=>{g&&n(g)},[g,S]),a.useEffect(()=>{y&&!S&&V(y)},[y,S]),a.useEffect(()=>{$&&S&&D($)},[$,S]),a.useEffect(()=>{(async()=>{if(re()&&z){const{data:E}=await z.from("app_config").select("value").eq("key","dashboard_notices").maybeSingle();E&&_(E.value)}else{const E=localStorage.getItem("geo_notices");E&&_(JSON.parse(E))}})()},[]);const te=v=>{if(M(v),!c)return;if(v==="all"){c(be=>({...be,startDate:"",endDate:""}));return}const E=parseInt(v),X=new Date,se=new Date;v==="365"?(se.setMonth(0,1),se.setHours(0,0,0,0)):se.setDate(X.getDate()-E);const ue=se.toLocaleDateString("en-CA"),$e=X.toLocaleDateString("en-CA");c(be=>({...be,startDate:ue,endDate:$e}))};a.useEffect(()=>{c&&!(w!=null&&w.startDate)&&!S&&te("30")},[]);const L=v=>{c&&c(v==="all"?E=>({...E,status:[]}):E=>({...E,status:[v]}))},ae=v=>{c&&c(v==="all"?E=>({...E,priority:[]}):E=>({...E,priority:[v]}))},me=v=>{if(!j)return;const E=t.findIndex(X=>X.id===j);E!==-1&&(v==="prev"&&E>0?n(t[E-1].id):v==="next"&&E<t.length-1&&n(t[E+1].id))},ie=j?t.findIndex(v=>v.id===j):-1,K=ie>0,le=ie!==-1&&ie<t.length-1,ce=w!=null&&w.status&&w.status.length===1?w.status[0]:"all",p=w!=null&&w.priority&&w.priority.length===1?w.priority[0]:"all";return e.jsxs("div",{className:`flex flex-col animate-in slide-in-from-right duration-500 ${S?"h-full":"gap-4"}`,children:[!S&&e.jsxs("div",{className:"shrink-0 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-3",children:[e.jsx(rt,{className:"w-8 h-8 text-brand-600 dark:text-brand-400"}),"Gestão de Demandas"]}),e.jsx("p",{className:"text-slate-500 dark:text-blue-200/50 mt-1 font-medium hidden sm:block",children:P==="list"?"Controle detalhado e histórico de ocorrências.":P==="board"?"Fluxo de trabalho visual por status.":"Calendário de prazos e vencimentos."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsx("div",{className:"hidden md:flex w-[280px]",children:e.jsx(Ve,{value:P,onChange:V,options:[{value:"list",label:"Lista",icon:$t},{value:"board",label:"Quadro",icon:Pt},{value:"calendar",label:"Data",icon:Lt}]})}),e.jsxs("button",{onClick:r,className:"w-full sm:w-auto px-5 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 transition-all flex items-center justify-center gap-2 active:scale-95 h-11",children:[e.jsx(Ut,{className:"w-5 h-5"})," ",e.jsx("span",{className:"whitespace-nowrap",children:"Nova Demanda"})]})]})]}),e.jsx("div",{className:"md:hidden flex overflow-x-auto gap-2 pb-2 scrollbar-none snap-x -mx-4 px-4 bg-slate-50 dark:bg-[#020617] z-20 pt-2 border-b border-slate-200 dark:border-white/5",children:[{id:"list",label:"Lista",icon:$t},{id:"board",label:"Quadro",icon:Pt},{id:"calendar",label:"Calendário",icon:Lt}].map(v=>{const E=P===v.id,X=v.icon;return e.jsxs("button",{onClick:()=>V(v.id),className:`
                                flex items-center gap-2 px-4 py-2.5 rounded-full text-xs font-bold whitespace-nowrap transition-all snap-start
                                ${E?"bg-brand-600 text-white shadow-md shadow-brand-500/30":"bg-white dark:bg-white/5 text-slate-500 dark:text-white/60 border border-slate-200 dark:border-white/10"}
                            `,children:[e.jsx(X,{className:"w-3.5 h-3.5"}),v.label]},v.id)})})]}),w&&c&&!S&&e.jsx("div",{className:"mb-2",children:e.jsx(ta,{status:ce,setStatus:L,priority:p,setPriority:ae,timeRange:u,setTimeRange:te,scope:"demands",setScope:()=>{},showScope:!1})}),!S&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 shrink-0",children:[e.jsx(ze,{title:"Total Filtrado",value:U.total,icon:Vt,colorClass:"bg-blue-500",textClass:"text-blue-600 dark:text-blue-400"}),e.jsx(ze,{title:"Pendentes",value:U.pending,icon:je,colorClass:"bg-slate-500",textClass:"text-slate-600 dark:text-slate-400"}),e.jsx(ze,{title:"Em Andamento",value:U.total-U.pending-U.completed,icon:tt,colorClass:"bg-amber-500",textClass:"text-amber-600 dark:text-amber-400"}),e.jsx(ze,{title:"Concluídos",value:U.completed,icon:Ge,colorClass:"bg-green-500",textClass:"text-green-600 dark:text-green-400"})]}),S&&w&&c&&e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 pt-12 pointer-events-none z-30",children:e.jsx("div",{className:"pointer-events-auto max-w-2xl mx-auto",children:e.jsx(ms,{filters:w,setFilters:c,users:k,isMapMode:!0,mapViewMode:F})})}),e.jsxs("div",{className:`flex-1 flex flex-col min-w-0 w-full relative ${S?"h-full":""}`,children:[P==="list"&&e.jsx(rs,{demands:t,citizens:s,onUpdateStatus:h||(()=>{}),onEdit:v=>{x(v)},onInteractionUpdate:N,onViewDemand:v=>n(v.id),onNotification:T,onViewCitizen:H}),P==="board"&&e.jsx(es,{demands:t,citizens:s,onViewDemand:v=>{n(v.id)},onUpdateStatus:h||(()=>{})}),P==="calendar"&&e.jsx(ts,{demands:t,interactions:l,notices:O,onEditDemand:v=>{n(v.id)}}),P==="map"&&e.jsx(hs,{demands:t,citizens:s,defaultCenter:A,preloadedMarkers:I,onViewDemand:v=>{n(v)},currentViewMode:F,onChangeViewMode:D,mapFocus:f})]}),j&&e.jsx(ps,{demand:t.find(v=>v.id===j),citizen:s.find(v=>{var E;return v.id===((E=t.find(X=>X.id===j))==null?void 0:E.citizenId)})||null,onClose:()=>{n(null),C&&C()},onEdit:v=>{n(null),x(v)},onUpdateStatus:(v,E)=>{h&&h(v,E)},onInteractionUpdate:N,onNavigate:v=>me(v),canNavigatePrev:K,canNavigateNext:le,onNotification:T,onViewCitizen:H})]})},gs=({locations:t})=>{const[s,l]=a.useState(null),[d,x]=a.useState(!1),r=t.length>0?t[0]:null;a.useEffect(()=>{(async()=>{if(!r){x(!1);return}const y=`weather_cache_${r.lat}_${r.lon}`,w=localStorage.getItem(y),c=new Date().toISOString().slice(0,13);if(w){const k=JSON.parse(w);if(k.hour===c){l(k.data);return}}x(!0);try{const T=await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${r.lat}&longitude=${r.lon}&current=temperature_2m,weather_code&timezone=auto`)).json();l(T),localStorage.setItem(y,JSON.stringify({hour:c,data:T}))}catch(k){console.error("Failed to fetch weather",k)}finally{x(!1)}})()},[r]);const h=C=>C===0?e.jsx(Nt,{className:"w-6 h-6 text-amber-500"}):C>=1&&C<=3?e.jsx(Aa,{className:"w-6 h-6 text-slate-400"}):C>=51&&C<=67?e.jsx($a,{className:"w-6 h-6 text-blue-400"}):C>=71&&C<=77?e.jsx(Pa,{className:"w-6 h-6 text-cyan-300"}):e.jsx(Nt,{className:"w-6 h-6 text-amber-500"});if(d&&r)return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-slate-200/50 dark:bg-white/5 animate-pulse min-w-[140px] h-[46px]",children:[e.jsx(we,{className:"w-4 h-4 animate-spin text-slate-400"}),e.jsx("div",{className:"h-3 w-16 bg-slate-300 dark:bg-white/10 rounded"})]});if(!r||!s)return null;const N=Math.round(s.current.temperature_2m),g=s.current.weather_code;return e.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 rounded-xl bg-white/60 dark:bg-white/5 backdrop-blur-md border border-slate-200 dark:border-white/10 shadow-sm transition-all hover:bg-white/80 dark:hover:bg-white/10 cursor-default",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h(g),e.jsxs("span",{className:"text-xl font-bold text-slate-900 dark:text-white",children:[N,"°"]})]}),e.jsxs("div",{className:"flex flex-col border-l border-slate-300 dark:border-white/10 pl-4 h-8 justify-center",children:[e.jsxs("span",{className:"text-xs font-bold text-slate-700 dark:text-white uppercase tracking-wide flex items-center gap-1",children:[e.jsx(Ce,{className:"w-3 h-3 text-brand-600 dark:text-brand-400"}),r.name]}),e.jsx("span",{className:"text-[10px] text-slate-500 dark:text-white/50",children:"Tempo Agora"})]})]})},fs=({onBack:t,onSuccess:s})=>{const[l,d]=a.useState(""),[x,r]=a.useState("search"),[h,N]=a.useState([]),[g,C]=a.useState(!1),[y,w]=a.useState(""),[c,k]=a.useState(""),[T,A]=a.useState(""),[H,I]=a.useState(!1);a.useEffect(()=>{const $=setTimeout(()=>w(l),500);return()=>clearTimeout($)},[l]),a.useEffect(()=>{if(!y||y.length<3){N([]);return}(async()=>{if(C(!0),re()&&z){const P=Ye(y),{data:V}=await z.from("citizens").select("*").or(`telefone.ilike.%${P}%,nome.ilike.%${y}%`).limit(5);V&&N(V.map(F=>({id:F.id,name:`${F.nome} ${F.sobrenome}`,phone:F.telefone,bairro:F.bairro,email:F.email||"",createdAt:F.created_at})))}C(!1)})()},[y]);const f=async()=>{if(!c||!l)return;I(!0);const $=Ye(l),P=c.trim().split(" "),V=P[0],F=P.slice(1).join(" ")||".";try{if(re()&&z){const{data:D,error:O}=await z.from("citizens").insert({nome:V,sobrenome:F,telefone:$,bairro:T,origem:"fast_track_mobile"}).select().single();if(O)throw O;D&&s(D.id)}}catch(D){console.error(D),alert("Erro ao criar cidadão rápido.")}finally{I(!1)}};return e.jsxs("div",{className:"fixed inset-0 bg-slate-50 dark:bg-[#020617] z-[100] flex flex-col animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"p-4 flex items-center gap-4 border-b border-slate-200 dark:border-white/10 bg-white dark:bg-[#0b1121]",children:[e.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-white/10",children:e.jsx(Ct,{className:"w-6 h-6 text-slate-600 dark:text-white"})}),e.jsx("h1",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Nova Solicitação"})]}),x==="search"&&e.jsxs("div",{className:"flex-1 p-6 flex flex-col",children:[e.jsx("label",{className:"text-sm font-bold text-slate-500 dark:text-white/50 mb-2 uppercase",children:"Quem está solicitando?"}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("input",{autoFocus:!0,type:"text",value:l,onChange:$=>d($.target.value),placeholder:"Telefone ou Nome...",className:"w-full text-2xl font-bold bg-transparent border-b-2 border-slate-300 dark:border-white/20 py-2 outline-none focus:border-brand-500 text-slate-900 dark:text-white placeholder:text-slate-300"}),g&&e.jsx(we,{className:"absolute right-0 top-3 w-6 h-6 animate-spin text-brand-500"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3",children:[h.map($=>e.jsxs("button",{onClick:()=>s($.id),className:"w-full text-left p-4 bg-white dark:bg-white/5 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex items-center justify-between active:scale-95 transition-transform",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 dark:bg-brand-500/20 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold",children:$.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:$.name}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:qe($.phone)})]})]}),e.jsx("div",{className:"bg-brand-600 text-white p-2 rounded-xl",children:e.jsx(xt,{className:"w-5 h-5"})})]},$.id)),y.length>3&&e.jsxs("button",{onClick:()=>r("create-citizen"),className:"w-full p-4 mt-4 bg-slate-100 dark:bg-white/5 rounded-2xl border-2 border-dashed border-slate-300 dark:border-white/10 flex items-center justify-center gap-2 text-slate-500 dark:text-white/60 font-bold active:scale-95 transition-transform",children:[e.jsx(Wt,{className:"w-5 h-5"}),'Cadastrar "',l,'"']})]})]}),x==="create-citizen"&&e.jsx("div",{className:"flex-1 p-6 flex flex-col",children:e.jsxs("div",{className:"bg-white dark:bg-white/5 p-6 rounded-3xl border border-slate-200 dark:border-white/10 shadow-lg space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Telefone"}),e.jsx("p",{className:"text-xl font-mono font-bold text-slate-900 dark:text-white border-b border-slate-100 pb-2",children:qe(l)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Nome Completo"}),e.jsx("input",{autoFocus:!0,type:"text",value:c,onChange:$=>k($.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: João da Silva"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Bairro (Opcional)"}),e.jsx("input",{type:"text",value:T,onChange:$=>A($.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: Centro"})]}),e.jsxs("button",{onClick:f,disabled:H||!c,className:"w-full py-4 bg-brand-600 text-white rounded-xl font-bold text-lg shadow-xl shadow-brand-500/20 flex items-center justify-center gap-2 active:scale-95 transition-transform disabled:opacity-50",children:[H?e.jsx(we,{className:"w-6 h-6 animate-spin"}):e.jsx(ut,{className:"w-6 h-6"}),"Salvar e Criar Demanda"]})]})})]})},ws=t=>{const[s,l]=a.useState(navigator.onLine),[d,x]=a.useState(!0),[r,h]=a.useState([]),[N,g]=a.useState([]),[C,y]=a.useState([]),[w,c]=a.useState([]),[k,T]=a.useState([]),[A,H]=a.useState(null),[I,f]=a.useState(null),[$,P]=a.useState(0),V=a.useCallback((O,_)=>{try{const u=localStorage.getItem("geo_map_cache"),M=u?JSON.parse(u):{};let j=!1;_.forEach(n=>{n.lat&&n.lon&&!M[n.id]&&(M[n.id]={lat:n.lat,lon:n.lon},j=!0)}),O.forEach(n=>{n.lat&&n.lon&&!M[n.id]&&(M[n.id]={lat:n.lat,lon:n.lon},j=!0)}),j&&localStorage.setItem("geo_map_cache",JSON.stringify(M))}catch(u){console.error("Error preloading map cache",u)}},[]),F=a.useCallback(async()=>{if(x(!0),!navigator.onLine){console.log("Offline mode: Loading from cache");const O=localStorage.getItem("cache_demands"),_=localStorage.getItem("cache_citizens"),u=localStorage.getItem("offline_demands_queue");let M=O?JSON.parse(O):[];const j=_?JSON.parse(_):[];u&&(M=[...JSON.parse(u),...M]),h(M),g(j),x(!1);return}if(re()&&z)try{const[{data:O},{data:_},{data:u},{data:M},{data:j},{data:n},{data:S}]=await Promise.all([z.from("demands").select("*").order("created_at",{ascending:!1}).limit(2e3),z.from("citizens").select("*").limit(3e3),z.from("system_users").select("*"),z.from("demand_interactions").select("*").order("created_at",{ascending:!1}).limit(1e3),z.from("app_config").select("*").eq("key","weather_locations").maybeSingle(),z.from("app_config").select("*").eq("key","global_theme_mode").maybeSingle(),z.from("dashboard_stats").select("*").maybeSingle()]),U=O?O.map(L=>({...L,citizenId:L.citizen_id,createdAt:L.created_at})):[],te=_?_.map(L=>({id:L.id,cpf:L.cpf,name:`${L.nome} ${L.sobrenome}`,email:L.email,phone:L.telefone,createdAt:L.created_at,logradouro:L.logradouro,numero:L.numero,bairro:L.bairro,cidade:L.cidade,estado:L.estado,cep:L.cep,lat:L.lat,lon:L.lon})):[];localStorage.setItem("cache_demands",JSON.stringify(U)),localStorage.setItem("cache_citizens",JSON.stringify(te)),O&&h(U),_&&g(te),u&&y(u),M&&c(M.map(L=>({id:L.id,demandId:L.demanda_id,type:L.tipo,text:L.texto,isCompleted:L.concluido,deadline:L.prazo,user:L.usuario,createdAt:L.created_at}))),j&&T(j.value),S&&H(S),n&&n.value&&f(n.value),V(U,te)}catch(O){console.error("Error fetching data, trying cache...",O);const _=localStorage.getItem("cache_demands"),u=localStorage.getItem("cache_citizens");_&&h(JSON.parse(_)),u&&g(JSON.parse(u))}finally{x(!1)}else h([]),x(!1)},[V]),D=a.useCallback(async()=>{const O=localStorage.getItem("offline_demands_queue");if(!O)return 0;const _=JSON.parse(O);if(_.length===0)return 0;if(re()&&z){console.log(`Syncing ${_.length} offline demands...`);let u=0;for(const M of _)try{const{error:j}=await z.from("demands").insert({id:M.id,title:M.title,description:M.description,level:M.level,status:M.status,priority:M.priority,type:M.type,deadline:M.deadline,citizen_id:M.citizenId,tags:M.tags});j?console.error("Failed to sync item",M.id,j):u++}catch(j){console.error("Error syncing item",j)}return localStorage.removeItem("offline_demands_queue"),P(u),F(),u}return 0},[F]);return a.useEffect(()=>{const O=()=>{l(!0),D(),F()},_=()=>{l(!1)};return window.addEventListener("online",O),window.addEventListener("offline",_),()=>{window.removeEventListener("online",O),window.removeEventListener("offline",_)}},[F,D]),a.useEffect(()=>{t?(F(),setTimeout(()=>{navigator.onLine&&D()},2e3)):h([])},[t,F,D]),{isOnline:s,isLoading:d,demands:r,setDemands:h,citizens:N,setCitizens:g,users:C,interactions:w,weatherLocations:k,setWeatherLocations:T,dbStats:A,themePreference:I,fetchData:F,processOfflineQueue:D,syncCount:$,setSyncCount:P}},vs=Ae.lazy(()=>ea(()=>import("./PeopleManager-BuCRwscc.js"),__vite__mapDeps([0,1,2,3]))),js=Ae.lazy(()=>ea(()=>import("./AdminScreen-BNKRXR4B.js"),__vite__mapDeps([4,1,2,3]))),vt={administrador:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","admin_panel","map"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!0,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},chefe_de_gabinete:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},assessor:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!1,showPending:!0,showInProgress:!0,showCompleted:!1,showHighPriority:!0,showAnalytics:!1,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0}},ks=Ae.memo(({data:t,title:s})=>{const l=t.reduce((x,r)=>x+r.value,0);let d=0;return l===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados"}):e.jsxs("div",{className:"flex items-center gap-6 h-full justify-center",children:[e.jsxs("div",{className:"relative w-32 h-32 shrink-0",children:[e.jsx("svg",{viewBox:"0 0 100 100",className:"transform -rotate-90 w-full h-full",children:t.map((x,r)=>{const h=x.value/l,N=40,g=2*Math.PI*N,C=`${h*g} ${g}`;return d+=h*100,e.jsx("circle",{cx:"50",cy:"50",r:N,fill:"transparent",stroke:x.color,strokeWidth:"12",strokeDasharray:C,strokeDashoffset:-(d-h*100)/100*g,className:"transition-all duration-1000 ease-out"},r)})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-xl font-bold text-slate-800 dark:text-white",children:l}),e.jsx("span",{className:"text-[9px] uppercase font-bold text-slate-400",children:"Total"})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:t.map((x,r)=>e.jsxs("div",{className:"flex items-center justify-between text-xs gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:x.color}}),e.jsx("span",{className:"font-medium text-slate-600 dark:text-white/80",children:x.label})]}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white",children:[Math.round(x.value/l*100),"%"]})]},r))})]})}),Ns=Ae.memo(({data:t,unit:s=""})=>{const l=Math.max(...t.map(d=>d.value),1);return t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados geográficos"}):e.jsx("div",{className:"h-full w-full flex items-end justify-between gap-2 px-2 pb-2 pt-4",children:t.slice(0,7).map((d,x)=>{const r=d.value/l*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1 group h-full justify-end",children:[e.jsxs("div",{className:"text-[10px] font-bold text-slate-600 dark:text-slate-300 mb-0.5",children:[d.value,s]}),e.jsx("div",{style:{height:`${r}%`},className:"w-full bg-brand-200 dark:bg-brand-500/30 rounded-t-sm group-hover:bg-brand-50 dark:group-hover:bg-brand-500 transition-colors min-h-[4px]"}),e.jsx("div",{className:"text-[9px] text-slate-400 truncate w-full text-center",title:d.label,children:d.label.slice(0,6)})]},x)})})}),aa=()=>{const[t,s]=a.useState(()=>{if(typeof window<"u"){const i=localStorage.getItem("geo_user");return i?JSON.parse(i):null}return null}),[l,d]=a.useState("dashboard"),[x,r]=a.useState(!0),h=a.useRef(0),N=a.useRef(null),[g,C]=a.useState("list"),[y,w]=a.useState(()=>typeof window<"u"&&localStorage.getItem("geo_theme_pref")||"auto"),[c,k]=a.useState(!1),[T,A]=a.useState("all"),[H,I]=a.useState("all"),[f,$]=a.useState("30"),[P,V]=a.useState("demands"),[F,D]=a.useState("activity"),[O,_]=a.useState(vt),[u,M]=a.useState({search:"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[]}),[j,n]=a.useState(null),[S,U]=a.useState(null),[te,L]=a.useState(null),[ae,me]=a.useState(null),[ie,K]=a.useState("demands"),[le,ce]=a.useState(null),[p,v]=a.useState("list"),{demands:E,setDemands:X,citizens:se,users:ue,interactions:$e,weatherLocations:be,setWeatherLocations:ke,isOnline:Fe,themePreference:Pe,fetchData:Ne,syncCount:Le}=ws(t);a.useEffect(()=>{Pe&&w(Pe)},[Pe]);const pe=a.useMemo(()=>{let i=null,m=null;if(u.startDate){const[q,Y,J]=u.startDate.split("-").map(Number);if(i=new Date(q,Y-1,J,0,0,0,0).getTime(),u.endDate){const[Te,Qe,Et]=u.endDate.split("-").map(Number);m=new Date(Te,Qe-1,Et,23,59,59,999).getTime()}else m=new Date(q,Y-1,J,23,59,59,999).getTime()}const B=u.search.toLowerCase();return E.filter(q=>{if(u.search){const Y=q.id.toLowerCase().includes(B),J=q.title.toLowerCase().includes(B),he=q.description.toLowerCase().includes(B);if(!Y&&!J&&!he)return!1}if(u.status.length>0&&!u.status.includes(q.status)||u.priority.length>0&&!u.priority.includes(q.priority)||u.level.length>0&&!u.level.includes(q.level)||u.responsibleId&&q.responsibleId!==u.responsibleId||u.tags&&u.tags.length>0&&(!q.tags||!u.tags.some(Y=>q.tags.includes(Y))))return!1;if(i!==null&&m!==null){let Y;if(u.dateType==="deadline"?Y=q.deadline:u.dateType==="updatedAt"?Y=q.updatedAt:Y=q.createdAt,!Y)return!1;let J;if(/^\d{4}-\d{2}-\d{2}$/.test(Y)){const[he,Te,Qe]=Y.split("-").map(Number);J=new Date(he,Te-1,Qe,12,0,0).getTime()}else J=new Date(Y).getTime();if(J<i||J>m)return!1}return!0})},[E,u]),_e=a.useMemo(()=>{const i=u.search.toLowerCase();return u.search?se.filter(m=>{var J,he;const B=m.name.toLowerCase().includes(i),q=(J=m.email)==null?void 0:J.toLowerCase().includes(i),Y=(he=m.phone)==null?void 0:he.includes(i);return B||q||Y}):se},[se,u.search]),Ee=a.useMemo(()=>{const i=[];return pe.length>0&&pe.forEach(m=>{m.lat&&m.lon&&i.push({id:m.id,type:"demand",lat:m.lat,lon:m.lon,title:m.title,status:m.status,priority:m.priority})}),_e.length>0&&_e.forEach(m=>{m.lat&&m.lon&&i.push({id:m.id,type:"citizen",lat:m.lat,lon:m.lon,name:m.name,bairro:m.bairro})}),i},[pe,_e]);a.useEffect(()=>{const i=m=>{var B,q;(B=m.detail)!=null&&B.demandId?(K("demands"),d("map")):(q=m.detail)!=null&&q.citizenId&&(m.detail.lat&&m.detail.lon&&me({lat:m.detail.lat,lon:m.detail.lon}),K("citizens"),d("map"))};return window.addEventListener("navigate-to-map",i),()=>window.removeEventListener("navigate-to-map",i)},[]),a.useEffect(()=>{Le>0&&R("success",`${Le} itens sincronizados.`)},[Le]),a.useEffect(()=>{N.current&&(N.current.scrollTo(0,0),r(!0))},[l]);const b=i=>{const m=i.currentTarget.scrollTop;Math.abs(m-h.current)>5&&(m>h.current&&m>50?r(!1):r(!0),h.current=m)};a.useEffect(()=>{const i=()=>{let B=!1;if(y==="dark")B=!0;else if(y==="light")B=!1;else{const q=new Date().getHours();B=q<6||q>=18}k(B),B?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};i();const m=setInterval(i,6e4);return()=>clearInterval(m)},[y]);const R=a.useCallback((i,m)=>{ce({type:i,message:m}),setTimeout(()=>ce(null),4e3)},[]),W=i=>{s(i)},ne=()=>{s(null),localStorage.removeItem("geo_user"),X([])},oe=()=>{const i=c?"light":"dark";w(i),localStorage.setItem("geo_theme_pref",i)},xe=i=>{U(i),d("people")},ye=i=>{U(null),n(null),L(null),me(null),K("demands"),M(m=>({...m,search:"",responsibleId:void 0})),d(i)},De=async(i,m)=>{const B=E.find(Y=>Y.id===i),q=B==null?void 0:B.status;if(X(Y=>Y.map(J=>J.id===i?{...J,status:m}:J)),re()&&z){if(await z.from("demands").update({status:m}).eq("id",i),q&&q!==m&&t){const Y=t.name,J=`Status alterado de "${q}" para "${m}" por ${Y}.`;await z.from("demand_interactions").insert({demanda_id:i,tipo:"comentario",texto:J,usuario:"Sistema",created_at:new Date().toISOString()}),Ne()}R("success","Status atualizado!")}},ge=()=>{const i=new Date,m=new Date;if(f!=="all"){const B=parseInt(f);B===365?(m.setMonth(0,1),m.setHours(0,0,0,0)):m.setDate(i.getDate()-B)}else m.setFullYear(1970);return m},fe=a.useMemo(()=>{const i=ge();return E.filter(m=>{const q=new Date(m.createdAt)>=i,Y=T==="all"||m.status===T,J=H==="all"||m.priority===H;return q&&Y&&J})},[E,T,H,f]),Ie=a.useMemo(()=>{const i=ge();return se.filter(m=>m.createdAt?new Date(m.createdAt)>=i:!0)},[se,f]),Q=a.useMemo(()=>{if(P==="demands"){const i=fe.length;let m=0,B=0,q=0;for(const Y of fe)Y.status===G.PENDING?m++:Y.status===G.COMPLETED&&B++,Y.priority===Z.HIGH&&q++;return{stat1:{label:"Filtradas",value:i,icon:Vt,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Pendentes",value:m,icon:je,color:"bg-slate-500",text:"text-slate-600 dark:text-slate-400"},stat3:{label:"Concluídos",value:B,icon:Ge,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat4:{label:"Alta Prioridade",value:q,icon:bt,color:"bg-red-500",text:"text-red-600 dark:text-red-400"}}}else{const i=se.length,m=new Date().toDateString(),B=se.filter(J=>J.createdAt&&new Date(J.createdAt).toDateString()===m).length,q={};for(const J of se)J.bairro&&(q[J.bairro]=(q[J.bairro]||0)+1);const Y=Object.entries(q).sort((J,he)=>he[1]-J[1])[0];return{stat1:{label:"Total Cidadãos",value:i,icon:He,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Novos Hoje",value:B,icon:Wt,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat3:{label:"Top Bairro",value:Y?Y[0]:"N/A",icon:Ce,color:"bg-brand-500",text:"text-brand-600 dark:text-brand-400"},stat4:{label:"Cadastros (Bairro)",value:Y?Y[1]:0,icon:Ht,color:"bg-purple-500",text:"text-purple-600 dark:text-purple-400"}}}},[fe,Ie,se,P]),lt=a.useMemo(()=>{if(P==="demands"){const i={[G.PENDING]:0,[G.IN_PROGRESS]:0,[G.COMPLETED]:0};return fe.forEach(m=>{i[m.status]!==void 0&&i[m.status]++}),[{label:"Pendente",value:i[G.PENDING],color:"#64748b"},{label:"Em Andamento",value:i[G.IN_PROGRESS],color:"#f59e0b"},{label:"Concluído",value:i[G.COMPLETED],color:"#10b981"}].filter(m=>m.value>0)}else{const i={};Ie.forEach(J=>{const he=J.createdAt?new Date(J.createdAt):new Date,Te=`${he.getFullYear()}-${String(he.getMonth()+1).padStart(2,"0")}`;i[Te]=(i[Te]||0)+1});const m=Object.keys(i).sort().reverse(),B=["#0ea5e9","#6366f1","#8b5cf6","#ec4899","#64748b"],q=m.slice(0,4).map((J,he)=>{const[Te,Qe]=J.split("-"),gt=new Date(parseInt(Te),parseInt(Qe)-1).toLocaleString("pt-BR",{month:"short",year:"2-digit"});return{label:gt.charAt(0).toUpperCase()+gt.slice(1),value:i[J],color:B[he%B.length]}}),Y=m.slice(4).reduce((J,he)=>J+i[he],0);return Y>0&&q.push({label:"Antigos",value:Y,color:"#94a3b8"}),q}},[fe,Ie,P]),We=a.useMemo(()=>{const i={};return P==="demands"?fe.forEach(m=>{const B=se.find(q=>q.id===m.citizenId);B&&B.bairro&&(i[B.bairro]=(i[B.bairro]||0)+1)}):Ie.forEach(m=>{m.bairro&&(i[m.bairro]=(i[m.bairro]||0)+1)}),Object.entries(i).sort((m,B)=>B[1]-m[1]).slice(0,7).map(([m,B])=>({label:m,value:B}))},[fe,Ie,se,P]),o=a.useMemo(()=>[...fe].sort((i,m)=>new Date(m.createdAt).getTime()-new Date(i.createdAt).getTime()).slice(0,5),[fe]),ee=a.useMemo(()=>[...Ie].sort((i,m)=>new Date(m.createdAt||0).getTime()-new Date(i.createdAt||0).getTime()).slice(0,5),[Ie]),de=a.useMemo(()=>{const i=new Date;return i.setHours(0,0,0,0),fe.filter(m=>m.deadline&&m.status!==G.COMPLETED).map(m=>({...m,date:new Date(m.deadline)})).filter(m=>m.date>=i).sort((m,B)=>m.date.getTime()-B.date.getTime()).slice(0,5)},[fe]),Me=t?O[t.role]||vt.assessor:vt.administrador,ve=()=>e.jsx("div",{className:"space-y-2",children:P==="demands"?o.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Ma,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):o.map(i=>e.jsxs("div",{onClick:()=>{t&&(L(i.id),d("demands"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-brand-50 dark:bg-brand-500/10 flex flex-col items-center justify-center text-brand-600 dark:text-brand-400 font-bold shrink-0 border border-brand-100 dark:border-brand-500/20",children:[e.jsx("span",{className:"text-xs",children:new Date(i.createdAt).getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:new Date(i.createdAt).toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:i.title}),e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${i.status==="Concluído"?"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300":i.status==="Em Andamento"?"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300":"bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300"}`,children:i.status})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:i.description})]})]},i.id)):ee.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(He,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):ee.map(i=>e.jsxs("div",{onClick:()=>{xe(i.id)},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-blue-50 dark:bg-blue-500/10 flex flex-col items-center justify-center text-blue-600 dark:text-blue-400 font-bold shrink-0 border border-blue-100 dark:border-blue-500/20",children:[e.jsx("span",{className:"text-xs",children:new Date(i.createdAt||Date.now()).getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:new Date(i.createdAt||Date.now()).toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:i.name}),e.jsx("span",{className:"shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300",children:i.phone?qe(i.phone):"Sem Tel"})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1 flex items-center gap-1",children:i.bairro&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-2.5 h-2.5"})," ",i.bairro]})})]})]},i.id))}),Ue=()=>e.jsx("div",{className:"space-y-2",children:P==="demands"?de.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Ge,{className:"w-6 h-6 mb-2 opacity-20"}),"Tudo em dia!"]}):de.map(i=>{const m=Math.ceil((i.date.getTime()-new Date().getTime())/864e5);return e.jsxs("div",{onClick:()=>{t&&(L(i.id),d("demands"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-amber-50 dark:bg-amber-500/10 flex flex-col items-center justify-center text-amber-600 dark:text-amber-400 font-bold shrink-0 border border-amber-100 dark:border-amber-500/20",children:[e.jsx("span",{className:"text-xs",children:i.date.getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:i.date.toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:i.title}),e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${m<=2?"bg-red-100 text-red-600 dark:bg-red-500/20":"bg-slate-100 text-slate-600 dark:bg-white/10"}`,children:m<0?"Exp.":`${m}d`})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:i.description})]})]},i.id)}):We.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Ce,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):We.slice(0,5).map((i,m)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs font-bold text-slate-400 w-4",children:m+1}),e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-white",children:i.label})]}),e.jsx("span",{className:"text-[10px] font-bold bg-purple-100 text-purple-600 dark:bg-purple-500/20 dark:text-purple-300 px-2 py-1 rounded-full",children:i.value})]},m))});return e.jsxs("div",{className:`flex h-screen bg-slate-50 dark:bg-[#020617] transition-colors duration-500 overflow-hidden ${c?"dark":""}`,children:[!t&&e.jsx("div",{className:"absolute inset-0 z-[100]",children:e.jsx(Xa,{onLogin:W})}),e.jsxs("div",{className:`dashboard-root flex h-full w-full transition-all duration-700 ease-in-out ${t?"filter-none scale-100 opacity-100":"blur-[5px] scale-[1.02] pointer-events-none grayscale-[0.2]"}`,children:[e.jsx(Wa,{currentView:l==="fast-track"?"demands":l,setView:ye,user:t,onLogout:ne,toggleTheme:oe,isDarkMode:c,systemConfig:O,showMobileDock:x}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 transition-all duration-300 relative lg:my-4 lg:mr-4 lg:ml-4",children:[!Fe&&e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-[1000] bg-amber-500/90 backdrop-blur-sm text-white text-xs font-bold text-center py-1.5 flex items-center justify-center gap-2 lg:rounded-t-[2.5rem]",children:[e.jsx(La,{className:"w-3 h-3"})," Modo Offline. As alterações serão salvas localmente."]}),e.jsxs("div",{className:`
                        flex-1 relative overflow-hidden flex flex-col glass-container
                        ${l==="map"?"rounded-none md:rounded-[2.5rem] lg:border-0":"rounded-[2.5rem]"}
                    `,children:[le&&e.jsxs("div",{className:`fixed top-6 right-6 z-[1000] px-4 py-3 rounded-xl shadow-2xl border flex items-center gap-3 animate-in slide-in-from-right duration-300 ${le.type==="success"?"bg-green-500 text-white border-green-600":"bg-red-500 text-white border-red-600"}`,children:[le.type==="success"?e.jsx(Ge,{className:"w-5 h-5"}):e.jsx(qt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-sm",children:le.message})]}),e.jsxs(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(we,{className:"w-8 h-8 animate-spin text-brand-500"})}),children:[["dashboard","new-demand","edit-demand","admin_panel","demands","people"].includes(l)&&e.jsxs("div",{className:"absolute inset-0 overflow-y-auto custom-scrollbar p-4 lg:p-6 pb-32 lg:pb-6",onScroll:b,ref:N,children:[e.jsx("div",{className:"lg:hidden h-2 w-full"}),l==="dashboard"&&e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 shrink-0",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white tracking-tight",children:["Olá, ",t?t.name.split(" ")[0]:"Bem-vindo"]})}),e.jsx(gs,{locations:be})]}),e.jsx(ta,{status:T,setStatus:A,priority:H,setPriority:I,timeRange:f,setTimeRange:$,scope:P,setScope:V,className:"sticky top-0 z-30"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 shrink-0",children:[e.jsx(ze,{title:Q.stat1.label,value:typeof Q.stat1.value=="string"?0:Q.stat1.value,subValue:typeof Q.stat1.value=="string"?Q.stat1.value:void 0,icon:Q.stat1.icon,colorClass:Q.stat1.color,textClass:Q.stat1.text}),e.jsx(ze,{title:Q.stat2.label,value:typeof Q.stat2.value=="string"?0:Q.stat2.value,subValue:typeof Q.stat2.value=="string"?Q.stat2.value:void 0,icon:Q.stat2.icon,colorClass:Q.stat2.color,textClass:Q.stat2.text}),e.jsx(ze,{title:Q.stat3.label,value:typeof Q.stat3.value=="string"?0:Q.stat3.value,subValue:typeof Q.stat3.value=="string"?Q.stat3.value:void 0,icon:Q.stat3.icon,colorClass:Q.stat3.color,textClass:Q.stat3.text}),e.jsx(ze,{title:Q.stat4.label,value:typeof Q.stat4.value=="string"?0:Q.stat4.value,subValue:typeof Q.stat4.value=="string"?Q.stat4.value:void 0,icon:Q.stat4.icon,colorClass:Q.stat4.color,textClass:Q.stat4.text})]}),Me.dashboardWidgets.showAnalytics&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-auto shrink-0",children:[e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(_a,{className:"w-3 h-3"})," ",P==="demands"?"Distribuição por Status":"Cadastros por Mês"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(ks,{data:lt,title:P==="demands"?"Demandas":"Cidadãos"})})]}),e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-3 h-3"})," ",P==="demands"?"Top Bairros (Demandas)":"Top Bairros (Residentes)"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Ns,{data:We})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 min-h-0",children:[e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${F!=="activity"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(Ve,{value:F,onChange:i=>D(i),options:[{value:"activity",label:"Atividade Recente",icon:dt},{value:"upcoming",label:"Próx. Prazos",icon:ft}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(dt,{className:"w-4 h-4"})," Atividades Recentes"]}),e.jsxs("button",{onClick:()=>d(P==="demands"?"demands":"people"),className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(et,{className:"w-3 h-3"})]})]}),ve()]}),e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${F!=="upcoming"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(Ve,{value:F,onChange:i=>D(i),options:[{value:"activity",label:"Atividade Recente",icon:dt},{value:"upcoming",label:"Próx. Prazos",icon:ft}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(ft,{className:"w-4 h-4"})," ",P==="demands"?"Próximos Prazos":"Top Bairros"]}),e.jsxs("button",{onClick:()=>{P==="demands"?(v("calendar"),d("demands")):d("map")},className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(et,{className:"w-3 h-3"})]})]}),Ue()]})]})]}),l==="new-demand"&&e.jsx(Ka,{initialSearchTerm:S||void 0,onSuccess:i=>{Ne(),d("demands"),U(null)},onCancel:()=>{d("demands"),U(null)},onNotification:R}),l==="edit-demand"&&j&&e.jsx(Qa,{demand:j,onSuccess:i=>{Ne(),d("demands"),n(null)},onCancel:()=>{d("demands"),n(null)},onNotification:R}),l==="admin_panel"&&t&&e.jsx(js,{currentUser:t,systemConfig:O,onUpdateConfig:_,onUpdateLocation:ke,onNotification:R,onLogout:ne,toggleTheme:oe,isDarkMode:c}),l==="demands"&&e.jsx(Rt,{demands:pe,citizens:se,interactions:$e,users:ue,onViewDemand:()=>{},onEditDemand:i=>{n(i),d("edit-demand")},onCreateDemand:()=>d("new-demand"),onUpdateStatus:De,onInteractionUpdate:Ne,filters:u,setFilters:M,onNotification:R,defaultLocation:be.length>0?be[0]:null,onViewCitizen:xe,initialViewMode:p,mapMarkers:Ee,initialSelectionId:te,clearSelection:()=>L(null)}),l==="people"&&e.jsx(vs,{initialSearchTerm:S||void 0,onCreateDemand:i=>{U(i),d("new-demand")},onEditDemand:i=>{n(i),d("edit-demand")},onNotification:R,onPersonUpdate:Ne,permissions:Me,onModeChange:C,demands:E})]}),l==="fast-track"&&e.jsx(fs,{onBack:()=>d("demands"),onSuccess:i=>{U(i),d("new-demand")}}),l==="map"&&e.jsx("div",{className:"absolute inset-0 z-0 flex flex-col overflow-hidden pb-[76px] md:pb-0",children:e.jsx(Rt,{demands:pe,citizens:se,interactions:$e,users:ue,onViewDemand:()=>{},onEditDemand:i=>{n(i),d("edit-demand")},onCreateDemand:()=>d("new-demand"),onUpdateStatus:De,onInteractionUpdate:Ne,filters:u,setFilters:M,onNotification:R,initialViewMode:"map",defaultLocation:be.length>0?be[0]:null,onViewCitizen:xe,mapMarkers:Ee,initialSelectionId:te,clearSelection:()=>L(null),mapFocus:ae,initialMapViewMode:ie})})]})]})]})]})]})};console.log("Iniciando Gabinete Digital (Main)...");const jt=document.getElementById("root");if(!jt)console.error("ERRO CRÍTICO: Elemento 'root' não encontrado no HTML.");else try{ht.createRoot(jt).render(e.jsx(Ae.StrictMode,{children:e.jsx(aa,{})})),console.log("React montado com sucesso via src/main.tsx")}catch(t){console.error("Erro ao montar React:",t),jt.innerHTML='<div style="color:red; padding: 20px;">Erro ao carregar a aplicação. Verifique o console.</div>'}console.log("Iniciando Gabinete Digital...");const kt=document.getElementById("root");if(!kt)console.error("ERRO CRÍTICO: Elemento 'root' não encontrado no HTML.");else try{ht.createRoot(kt).render(e.jsx(Ae.StrictMode,{children:e.jsx(aa,{})})),console.log("React montado com sucesso.")}catch(t){console.error("Erro ao montar React:",t),kt.innerHTML='<div style="color:red; padding: 20px;">Erro ao carregar a aplicação. Verifique o console.</div>'}export{us as D,as as P,ze as S,ps as a,Ye as b,Ve as c,qe as f,re as i,e as j,z as s};
