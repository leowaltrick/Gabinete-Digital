const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PeopleManager-Bc4_vqKP.js","assets/vendor-Ch640rW9.js","assets/db-D0DtOM0q.js","assets/maps-BH1Tlc0s.js","assets/AdminScreen-8fCEdxRu.js"])))=>i.map(i=>d[i]);
import{c as Vt,a as Yt,b as Kt,R as De,r as a,H as Qt,L as Ke,U as Pe,M as $t,d as Zt,P as Xt,e as ea,S as ut,f as ta,h as wt,i as aa,j as lt,A as gt,k as Be,l as me,m as nt,n as ge,F as ft,X as Se,o as Pt,C as fe,p as at,q as sa,s as ra,t as tt,B as la,u as _t,v as na,w as oa,x as Je,y as Lt,z as da,D as ot,E as ue,Z as We,G as $e,I as Fe,J as Ve,K as Mt,N as ia,O as Ot,Q as ca,T as xa,V as ha,W as st,Y as vt,_ as ma,$ as ba,a0 as ua,a1 as pa,a2 as rt,a3 as ga,a4 as fa,a5 as wa,a6 as va,a7 as jt,a8 as ja,a9 as pt,aa as ka,ab as Na,ac as kt,ad as Nt,ae as yt,af as Rt,ag as ya,ah as Ca,ai as Sa,aj as zt,ak as Da,al as Ea,am as xt,an as Ia}from"./vendor-Ch640rW9.js";import{c as Aa}from"./db-D0DtOM0q.js";import{l as ye,M as Ut,T as Ft,a as Gt,u as Ht,C as Ta,P as qt}from"./maps-BH1Tlc0s.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))x(m);new MutationObserver(m=>{for(const n of m)if(n.type==="childList")for(const b of n.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&x(b)}).observe(document,{childList:!0,subtree:!0});function l(m){const n={};return m.integrity&&(n.integrity=m.integrity),m.referrerPolicy&&(n.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?n.credentials="include":m.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function x(m){if(m.ep)return;m.ep=!0;const n=l(m);fetch(m.href,n)}})();var ht={exports:{}},He={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ct;function $a(){if(Ct)return He;Ct=1;var t=Vt(),o=Symbol.for("react.element"),l=Symbol.for("react.fragment"),x=Object.prototype.hasOwnProperty,m=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function b(N,p,y){var w,j={},d=null,C=null;y!==void 0&&(d=""+y),p.key!==void 0&&(d=""+p.key),p.ref!==void 0&&(C=p.ref);for(w in p)x.call(p,w)&&!n.hasOwnProperty(w)&&(j[w]=p[w]);if(N&&N.defaultProps)for(w in p=N.defaultProps,p)j[w]===void 0&&(j[w]=p[w]);return{$$typeof:o,type:N,key:d,ref:C,props:j,_owner:m.current}}return He.Fragment=l,He.jsx=b,He.jsxs=b,He}var St;function Pa(){return St||(St=1,ht.exports=$a()),ht.exports}var e=Pa(),Ze={},Dt;function _a(){if(Dt)return Ze;Dt=1;var t=Yt();return Ze.createRoot=t.createRoot,Ze.hydrateRoot=t.hydrateRoot,Ze}var La=_a();const Ma=Kt(La),Oa="modulepreload",Ra=function(t){return"/Gabinete-Digital/"+t},Et={},Bt=function(o,l,x){let m=Promise.resolve();if(l&&l.length>0){let b=function(y){return Promise.all(y.map(w=>Promise.resolve(w).then(j=>({status:"fulfilled",value:j}),j=>({status:"rejected",reason:j}))))};document.getElementsByTagName("link");const N=document.querySelector("meta[property=csp-nonce]"),p=(N==null?void 0:N.nonce)||(N==null?void 0:N.getAttribute("nonce"));m=b(l.map(y=>{if(y=Ra(y),y in Et)return;Et[y]=!0;const w=y.endsWith(".css"),j=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${j}`))return;const d=document.createElement("link");if(d.rel=w?"stylesheet":Oa,w||(d.as="script"),d.crossOrigin="",d.href=y,p&&d.setAttribute("nonce",p),document.head.appendChild(d),w)return new Promise((C,D)=>{d.addEventListener("load",C),d.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${y}`)))})}))}function n(b){const N=new Event("vite:preloadError",{cancelable:!0});if(N.payload=b,window.dispatchEvent(N),!N.defaultPrevented)throw b}return m.then(b=>{for(const N of b||[])N.status==="rejected"&&n(N.reason);return o().catch(n)})},za=De.memo(({currentView:t,setView:o,user:l,onLogout:x,toggleTheme:m,isDarkMode:n,systemConfig:b,showMobileDock:N=!0})=>{const[p,y]=a.useState(!0),[w,j]=a.useState(!1),d=p||w,C=l&&b[l.role]?b[l.role]:{allowedViews:[]},$=[{id:"dashboard",label:"Home",icon:Qt},{id:"demands",label:"Demandas",icon:Ke},{id:"people",label:"Cidadãos",icon:Pe},{id:"map",label:"Mapa",icon:$t}].filter(v=>C.allowedViews.includes(v.id)),J=v=>v.split("_").map(P=>P.charAt(0).toUpperCase()+P.slice(1)).join(" "),I=v=>{o(v)};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`
          hidden lg:flex
          transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]
          flex-col will-change-transform group z-40 overflow-hidden
          static h-auto
          my-4 ml-4 mr-0
          rounded-[2.5rem] border border-white/60 dark:border-white/5
          bg-white/80 dark:bg-[#020617]/80 backdrop-blur-2xl
          shadow-xl shadow-slate-200/50 dark:shadow-black/20
          ${d?"w-72":"w-24"}
        `,onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),children:[e.jsxs("div",{className:`p-6 flex items-center ${d?"justify-between":"justify-center"} border-b border-slate-100 dark:border-white/5 h-28 shrink-0 relative`,children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden whitespace-nowrap",children:[e.jsx("div",{className:`w-12 h-12 min-w-[3rem] bg-gradient-to-br from-brand-500 to-brand-600 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-500/30 ring-1 ring-white/20 transition-transform duration-300 ${!d&&!p?"scale-110":""}`,children:e.jsx(Zt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:`transition-all duration-300 origin-left ${d?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight text-slate-900 dark:text-white leading-none",children:"Gabinete"}),e.jsx("span",{className:"text-[10px] text-brand-600 dark:text-brand-400 font-bold tracking-[0.2em] uppercase",children:"Digital"})]})]}),e.jsx("button",{onClick:()=>y(!p),className:`
                flex absolute right-6 top-1/2 -translate-y-1/2 text-slate-400 dark:text-white/30 hover:text-brand-600 dark:hover:text-white transition-all duration-300
                ${d?"opacity-0 group-hover:opacity-100 delay-100":"opacity-0 pointer-events-none"}
            `,title:p?"Desafixar menu":"Fixar menu",children:p?e.jsx(Xt,{className:"w-4 h-4"}):e.jsx(ea,{className:"w-4 h-4"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-x-hidden overflow-y-auto custom-scrollbar flex flex-col",children:$.map(v=>{const P=v.icon,A=t===v.id;return e.jsxs("button",{onClick:()=>I(v.id),disabled:!l,className:`
                  w-full flex items-center gap-4 px-4 py-3.5 rounded-2xl text-sm font-bold transition-all duration-300 relative group/item
                  ${l?"":"opacity-30 cursor-not-allowed"}
                  ${A?"bg-brand-500/10 dark:bg-white/10 text-brand-700 dark:text-white shadow-sm ring-1 ring-brand-500/20 dark:ring-white/10":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white"}
                  ${d?"":"justify-center"}
                `,children:[e.jsx(P,{className:`w-6 h-6 min-w-[1.5rem] transition-transform duration-300 ${A?"scale-110":"group-hover/item:scale-110"}`}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${d?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 w-0 hidden"}`,children:v.label}),A&&d&&e.jsx("div",{className:"absolute right-4 w-1.5 h-1.5 rounded-full bg-brand-500 shadow-[0_0_8px_currentColor]"})]},v.id)})}),e.jsxs("div",{className:"p-4 border-t border-slate-100 dark:border-white/5 shrink-0 space-y-2",children:[e.jsxs("button",{onClick:m,className:`
                  lg:hidden w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5
                  ${d?"":"justify-center"}
                `,children:[n?e.jsx(ut,{className:"w-5 h-5 min-w-[1.25rem] text-amber-400"}):e.jsx(ta,{className:"w-5 h-5 min-w-[1.25rem] text-slate-600"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${d?"opacity-100":"opacity-0 w-0 hidden"}`,children:n?"Modo Claro":"Modo Escuro"})]}),l&&e.jsxs("button",{onClick:()=>I("admin_panel"),className:`
                  w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium transition-all
                  ${t==="admin_panel"?"bg-slate-100 dark:bg-white/10 text-brand-700 dark:text-brand-300":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5"}
                  ${d?"":"justify-center"}
                `,children:[e.jsx(wt,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${d?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Configurações"})]}),e.jsxs("button",{onClick:x,disabled:!l,className:`
                w-full flex items-center gap-4 px-4 py-3 rounded-2xl text-sm font-medium text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors
                ${d?"":"justify-center"}
                `,children:[e.jsx(aa,{className:"w-5 h-5 min-w-[1.25rem]"}),e.jsx("span",{className:`whitespace-nowrap transition-all duration-300 ${d?"opacity-100":"opacity-0 w-0 hidden"}`,children:"Sair"})]}),e.jsxs("div",{className:`mt-2 flex items-center gap-3 p-2 rounded-2xl border transition-all duration-300 
                ${d?"bg-slate-50/50 dark:bg-white/5 border-slate-100 dark:border-white/5":"bg-transparent border-transparent justify-center"}
            `,children:[e.jsx("div",{className:"w-9 h-9 min-w-[2.25rem] rounded-full bg-slate-200 dark:bg-slate-800 flex items-center justify-center overflow-hidden border border-white dark:border-white/10 shadow-sm",children:l!=null&&l.avatar?e.jsx("img",{src:l.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(lt,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"})}),e.jsxs("div",{className:`flex-1 min-w-0 overflow-hidden transition-all duration-300 ${d?"opacity-100":"opacity-0 w-0 hidden"}`,children:[e.jsx("p",{className:"text-xs font-bold truncate text-slate-800 dark:text-white",children:l?l.name.split(" ")[0]:"..."}),e.jsx("p",{className:"text-[9px] text-brand-600 dark:text-brand-400 font-bold uppercase truncate tracking-wider",children:l?J(l.role):""})]})]})]})]}),e.jsx("nav",{className:`
            lg:hidden fixed bottom-0 left-0 right-0 z-[900] 
            bg-white/95 dark:bg-[#0f172a]/95 backdrop-blur-xl 
            border-t border-slate-200 dark:border-white/10 
            pb-safe-area shadow-[0_-4px_20px_rgba(0,0,0,0.05)]
            transition-transform duration-300 ease-in-out
            ${N?"translate-y-0":"translate-y-full"}
        `,children:e.jsxs("div",{className:"flex items-center justify-around h-[76px] px-2 pb-2",children:[$.map(v=>{const P=t===v.id,A=v.icon;return e.jsxs("button",{onClick:()=>I(v.id),className:`
                    flex flex-col items-center justify-center gap-1.5 w-full h-full transition-all duration-200 active:scale-95
                    ${P?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`
                    relative p-2 rounded-2xl transition-all duration-300
                    ${P?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}
                `,children:e.jsx(A,{className:`w-6 h-6 transition-all ${P?"stroke-[2.5px] scale-110":"stroke-2"}`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide transition-opacity ${P?"opacity-100":"opacity-60"}`,children:v.label})]},v.id)}),e.jsxs("button",{onClick:()=>I("admin_panel"),className:`
                flex flex-col items-center justify-center gap-1.5 w-full h-full transition-all duration-200 active:scale-95
                ${t==="admin_panel"?"text-brand-600 dark:text-brand-400":"text-slate-400 dark:text-slate-500"}
                `,children:[e.jsx("div",{className:`relative p-2 rounded-2xl transition-all duration-300 ${t==="admin_panel"?"bg-brand-50 dark:bg-brand-500/20 -translate-y-1":""}`,children:e.jsx(wt,{className:`w-6 h-6 ${t==="admin_panel"?"stroke-[2.5px]":"stroke-2"}`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide ${t==="admin_panel"?"opacity-100":"opacity-60"}`,children:"Configurações"})]})]})})]})});var _e=(t=>(t.MUNICIPAL="Municipal",t.ESTADUAL="Estadual",t.FEDERAL="Federal",t))(_e||{}),G=(t=>(t.PENDING="Pendente",t.IN_PROGRESS="Em Andamento",t.COMPLETED="Concluído",t))(G||{}),Q=(t=>(t.LOW="Baixa",t.MEDIUM="Média",t.HIGH="Alta",t))(Q||{}),Ye=(t=>(t.SOLICITACAO="Solicitação",t.RECLAMACAO="Reclamação",t.ELOGIO="Elogio",t.DENUNCIA="Denúncia",t.SUGESTAO="Sugestão",t))(Ye||{});const Ua="yioefhebxsohutdypxqd",It=`https://${Ua}.supabase.co`,At="sb_publishable_ltKmfB3EreWKb757l0c6mw__0FBPSeR",M=It&&At?Aa(It,At):null,re=()=>!!M,Le=t=>{const o=t.replace(/\D/g,"");return o.length>11?t.slice(0,15):o.length>10?o.replace(/^(\d\d)(\d{5})(\d{4}).*/,"($1) $2-$3"):o.length>5?o.replace(/^(\d\d)(\d{4})(\d{0,4}).*/,"($1) $2-$3"):o.length>2?o.replace(/^(\d\d)(\d{0,5})/,"($1) $2"):o},Ue=t=>t.replace(/\D/g,""),Fa=t=>{if(!t)return new Date;if(t.length===10&&t.includes("-")){const[o,l,x]=t.split("-").map(Number);return new Date(o,l-1,x)}return new Date(t)},qe=t=>t?Fa(t).toLocaleDateString("pt-BR"):"",Ga=({initialSearchTerm:t,onSuccess:o,onCancel:l,onNotification:x})=>{const[m,n]=a.useState(""),[b,N]=a.useState([]),[p,y]=a.useState(!1),[w,j]=a.useState(!1),[d,C]=a.useState(null),[D,$]=a.useState(!1),J=a.useRef(null),[I,v]=a.useState(""),[P,A]=a.useState(""),[V,L]=a.useState(""),[K,q]=a.useState(""),[U,h]=a.useState(""),[T,i]=a.useState(!1),[r,S]=a.useState(""),[H,Z]=a.useState(""),[k,O]=a.useState(""),[se,ae]=a.useState(""),[W,ee]=a.useState(""),[ne,f]=a.useState(""),[F,X]=a.useState(""),[oe,Ee]=a.useState(_e.MUNICIPAL),[we,Ie]=a.useState(G.PENDING),[pe,ce]=a.useState(Q.MEDIUM),[Ne,Oe]=a.useState(Ye.SOLICITACAO),[xe,Re]=a.useState(""),[ve,Ae]=a.useState([]),[je,u]=a.useState(""),[_,B]=a.useState(!1),[R,le]=a.useState(!1);a.useEffect(()=>{const s=new Date;s.setDate(s.getDate()+7),Re(s.toISOString().split("T")[0]),t&&(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)?ke(t):(n(t),he(t)))},[]),a.useEffect(()=>{const s=E=>{J.current&&!J.current.contains(E.target)&&y(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const de=s=>({id:s.id||"temp-id",cpf:s.cpf,name:`${s.nome} ${s.sobrenome}`,email:s.email||"",phone:s.telefone||"",logradouro:s.logradouro,numero:s.numero,complemento:s.complemento||void 0,bairro:s.bairro,cep:s.cep,cidade:s.cidade,estado:s.estado}),be=s=>{s.cep&&h(s.cep),s.logradouro&&S(s.logradouro),s.numero&&Z(s.numero),s.bairro&&O(s.bairro),s.cidade&&ae(s.cidade),s.estado&&ee(s.estado)},ke=async s=>{if(re()&&M){const{data:E}=await M.from("citizens").select("*").eq("id",s).maybeSingle();if(E){const z=de(E);C(z),n(z.name),be(z),$(!1)}}},he=async s=>{if(!(!s||s.length<2)){j(!0),y(!0),N([]);try{if(re()&&M){const E=Ue(s);let z=M.from("citizens").select("*").limit(10);E.length>3?z=z.or(`telefone.ilike.%${E}%,nome.ilike.%${s}%,sobrenome.ilike.%${s}%`):z=z.or(`nome.ilike.%${s}%,sobrenome.ilike.%${s}%`);const{data:Y}=await z;Y&&N(Y.map(te=>de(te)))}}catch(E){console.error(E)}finally{j(!1)}}},Qe=s=>{C(s),n(s.name),y(!1),$(!1),be(s)},dt=()=>{C(null),$(!0),y(!1);const s=Ue(m);if(s.length>=8)L(s);else{const E=m.split(" ");E.length>0&&v(E[0]),E.length>1&&A(E.slice(1).join(" "))}},it=async()=>{const s=U.replace(/\D/g,"");if(s.length===8){i(!0);try{const z=await(await fetch(`https://viacep.com.br/ws/${s}/json/`)).json();z.erro||(S(z.logradouro),O(z.bairro),ae(z.localidade),ee(z.uf))}catch(E){console.error(E)}finally{i(!1)}}},c=async s=>{if(s.preventDefault(),!ne||!F){x&&x("error","Preencha título e descrição.");return}if(D&&!d){if(!I){x&&x("error","Nome é obrigatório.");return}if(!V){x&&x("error","Telefone é obrigatório.");return}}le(!0);try{let E=d==null?void 0:d.id;if(D&&!E){const te=Ue(V);if(!navigator.onLine)E=crypto.randomUUID();else if(re()&&M){const{data:ie}=await M.from("citizens").select("id").eq("telefone",te).maybeSingle();if(ie)E=ie.id;else{const{data:Te,error:Ge}=await M.from("citizens").insert({nome:I,sobrenome:P||".",telefone:te,email:K||null,cep:U||null,logradouro:r||null,numero:H||null,bairro:k||null,cidade:se||null,estado:W||null}).select().single();if(Ge)throw Ge;E=Te.id}}}const z=crypto.randomUUID(),Y={id:z,title:ne,description:F,level:oe,status:we,priority:pe,type:Ne,deadline:xe||null,citizen_id:E,tags:ve,created_at:new Date().toISOString()};if(navigator.onLine){if(re()&&M){const{error:te}=await M.from("demands").insert(Y);if(te)throw te;x&&x("success","Demanda criada com sucesso!")}}else{const te=localStorage.getItem("offline_demands_queue"),ie=te?JSON.parse(te):[];ie.push(Y),localStorage.setItem("offline_demands_queue",JSON.stringify(ie)),x&&x("success","Salvo Offline! Será sincronizado quando online.")}setTimeout(()=>o(z),1e3)}catch(E){x&&x("error",`Erro: ${E.message}`),le(!1)}},g=()=>{je.trim()&&!ve.includes(je.trim())&&(Ae([...ve,je.trim()]),u(""),B(!1))};return e.jsxs("div",{className:"h-full flex flex-col relative animate-in fade-in slide-in-from-right duration-500 pb-20",children:[e.jsx("div",{className:"shrink-0 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:l,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:e.jsx(gt,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-2",children:"Nova Demanda"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50 font-medium",children:"Preencha os dados da solicitação."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar pb-6 -mr-2 pr-2",children:e.jsx("div",{className:"max-w-none mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 items-start",children:[e.jsxs("div",{className:"lg:col-span-7 space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-visible z-20",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[e.jsx(lt,{className:"w-4 h-4"})," Solicitante"]})}),e.jsxs("div",{className:"relative",ref:J,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:m,onChange:s=>n(s.target.value),onKeyDown:s=>s.key==="Enter"&&he(m),placeholder:"Buscar por Nome ou Telefone (Enter)",className:`w-full pl-10 pr-10 py-3 glass-input border rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium transition-all ${D?"border-blue-300 dark:border-blue-500/50":"border-slate-300 dark:border-white/10"}`,autoComplete:"off"}),e.jsx(Be,{className:"w-5 h-5 text-slate-400 absolute left-3 top-3.5"}),w&&e.jsx(me,{className:"absolute right-3 top-3.5 w-5 h-5 text-brand-500 animate-spin"})]}),p&&!d&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden max-h-60 overflow-y-auto z-50",children:b.length>0?b.map(s=>e.jsxs("button",{onClick:()=>Qe(s),className:"w-full text-left p-3 hover:bg-slate-50 dark:hover:bg-white/5 border-b border-slate-100 dark:border-white/5 flex flex-col",children:[e.jsx("span",{className:"font-bold text-slate-800 dark:text-white text-sm",children:s.name}),e.jsxs("div",{className:"flex gap-2 text-xs text-slate-500",children:[s.phone&&e.jsx("span",{children:Le(s.phone)}),s.bairro&&e.jsxs("span",{children:["• ",s.bairro]})]})]},s.id)):!w&&m.length>2&&e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Nenhum resultado."}),e.jsx("button",{onClick:dt,className:"text-sm font-bold text-brand-600 hover:underline",children:"Cadastrar Novo"})]})})]}),d&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-slate-50 dark:bg-white/5 p-4 rounded-2xl border border-slate-100 dark:border-white/5 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white dark:bg-slate-800 rounded-full border border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 font-bold text-brand-600",children:d.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-slate-900 dark:text-white",children:d.name}),e.jsx("p",{className:"text-xs text-slate-500",children:Le(d.phone)})]})]}),e.jsx("button",{onClick:()=>{C(null),n("")},className:"text-xs text-red-500 hover:underline",children:"Trocar"})]}),D&&!d&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl border border-blue-100 dark:border-blue-500/20 animate-in fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300 text-xs font-bold uppercase",children:[e.jsx(nt,{className:"w-4 h-4"})," Novo Cadastro"]}),e.jsx("button",{onClick:()=>$(!1),className:"text-xs text-slate-400 hover:text-slate-600",children:"Cancelar"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Nome",value:I,onChange:s=>v(s.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"text",placeholder:"Sobrenome",value:P,onChange:s=>A(s.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"}),e.jsx("input",{type:"tel",placeholder:"Telefone (Só números)",value:V,onChange:s=>L(Ue(s.target.value)),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500",required:!0}),e.jsx("input",{type:"email",placeholder:"Email (Opcional)",value:K,onChange:s=>q(s.target.value),className:"w-full px-3 py-2.5 rounded-xl border border-blue-200 dark:border-blue-500/30 glass-input text-sm outline-none focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx(ge,{className:"w-4 h-4"})," Endereço da Ocorrência"]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"CEP"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:U,onChange:s=>h(s.target.value),onBlur:it,className:"w-full pl-9 pr-8 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm",placeholder:"00000-000"}),e.jsx(Be,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400"}),T&&e.jsx(me,{className:"absolute right-3 top-3 w-4 h-4 text-brand-500 animate-spin"})]})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Cidade"}),e.jsx("input",{type:"text",value:se,onChange:s=>ae(s.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-9",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Logradouro"}),e.jsx("input",{type:"text",value:r,onChange:s=>S(s.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-3",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Número"}),e.jsx("input",{type:"text",value:H,onChange:s=>Z(s.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-8 sm:col-span-8",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"Bairro"}),e.jsx("input",{type:"text",value:k,onChange:s=>O(s.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm"})]}),e.jsxs("div",{className:"col-span-4 sm:col-span-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 dark:text-white/50 uppercase mb-1 block",children:"UF"}),e.jsx("input",{type:"text",value:W,onChange:s=>ee(s.target.value),className:"w-full px-3 py-2.5 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm uppercase",maxLength:2})]})]})]})]}),e.jsx("div",{className:"lg:col-span-5 space-y-6",children:e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[e.jsx(ft,{className:"w-4 h-4"})," Detalhes da Solicitação"]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:Ne,onChange:s=>Oe(s.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(Ye).map(s=>e.jsx("option",{value:s,children:s},s))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título"}),e.jsx("input",{type:"text",value:ne,onChange:s=>f(s.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base font-bold text-slate-900 dark:text-white",placeholder:"Ex: Buraco na via"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição"}),e.jsx("textarea",{value:F,onChange:s=>X(s.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none",placeholder:"Descreva a situação em detalhes..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Etiquetas (Tags)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:ve.map(s=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1",children:[s,e.jsx(Se,{onClick:()=>Ae(ve.filter(E=>E!==s)),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500"})]},s))}),_?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text",value:je,onChange:s=>u(s.target.value),className:"flex-1 px-3 py-2 rounded-xl border border-slate-300 dark:border-white/10 glass-input text-sm",placeholder:"Nova tag...",onKeyDown:s=>{s.key==="Enter"&&g()}}),e.jsx("button",{type:"button",onClick:g,className:"px-3 py-2 bg-brand-600 text-white rounded-xl text-xs font-bold",children:"Add"})]}):e.jsxs("button",{type:"button",onClick:()=>B(!0),className:"text-xs text-brand-600 font-bold flex items-center gap-1 hover:underline",children:[e.jsx(Pt,{className:"w-3 h-3"})," Adicionar Tag"]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Inicial"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:we,onChange:s=>Ie(s.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(G).map(s=>e.jsx("option",{value:s,children:s},s))})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível"}),e.jsx("div",{className:"relative",children:e.jsx("select",{value:oe,onChange:s=>Ee(s.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:Object.values(_e).map(s=>e.jsx("option",{value:s,children:s},s))})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:xe,onChange:s=>Re(s.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"}),e.jsx(fe,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.values(Q).map(s=>e.jsxs("label",{className:`flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition-all ${pe===s?s==="Alta"?"text-red-600 bg-red-100":s==="Média"?"text-amber-600 bg-amber-100":"text-green-600 bg-green-100":"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[e.jsx("input",{type:"radio",name:"priority",value:s,checked:pe===s,onChange:()=>ce(s),className:"hidden"}),e.jsx("span",{className:"font-bold text-sm uppercase",children:s})]},s))})]})]})]})]})})]})})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-[60] flex gap-3 md:hidden",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:c,disabled:R,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[R?e.jsx(me,{className:"w-5 h-5 animate-spin"}):navigator.onLine?e.jsx(at,{className:"w-5 h-5"}):e.jsx(sa,{className:"w-5 h-5"}),R?"Salvando...":navigator.onLine?"Criar":"Salvar Offline"]})]}),e.jsxs("div",{className:"hidden md:flex fixed bottom-6 right-6 z-50 gap-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-3 rounded-xl font-bold text-slate-500 bg-white shadow-lg border border-slate-200 hover:bg-slate-50 transition-all",children:"Cancelar"}),e.jsxs("button",{onClick:c,disabled:R,className:"px-8 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-xl flex items-center gap-2 disabled:opacity-70 transition-all",children:[R?e.jsx(me,{className:"w-5 h-5 animate-spin"}):e.jsx(at,{className:"w-5 h-5"}),R?"Salvando...":"Criar Demanda"]})]})]})},Ha=({demand:t,onSuccess:o,onCancel:l,onNotification:x})=>{const[m,n]=a.useState(t.title),[b,N]=a.useState(t.description),[p,y]=a.useState(t.level),[w,j]=a.useState(t.status),[d,C]=a.useState(t.priority),[D,$]=a.useState(t.type||Ye.SOLICITACAO),[J,I]=a.useState(t.deadline?t.deadline.split("T")[0]:""),[v,P]=a.useState(null),[A,V]=a.useState(!1),[L,K]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!(!t.citizenId||!re()||!M)){V(!0);try{const{data:T,error:i}=await M.from("citizens").select("*").eq("id",t.citizenId).maybeSingle();if(T)P(T);else{const{data:r}=await M.from("citizens").select("*").eq("cpf",t.citizenId).maybeSingle();r&&P(r)}}catch(T){console.error("Error fetching citizen details:",T.message||T)}finally{V(!1)}}})()},[t.citizenId]);const q=async h=>{h.preventDefault(),K(!0);try{if(!re()||!M)throw new Error("Supabase não configurado.");const{error:T}=await M.from("demands").update({title:m,description:b,level:p,status:w,priority:d,type:D,deadline:J||null}).eq("id",t.id);if(T)throw T;x&&x("success","Alterações salvas com sucesso!"),setTimeout(()=>o(t.id),1e3)}catch(T){x&&x("error",T.message||"Erro ao atualizar demanda."),K(!1)}},U=h=>{switch(h){case Q.HIGH:return"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-500/10 border-red-200 dark:border-red-500/20";case Q.MEDIUM:return"text-amber-600 dark:text-amber-400 bg-amber-100 dark:bg-amber-500/10 border-amber-200 dark:border-amber-500/20";case Q.LOW:return"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-500/10 border-green-200 dark:border-green-500/20"}};return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24 md:pb-0 animate-in fade-in slide-in-from-right duration-500 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-slate-50/95 dark:bg-[#020617]/95 backdrop-blur-sm z-20 py-2 md:static md:bg-transparent md:py-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:l,className:"p-2 rounded-xl hover:bg-slate-200 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors",children:[" ",e.jsx(gt,{className:"w-6 h-6"})," "]}),e.jsxs("div",{children:[" ",e.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white tracking-tight flex flex-col md:flex-row md:items-center gap-1 md:gap-2",children:[" Edição de Demanda ",e.jsxs("span",{className:"text-xs md:text-sm font-normal text-slate-400 dark:text-white/40 border border-slate-200 dark:border-white/10 px-2 py-0.5 rounded-md font-mono w-fit",children:["#",t.id.slice(0,8)]})," "]})," "]})]}),e.jsxs("div",{className:"hidden md:flex gap-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 dark:text-white/60 hover:bg-slate-100 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white transition-colors border border-transparent",children:" Cancelar "}),e.jsxs("button",{onClick:q,disabled:L,className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-[0_0_20px_rgba(14,165,233,0.3)] transition-all flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[" ",L?e.jsx(me,{className:"w-5 h-5 animate-spin"}):e.jsx(at,{className:"w-5 h-5"})," ",L?"Salvando...":"Salvar Alterações"," "]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-500 via-blue-500 to-brand-500"}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-xs font-bold uppercase tracking-wider text-brand-600 dark:text-brand-400",children:[" ",e.jsx(lt,{className:"w-4 h-4"})," Solicitante Vinculado "]}),A?e.jsxs("div",{className:"flex items-center gap-4 animate-pulse",children:[" ",e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-200 dark:bg-white/10 rounded-full"})," ",e.jsxs("div",{className:"space-y-2 flex-1",children:[" ",e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-white/10 rounded w-1/3"})," ",e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-white/10 rounded w-1/4"})," "]})," "]}):v?e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 md:gap-6",children:[" ",e.jsxs("div",{className:"flex items-center gap-4 md:gap-5",children:[" ",e.jsxs("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-slate-100 dark:bg-slate-900 rounded-full border-2 border-slate-200 dark:border-white/10 flex items-center justify-center shrink-0 shadow-inner",children:[" ",e.jsx("span",{className:"text-xl md:text-2xl font-bold text-brand-600 dark:text-brand-400",children:v.nome.charAt(0)})," "]})," ",e.jsxs("div",{children:[" ",e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-slate-900 dark:text-white",children:[v.nome," ",v.sobrenome]})," ",v.telefone&&e.jsxs("p",{className:"text-slate-500 dark:text-white/50 font-mono text-xs md:text-sm mt-1 flex items-center gap-2",children:[" ",e.jsx(ra,{className:"w-3 h-3"})," ",Le(v.telefone)," "]})," "]})," "]})," ",e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 text-xs md:text-sm",children:[" ",e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 dark:text-white/80 bg-slate-50 dark:bg-white/5 px-3 py-1.5 rounded-lg border border-slate-200 dark:border-white/5",children:[" ",e.jsx(ge,{className:"w-4 h-4 text-brand-500"})," ",v.cidade," - ",v.estado," "]})," "]})," "]}):e.jsx("div",{className:"text-slate-500 dark:text-white/50 italic text-sm",children:"Cidadão não encontrado."})]}),e.jsxs("div",{className:"glass-panel p-4 md:p-8 rounded-3xl border border-slate-200 dark:border-white/10 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx(ft,{className:"w-4 h-4"})," Detalhes da Solicitação "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Tipo de Demanda"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:D,onChange:h=>$(h.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(Ye).map(h=>e.jsx("option",{value:h,children:h},h))," "]})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Título da Ocorrência"})," ",e.jsx("input",{type:"text",value:m,onChange:h=>n(h.target.value),className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-base md:text-lg font-bold text-slate-900 dark:text-white"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Descrição Detalhada"})," ",e.jsx("textarea",{value:b,onChange:h=>N(h.target.value),rows:8,className:"w-full px-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-sm text-slate-900 dark:text-white leading-relaxed resize-none"})," "]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/5",children:[" ",e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/40 uppercase mb-2",children:"Localização Registrada"})," ",e.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-white",children:[" ",e.jsx(ge,{className:"w-5 h-5 text-red-500 shrink-0"})," ",e.jsxs("span",{className:"font-medium text-sm",children:[" ",v==null?void 0:v.logradouro,", ",v==null?void 0:v.numero," - ",v==null?void 0:v.bairro,", ",v==null?void 0:v.cidade,"/",v==null?void 0:v.estado," "]})," "]})," "]})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-3xl border border-slate-200 dark:border-white/10 lg:sticky lg:top-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40",children:[" ",e.jsx(tt,{className:"w-4 h-4"})," Controle de Gestão "]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Status Atual"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:w,onChange:h=>j(h.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(G).map(h=>e.jsx("option",{value:h,children:h},h))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prioridade"})," ",e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[" ",Object.values(Q).map(h=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${d===h?U(h):"border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/50 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[" ",e.jsx("input",{type:"radio",name:"priority",value:h,checked:d===h,onChange:()=>C(h),className:"accent-current"})," ",e.jsx("span",{className:"font-bold text-sm uppercase",children:h})," "]},h))," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Nível de Governo"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsxs("select",{value:p,onChange:h=>y(h.target.value),className:"w-full pl-4 pr-10 py-3 appearance-none glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium [&>option]:bg-white dark:[&>option]:bg-slate-900",children:[" ",Object.values(_e).map(h=>e.jsx("option",{value:h,children:h},h))," "]})," ",e.jsx("div",{className:"absolute right-3 top-3.5 pointer-events-none text-slate-500 dark:text-white/50",children:"▼"})," "]})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-white/80 mb-2",children:"Prazo Limite"})," ",e.jsxs("div",{className:"relative",children:[" ",e.jsx("input",{type:"date",value:J,onChange:h=>I(h.target.value),className:"w-full pl-10 pr-4 py-3 glass-input border border-slate-300 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 text-slate-900 dark:text-white font-medium"})," ",e.jsx(fe,{className:"w-5 h-5 text-slate-400 dark:text-white/40 absolute left-3 top-3.5"})," "]})," "]})]})]})})]}),e.jsxs("div",{className:"md:hidden fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-30 flex gap-3 pb-6",children:[e.jsx("button",{onClick:l,className:"flex-1 py-3 rounded-xl font-bold text-slate-500 dark:text-white/60 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 active:scale-95 transition-all",children:" Cancelar "}),e.jsxs("button",{onClick:q,disabled:L,className:"flex-1 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 active:scale-95 transition-all",children:[" ",L?e.jsx(me,{className:"w-5 h-5 animate-spin"}):e.jsx(at,{className:"w-5 h-5"})," ",L?"Salvando...":"Salvar"," "]})]})]})},qa=()=>e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden pointer-events-none select-none p-4 lg:p-8 flex gap-6 bg-slate-100 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"hidden lg:flex w-72 h-full flex-col gap-8 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-8 opacity-40 blur-[2px] shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-5 w-32 bg-slate-200 dark:bg-white/10 rounded-lg"})]}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-12 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"},t))}),e.jsx("div",{className:"mt-auto h-14 w-full bg-slate-100 dark:bg-white/5 rounded-2xl"})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6 opacity-30 lg:opacity-50 blur-[3px] lg:blur-[1px]",children:[e.jsxs("div",{className:"h-24 w-full bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 flex items-center justify-between px-10 shadow-sm",children:[e.jsx("div",{className:"h-8 w-64 bg-slate-200 dark:bg-white/10 rounded-xl"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-200 dark:bg-white/10"})]})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"h-40 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-6 flex flex-col justify-between shadow-sm",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-100 dark:bg-white/5"}),e.jsx("div",{className:"h-5 w-24 bg-slate-200 dark:bg-white/10 rounded-lg"})]},t))}),e.jsx("div",{className:"flex-1 bg-white dark:bg-[#1e293b] rounded-[2.5rem] border border-slate-200 dark:border-white/5 p-10 flex items-end justify-between gap-6 shadow-sm",children:[40,70,50,90,60,80,50,75,45,65,85,55,70,40,60].map((t,o)=>e.jsx("div",{className:"w-full bg-slate-200 dark:bg-white/5 rounded-t-xl",style:{height:`${t}%`}},o))})]})]}),Ba=({onLogin:t})=>{const[o,l]=a.useState("login"),[x,m]=a.useState(!1),[n,b]=a.useState(!1),[N,p]=a.useState(""),[y,w]=a.useState(""),[j,d]=a.useState(""),[C,D]=a.useState(""),[$,J]=a.useState(null),[I,v]=a.useState(!1),[P,A]=a.useState(null);a.useEffect(()=>{b(!0)},[]);const V=a.useMemo(()=>async i=>{const r=new TextEncoder().encode(i),S=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(S)).map(Z=>Z.toString(16).padStart(2,"0")).join("")},[]),L=a.useMemo(()=>{const i=j;return{length:i.length>=8&&i.length<=12,hasUpper:/[A-Z]/.test(i),isAlphanumeric:/[a-zA-Z]/.test(i)&&/[0-9]/.test(i),match:i===C&&i.length>0}},[j,C]),K=Object.values(L).every(Boolean),q=async i=>{i.preventDefault(),v(!0),A(null);try{if(re()&&M){const r=await V(y),{data:S,error:H}=await M.from("system_users").select("*").eq("email",N).maybeSingle();if(H)throw H;if(!S||S.senha_hash!==r){A("Credenciais inválidas."),v(!1);return}if(!S.ativo){A("Conta desativada."),v(!1);return}if(!S.last_login){J(S),l("new_password"),v(!1);return}await h(S)}else await new Promise(r=>setTimeout(r,800)),N==="admin@admin"&&y==="admin"?await h({id:"demo-admin",email:"admin@admin",name:"Administrador Demo",role:"administrador",avatar:"https://ui-avatars.com/api/?name=Admin&background=0284c7&color=fff"},!0):(A("Credenciais inválidas."),v(!1))}catch{A("Erro ao processar login."),v(!1)}},U=async i=>{if(i.preventDefault(),!(!K||!$)){if(v(!0),A(null),j==="Senha4321"){A("A nova senha não pode ser igual à senha padrão."),v(!1);return}try{if(re()&&M){const r=await V(j),{error:S}=await M.from("system_users").update({senha_hash:r,last_login:new Date().toISOString()}).eq("id",$.id);if(S)throw S;const H={...$,last_login:new Date().toISOString()};await h(H)}}catch(r){A("Erro ao salvar nova senha: "+r.message),v(!1)}}},h=async(i,r=!1)=>{!r&&re()&&M&&o==="login"&&await M.from("system_users").update({last_login:new Date().toISOString()}).eq("id",i.id);const S=r?i:{id:i.id,email:i.email,name:i.nome,role:i.perfil,avatar:`https://ui-avatars.com/api/?name=${i.nome}&background=0284c7&color=fff`};m(!0),setTimeout(()=>{localStorage.setItem("geo_user",JSON.stringify(S)),t(S)},400)},T=({fulfilled:i,label:r})=>e.jsxs("div",{className:`flex items-center gap-2 text-xs transition-colors duration-200 ${i?"text-emerald-600 font-bold":"text-slate-400"}`,children:[e.jsx("div",{className:`w-3.5 h-3.5 rounded-full flex items-center justify-center border ${i?"bg-emerald-500 border-emerald-500 text-white":"border-slate-300 bg-transparent"}`,children:i&&e.jsx(ot,{className:"w-2.5 h-2.5"})}),e.jsx("span",{children:r})]});return e.jsxs("div",{className:`fixed inset-0 z-[100] bg-slate-50 dark:bg-[#020617] transition-all duration-700 overflow-hidden ${x?"opacity-0 scale-105 pointer-events-none":"opacity-100"}`,children:[e.jsx(qa,{}),e.jsx("div",{className:"absolute inset-0 bg-white/40 dark:bg-black/60 backdrop-blur-[4px] z-10 transition-colors duration-700"}),e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col lg:flex-row w-full h-full",children:[e.jsx("div",{className:"w-full lg:w-1/2 h-full flex items-center justify-center p-6 relative",children:e.jsxs("div",{className:`
                  w-full max-w-[440px]
                  bg-white/80 dark:bg-[#0f172a]/70 backdrop-blur-2xl 
                  border border-white/50 dark:border-white/10 
                  shadow-[0_8px_40px_-12px_rgba(0,0,0,0.1)] dark:shadow-black/50
                  rounded-[2.5rem] p-8 md:p-12
                  transform transition-all duration-700 ease-out flex flex-col
                  ${n?"translate-y-0 opacity-100 scale-100":"translate-y-12 opacity-0 scale-95"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-4 mb-10",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand-600 to-brand-700 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-600/20 text-white ring-4 ring-white/50 dark:ring-white/5",children:e.jsx(la,{className:"w-7 h-7"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-extrabold text-slate-900 dark:text-white tracking-tight leading-none",children:["Gabinete",e.jsx("br",{}),"Digital"]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:o==="login"?"Acesso ao Painel":"Configuração Inicial"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1 font-medium",children:o==="login"?"Gerencie seu mandato com eficiência.":"Defina sua senha de segurança."})]}),P&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-500/20 text-red-600 dark:text-red-300 text-sm font-bold rounded-2xl flex items-center gap-3 animate-in slide-in-from-left-2 shadow-sm",children:[e.jsx(nt,{className:"w-5 h-5 flex-shrink-0"}),P]}),o==="login"?e.jsxs("form",{onSubmit:q,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(_t,{className:"w-5 h-5"})}),e.jsx("input",{type:"email",value:N,onChange:i=>p(i.target.value),className:"block w-full pl-11 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Email",required:!0,autoComplete:"email"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-600 transition-colors",children:e.jsx(na,{className:"w-5 h-5"})}),e.jsx("input",{type:"password",value:y,onChange:i=>w(i.target.value),className:"block w-full pl-11 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold shadow-sm",placeholder:"Senha",required:!0,autoComplete:"current-password"})]})]}),e.jsxs("button",{type:"submit",disabled:I,className:"w-full py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-base transition-all transform active:scale-[0.98] shadow-lg shadow-brand-600/20 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed group relative overflow-hidden",children:[I?e.jsx(me,{className:"w-5 h-5 animate-spin"}):e.jsx(oa,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"}),I?"Conectando...":"Entrar"]})]}):e.jsxs("form",{onSubmit:U,className:"space-y-6 animate-in slide-in-from-right-8 duration-500",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"password",value:j,onChange:i=>d(i.target.value),className:"block w-full pl-5 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Nova Senha",maxLength:12,autoComplete:"new-password"})}),e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"password",value:C,onChange:i=>D(i.target.value),className:"block w-full pl-5 pr-4 py-4 bg-white/60 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-2xl text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all outline-none font-bold",placeholder:"Confirmar Senha",maxLength:12,autoComplete:"new-password"})})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-white/5 rounded-2xl border border-slate-100 dark:border-white/5 grid grid-cols-2 gap-3",children:[e.jsx(T,{fulfilled:L.length,label:"8-12 dígitos"}),e.jsx(T,{fulfilled:L.isAlphanumeric,label:"Letras/Números"}),e.jsx(T,{fulfilled:L.hasUpper,label:"Maiúscula"}),e.jsx(T,{fulfilled:L.match,label:"Senhas Iguais"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{l("login"),d(""),D(""),J(null)},className:"flex-1 py-4 bg-white dark:bg-white/5 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-white/10 rounded-2xl font-bold text-sm border border-slate-200 dark:border-white/10 transition-colors",children:"Voltar"}),e.jsxs("button",{type:"submit",disabled:I||!K,className:"flex-[2] py-4 bg-brand-600 hover:bg-brand-500 text-white rounded-2xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 disabled:opacity-50 transition-all",children:[I?e.jsx(me,{className:"w-5 h-5 animate-spin"}):e.jsx(Je,{className:"w-5 h-5"})," Confirmar"]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-200/50 dark:border-white/5 text-center",children:e.jsxs("p",{className:"text-[10px] uppercase font-bold text-slate-400 dark:text-slate-500 tracking-widest",children:["Desenvolvido por ",e.jsx("a",{href:"mailto:leowaltrick@gmail.com?subject=App Gabinete Digital",title:"Entrar em contato",className:"text-brand-600 dark:text-brand-400 hover:opacity-80 transition-opacity",children:"LW Consulting"})]})})]})}),e.jsx("div",{className:"hidden lg:flex w-1/2 h-full items-center justify-center p-12 xl:p-20 relative pointer-events-none",children:e.jsxs("div",{className:`
                  w-full max-w-xl pointer-events-auto
                  transform transition-all duration-1000 delay-200 flex flex-col gap-10
                  ${n?"translate-x-0 opacity-100":"translate-x-20 opacity-0"}
              `,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-extrabold text-slate-900 dark:text-white leading-tight mb-4 drop-shadow-sm",children:["Gestão inteligente",e.jsx("br",{}),"para mandatos modernos."]}),e.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-300 font-medium leading-relaxed",children:"Centralize demandas, acompanhe solicitações e tome decisões estratégicas baseadas em dados."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{title:"Central de Demandas",icon:Ke,desc:"Acompanhe solicitações em tempo real."},{title:"Base de Cidadãos",icon:Pe,desc:"Histórico completo de atendimentos."},{title:"Mapa de Calor",icon:$t,desc:"Geolocalização de ocorrências."},{title:"Gestão de Prazos",icon:fe,desc:"Alertas automáticos de vencimento."},{title:"Analytics",icon:Lt,desc:"Indicadores de desempenho do gabinete."},{title:"Controle de Acesso",icon:da,desc:"Permissões granulares por perfil."}].map((i,r)=>e.jsxs("div",{className:"bg-white/60 dark:bg-black/40 backdrop-blur-md border border-white/40 dark:border-white/10 p-4 rounded-2xl shadow-sm hover:bg-white/80 dark:hover:bg-white/10 transition-colors duration-300",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 mb-3",children:e.jsx(i.icon,{className:"w-5 h-5"})}),e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white text-sm mb-1",children:i.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-snug",children:i.desc})]},r))})]})})]})]})},Me=({options:t,value:o,onChange:l,size:x="md"})=>{const m=t.findIndex(n=>n.value===o);return e.jsxs("div",{className:`bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex relative border border-slate-200 dark:border-white/5 shadow-inner min-w-max ${x==="sm"?"h-9":"h-11"}`,children:[e.jsx("div",{className:"absolute top-1 bottom-1 rounded-lg bg-white dark:bg-slate-600 shadow-sm transition-all duration-300 ease-out z-0",style:{width:`calc(${100/t.length}% - 0.35rem)`,left:`calc(${m*(100/t.length)}% + 0.18rem)`}}),t.map(n=>{const b=o===n.value,N=n.icon;return e.jsxs("button",{onClick:()=>l(n.value),className:`
                flex-1 px-3 text-xs font-bold rounded-lg transition-all duration-300 relative z-10 flex items-center justify-center gap-1.5 whitespace-nowrap
                ${b?"text-brand-600 dark:text-white":"text-slate-500 dark:text-white/40 hover:text-slate-700"}
            `,children:[N&&e.jsx(N,{className:x==="sm"?"w-3 h-3":"w-4 h-4"}),n.label]},n.value)})]})},Ja=({demands:t,citizens:o,onViewDemand:l,onUpdateStatus:x})=>{const[m,n]=a.useState(null),[b,N]=a.useState(G.PENDING),p=[{id:G.PENDING,label:"Pendente",icon:ue,color:"text-slate-500",bg:"bg-slate-100 dark:bg-slate-900/50",border:"border-slate-300 dark:border-slate-700"},{id:G.IN_PROGRESS,label:"Em Andamento",icon:We,color:"text-amber-500",bg:"bg-amber-50 dark:bg-amber-900/10",border:"border-amber-300 dark:border-amber-700"},{id:G.COMPLETED,label:"Concluído",icon:$e,color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/10",border:"border-green-300 dark:border-green-700"}],y=(d,C)=>{n(C),d.dataTransfer.setData("demandId",C),d.dataTransfer.effectAllowed="move"},w=d=>{d.preventDefault(),d.dataTransfer.dropEffect="move"},j=(d,C)=>{d.preventDefault();const D=d.dataTransfer.getData("demandId");D&&x(D,C),n(null)};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500",children:[e.jsx("div",{className:"md:hidden landscape:hidden px-1 pb-3 shrink-0",children:e.jsx(Me,{value:b,onChange:d=>N(d),options:[{value:G.PENDING,label:"Pendente",icon:ue},{value:G.IN_PROGRESS,label:"Andamento",icon:We},{value:G.COMPLETED,label:"Concluído",icon:$e}]})}),e.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-auto md:overflow-visible custom-scrollbar",children:e.jsx("div",{className:"flex flex-col landscape:flex-row md:flex-row h-full landscape:gap-4 md:gap-6 pb-4",children:p.map(d=>{const C=t.filter(I=>I.status===d.id),D=d.icon,J=b===d.id?"flex":"hidden landscape:flex md:flex";return e.jsxs("div",{className:`${J} flex-1 flex-col min-w-0 md:min-w-[320px] md:max-w-md h-full transition-all duration-300`,onDragOver:w,onDrop:I=>j(I,d.id),children:[e.jsxs("div",{className:`p-3 md:p-4 rounded-t-3xl border-x border-t border-slate-200 dark:border-white/10 ${d.bg} backdrop-blur-sm flex justify-between items-center relative md:sticky top-0 z-10 shrink-0`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:`w-5 h-5 ${d.color}`}),e.jsx("h3",{className:"font-bold text-slate-700 dark:text-white text-sm md:text-base",children:d.label})]}),e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-white dark:bg-white/10 text-xs font-bold text-slate-600 dark:text-white shadow-sm border border-slate-100 dark:border-white/5",children:C.length})]}),e.jsx("div",{className:`flex-1 overflow-y-auto p-2 landscape:p-2 md:p-3 space-y-3 border-x border-b border-slate-200 dark:border-white/10 rounded-b-3xl bg-white/30 dark:bg-white/5 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/10 transition-colors ${m?"bg-slate-50/50 dark:bg-white/10":""}`,children:C.length===0?e.jsx("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 dark:text-white/20 border-2 border-dashed border-slate-300 dark:border-white/10 rounded-xl m-2",children:e.jsx("p",{className:"text-sm",children:"Vazio"})}):C.map(I=>{const v=o.find(P=>P.id===I.citizenId);return e.jsxs("div",{draggable:!0,onDragStart:P=>y(P,I.id),onClick:()=>l(I),className:`
                                                    bg-white dark:bg-[#1e293b] rounded-xl border border-slate-200 dark:border-white/5 shadow-sm 
                                                    hover:shadow-md hover:border-brand-500/50 dark:hover:border-brand-500/50 
                                                    transition-all cursor-pointer group relative overflow-hidden active:cursor-grabbing
                                                    p-4 landscape:p-2.5 
                                                `,children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${I.priority===Q.HIGH?"bg-red-500":I.priority===Q.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-2 landscape:mb-1",children:[e.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-white/40 font-mono",children:["#",I.id.slice(0,6)]}),e.jsxs("div",{className:"flex gap-1",children:[I.level===_e.FEDERAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500",title:"Federal"}),I.level===_e.ESTADUAL&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500",title:"Estadual"})]})]}),e.jsx("h4",{className:"font-bold text-slate-800 dark:text-white text-sm leading-snug mb-2 pl-2 group-hover:text-brand-600 dark:group-hover:text-brand-400 transition-colors landscape:mb-1 landscape:line-clamp-2",children:I.title}),e.jsxs("div",{className:"flex items-center gap-2 pl-2 mb-3 landscape:mb-1",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-[10px] font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:(v==null?void 0:v.name.charAt(0))||"?"}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 truncate max-w-[120px] landscape:hidden",children:(v==null?void 0:v.name)||"Não identificado"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100 dark:border-white/5 pl-2 landscape:hidden",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 dark:text-white/40",children:[e.jsx(fe,{className:"w-3 h-3"})," ",new Date(I.createdAt).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"})]}),I.deadline&&e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${new Date(I.deadline)<new Date?"bg-red-100 text-red-600":"bg-slate-100 text-slate-500"} dark:bg-white/10 dark:text-white/60`,children:qe(I.deadline)})]})]},I.id)})})]},d.id)})})})]})},Wa=({demands:t,interactions:o=[],notices:l=[],onEditDemand:x})=>{const[m,n]=a.useState(new Date),[b,N]=a.useState(null),[p,y]=a.useState(!0),[w,j]=a.useState(!0),[d,C]=a.useState(!0),D=m.getFullYear(),$=m.getMonth(),J=new Date(D,$+1,0).getDate(),I=new Date(D,$,1).getDay(),v=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],P=()=>{n(new Date(D,$-1,1)),N(null)},A=()=>{n(new Date(D,$+1,1)),N(null)},V=()=>{const r=new Date;n(r),N(r.getDate())},L=(r,S)=>{const H=r.split("T")[0].split("-").map(Number);return H[2]===S&&H[1]-1===$&&H[0]===D},K=r=>{const S=p?t.filter(k=>k.deadline&&L(k.deadline,r)):[],H=w?o.filter(k=>k.type==="checklist"&&k.deadline&&!k.isCompleted&&L(k.deadline,r)):[],Z=d?l.filter(k=>L(k.date,r)):[];return{demands:S,checklists:H,notices:Z}},q=[...p?t.filter(r=>r.deadline&&r.status!==G.COMPLETED).map(r=>({type:"demand",data:r,date:new Date(r.deadline)})):[],...w?o.filter(r=>r.type==="checklist"&&r.deadline&&!r.isCompleted).map(r=>({type:"checklist",data:r,date:new Date(r.deadline)})):[],...d?l.filter(r=>new Date(r.date)>=new Date).map(r=>({type:"notice",data:r,date:new Date(r.date)})):[]].sort((r,S)=>r.date.getTime()-S.date.getTime()).slice(0,15),U=b?K(b):{demands:[],checklists:[],notices:[]},h=r=>{switch(r){case Q.HIGH:return"bg-red-100 text-red-700 dark:bg-red-500/20 dark:text-red-300 border-l-2 border-red-500";case Q.MEDIUM:return"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300 border-l-2 border-amber-500";case Q.LOW:return"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300 border-l-2 border-green-500"}},T=r=>{switch(r){case"alert":return e.jsx(Ot,{className:"w-3 h-3 text-red-500"});case"event":return e.jsx(fe,{className:"w-3 h-3 text-blue-500"});default:return e.jsx(ia,{className:"w-3 h-3 text-slate-500"})}},i=()=>{const r=[];for(let S=0;S<I;S++)r.push(e.jsx("div",{className:"min-h-[80px] bg-slate-50/30 dark:bg-slate-900/20 border-r border-b border-slate-200 dark:border-white/5"},`empty-${S}`));for(let S=1;S<=J;S++){const{demands:H,checklists:Z,notices:k}=K(S),O=H.length+Z.length+k.length,se=S===new Date().getDate()&&$===new Date().getMonth()&&D===new Date().getFullYear(),ae=S===b;r.push(e.jsxs("div",{onClick:()=>N(S),className:`
                min-h-[80px] md:min-h-[120px] h-auto flex flex-col
                border-r border-b border-slate-200 dark:border-white/5 p-1 md:p-2 relative group hover:bg-slate-50 dark:hover:bg-white/5 transition-colors cursor-pointer
                ${ae?"bg-brand-50 dark:bg-brand-900/10 shadow-[inset_0_0_0_2px_rgba(14,165,233,0.5)]":se?"bg-brand-500/5":"bg-transparent"}
            `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`text-xs md:text-sm font-bold w-6 h-6 md:w-7 md:h-7 flex items-center justify-center rounded-full transition-all
                ${se?"bg-brand-500 text-white shadow-lg shadow-brand-500/30":ae?"bg-slate-900 dark:bg-white text-white dark:text-slate-900":"text-slate-500 dark:text-white/50"}
            `,children:S}),O>0&&e.jsx("span",{className:"text-[9px] bg-slate-200 dark:bg-white/10 text-slate-600 dark:text-white/70 px-1.5 py-0.5 rounded-full font-bold",children:O})]}),e.jsxs("div",{className:"space-y-1 overflow-y-hidden flex-1",children:[e.jsxs("div",{className:"hidden md:block space-y-1",children:[k.map(W=>e.jsxs("div",{className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 ${W.type==="alert"?"border-red-400 bg-red-50 dark:bg-red-500/10":"border-blue-400 bg-blue-50 dark:bg-blue-500/10"}`,children:[T(W.type)," ",W.title]},W.id)),H.slice(0,3-k.length).map(W=>e.jsx("div",{className:`w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 ${h(W.priority)}`,children:W.title},W.id)),Z.slice(0,Math.max(0,3-(H.length+k.length))).map(W=>e.jsxs("div",{className:"w-full text-left text-[9px] px-1.5 py-0.5 rounded truncate font-medium flex items-center gap-1 border-l-2 border-l-slate-400 bg-slate-100 dark:bg-white/5 text-slate-600 dark:text-white/60",children:[e.jsx(Mt,{className:"w-2 h-2"})," ",W.text]},W.id)),H.length+Z.length+k.length>3&&e.jsxs("div",{className:"text-[9px] text-slate-400 pl-1",children:["+ ",O-3," mais"]})]}),e.jsxs("div",{className:"md:hidden flex flex-wrap justify-center content-end h-full pb-1 gap-1",children:[k.map((W,ee)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"},`n-${ee}`)),H.map((W,ee)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-500"},`d-${ee}`)),Z.map((W,ee)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"},`c-${ee}`))]})]})]},S))}return r};return e.jsxs("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-500 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 shrink-0",children:[e.jsxs("button",{onClick:()=>y(!p),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${p?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-500/20 dark:border-brand-500/30 dark:text-brand-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p?"bg-brand-500":"bg-slate-300"}`})," Demandas"]}),e.jsxs("button",{onClick:()=>j(!w),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${w?"bg-slate-100 border-slate-300 text-slate-700 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${w?"bg-slate-500":"bg-slate-300"}`})," Checklists"]}),e.jsxs("button",{onClick:()=>C(!d),className:`px-3 py-1.5 rounded-lg text-xs font-bold border flex items-center gap-2 transition-all ${d?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-500/20 dark:border-blue-500/30 dark:text-blue-300":"bg-white border-slate-200 text-slate-500 dark:bg-white/5 dark:border-white/10 dark:text-white/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${d?"bg-blue-500":"bg-slate-300"}`})," Avisos"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-6 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 glass-panel rounded-3xl shadow-sm border border-slate-200 dark:border-white/10 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 md:p-6 border-b border-slate-200 dark:border-white/10 flex items-center justify-between bg-white/50 dark:bg-white/5 backdrop-blur-sm shrink-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-slate-900 dark:text-white capitalize flex items-center gap-2",children:[e.jsx(fe,{className:"w-6 h-6 text-brand-600 dark:text-brand-400"}),v[$]," ",e.jsx("span",{className:"text-slate-400 dark:text-white/40 font-normal",children:D})]}),e.jsxs("div",{className:"flex bg-white dark:bg-white/10 rounded-xl border border-slate-200 dark:border-white/10 shadow-sm",children:[e.jsx("button",{onClick:P,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-l-xl border-r border-slate-200 dark:border-white/10",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:V,className:"px-4 text-xs font-bold text-slate-600 dark:text-white/70 hover:bg-slate-50 dark:hover:bg-white/10",children:"Hoje"}),e.jsx("button",{onClick:A,className:"p-2 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-600 dark:text-white/70 rounded-r-xl border-l border-slate-200 dark:border-white/10",children:e.jsx(Ve,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"grid grid-cols-7 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(r=>e.jsx("div",{className:"py-2 text-center text-[10px] md:text-xs font-bold text-slate-500 dark:text-white/30 uppercase tracking-wider",children:r},r))}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"grid grid-cols-7 bg-transparent min-h-full",children:i()})})]}),e.jsx("div",{className:"w-full lg:w-80 glass-panel rounded-3xl border border-slate-200 dark:border-white/10 flex flex-col shrink-0 overflow-hidden h-[300px] lg:h-auto",children:b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 flex justify-between items-center shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:[b," de ",v[$]]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-white/50",children:[U.demands.length+U.checklists.length+U.notices.length," eventos"]})]}),e.jsx("button",{onClick:()=>N(null),className:"text-xs text-brand-600 hover:underline",children:"Ver Geral"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar",children:[[...U.notices,...U.demands,...U.checklists].map((r,S)=>e.jsxs("div",{className:"p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10",children:[e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white line-clamp-2",children:r.title||r.text}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-white/50 capitalize",children:r.type==="checklist"?"Tarefa":r.type||"Demanda"})]},S)),U.demands.length===0&&U.notices.length===0&&U.checklists.length===0&&e.jsx("p",{className:"text-center text-xs text-slate-400 mt-4",children:"Nada para este dia."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-slate-900/40 shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-brand-600 dark:text-brand-400"}),"Próximos Prazos"]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-white/50",children:"Visão geral de urgências e avisos"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:q.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-slate-400 dark:text-white/30 text-center",children:[e.jsx(ue,{className:"w-10 h-10 mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Nenhum evento futuro."})]}):q.map((r,S)=>{const H=r.date.getDate()===new Date().getDate(),Z=r.type==="notice"?"bg-blue-50 text-blue-600 border-blue-100 dark:bg-blue-500/10 dark:text-blue-400":r.type==="demand"?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400":"bg-slate-50 text-slate-600 border-slate-100 dark:bg-white/5 dark:text-slate-400";return e.jsxs("div",{onClick:()=>r.type==="demand"&&x(r.data),className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:`w-10 h-10 rounded-lg flex flex-col items-center justify-center font-bold shrink-0 border ${Z}`,children:[e.jsx("span",{className:"text-xs",children:r.date.getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:r.date.toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:r.type==="notice"||r.type==="demand"?r.data.title:r.data.text}),r.type==="demand"&&e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${H?"bg-red-100 text-red-600":"bg-slate-100 text-slate-600"} dark:bg-white/10`,children:H?"HOJE":r.data.status})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:r.type==="notice"?"Aviso Mural":r.type==="demand"?r.data.description:"Tarefa Checklist"})]})]},`${r.type}-${r.data.id}-${S}`)})})]})})]})]})},Va=ye.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41]}),Ya=({demandId:t,lat:o,lon:l,address:x,onClick:m,onLocationUpdate:n})=>{const[b,N]=a.useState(null),[p,y]=a.useState(!1);return a.useEffect(()=>{if(o&&l){N({lat:o,lon:l});return}if(x&&(!o||!l)){y(!0);const j=setTimeout(async()=>{try{const d=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(x)}&limit=1`,C=await fetch(d,{headers:{"User-Agent":"GabineteDigitalApp/1.0"}});if(!C.ok)throw new Error("Falha na requisição de geocodificação");const D=await C.json();if(D&&D.length>0){const $=parseFloat(D[0].lat),J=parseFloat(D[0].lon);if(N({lat:$,lon:J}),re()&&M&&t){const{error:I}=await M.from("demands").update({lat:$,lon:J}).eq("id",t);!I&&n&&n()}}}catch(d){console.error("Geocoding error:",d)}finally{y(!1)}},1500);return()=>clearTimeout(j)}},[o,l,x,t]),!b&&!p?e.jsxs("div",{className:"w-full h-full bg-slate-100 dark:bg-white/5 flex flex-col items-center justify-center text-slate-400",children:[e.jsx(ge,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("span",{className:"text-xs",children:"Sem localização GPS"})]}):e.jsxs("div",{className:"relative w-full h-48 rounded-xl overflow-hidden border border-slate-200 dark:border-white/10 group cursor-pointer",onClick:m,children:[p?e.jsxs("div",{className:"w-full h-full bg-slate-50 dark:bg-white/5 flex flex-col items-center justify-center text-slate-400",children:[e.jsx(me,{className:"w-6 h-6 animate-spin mb-2 text-brand-500"}),e.jsx("span",{className:"text-xs",children:"Buscando endereço..."})]}):b?e.jsxs(Ut,{center:[b.lat,b.lon],zoom:15,scrollWheelZoom:!1,zoomControl:!1,dragging:!1,doubleClickZoom:!1,attributionControl:!1,style:{width:"100%",height:"100%"},children:[e.jsx(Ft,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(Gt,{position:[b.lat,b.lon],icon:Va})]},`${b.lat}-${b.lon}`):null,e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors z-[400] flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"bg-white/90 dark:bg-black/80 backdrop-blur-sm px-3 py-1.5 rounded-full text-xs font-bold text-slate-900 dark:text-white opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-2 transform translate-y-2 group-hover:translate-y-0 duration-200",children:[e.jsx(ca,{className:"w-3 h-3"})," Expandir Mapa"]})})]})},Ka=({demand:t,citizen:o,onClose:l,onEdit:x,onUpdateStatus:m,onInteractionUpdate:n,onNavigate:b,canNavigatePrev:N,canNavigateNext:p,onNotification:y,onViewCitizen:w})=>{const[j,d]=a.useState([]),[C,D]=a.useState(!1),[$,J]=a.useState([]),[I,v]=a.useState(""),[P,A]=a.useState(""),[V,L]=a.useState(""),[K,q]=a.useState(!1),[U,h]=a.useState(t.tags||[]),[T,i]=a.useState(""),[r,S]=a.useState(!1),H=a.useRef(null),[Z,k]=a.useState(!1),[O,se]=a.useState(new Date),ae=a.useRef(null),W=a.useMemo(()=>{const u=localStorage.getItem("geo_user");return u?JSON.parse(u):{name:"Usuário"}},[]);a.useEffect(()=>{ee(),J([]),h(t.tags||[])},[t.id]),a.useEffect(()=>{const u=_=>{ae.current&&!ae.current.contains(_.target)&&k(!1),r&&H.current&&!H.current.contains(_.target)&&_.target.tagName!=="BUTTON"&&S(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[r]);const ee=async()=>{D(!0);try{if(re()&&M){const{data:u,error:_}=await M.from("demand_interactions").select("*").eq("demanda_id",t.id).order("created_at",{ascending:!0});if(_)throw _;u&&d(u.map(B=>({id:B.id,demandId:B.demanda_id,type:B.tipo,text:B.texto,isCompleted:B.concluido,deadline:B.prazo,user:B.usuario,createdAt:B.created_at})))}}catch(u){console.error("Erro ao carregar interações",u)}finally{D(!1)}},ne=async u=>{const _=u==="comentario"?I:P;if(!_.trim())return;const B=crypto.randomUUID(),R={id:B,demandId:t.id,type:u,text:_,isCompleted:!1,deadline:u==="checklist"&&V?V:void 0,user:W.name,createdAt:new Date().toISOString()};d(le=>[...le,R]),J(le=>[...le,B]),u==="comentario"&&v(""),u==="checklist"&&(A(""),L(""),q(!1));try{if(re()&&M){const le={demanda_id:t.id,tipo:u,texto:_,usuario:W.name};u==="checklist"&&(le.concluido=!1,le.prazo=V||null);const{data:de,error:be}=await M.from("demand_interactions").insert(le).select().single();if(be)throw be;de&&(d(ke=>ke.map(he=>he.id===B?{...he,id:de.id,createdAt:de.created_at}:he)),J(ke=>[...ke.filter(he=>he!==B),de.id]),setTimeout(()=>{J(ke=>ke.filter(he=>he!==de.id))},3e3),n&&n())}}catch(le){console.error("Erro ao salvar interação",le),y&&y("error","Erro ao salvar interação"),d(de=>de.filter(be=>be.id!==B)),J(de=>de.filter(be=>be!==B))}},f=async(u,_)=>{d(B=>B.map(R=>R.id===u?{...R,isCompleted:!_}:R));try{re()&&M&&(await M.from("demand_interactions").update({concluido:!_}).eq("id",u),n&&n())}catch(B){console.error("Erro ao atualizar checklist",B),y&&y("error","Erro ao atualizar checklist"),d(R=>R.map(le=>le.id===u?{...le,isCompleted:_}:le))}},F=async u=>{d(_=>_.filter(B=>B.id!==u));try{re()&&M&&(await M.from("demand_interactions").delete().eq("id",u),n&&n())}catch(_){console.error(_)}},X=async()=>{if(!T.trim())return;const u=[...U,T.trim()];h(u),i(""),S(!1);try{re()&&M&&(await M.from("demands").update({tags:u}).eq("id",t.id),n&&n())}catch(_){console.error(_)}},oe=async u=>{const _=U.filter(B=>B!==u);h(_);try{re()&&M&&(await M.from("demands").update({tags:_}).eq("id",t.id),n&&n())}catch(B){console.error(B)}},Ee=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],we=(u,_)=>new Date(u,_+1,0).getDate(),Ie=(u,_)=>new Date(u,_,1).getDay(),pe=u=>{const _=new Date(O.getFullYear(),O.getMonth(),u),B=_.getFullYear(),R=String(_.getMonth()+1).padStart(2,"0"),le=String(_.getDate()).padStart(2,"0");L(`${B}-${R}-${le}`),k(!1)},ce=j.filter(u=>u.type==="checklist"),Ne=j.filter(u=>u.type==="comentario").reverse(),Oe=a.useMemo(()=>{if(ce.length===0)return 0;const u=ce.filter(_=>_.isCompleted).length;return Math.round(u/ce.length*100)},[ce]),xe=[{value:G.PENDING,label:"Pendente",icon:ue},{value:G.IN_PROGRESS,label:"Em Andamento",icon:ue},{value:G.COMPLETED,label:"Concluído",icon:ue}],Re=u=>{const _=u.replace(/\D/g,"");window.open(`https://wa.me/55${_}`,"_blank")},ve=u=>{window.open(`mailto:${u}`,"_blank")},Ae=()=>{const u=new CustomEvent("navigate-to-map",{detail:{demandId:t.id}});window.dispatchEvent(u),l()},je=o?`${o.logradouro}, ${o.numero} - ${o.bairro}, ${o.cidade} - ${o.estado}`:void 0;return e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-end md:items-center justify-center sm:p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity duration-300",onClick:l}),e.jsxs("div",{className:"relative w-full h-full md:h-[90vh] md:max-w-6xl bg-white dark:bg-[#0b1121] md:rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in slide-in-from-bottom-10 md:zoom-in-95 duration-300 border-t md:border border-slate-200 dark:border-white/10",children:[e.jsxs("div",{className:"px-4 py-3 md:px-8 md:py-5 border-b border-slate-200 dark:border-white/10 flex items-start justify-between bg-white/90 dark:bg-[#0b1121]/90 backdrop-blur-md z-20 shrink-0 sticky top-0",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 flex-wrap",children:[e.jsx("button",{onClick:l,className:"mr-2 p-1 rounded-lg hover:bg-slate-100 dark:hover:bg-white/10 text-slate-500 dark:text-white transition-colors md:hidden",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-white/40 font-mono",children:["#",t.id.slice(0,8)]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold uppercase border ${t.priority===Q.HIGH?"bg-red-50 text-red-600 border-red-100 dark:bg-red-500/10 dark:text-red-300 dark:border-red-500/20":t.priority===Q.MEDIUM?"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-300 dark:border-amber-500/20":"bg-green-50 text-green-600 border-green-100 dark:bg-green-500/10 dark:text-green-300 dark:border-green-500/20"}`,children:t.priority})]}),e.jsx("h2",{className:"text-lg md:text-2xl font-bold text-slate-900 dark:text-white leading-tight line-clamp-1",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[b&&e.jsxs("div",{className:"hidden md:flex items-center bg-slate-100 dark:bg-white/5 rounded-xl border border-slate-200 dark:border-white/10 mr-2",children:[e.jsx("button",{onClick:()=>b("prev"),disabled:!N,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors border-r border-slate-200 dark:border-white/10",title:"Demanda Anterior",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>b("next"),disabled:!p,className:"p-2.5 text-slate-500 hover:text-brand-600 disabled:opacity-30 disabled:hover:text-slate-500 transition-colors",title:"Próxima Demanda",children:e.jsx(Ve,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>{x(t),l()},className:"p-2 md:p-2.5 text-slate-500 hover:text-brand-600 hover:bg-slate-100 rounded-xl transition-colors dark:text-white/50 dark:hover:text-white dark:hover:bg-white/10",title:"Editar",children:e.jsx(xa,{className:"w-5 h-5"})}),e.jsx("button",{onClick:l,className:"p-2 md:p-2.5 text-slate-400 hover:text-slate-800 hover:bg-slate-100 rounded-full transition-colors dark:text-white/40 dark:hover:text-white dark:hover:bg-white/10",children:e.jsx(Se,{className:"w-6 h-6"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50/30 dark:bg-black/20 custom-scrollbar overscroll-contain flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 p-4 md:p-8 space-y-6 md:space-y-8 min-w-0",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(ft,{className:"w-4 h-4"})," Descrição"]}),e.jsx("div",{className:"md:hidden",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${t.status===G.COMPLETED?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:t.status})})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-5 md:p-6 shadow-sm",children:[e.jsx("p",{className:"text-sm md:text-base text-slate-700 dark:text-slate-200 leading-relaxed whitespace-pre-line",children:t.description}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-white/5 flex flex-wrap gap-2 items-center",children:[e.jsx(ha,{className:"w-4 h-4 text-slate-400"}),U.map(u=>e.jsxs("span",{className:"px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white text-xs font-bold rounded-lg flex items-center gap-1 group",children:[u,e.jsx(Se,{onClick:()=>oe(u),className:"w-3 h-3 cursor-pointer text-slate-400 hover:text-red-500 hidden group-hover:block"})]},u)),r?e.jsxs("div",{className:"flex items-center gap-2",ref:ae,children:[e.jsx("input",{ref:H,autoFocus:!0,type:"text",value:T,onChange:u=>i(u.target.value),className:"w-24 px-2 py-1 text-xs border rounded-lg outline-none",placeholder:"Nova tag...",onKeyDown:u=>{u.key==="Enter"&&X(),u.key==="Escape"&&S(!1)}}),e.jsx("button",{onClick:X,className:"text-xs font-bold text-brand-600",children:"OK"})]}):e.jsxs("button",{onClick:()=>S(!0),className:"text-xs text-slate-400 hover:text-brand-600 flex items-center gap-1 px-2 py-1 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(st,{className:"w-3 h-3"})," Adicionar"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(ge,{className:"w-4 h-4"})," Localização"]}),e.jsx(Ya,{demandId:t.id,lat:t.lat,lon:t.lon,address:je,onClick:Ae,onLocationUpdate:n})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(Mt,{className:"w-4 h-4"})," Checklist"]}),ce.length>0&&e.jsxs("span",{className:"text-xs font-mono text-slate-400 dark:text-white/40",children:[Math.round(Oe),"%"]})]}),ce.length>0&&e.jsx("div",{className:"h-1.5 w-full bg-slate-200 dark:bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-500",style:{width:`${Oe}%`}})}),e.jsxs("div",{className:"space-y-2",children:[ce.map(u=>e.jsxs("div",{className:"flex items-start gap-3 group bg-white dark:bg-white/5 p-3 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 dark:hover:border-white/10 transition-colors",children:[e.jsx("button",{onClick:()=>f(u.id,u.isCompleted||!1),className:`mt-0.5 w-5 h-5 rounded-lg border flex items-center justify-center transition-all ${u.isCompleted?"bg-green-500 border-green-500 text-white":"bg-white dark:bg-transparent border-slate-300 dark:border-white/20 hover:border-brand-500 text-transparent hover:text-brand-500/20"}`,children:e.jsx(ot,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm transition-all font-medium ${u.isCompleted?"text-slate-400 line-through dark:text-white/30":"text-slate-800 dark:text-white"}`,children:u.text}),(u.deadline||u.isCompleted)&&e.jsx("div",{className:"flex items-center gap-2 mt-1.5",children:u.deadline&&e.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold uppercase flex items-center gap-1 ${u.isCompleted?"bg-slate-100 text-slate-400 dark:bg-white/5":new Date(u.deadline)<new Date?"bg-red-100 text-red-600 dark:bg-red-500/20 dark:text-red-300":"bg-slate-100 text-slate-500 dark:bg-white/10 dark:text-white/60"}`,children:[e.jsx(fe,{className:"w-3 h-3"})," ",qe(u.deadline)]})})]}),e.jsx("button",{onClick:()=>F(u.id),className:"opacity-0 group-hover:opacity-100 p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",children:e.jsx(vt,{className:"w-4 h-4"})})]},u.id)),K?e.jsxs("div",{className:"bg-white dark:bg-white/5 p-4 rounded-xl border border-brand-500/30 shadow-lg ring-1 ring-brand-500/10 animate-in fade-in zoom-in-95",children:[e.jsx("input",{type:"text",autoFocus:!0,value:P,onChange:u=>A(u.target.value),placeholder:"Descreva a tarefa...",className:"w-full bg-transparent border-none outline-none text-sm text-slate-900 dark:text-white placeholder:text-slate-400 mb-4 font-medium",onKeyDown:u=>u.key==="Enter"&&ne("checklist")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 border-t border-slate-100 dark:border-white/5 pt-3",children:[e.jsxs("div",{className:"relative w-full sm:w-auto",ref:ae,children:[e.jsxs("button",{onClick:()=>k(!Z),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all border ${V?"bg-brand-50 text-brand-700 border-brand-200 dark:bg-brand-500/20 dark:text-brand-300 dark:border-brand-500/30":"bg-slate-50 text-slate-500 border-slate-200 dark:bg-white/5 dark:text-white/50 dark:border-white/10 hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(fe,{className:"w-3.5 h-3.5"}),V?qe(V):"Definir Prazo"]}),Z&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-64 glass-panel bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-white/10 p-3 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:()=>se(new Date(O.getFullYear(),O.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Fe,{className:"w-4 h-4 text-slate-600 dark:text-white"})}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white text-xs",children:[Ee[O.getMonth()]," ",O.getFullYear()]}),e.jsx("button",{onClick:()=>se(new Date(O.getFullYear(),O.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Ve,{className:"w-4 h-4 text-slate-600 dark:text-white"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-1",children:["D","S","T","Q","Q","S","S"].map(u=>e.jsx("span",{className:"text-[9px] font-bold text-slate-400 dark:text-white/40",children:u},u))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:Ie(O.getFullYear(),O.getMonth())}).map((u,_)=>e.jsx("div",{},`empty-${_}`)),Array.from({length:we(O.getFullYear(),O.getMonth())}).map((u,_)=>{const B=_+1,R=V&&new Date(V).getDate()===B&&new Date(V).getMonth()===O.getMonth();return e.jsx("button",{onClick:()=>pe(B),className:`h-6 w-6 rounded-full text-[10px] font-medium flex items-center justify-center transition-all ${R?"bg-brand-500 text-white":"text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:B},B)})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-end",children:[e.jsx("button",{onClick:()=>q(!1),className:"px-3 py-1.5 text-xs font-bold text-slate-500 hover:text-slate-700 dark:text-white/60 dark:hover:text-white",children:"Cancelar"}),e.jsx("button",{onClick:()=>ne("checklist"),className:"px-4 py-1.5 bg-brand-600 text-white text-xs font-bold rounded-lg hover:bg-brand-500 shadow-sm",children:"Salvar Item"})]})]})]}):e.jsxs("button",{onClick:()=>q(!0),className:"flex items-center justify-center gap-2 text-sm text-slate-500 dark:text-white/50 hover:text-brand-600 dark:hover:text-brand-400 transition-colors px-4 py-3 rounded-xl border border-dashed border-slate-300 dark:border-white/10 hover:border-brand-300 dark:hover:border-brand-500/30 hover:bg-slate-50 dark:hover:bg-white/5 w-full group",children:[e.jsx(st,{className:"w-4 h-4 group-hover:scale-110 transition-transform"})," Adicionar item ao checklist"]})]})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(ma,{className:"w-4 h-4"})," Comentários"]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-3 md:p-4 bg-slate-50 dark:bg-white/5 border-b border-slate-200 dark:border-white/10 flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold text-xs shrink-0",children:W.name.charAt(0)}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:I,onChange:u=>v(u.target.value),placeholder:"Escreva um comentário...",className:"w-full bg-white dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl pl-4 pr-10 py-2.5 text-sm outline-none focus:border-brand-500 transition-all text-slate-900 dark:text-white shadow-sm",onKeyDown:u=>u.key==="Enter"&&ne("comentario")}),e.jsx("button",{onClick:()=>ne("comentario"),disabled:!I.trim(),className:"absolute right-2 top-2 p-1 text-slate-400 hover:text-brand-600 disabled:opacity-30 transition-colors",children:e.jsx(ba,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-white/5 max-h-[300px] overflow-y-auto custom-scrollbar",children:Ne.length===0?e.jsx("div",{className:"p-6 text-center text-slate-400 dark:text-white/30 text-sm italic",children:"Nenhum comentário registrado."}):Ne.map(u=>e.jsxs("div",{className:`p-4 flex gap-3 hover:bg-slate-50 dark:hover:bg-white/5 transition-colors group ${$.includes(u.id)?"bg-amber-50 dark:bg-amber-500/10 animate-pulse duration-1000":""}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs shrink-0 border border-slate-300 dark:border-white/10",children:u.user.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-slate-900 dark:text-white",children:u.user}),e.jsx("span",{className:"text-[10px] text-slate-400",children:new Date(u.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed break-words bg-slate-50 dark:bg-white/5 p-3 rounded-tr-xl rounded-br-xl rounded-bl-xl border border-slate-100 dark:border-white/5",children:u.text})]}),e.jsx("button",{onClick:()=>F(u.id),className:"opacity-0 group-hover:opacity-100 self-start p-2 text-slate-300 hover:text-red-500 transition-all",children:e.jsx(vt,{className:"w-4 h-4"})})]},u.id))})]})]})]}),e.jsxs("div",{className:"w-full md:w-80 bg-white/50 dark:bg-black/20 border-t md:border-t-0 md:border-l border-slate-200 dark:border-white/10 p-4 md:p-6 space-y-6 md:h-auto overflow-y-auto",children:[e.jsxs("div",{className:"hidden md:block",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 mb-3 block",children:"Status"}),e.jsx("div",{className:"bg-slate-100 dark:bg-black/20 p-1 rounded-xl flex flex-col relative border border-slate-200 dark:border-white/5 gap-1",children:xe.map(u=>{const _=t.status===u.value;return e.jsxs("button",{onClick:()=>m(t.id,u.value),className:`
                                                w-full py-2.5 px-3 text-sm font-bold rounded-lg transition-all duration-300 flex items-center gap-3
                                                ${_?"bg-white dark:bg-white/10 text-brand-600 dark:text-white shadow-sm ring-1 ring-slate-200 dark:ring-white/10":"text-slate-500 dark:text-white/40 hover:bg-slate-200 dark:hover:bg-white/5"}
                                            `,children:[e.jsx(u.icon,{className:`w-4 h-4 ${_?"text-brand-500 dark:text-brand-400":"opacity-50"}`}),u.label]},u.value)})})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4 space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40 mb-2",children:"Datas"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-500 dark:text-white/50",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Criado em"}),e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white",children:new Date(t.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${t.deadline?"bg-brand-100 dark:bg-brand-500/20 text-brand-600 dark:text-brand-400":"bg-slate-100 dark:bg-white/10 text-slate-500"}`,children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Prazo Demanda"}),e.jsx("p",{className:`text-sm font-bold ${t.deadline?"text-slate-800 dark:text-white":"text-slate-400 italic"}`,children:qe(t.deadline)||"Sem prazo"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-2xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40",children:"Solicitante"})}),o?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-white/5 p-2 -ml-2 rounded-xl transition-colors group",onClick:()=>w&&w(o.id),children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-sm shadow-inner shrink-0",children:o.name.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-bold text-slate-900 dark:text-white truncate group-hover:text-brand-600 transition-colors flex items-center gap-1",children:[o.name,e.jsx(ua,{className:"w-3 h-3 opacity-0 group-hover:opacity-100"})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:Le(o.phone)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[o.phone&&e.jsxs("button",{onClick:()=>Re(o.phone),className:"flex-1 py-1.5 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Conversar no WhatsApp",children:[e.jsx(pa,{className:"w-3.5 h-3.5"})," WhatsApp"]}),o.email&&e.jsxs("button",{onClick:()=>ve(o.email),className:"flex-1 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-colors shadow-sm active:scale-95",title:"Enviar Email",children:[e.jsx(_t,{className:"w-3.5 h-3.5"})," Email"]})]})]}):e.jsx("div",{className:"text-center py-4 text-slate-400 text-xs italic",children:"Nenhum solicitante vinculado."})]})]})]})]})]})},Qa=({currentPage:t,totalPages:o,onPageChange:l,totalItems:x,itemsPerPage:m})=>{if(o<=1)return null;const n=(t-1)*m+1,b=Math.min(t*m,x);return e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 py-4 px-2 border-t border-slate-200 dark:border-white/10 mt-auto",children:[e.jsxs("div",{className:"text-xs text-slate-500 dark:text-white/50 font-medium order-2 sm:order-1",children:["Mostrando ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:n})," a ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:b})," de ",e.jsx("span",{className:"font-bold text-slate-700 dark:text-white",children:x})," registros"]}),e.jsxs("div",{className:"flex items-center gap-2 order-1 sm:order-2",children:[e.jsx("button",{onClick:()=>l(t-1),disabled:t===1,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Página anterior",children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-1 px-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700 dark:text-white",children:t}),e.jsx("span",{className:"text-sm text-slate-400 dark:text-white/40",children:"/"}),e.jsx("span",{className:"text-sm text-slate-500 dark:text-white/50 font-medium",children:o})]}),e.jsx("button",{onClick:()=>l(t+1),disabled:t===o,className:"p-2 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 text-slate-600 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Próxima página",children:e.jsx(Ve,{className:"w-4 h-4"})})]})]})},Za=De.memo(({demand:t,onUpdateStatus:o})=>{const l=n=>{o(t.id,n.target.value)},x=n=>n.stopPropagation(),m=n=>{switch(n){case G.COMPLETED:return"bg-green-50 text-green-700 border-green-200 dark:bg-green-500/10 dark:text-green-400 dark:border-green-500/20";case G.IN_PROGRESS:return"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";default:return"bg-slate-100 text-slate-600 border-slate-200 dark:bg-white/5 dark:text-slate-400 dark:border-white/10"}};return e.jsxs("div",{className:"relative inline-block group/status",onClick:x,children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg border transition-colors shadow-sm ${m(t.status)}`,children:[t.status===G.COMPLETED&&e.jsx($e,{className:"w-3.5 h-3.5"}),t.status===G.IN_PROGRESS&&e.jsx(We,{className:"w-3.5 h-3.5"}),t.status===G.PENDING&&e.jsx(ue,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:t.status}),e.jsx("div",{className:"ml-1 pl-1 border-l border-current/20 opacity-50",children:e.jsx(rt,{className:"w-3 h-3"})})]}),e.jsx("select",{value:t.status,onChange:l,onClick:x,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer font-bold text-sm appearance-none",children:Object.values(G).map(n=>e.jsx("option",{value:n,children:n},n))})]})}),Xa=({demands:t,citizens:o,onUpdateStatus:l,onEdit:x,initialSelectionId:m,clearSelection:n,onInteractionUpdate:b,onNotification:N,onViewCitizen:p})=>{const[y,w]=a.useState(null),[j,d]=a.useState("createdAt"),[C,D]=a.useState("desc"),[$,J]=a.useState(1),I=10,v=i=>{j===i?D(r=>r==="asc"?"desc":"asc"):(d(i),D("desc"))},P=i=>j!==i?e.jsx(ga,{className:"w-3 h-3 text-slate-300"}):C==="asc"?e.jsx(fa,{className:"w-3 h-3 text-brand-600"}):e.jsx(wa,{className:"w-3 h-3 text-brand-600"}),A=a.useMemo(()=>[...t].sort((i,r)=>{let S=0;switch(j){case"createdAt":S=new Date(i.createdAt).getTime()-new Date(r.createdAt).getTime();break;case"deadline":const H=i.deadline?new Date(i.deadline).getTime():0,Z=r.deadline?new Date(r.deadline).getTime():0;S=H-Z;break;case"priority":const k={[Q.LOW]:1,[Q.MEDIUM]:2,[Q.HIGH]:3};S=k[i.priority]-k[r.priority];break;case"status":const O={[G.PENDING]:1,[G.IN_PROGRESS]:2,[G.COMPLETED]:3};S=O[i.status]-O[r.status];break;default:S=0}return C==="asc"?S:-S}),[t,j,C]);a.useEffect(()=>{J(1)},[t]),a.useEffect(()=>{m&&(w(m),n&&setTimeout(n,1e3))},[m]);const V=i=>{const r=A.findIndex(S=>S.id===y);r!==-1&&(i==="prev"&&r>0?w(A[r-1].id):i==="next"&&r<A.length-1&&w(A[r+1].id))},L=y?A.findIndex(i=>i.id===y):-1,K=L>0,q=L!==-1&&L<A.length-1,U=Math.ceil(A.length/I),h=A.slice(($-1)*I,$*I),T=i=>{switch(i){case Q.HIGH:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-red-100 text-red-600 dark:bg-red-500/10 dark:text-red-300 border border-red-200 dark:border-red-500/20",children:"Alta"});case Q.MEDIUM:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-amber-100 text-amber-600 dark:bg-amber-500/10 dark:text-amber-300 border border-amber-200 dark:border-amber-500/20",children:"Média"});case Q.LOW:return e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-green-100 text-green-600 dark:bg-green-500/10 dark:text-green-300 border border-green-200 dark:border-green-500/20",children:"Baixa"})}};return e.jsxs("div",{className:"flex flex-col w-full gap-2 relative",children:[e.jsx("div",{className:"glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-slate-900/50 shadow-sm relative w-full flex flex-col min-h-0",children:A.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 dark:text-white/30 text-sm py-20",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-4",children:e.jsx(Be,{className:"w-6 h-6 opacity-30"})}),e.jsx("p",{children:"Nenhuma demanda encontrada."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full relative",children:[e.jsxs("table",{className:"w-full text-left border-collapse hidden md:table",children:[e.jsx("thead",{className:"bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-sm border-b border-slate-200 dark:border-white/10",children:e.jsxs("tr",{className:"text-xs font-bold text-slate-500 dark:text-blue-200/50 uppercase tracking-wider",children:[e.jsx("th",{className:"p-4 first:pl-6 w-[35%] min-w-[200px]",children:"Título"}),e.jsx("th",{className:"p-4 w-[20%] min-w-[150px]",children:"Solicitante"}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>v("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",P("status")]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-slate-100 dark:hover:bg-white/5 transition-colors select-none",onClick:()=>v("priority"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prioridade ",P("priority")]})}),e.jsx("th",{className:"p-4 hidden lg:table-cell cursor-pointer",onClick:()=>v("createdAt"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Criação ",P("createdAt")]})}),e.jsx("th",{className:"p-4 hidden xl:table-cell cursor-pointer",onClick:()=>v("deadline"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Prazo ",P("deadline")]})}),e.jsx("th",{className:"p-4 text-right last:pr-6 w-[80px]",children:"Ação"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-white/5 text-sm",children:h.map(i=>{const r=o.find(S=>S.id===i.citizenId);return e.jsxs("tr",{onClick:()=>w(i.id),className:"hover:bg-white/60 dark:hover:bg-white/5 transition-colors cursor-pointer group",children:[e.jsxs("td",{className:"p-4 first:pl-6",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white truncate max-w-[250px]",title:i.title,children:i.title}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-white/50 truncate mt-0.5 max-w-[250px]",children:i.description})]}),e.jsx("td",{className:"p-4",children:r?e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group/citizen p-1 -ml-1 rounded-lg hover:bg-brand-50 dark:hover:bg-white/10 transition-colors",onClick:S=>{S.stopPropagation(),p&&p(r.id)},children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs border border-slate-200 dark:border-white/10 shrink-0",children:r.name.charAt(0)}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"font-medium text-slate-900 dark:text-white truncate max-w-[150px] group-hover/citizen:text-brand-600 transition-colors",children:r.name})})]}):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"Não vinculado"})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:e.jsx(Za,{demand:i,onUpdateStatus:l})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:T(i.priority)}),e.jsx("td",{className:"p-4 hidden lg:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:new Date(i.createdAt).toLocaleDateString()}),e.jsx("td",{className:"p-4 hidden xl:table-cell text-slate-500 dark:text-white/50 font-mono text-xs whitespace-nowrap",children:i.deadline?qe(i.deadline):"-"}),e.jsx("td",{className:"p-4 text-right last:pr-6",children:e.jsx("div",{className:"p-2 text-slate-400 group-hover:text-brand-600 transition-colors inline-flex bg-slate-100 dark:bg-white/5 rounded-lg group-hover:bg-brand-50 dark:group-hover:bg-brand-500/10",children:e.jsx(Je,{className:"w-4 h-4"})})})]},i.id)})})]}),e.jsx("div",{className:"md:hidden space-y-3 p-3",children:h.map(i=>{const r=o.find(S=>S.id===i.citizenId);return e.jsxs("div",{onClick:()=>w(i.id),className:"glass-panel p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm active:scale-[0.98] transition-all cursor-pointer relative overflow-hidden group",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${i.priority===Q.HIGH?"bg-red-500":i.priority===Q.MEDIUM?"bg-amber-500":"bg-green-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2 pl-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-xs font-bold text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:r?r.name.charAt(0):"?"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-bold text-slate-900 dark:text-white truncate",children:r?r.name.split(" ")[0]:"S/ Solicitante"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-white/50",children:new Date(i.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase border ${i.status===G.COMPLETED?"bg-green-50 text-green-700 border-green-200":"bg-slate-50 text-slate-600 border-slate-200"}`,children:i.status})]}),e.jsxs("div",{className:"pl-3",children:[e.jsx("h4",{className:"font-bold text-sm text-slate-800 dark:text-white mb-1 leading-snug",children:i.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/60 line-clamp-2 mb-3",children:i.description}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-100 dark:border-white/5 pt-2",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 font-bold uppercase",children:[e.jsx(ge,{className:"w-3 h-3"})," ",i.level]}),e.jsxs("div",{className:"flex items-center gap-1 text-brand-600 text-xs font-bold",children:["Detalhes ",e.jsx(Je,{className:"w-3 h-3"})]})]})]})]},i.id)})})]}),e.jsx("div",{className:"bg-slate-50/50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-white/5 rounded-b-3xl",children:e.jsx(Qa,{currentPage:$,totalPages:U,onPageChange:J,totalItems:A.length,itemsPerPage:I})})]})}),y&&e.jsx(Ka,{demand:t.find(i=>i.id===y),citizen:o.find(i=>{var r;return i.id===((r=t.find(S=>S.id===y))==null?void 0:r.citizenId)})||null,onClose:()=>w(null),onEdit:i=>{w(null),x(i)},onUpdateStatus:(i,r)=>{l(i,r)},onInteractionUpdate:b,onNavigate:i=>V(i),canNavigatePrev:K,canNavigateNext:q,onNotification:N,onViewCitizen:p})]})};ye.Icon&&ye.Icon.Default&&(delete ye.Icon.Default.prototype._getIconUrl,ye.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}));const mt={},es=(t,o,l)=>t==="citizen"?"blue":o===G.COMPLETED?"green":l===Q.HIGH?"red":o===G.IN_PROGRESS?"orange":l===Q.MEDIUM?"gold":"blue",ts=(t,o,l)=>{const x=es(t,o,l),m=`${t}-${x}`;if(mt[m])return mt[m];const n=new ye.Icon({iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${x}.png`,shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:t==="citizen"?"custom-citizen-icon":""});return mt[m]=n,n},as=({markers:t})=>{const o=Ht(),[l,x]=a.useState([]),m=a.useRef(null),n=a.useCallback(()=>{if(!o)return;const b=o.getBounds();let N=2e3;const p=b.pad(.2),y=t.filter(w=>p.contains(ye.latLng(w.lat,w.lon)));x(y.slice(0,N))},[o,t]);return a.useEffect(()=>{n()},[t]),a.useEffect(()=>{if(!o)return;const b=()=>{m.current&&clearTimeout(m.current),m.current=setTimeout(n,200)};return o.on("moveend",b),o.on("zoomend",b),()=>{o.off("moveend",b),o.off("zoomend",b),m.current&&clearTimeout(m.current)}},[o,n]),e.jsx(e.Fragment,{children:l.map(b=>e.jsx(Ta,{center:[b.lat,b.lon],radius:5,pathOptions:{fillColor:"#0ea5e9",fillOpacity:.6,color:"#0284c7",weight:1,opacity:.5},children:e.jsx(qt,{children:e.jsxs("div",{className:"p-1 min-w-[150px]",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-900",children:b.name}),e.jsx("p",{className:"text-xs text-slate-500",children:b.bairro})]})})},`dot-${b.id}`))})},ss=({markers:t,onViewDemand:o})=>{const l=Ht(),[x,m]=a.useState([]),n=a.useRef(null),b=typeof window<"u"&&window.innerWidth<768,N=a.useCallback(()=>{if(!l)return;const p=l.getBounds(),y=l.getZoom();let w=b?40:150;if(t.length<=w){x.length!==t.length&&m(t);return}y<15&&(w=Math.floor(w*.6));const j=p.pad(b?.1:.2),d=t.filter(C=>j.contains(ye.latLng(C.lat,C.lon)));m(d.slice(0,w))},[l,t,b]);return a.useEffect(()=>{N()},[t]),a.useEffect(()=>{if(!l)return;const p=()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(N,250)};return l.on("moveend",p),l.on("zoomend",p),()=>{l.off("moveend",p),l.off("zoomend",p),n.current&&clearTimeout(n.current)}},[l,N]),e.jsx(e.Fragment,{children:x.map(p=>e.jsx(Gt,{position:[p.lat,p.lon],icon:ts(p.type,p.status,p.priority),eventHandlers:{click:()=>{b&&l.flyTo([p.lat,p.lon],16,{duration:.5})}},children:e.jsx(qt,{children:e.jsx("div",{className:"p-1 min-w-[200px]",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-800 leading-tight",children:p.title}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full ${p.status==="Concluído"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:p.status}),p.priority===Q.HIGH&&e.jsx("span",{className:"text-red-600 font-bold",children:"ALTA"})]}),e.jsx("button",{onClick:y=>{y.stopPropagation(),o&&o(p.id)},className:"mt-1 w-full bg-brand-600 text-white text-xs font-bold py-1.5 rounded hover:bg-brand-700 transition-colors",children:"Ver Detalhes"})]})})})},`m-${p.type}-${p.id}`))})},rs=({zoomIn:t,zoomOut:o})=>e.jsxs("div",{className:"flex flex-col gap-2 pointer-events-auto shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-white/10",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors border-b border-slate-100 dark:border-white/10",children:e.jsx(st,{className:"w-5 h-5"})}),e.jsx("button",{onClick:o,className:"w-10 h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center justify-center text-slate-700 dark:text-white transition-colors",children:e.jsx(va,{className:"w-5 h-5"})})]}),ls=({markers:t,viewMode:o,onViewDemand:l})=>{var x;return o==="citizens"?e.jsx(as,{markers:t}):e.jsx(ss,{markers:t,onViewDemand:l},`ml-${t.length}-${((x=t[0])==null?void 0:x.id)||"empty"}`)},ns=({defaultCenter:t,onViewDemand:o,preloadedMarkers:l,currentViewMode:x,onChangeViewMode:m})=>{const n=a.useRef(null),b=t?[t.lat,t.lon]:[-23.5505,-46.6333],N=a.useMemo(()=>l?l.filter(w=>w.type===(x==="demands"?"demand":"citizen")):[],[x,l]),p=()=>{var w;return(w=n.current)==null?void 0:w.zoomIn()},y=()=>{var w;return(w=n.current)==null?void 0:w.zoomOut()};return e.jsxs("div",{className:"transition-all duration-300 ease-in-out border-slate-200 dark:border-white/10 shadow-sm bg-slate-100 dark:bg-slate-900 overflow-hidden h-full w-full relative",children:[e.jsx("div",{className:"absolute left-4 bottom-4 md:bottom-8 z-[400] pointer-events-none flex flex-col gap-2",children:e.jsxs("div",{className:"pointer-events-auto bg-white/90 dark:bg-black/80 backdrop-blur-md p-1.5 rounded-xl shadow-lg border border-slate-200 dark:border-white/10 flex gap-1",children:[e.jsxs("button",{onClick:()=>m("demands"),className:`px-3 py-2 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors ${x==="demands"?"bg-brand-600 text-white":"text-slate-600 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(Ke,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Demandas"})]}),e.jsxs("button",{onClick:()=>m("citizens"),className:`px-3 py-2 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors ${x==="citizens"?"bg-brand-600 text-white":"text-slate-600 dark:text-white hover:bg-slate-100 dark:hover:bg-white/10"}`,children:[e.jsx(Pe,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Cidadãos"})]})]})}),e.jsx("div",{className:"absolute right-4 bottom-4 md:bottom-8 z-[400] flex flex-col gap-3 pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",children:e.jsx(rs,{zoomIn:p,zoomOut:y})})}),e.jsxs(Ut,{ref:n,center:b,zoom:13,style:{width:"100%",height:"100%"},zoomControl:!1,scrollWheelZoom:!0,dragging:!0,preferCanvas:!0,children:[e.jsx(Ft,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors © <a href="https://carto.com/attributions">CARTO</a>'}),e.jsx(ls,{markers:N,viewMode:x,onViewDemand:o})]})]})},Xe=({options:t,selectedValues:o,onChange:l,placeholder:x,label:m})=>{const[n,b]=a.useState(!1),[N,p]=a.useState(""),y=a.useRef(null);a.useEffect(()=>{const C=D=>{y.current&&!y.current.contains(D.target)&&(b(!1),p(""))};return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[]);const w=a.useMemo(()=>t.filter(C=>C.label.toLowerCase().includes(N.toLowerCase())),[t,N]),j=C=>{o.includes(C)?l(o.filter(D=>D!==C)):l([...o,C])},d=(C,D)=>{D.stopPropagation(),l(o.filter($=>$!==C))};return e.jsxs("div",{className:"relative min-w-[200px]",ref:y,children:[m&&e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:m}),e.jsxs("div",{onClick:()=>b(!n),className:`
            w-full min-h-[46px] px-3 py-2 glass-input border border-slate-300 dark:border-white/10 rounded-2xl 
            focus:border-brand-500 outline-none font-bold text-slate-700 dark:text-white cursor-pointer shadow-sm
            flex items-center justify-between transition-all hover:bg-slate-50 dark:hover:bg-white/5
            ${n?"ring-2 ring-brand-500/20 border-brand-500":""}
        `,children:[e.jsx("div",{className:"flex flex-wrap gap-1.5",children:o.length===0?e.jsx("span",{className:"text-slate-400 dark:text-white/40 text-sm font-medium py-1",children:x}):o.map(C=>{const D=t.find($=>$.value===C);return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 text-xs font-bold border border-brand-200 dark:border-brand-500/30",children:[(D==null?void 0:D.label)||C,e.jsx("div",{onClick:$=>d(C,$),className:"hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-full p-0.5 cursor-pointer",children:e.jsx(Se,{className:"w-3 h-3"})})]},C)})}),e.jsx(rt,{className:`w-4 h-4 text-slate-400 transition-transform duration-300 ${n?"rotate-180":""}`})]}),n&&e.jsxs("div",{className:"absolute top-full left-0 w-full mt-2 glass-panel bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden z-50 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"p-2 border-b border-slate-100 dark:border-white/5",children:e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"w-4 h-4 text-slate-400 absolute left-3 top-2.5"}),e.jsx("input",{type:"text",value:N,onChange:C=>p(C.target.value),placeholder:"Filtrar opções...",className:"w-full pl-9 pr-3 py-2 text-sm bg-slate-50 dark:bg-white/5 rounded-lg border-none outline-none text-slate-900 dark:text-white placeholder:text-slate-400",autoFocus:!0,onClick:C=>C.stopPropagation()})]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-white/20",children:w.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-slate-400 dark:text-white/40 italic",children:"Nenhuma opção encontrada."}):w.map(C=>{const D=o.includes(C.value);return e.jsxs("div",{onClick:()=>j(C.value),className:`
                                    flex items-center justify-between px-3 py-2.5 rounded-lg cursor-pointer text-sm font-medium transition-colors
                                    ${D?"bg-brand-50 dark:bg-brand-500/10 text-brand-700 dark:text-brand-300":"text-slate-700 dark:text-white hover:bg-slate-50 dark:hover:bg-white/5"}
                                `,children:[e.jsx("span",{children:C.label}),D&&e.jsx(ot,{className:"w-4 h-4 text-brand-500"})]},C.value)})}),e.jsxs("div",{className:"p-2 border-t border-slate-100 dark:border-white/5 bg-slate-50/50 dark:bg-white/5 flex justify-between",children:[e.jsx("button",{onClick:()=>l([]),className:"text-xs text-slate-500 hover:text-red-500 px-2 py-1 transition-colors",children:"Limpar"}),e.jsx("button",{onClick:()=>b(!1),className:"text-xs font-bold text-brand-600 dark:text-brand-400 px-2 py-1 hover:bg-brand-50 dark:hover:bg-white/5 rounded transition-colors",children:"Pronto"})]})]})]})},ze=({label:t,onRemove:o})=>e.jsxs("div",{className:"flex items-center gap-1 pl-3 pr-1 py-1 bg-brand-50 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 border border-brand-100 dark:border-brand-500/30 rounded-lg text-xs font-bold animate-in zoom-in-95 shadow-sm whitespace-nowrap",children:[e.jsx("span",{children:t}),e.jsx("button",{onClick:l=>{l.stopPropagation(),o()},className:"p-0.5 hover:bg-brand-200 dark:hover:bg-brand-500/40 rounded-md transition-colors text-brand-600 dark:text-brand-400",children:e.jsx(Se,{className:"w-3 h-3"})})]}),et=({label:t,icon:o,isActive:l,onClick:x})=>e.jsxs("button",{onClick:x,className:`
            flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold transition-all shadow-sm whitespace-nowrap border
            ${l?"bg-brand-600 text-white border-brand-600":"bg-white dark:bg-slate-800 text-slate-600 dark:text-white border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}
        `,children:[o&&e.jsx(o,{className:`w-3.5 h-3.5 ${l?"text-white":"text-slate-400"}`}),t]}),os=({filters:t,setFilters:o,onExport:l,users:x=[],availableTags:m=[],isMapMode:n=!1,mapViewMode:b})=>{var ee,ne;const[N,p]=a.useState(!1),[y,w]=a.useState(!1),[j,d]=a.useState(new Date),C=a.useRef(null),D=a.useRef(null),$=(f,F)=>{o(X=>({...X,[f]:F}))},J=()=>{o({search:t.search,level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",responsibleId:void 0,tags:[]})},I=(f,F)=>{Array.isArray(t[f])&&F?o(X=>({...X,[f]:X[f].filter(oe=>oe!==F)})):o(f==="startDate"||f==="endDate"?X=>({...X,startDate:"",endDate:""}):X=>({...X,[f]:void 0}))},v=f=>{const F=t.status;F.includes(f)?$("status",F.filter(X=>X!==f)):$("status",[...F,f])},P=f=>{const F=t.priority;F.includes(f)?$("priority",F.filter(X=>X!==f)):$("priority",[...F,f])},A=()=>{if(t.startDate)$("startDate",""),$("endDate","");else{const f=new Date().toLocaleDateString("en-CA");$("startDate",f),$("endDate",f)}},V=f=>f?f.split("_").map(F=>F.charAt(0).toUpperCase()+F.slice(1)).join(" "):"",L=f=>{const F=x.find(X=>X.id===f);return F?F.nome:"Usuário"},K=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],q=(f,F)=>new Date(f,F+1,0).getDate(),U=(f,F)=>new Date(f,F,1).getDay(),h=f=>{const X=new Date(j.getFullYear(),j.getMonth(),f).toLocaleDateString("en-CA");!t.startDate||t.startDate&&t.endDate?o(oe=>({...oe,startDate:X,endDate:""})):X<t.startDate?o(oe=>({...oe,startDate:X,endDate:t.startDate})):(o(oe=>({...oe,endDate:X})),setTimeout(()=>w(!1),300))},T=t.startDate?new Date(t.startDate+"T00:00:00").getTime():null,i=t.endDate?new Date(t.endDate+"T00:00:00").getTime():null,r=f=>{if(!T)return!1;const F=new Date(j.getFullYear(),j.getMonth(),f).getTime();return F===T?"start":i&&F===i?"end":i&&F>T&&F<i?"range":!1};a.useEffect(()=>{const f=F=>{C.current&&!C.current.contains(F.target)&&w(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]);const S=t.level.length+t.status.length+t.priority.length+(((ee=t.tags)==null?void 0:ee.length)||0)+(t.startDate?1:0)+(t.responsibleId?1:0),H=t.startDate?`${new Date(t.startDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})} ${t.endDate?" - "+new Date(t.endDate+"T00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}):""}`:"Selecionar Período",Z={createdAt:"Criação",updatedAt:"Atualização",deadline:"Prazo"},k=Object.values(_e).map(f=>({value:f,label:f})),O=Object.values(G).map(f=>({value:f,label:f})),se=Object.values(Q).map(f=>({value:f,label:f})),ae=m.map(f=>({value:f,label:f})),W=!n||b==="demands";return e.jsxs("div",{className:"flex flex-col relative z-30 space-y-3",children:[e.jsxs("div",{className:`
          flex flex-col md:flex-row gap-3 items-center relative z-20 
          ${n?"bg-transparent":"glass-panel p-2 md:p-3 rounded-2xl shadow-sm border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md"}
      `,children:[e.jsxs("div",{className:`flex-1 w-full relative group ${n?"shadow-lg rounded-2xl":""}`,children:[e.jsx("input",{type:"text",value:t.search,onChange:f=>$("search",f.target.value),placeholder:n?"Buscar locais ou demandas...":"Buscar por título, nome ou celular...",className:`
                    w-full pl-11 pr-4 py-3 outline-none transition-all font-medium text-slate-700 dark:text-white placeholder:text-slate-400
                    ${n?"bg-white/95 dark:bg-[#1e293b]/95 border-0 rounded-2xl shadow-md focus:ring-2 ring-brand-500/50":"bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl focus:border-brand-500 focus:bg-white dark:focus:bg-black/20"}
                `}),e.jsx(Be,{className:"w-5 h-5 text-slate-400 absolute left-3.5 top-3.5 group-focus-within:text-brand-500 transition-colors"}),t.search&&e.jsx("button",{onClick:()=>$("search",""),className:"absolute right-3 top-3.5 text-slate-400 hover:text-slate-600 dark:hover:text-white",children:e.jsx(Se,{className:"w-5 h-5"})})]}),n?e.jsx("div",{className:"hidden md:flex",children:e.jsx("button",{onClick:()=>p(!N),className:"w-12 h-12 bg-white dark:bg-slate-800 text-slate-600 dark:text-white rounded-2xl shadow-lg flex items-center justify-center hover:bg-slate-50 transition-transform active:scale-95",children:e.jsx(jt,{className:"w-5 h-5"})})}):e.jsxs("div",{className:"flex w-full md:w-auto gap-2",children:[e.jsxs("button",{onClick:()=>p(!N),className:`flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-3 rounded-xl font-bold transition-all border ${N||S>0?"bg-brand-500 text-white border-brand-500 shadow-lg shadow-brand-500/20":"bg-white dark:bg-white/5 text-slate-600 dark:text-white/70 border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}`,children:[e.jsx(jt,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Filtros"}),S>0&&e.jsx("span",{className:"bg-white text-brand-600 text-[10px] w-5 h-5 flex items-center justify-center rounded-full ml-1 shadow-sm",children:S})]}),l&&e.jsx("button",{onClick:l,className:"w-[46px] h-[46px] bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 rounded-xl flex items-center justify-center shrink-0 transition-all",title:"Exportar Dados",children:e.jsx(ja,{className:"w-5 h-5"})})]})]}),n&&b!=="citizens"&&e.jsxs("div",{className:"flex overflow-x-auto gap-2 pb-2 -mx-4 px-4 md:mx-0 md:px-0 scrollbar-none snap-x",children:[e.jsx(et,{label:"Pendentes",icon:ue,isActive:t.status.includes(G.PENDING),onClick:()=>v(G.PENDING)}),e.jsx(et,{label:"Alta Prioridade",icon:nt,isActive:t.priority.includes(Q.HIGH),onClick:()=>P(Q.HIGH)}),e.jsx(et,{label:"Em Andamento",icon:We,isActive:t.status.includes(G.IN_PROGRESS),onClick:()=>v(G.IN_PROGRESS)}),e.jsx(et,{label:"Hoje",icon:fe,isActive:!!t.startDate,onClick:A})]}),n&&b==="citizens"&&e.jsx("div",{className:"flex overflow-x-auto gap-2 pb-2 -mx-4 px-4 md:mx-0 md:px-0 scrollbar-none",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold bg-brand-600 text-white shadow-sm whitespace-nowrap border border-brand-600",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"})," Visualizando Mapa de Cidadãos"]})}),(!n||n&&window.innerWidth>=768)&&S>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center px-1",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase text-slate-400 dark:text-white/40 mr-1 flex items-center gap-1",children:[e.jsx(pt,{className:"w-3 h-3"})," Ativos:"]}),W&&t.status.map(f=>e.jsx(ze,{label:`Status: ${f}`,onRemove:()=>I("status",f)},`status-${f}`)),W&&t.priority.map(f=>e.jsx(ze,{label:`Prioridade: ${f}`,onRemove:()=>I("priority",f)},`prio-${f}`)),W&&t.level.map(f=>e.jsx(ze,{label:`Esfera: ${f}`,onRemove:()=>I("level",f)},`lvl-${f}`)),W&&((ne=t.tags)==null?void 0:ne.map(f=>e.jsx(ze,{label:`Tag: ${f}`,onRemove:()=>I("tags",f)},`tag-${f}`))),W&&t.responsibleId&&e.jsx(ze,{label:`Resp: ${L(t.responsibleId)}`,onRemove:()=>I("responsibleId")}),t.startDate&&e.jsx(ze,{label:`${Z[t.dateType]}: ${H}`,onRemove:()=>I("startDate")}),e.jsxs("button",{onClick:J,className:"text-[10px] font-bold text-red-500 hover:text-red-600 ml-auto hover:bg-red-50 dark:hover:bg-red-900/20 px-2 py-1 rounded transition-colors flex items-center gap-1",children:[e.jsx(ka,{className:"w-3 h-3"})," Limpar"]})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10 bg-slate-900/30 backdrop-blur-sm transition-opacity",onClick:()=>p(!1)}),e.jsxs("div",{ref:D,className:`
                    absolute z-[60] glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white dark:bg-[#0f172a] shadow-2xl animate-in slide-in-from-top-2 duration-200 overflow-hidden
                    w-full md:w-[800px] md:right-0 md:left-auto
                    ${n?"top-[70px]":"top-[calc(100%+12px)]"}
                `,children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2 text-sm",children:[e.jsx(pt,{className:"w-4 h-4 text-brand-500"})," Filtros Avançados"]}),e.jsx("button",{onClick:()=>p(!1),className:"p-1.5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Se,{className:"w-4 h-4 text-slate-500 dark:text-white/60"})})]}),e.jsxs("div",{className:`p-6 grid gap-8 max-h-[70vh] overflow-y-auto custom-scrollbar ${W?"grid-cols-1 md:grid-cols-3":"grid-cols-1"}`,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Período"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Me,{options:["createdAt","updatedAt","deadline"].map(f=>({value:f,label:Z[f]})),value:t.dateType,onChange:f=>$("dateType",f),size:"sm"}),e.jsxs("div",{className:"relative",ref:C,children:[e.jsx("button",{onClick:()=>w(!y),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl text-sm font-bold transition-all border ${t.startDate?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-900/20 dark:border-brand-500/30 dark:text-brand-300":"bg-slate-50 dark:bg-white/5 border-slate-200 dark:border-white/10 text-slate-600 dark:text-white/70 hover:bg-slate-100"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 opacity-70"})," ",H]})}),y&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-72 bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 p-4 z-50 animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>d(new Date(j.getFullYear(),j.getMonth()-1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-bold text-sm",children:[K[j.getMonth()]," ",j.getFullYear()]}),e.jsx("button",{onClick:()=>d(new Date(j.getFullYear(),j.getMonth()+1,1)),className:"p-1 hover:bg-slate-100 dark:hover:bg-white/10 rounded",children:e.jsx(Ve,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["D","S","T","Q","Q","S","S"].map(f=>e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:f},f))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:U(j.getFullYear(),j.getMonth())}).map((f,F)=>e.jsx("div",{},`empty-${F}`)),Array.from({length:q(j.getFullYear(),j.getMonth())}).map((f,F)=>{const X=F+1,oe=r(X);return e.jsx("button",{onClick:()=>h(X),className:`h-8 w-8 rounded-full text-xs font-medium transition-all ${oe==="start"||oe==="end"?"bg-brand-500 text-white shadow-lg":oe==="range"?"bg-brand-100 dark:bg-brand-500/20 text-brand-700 dark:text-brand-300 rounded-none":"hover:bg-slate-100 dark:hover:bg-white/10"}`,children:X},X)})]})]})]})]})]}),W&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Classificação"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Xe,{options:O,selectedValues:t.status,onChange:f=>$("status",f),placeholder:"Todos Status",label:"Status"}),e.jsx(Xe,{options:se,selectedValues:t.priority,onChange:f=>$("priority",f),placeholder:"Todas Prioridades",label:"Prioridade"}),e.jsx(Xe,{options:k,selectedValues:t.level,onChange:f=>$("level",f),placeholder:"Todas Esferas",label:"Esfera"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-100 dark:border-white/5 pb-2 block",children:"Contexto"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-white/50 uppercase mb-1.5 ml-1",children:"Responsável"}),e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"w-4 h-4 text-slate-400 absolute left-3 top-3 pointer-events-none"}),e.jsxs("select",{value:t.responsibleId||"",onChange:f=>$("responsibleId",f.target.value||void 0),className:"w-full pl-9 pr-8 py-2.5 bg-slate-50 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-xl text-sm outline-none focus:border-brand-500 font-bold text-slate-700 dark:text-white appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"Todos os Responsáveis"}),x.map(f=>e.jsxs("option",{value:f.id,children:[f.nome," (",V(f.perfil),")"]},f.id))]}),e.jsx("div",{className:"absolute right-3 top-3 pointer-events-none text-slate-400 text-xs",children:"▼"})]})]}),e.jsx(Xe,{options:ae,selectedValues:t.tags||[],onChange:f=>$("tags",f),placeholder:"Filtrar por Tags",label:"Etiquetas (Tags)"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 dark:border-white/10 bg-slate-50/50 dark:bg-white/5 flex justify-end gap-3",children:[e.jsx("button",{onClick:J,className:"px-4 py-2 text-xs font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-xl transition-colors",children:"Limpar Tudo"}),e.jsx("button",{onClick:()=>p(!1),className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold text-sm shadow-lg shadow-brand-500/20 transition-all active:scale-95",children:"Aplicar Filtros"})]})]})]})]})},Jt=({status:t,setStatus:o,priority:l,setPriority:x,timeRange:m,setTimeRange:n,scope:b,setScope:N,showScope:p=!0,className:y=""})=>e.jsxs("div",{className:`glass-panel p-3 rounded-3xl flex flex-col md:flex-row gap-4 items-center border border-slate-200 dark:border-white/10 bg-white/60 dark:bg-white/5 backdrop-blur-md shadow-sm ${y}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-white/50 text-xs font-bold uppercase tracking-wider shrink-0",children:[e.jsx(pt,{className:"w-4 h-4 text-brand-500"})," Filtros"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto overflow-x-auto scrollbar-none items-start sm:items-center flex-1",children:[p&&b&&N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-w-[200px]",children:e.jsx(Me,{value:b,onChange:N,options:[{value:"demands",label:"Demandas",icon:Ke},{value:"citizens",label:"Cidadãos",icon:Pe}]})}),e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"})]}),e.jsx("div",{className:"min-w-[280px]",children:e.jsx(Me,{value:m,onChange:n,options:[{value:"7",label:"7d"},{value:"30",label:"30d"},{value:"90",label:"90d"},{value:"365",label:"Ano"},{value:"all",label:"Tudo"}]})}),(!p||b==="demands")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block mx-1"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:t,onChange:w=>o(w.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Status: Todos"}),e.jsx("option",{value:G.PENDING,children:"Pendentes"}),e.jsx("option",{value:G.IN_PROGRESS,children:"Em Andamento"}),e.jsx("option",{value:G.COMPLETED,children:"Concluídos"})]}),e.jsx(rt,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]}),e.jsxs("div",{className:"relative group flex-1 sm:flex-none",children:[e.jsxs("select",{value:l,onChange:w=>x(w.target.value),className:"w-full sm:w-auto appearance-none bg-slate-100 dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-700 dark:text-white text-xs font-bold py-3 pl-3 pr-8 rounded-xl outline-none focus:border-brand-500 transition-colors cursor-pointer hover:bg-slate-200 dark:hover:bg-white/10 h-11",children:[e.jsx("option",{value:"all",children:"Prioridade: Todas"}),e.jsx("option",{value:Q.HIGH,children:"Alta"}),e.jsx("option",{value:Q.MEDIUM,children:"Média"}),e.jsx("option",{value:Q.LOW,children:"Baixa"})]}),e.jsx(rt,{className:"w-3 h-3 text-slate-400 absolute right-2.5 top-4 pointer-events-none group-hover:text-brand-500 transition-colors"})]})]})]})]}),(t!=="all"||l!=="all"||m!=="30")&&e.jsxs("button",{onClick:()=>{o("all"),x("all"),n("30")},className:"ml-auto p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-slate-400 hover:text-red-500 rounded-xl transition-colors flex items-center gap-1 text-[10px] font-bold uppercase",title:"Limpar Filtros",children:[e.jsx(Se,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden md:inline",children:"Limpar"})]})]}),Ce=De.memo(({title:t,value:o,icon:l,colorClass:x,textClass:m,trend:n,subValue:b})=>e.jsxs("div",{className:"glass-panel p-3 md:p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex flex-col justify-between hover:bg-white/60 dark:hover:bg-white/5 transition-colors group min-h-[100px] will-change-transform",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:`p-2 rounded-xl ${x} bg-opacity-10 shrink-0`,children:e.jsx(l,{className:`w-4 h-4 ${m}`})}),n&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-bold text-emerald-600 bg-emerald-100 dark:bg-emerald-500/20 px-1.5 py-0.5 rounded-full border border-emerald-200 dark:border-emerald-500/10",children:[e.jsx(Na,{className:"w-3 h-3"})," ",n]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-800 dark:text-white tracking-tight block",children:b||o}),e.jsx("span",{className:`block text-[10px] font-bold uppercase tracking-wider opacity-70 ${m} mt-1`,children:t})]})]})),Tt=({demands:t,citizens:o,interactions:l=[],onViewDemand:x,onEditDemand:m,onCreateDemand:n,onUpdateStatus:b,onInteractionUpdate:N,initialSelectionId:p,clearSelection:y,initialViewMode:w="list",filters:j,setFilters:d,users:C=[],onNotification:D,defaultLocation:$,onViewCitizen:J,mapMarkers:I})=>{const[v,P]=a.useState(w),[A,V]=a.useState("demands"),[L,K]=a.useState([]),[q,U]=a.useState("30"),h=w==="map",T=a.useMemo(()=>{const k=t.length;let O=0,se=0,ae=0;for(const W of t)W.status===G.PENDING?O++:W.status===G.COMPLETED&&se++,W.priority===Q.HIGH&&ae++;return{total:k,pending:O,completed:se,highPriority:ae}},[t]);a.useEffect(()=>{p&&!h&&P("list")},[p,h]),a.useEffect(()=>{w&&!h&&P(w)},[w,h]),a.useEffect(()=>{(async()=>{if(re()&&M){const{data:O}=await M.from("app_config").select("value").eq("key","dashboard_notices").maybeSingle();O&&K(O.value)}else{const O=localStorage.getItem("geo_notices");O&&K(JSON.parse(O))}})()},[]);const i=k=>{if(U(k),!d)return;if(k==="all"){d(ne=>({...ne,startDate:"",endDate:""}));return}const O=parseInt(k),se=new Date,ae=new Date;k==="365"?(ae.setMonth(0,1),ae.setHours(0,0,0,0)):ae.setDate(se.getDate()-O);const W=ae.toLocaleDateString("en-CA"),ee=se.toLocaleDateString("en-CA");d(ne=>({...ne,startDate:W,endDate:ee}))};a.useEffect(()=>{d&&!(j!=null&&j.startDate)&&!h&&i("30")},[]);const r=k=>{d&&d(k==="all"?O=>({...O,status:[]}):O=>({...O,status:[k]}))},S=k=>{d&&d(k==="all"?O=>({...O,priority:[]}):O=>({...O,priority:[k]}))},H=j!=null&&j.status&&j.status.length===1?j.status[0]:"all",Z=j!=null&&j.priority&&j.priority.length===1?j.priority[0]:"all";return e.jsxs("div",{className:`flex flex-col animate-in slide-in-from-right duration-500 ${h?"h-full":"gap-4"}`,children:[!h&&e.jsxs("div",{className:"shrink-0 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-3",children:[e.jsx(Ke,{className:"w-8 h-8 text-brand-600 dark:text-brand-400"}),"Gestão de Demandas"]}),e.jsx("p",{className:"text-slate-500 dark:text-blue-200/50 mt-1 font-medium hidden sm:block",children:v==="list"?"Controle detalhado e histórico de ocorrências.":v==="board"?"Fluxo de trabalho visual por status.":"Calendário de prazos e vencimentos."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsx("div",{className:"hidden md:flex w-[280px]",children:e.jsx(Me,{value:v,onChange:P,options:[{value:"list",label:"Lista",icon:kt},{value:"board",label:"Quadro",icon:Nt},{value:"calendar",label:"Data",icon:yt}]})}),e.jsxs("button",{onClick:n,className:"w-full sm:w-auto px-5 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 transition-all flex items-center justify-center gap-2 active:scale-95 h-11",children:[e.jsx(Pt,{className:"w-5 h-5"})," ",e.jsx("span",{className:"whitespace-nowrap",children:"Nova Demanda"})]})]})]}),e.jsx("div",{className:"md:hidden flex overflow-x-auto gap-2 pb-2 scrollbar-none snap-x -mx-4 px-4 bg-slate-50 dark:bg-[#020617] z-20 pt-2 border-b border-slate-200 dark:border-white/5",children:[{id:"list",label:"Lista",icon:kt},{id:"board",label:"Quadro",icon:Nt},{id:"calendar",label:"Calendário",icon:yt}].map(k=>{const O=v===k.id,se=k.icon;return e.jsxs("button",{onClick:()=>P(k.id),className:`
                                flex items-center gap-2 px-4 py-2.5 rounded-full text-xs font-bold whitespace-nowrap transition-all snap-start
                                ${O?"bg-brand-600 text-white shadow-md shadow-brand-500/30":"bg-white dark:bg-white/5 text-slate-500 dark:text-white/60 border border-slate-200 dark:border-white/10"}
                            `,children:[e.jsx(se,{className:"w-3.5 h-3.5"}),k.label]},k.id)})})]}),j&&d&&!h&&e.jsx("div",{className:"mb-2",children:e.jsx(Jt,{status:H,setStatus:r,priority:Z,setPriority:S,timeRange:q,setTimeRange:i,scope:"demands",setScope:()=>{},showScope:!1})}),!h&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 shrink-0",children:[e.jsx(Ce,{title:"Total Filtrado",value:T.total,icon:Rt,colorClass:"bg-blue-500",textClass:"text-blue-600 dark:text-blue-400"}),e.jsx(Ce,{title:"Pendentes",value:T.pending,icon:ue,colorClass:"bg-slate-500",textClass:"text-slate-600 dark:text-slate-400"}),e.jsx(Ce,{title:"Em Andamento",value:T.total-T.pending-T.completed,icon:We,colorClass:"bg-amber-500",textClass:"text-amber-600 dark:text-amber-400"}),e.jsx(Ce,{title:"Concluídos",value:T.completed,icon:$e,colorClass:"bg-green-500",textClass:"text-green-600 dark:text-green-400"})]}),h&&j&&d&&e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 pt-12 pointer-events-none z-30",children:e.jsx("div",{className:"pointer-events-auto max-w-2xl mx-auto",children:e.jsx(os,{filters:j,setFilters:d,users:C,isMapMode:!0,mapViewMode:A})})}),e.jsxs("div",{className:`flex-1 flex flex-col min-w-0 w-full relative ${h?"h-full":""}`,children:[v==="list"&&e.jsx(Xa,{demands:t,citizens:o,onUpdateStatus:b||(()=>{}),onEdit:m,onInteractionUpdate:N,initialSelectionId:p,clearSelection:y,onNotification:D,onViewCitizen:J}),v==="board"&&e.jsx(Ja,{demands:t,citizens:o,onViewDemand:k=>{x(k)},onUpdateStatus:b||(()=>{})}),v==="calendar"&&e.jsx(Wa,{demands:t,interactions:l,notices:L,onEditDemand:m}),v==="map"&&e.jsx(ns,{demands:t,citizens:o,defaultCenter:$,preloadedMarkers:I,onViewDemand:k=>{const O=t.find(se=>se.id===k);O&&x(O)},currentViewMode:A,onChangeViewMode:V})]})]})},ds=({locations:t})=>{const[o,l]=a.useState(null),[x,m]=a.useState(!1),n=t.length>0?t[0]:null;a.useEffect(()=>{(async()=>{if(!n){m(!1);return}const w=`weather_cache_${n.lat}_${n.lon}`,j=localStorage.getItem(w),d=new Date().toISOString().slice(0,13);if(j){const C=JSON.parse(j);if(C.hour===d){l(C.data);return}}m(!0);try{const D=await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${n.lat}&longitude=${n.lon}&current=temperature_2m,weather_code&timezone=auto`)).json();l(D),localStorage.setItem(w,JSON.stringify({hour:d,data:D}))}catch(C){console.error("Failed to fetch weather",C)}finally{m(!1)}})()},[n]);const b=y=>y===0?e.jsx(ut,{className:"w-6 h-6 text-amber-500"}):y>=1&&y<=3?e.jsx(ya,{className:"w-6 h-6 text-slate-400"}):y>=51&&y<=67?e.jsx(Ca,{className:"w-6 h-6 text-blue-400"}):y>=71&&y<=77?e.jsx(Sa,{className:"w-6 h-6 text-cyan-300"}):e.jsx(ut,{className:"w-6 h-6 text-amber-500"});if(x&&n)return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-slate-200/50 dark:bg-white/5 animate-pulse min-w-[140px] h-[46px]",children:[e.jsx(me,{className:"w-4 h-4 animate-spin text-slate-400"}),e.jsx("div",{className:"h-3 w-16 bg-slate-300 dark:bg-white/10 rounded"})]});if(!n||!o)return null;const N=Math.round(o.current.temperature_2m),p=o.current.weather_code;return e.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 rounded-xl bg-white/60 dark:bg-white/5 backdrop-blur-md border border-slate-200 dark:border-white/10 shadow-sm transition-all hover:bg-white/80 dark:hover:bg-white/10 cursor-default",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[b(p),e.jsxs("span",{className:"text-xl font-bold text-slate-900 dark:text-white",children:[N,"°"]})]}),e.jsxs("div",{className:"flex flex-col border-l border-slate-300 dark:border-white/10 pl-4 h-8 justify-center",children:[e.jsxs("span",{className:"text-xs font-bold text-slate-700 dark:text-white uppercase tracking-wide flex items-center gap-1",children:[e.jsx(ge,{className:"w-3 h-3 text-brand-600 dark:text-brand-400"}),n.name]}),e.jsx("span",{className:"text-[10px] text-slate-500 dark:text-white/50",children:"Tempo Agora"})]})]})},is=({onBack:t,onSuccess:o})=>{const[l,x]=a.useState(""),[m,n]=a.useState("search"),[b,N]=a.useState([]),[p,y]=a.useState(!1),[w,j]=a.useState(""),[d,C]=a.useState(""),[D,$]=a.useState(""),[J,I]=a.useState(!1);a.useEffect(()=>{const P=setTimeout(()=>j(l),500);return()=>clearTimeout(P)},[l]),a.useEffect(()=>{if(!w||w.length<3){N([]);return}(async()=>{if(y(!0),re()&&M){const A=Ue(w),{data:V}=await M.from("citizens").select("*").or(`telefone.ilike.%${A}%,nome.ilike.%${w}%`).limit(5);V&&N(V.map(L=>({id:L.id,name:`${L.nome} ${L.sobrenome}`,phone:L.telefone,bairro:L.bairro,email:L.email||"",createdAt:L.created_at})))}y(!1)})()},[w]);const v=async()=>{if(!d||!l)return;I(!0);const P=Ue(l),A=d.trim().split(" "),V=A[0],L=A.slice(1).join(" ")||".";try{if(re()&&M){const{data:K,error:q}=await M.from("citizens").insert({nome:V,sobrenome:L,telefone:P,bairro:D,origem:"fast_track_mobile"}).select().single();if(q)throw q;K&&o(K.id)}}catch(K){console.error(K),alert("Erro ao criar cidadão rápido.")}finally{I(!1)}};return e.jsxs("div",{className:"fixed inset-0 bg-slate-50 dark:bg-[#020617] z-[100] flex flex-col animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"p-4 flex items-center gap-4 border-b border-slate-200 dark:border-white/10 bg-white dark:bg-[#0b1121]",children:[e.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-white/10",children:e.jsx(gt,{className:"w-6 h-6 text-slate-600 dark:text-white"})}),e.jsx("h1",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Nova Solicitação"})]}),m==="search"&&e.jsxs("div",{className:"flex-1 p-6 flex flex-col",children:[e.jsx("label",{className:"text-sm font-bold text-slate-500 dark:text-white/50 mb-2 uppercase",children:"Quem está solicitando?"}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("input",{autoFocus:!0,type:"text",value:l,onChange:P=>x(P.target.value),placeholder:"Telefone ou Nome...",className:"w-full text-2xl font-bold bg-transparent border-b-2 border-slate-300 dark:border-white/20 py-2 outline-none focus:border-brand-500 text-slate-900 dark:text-white placeholder:text-slate-300"}),p&&e.jsx(me,{className:"absolute right-0 top-3 w-6 h-6 animate-spin text-brand-500"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3",children:[b.map(P=>e.jsxs("button",{onClick:()=>o(P.id),className:"w-full text-left p-4 bg-white dark:bg-white/5 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm flex items-center justify-between active:scale-95 transition-transform",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 dark:bg-brand-500/20 flex items-center justify-center text-brand-600 dark:text-brand-400 font-bold",children:P.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:P.name}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:Le(P.phone)})]})]}),e.jsx("div",{className:"bg-brand-600 text-white p-2 rounded-xl",children:e.jsx(st,{className:"w-5 h-5"})})]},P.id)),w.length>3&&e.jsxs("button",{onClick:()=>n("create-citizen"),className:"w-full p-4 mt-4 bg-slate-100 dark:bg-white/5 rounded-2xl border-2 border-dashed border-slate-300 dark:border-white/10 flex items-center justify-center gap-2 text-slate-500 dark:text-white/60 font-bold active:scale-95 transition-transform",children:[e.jsx(zt,{className:"w-5 h-5"}),'Cadastrar "',l,'"']})]})]}),m==="create-citizen"&&e.jsx("div",{className:"flex-1 p-6 flex flex-col",children:e.jsxs("div",{className:"bg-white dark:bg-white/5 p-6 rounded-3xl border border-slate-200 dark:border-white/10 shadow-lg space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Telefone"}),e.jsx("p",{className:"text-xl font-mono font-bold text-slate-900 dark:text-white border-b border-slate-100 pb-2",children:Le(l)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Nome Completo"}),e.jsx("input",{autoFocus:!0,type:"text",value:d,onChange:P=>C(P.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: João da Silva"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-400 mb-1",children:"Bairro (Opcional)"}),e.jsx("input",{type:"text",value:D,onChange:P=>$(P.target.value),className:"w-full text-lg font-bold bg-slate-50 dark:bg-black/20 p-3 rounded-xl outline-none focus:ring-2 ring-brand-500",placeholder:"Ex: Centro"})]}),e.jsxs("button",{onClick:v,disabled:J||!d,className:"w-full py-4 bg-brand-600 text-white rounded-xl font-bold text-lg shadow-xl shadow-brand-500/20 flex items-center justify-center gap-2 active:scale-95 transition-transform disabled:opacity-50",children:[J?e.jsx(me,{className:"w-6 h-6 animate-spin"}):e.jsx(ot,{className:"w-6 h-6"}),"Salvar e Criar Demanda"]})]})})]})},cs=t=>{const[o,l]=a.useState(navigator.onLine),[x,m]=a.useState(!0),[n,b]=a.useState([]),[N,p]=a.useState([]),[y,w]=a.useState([]),[j,d]=a.useState([]),[C,D]=a.useState([]),[$,J]=a.useState(null),[I,v]=a.useState(null),[P,A]=a.useState(0),V=a.useCallback((q,U)=>{try{const h=localStorage.getItem("geo_map_cache"),T=h?JSON.parse(h):{};let i=!1;U.forEach(r=>{r.lat&&r.lon&&!T[r.id]&&(T[r.id]={lat:r.lat,lon:r.lon},i=!0)}),q.forEach(r=>{r.lat&&r.lon&&!T[r.id]&&(T[r.id]={lat:r.lat,lon:r.lon},i=!0)}),i&&localStorage.setItem("geo_map_cache",JSON.stringify(T))}catch(h){console.error("Error preloading map cache",h)}},[]),L=a.useCallback(async()=>{if(m(!0),!navigator.onLine){console.log("Offline mode: Loading from cache");const q=localStorage.getItem("cache_demands"),U=localStorage.getItem("cache_citizens"),h=localStorage.getItem("offline_demands_queue");let T=q?JSON.parse(q):[];const i=U?JSON.parse(U):[];h&&(T=[...JSON.parse(h),...T]),b(T),p(i),m(!1);return}if(re()&&M)try{const[{data:q},{data:U},{data:h},{data:T},{data:i},{data:r},{data:S}]=await Promise.all([M.from("demands").select("*").order("created_at",{ascending:!1}).limit(2e3),M.from("citizens").select("*").limit(3e3),M.from("system_users").select("*"),M.from("demand_interactions").select("*").order("created_at",{ascending:!1}).limit(1e3),M.from("app_config").select("*").eq("key","weather_locations").maybeSingle(),M.from("app_config").select("*").eq("key","global_theme_mode").maybeSingle(),M.from("dashboard_stats").select("*").maybeSingle()]),H=q?q.map(k=>({...k,citizenId:k.citizen_id,createdAt:k.created_at})):[],Z=U?U.map(k=>({id:k.id,cpf:k.cpf,name:`${k.nome} ${k.sobrenome}`,email:k.email,phone:k.telefone,createdAt:k.created_at,logradouro:k.logradouro,numero:k.numero,bairro:k.bairro,cidade:k.cidade,estado:k.estado,cep:k.cep,lat:k.lat,lon:k.lon})):[];localStorage.setItem("cache_demands",JSON.stringify(H)),localStorage.setItem("cache_citizens",JSON.stringify(Z)),q&&b(H),U&&p(Z),h&&w(h),T&&d(T.map(k=>({id:k.id,demandId:k.demanda_id,type:k.tipo,text:k.texto,isCompleted:k.concluido,deadline:k.prazo,user:k.usuario,createdAt:k.created_at}))),i&&D(i.value),S&&J(S),r&&r.value&&v(r.value),V(H,Z)}catch(q){console.error("Error fetching data, trying cache...",q);const U=localStorage.getItem("cache_demands"),h=localStorage.getItem("cache_citizens");U&&b(JSON.parse(U)),h&&p(JSON.parse(h))}finally{m(!1)}else b([]),m(!1)},[V]),K=a.useCallback(async()=>{const q=localStorage.getItem("offline_demands_queue");if(!q)return 0;const U=JSON.parse(q);if(U.length===0)return 0;if(re()&&M){console.log(`Syncing ${U.length} offline demands...`);let h=0;for(const T of U)try{const{error:i}=await M.from("demands").insert({id:T.id,title:T.title,description:T.description,level:T.level,status:T.status,priority:T.priority,type:T.type,deadline:T.deadline,citizen_id:T.citizenId,tags:T.tags});i?console.error("Failed to sync item",T.id,i):h++}catch(i){console.error("Error syncing item",i)}return localStorage.removeItem("offline_demands_queue"),A(h),L(),h}return 0},[L]);return a.useEffect(()=>{const q=()=>{l(!0),K(),L()},U=()=>{l(!1)};return window.addEventListener("online",q),window.addEventListener("offline",U),()=>{window.removeEventListener("online",q),window.removeEventListener("offline",U)}},[L,K]),a.useEffect(()=>{t?(L(),setTimeout(()=>{navigator.onLine&&K()},2e3)):b([])},[t,L,K]),{isOnline:o,isLoading:x,demands:n,setDemands:b,citizens:N,setCitizens:p,users:y,interactions:j,weatherLocations:C,setWeatherLocations:D,dbStats:$,themePreference:I,fetchData:L,processOfflineQueue:K,syncCount:P,setSyncCount:A}},xs=De.lazy(()=>Bt(()=>import("./PeopleManager-Bc4_vqKP.js"),__vite__mapDeps([0,1,2,3]))),hs=De.lazy(()=>Bt(()=>import("./AdminScreen-8fCEdxRu.js"),__vite__mapDeps([4,1,2,3]))),bt={administrador:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","admin_panel","map"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!0,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},chefe_de_gabinete:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!0,showPending:!0,showInProgress:!0,showCompleted:!0,showHighPriority:!0,showAnalytics:!0,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0},assessor:{allowedViews:["dashboard","demands","new-demand","edit-demand","people","map","admin_panel"],dashboardWidgets:{showTotal:!0,showCitizens:!1,showPending:!0,showInProgress:!0,showCompleted:!1,showHighPriority:!0,showAnalytics:!1,showTags:!1,showUpcomingActivities:!0,showRecentActivity:!0,showQuickAccess:!1},canCreateDemand:!0,canCreateCitizen:!0}},ms=De.memo(({data:t,title:o})=>{const l=t.reduce((m,n)=>m+n.value,0);let x=0;return l===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados"}):e.jsxs("div",{className:"flex items-center gap-6 h-full justify-center",children:[e.jsxs("div",{className:"relative w-32 h-32 shrink-0",children:[e.jsx("svg",{viewBox:"0 0 100 100",className:"transform -rotate-90 w-full h-full",children:t.map((m,n)=>{const b=m.value/l,N=40,p=2*Math.PI*N,y=`${b*p} ${p}`;return x+=b*100,e.jsx("circle",{cx:"50",cy:"50",r:N,fill:"transparent",stroke:m.color,strokeWidth:"12",strokeDasharray:y,strokeDashoffset:-(x-b*100)/100*p,className:"transition-all duration-1000 ease-out"},n)})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-xl font-bold text-slate-800 dark:text-white",children:l}),e.jsx("span",{className:"text-[9px] uppercase font-bold text-slate-400",children:"Total"})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:t.map((m,n)=>e.jsxs("div",{className:"flex items-center justify-between text-xs gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:m.color}}),e.jsx("span",{className:"font-medium text-slate-600 dark:text-white/80",children:m.label})]}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white",children:[Math.round(m.value/l*100),"%"]})]},n))})]})}),bs=De.memo(({data:t,unit:o=""})=>{const l=Math.max(...t.map(x=>x.value),1);return t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"Sem dados geográficos"}):e.jsx("div",{className:"h-full w-full flex items-end justify-between gap-2 px-2 pb-2 pt-4",children:t.slice(0,7).map((x,m)=>{const n=x.value/l*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1 group h-full justify-end",children:[e.jsxs("div",{className:"text-[10px] font-bold text-slate-600 dark:text-slate-300 mb-0.5",children:[x.value,o]}),e.jsx("div",{style:{height:`${n}%`},className:"w-full bg-brand-200 dark:bg-brand-500/30 rounded-t-sm group-hover:bg-brand-50 dark:group-hover:bg-brand-500 transition-colors min-h-[4px]"}),e.jsx("div",{className:"text-[9px] text-slate-400 truncate w-full text-center",title:x.label,children:x.label.slice(0,6)})]},m)})})}),us=()=>{const[t,o]=a.useState(()=>{if(typeof window<"u"){const c=localStorage.getItem("geo_user");return c?JSON.parse(c):null}return null}),[l,x]=a.useState("dashboard"),[m,n]=a.useState(!0),b=a.useRef(0),N=a.useRef(null),[p,y]=a.useState("list"),[w,j]=a.useState(()=>typeof window<"u"&&localStorage.getItem("geo_theme_pref")||"auto"),[d,C]=a.useState(!1),[D,$]=a.useState("all"),[J,I]=a.useState("all"),[v,P]=a.useState("30"),[A,V]=a.useState("demands"),[L,K]=a.useState("activity"),[q,U]=a.useState(bt),[h,T]=a.useState({search:"",level:[],priority:[],status:[],startDate:"",endDate:"",dateType:"createdAt",tags:[]}),[i,r]=a.useState(null),[S,H]=a.useState(null),[Z,k]=a.useState(null),[O,se]=a.useState("list"),{demands:ae,setDemands:W,citizens:ee,users:ne,interactions:f,weatherLocations:F,setWeatherLocations:X,isOnline:oe,themePreference:Ee,fetchData:we,syncCount:Ie}=cs(t);a.useEffect(()=>{Ee&&j(Ee)},[Ee]);const pe=a.useMemo(()=>{let c=null,g=null;if(h.startDate){const[E,z,Y]=h.startDate.split("-").map(Number);if(c=new Date(E,z-1,Y,0,0,0,0).getTime(),h.endDate){const[ie,Te,Ge]=h.endDate.split("-").map(Number);g=new Date(ie,Te-1,Ge,23,59,59,999).getTime()}else g=new Date(E,z-1,Y,23,59,59,999).getTime()}const s=h.search.toLowerCase();return ae.filter(E=>{if(h.search){const z=E.id.toLowerCase().includes(s),Y=E.title.toLowerCase().includes(s),te=E.description.toLowerCase().includes(s);if(!z&&!Y&&!te)return!1}if(h.status.length>0&&!h.status.includes(E.status)||h.priority.length>0&&!h.priority.includes(E.priority)||h.level.length>0&&!h.level.includes(E.level)||h.responsibleId&&E.responsibleId!==h.responsibleId||h.tags&&h.tags.length>0&&(!E.tags||!h.tags.some(z=>E.tags.includes(z))))return!1;if(c!==null&&g!==null){let z;if(h.dateType==="deadline"?z=E.deadline:h.dateType==="updatedAt"?z=E.updatedAt:z=E.createdAt,!z)return!1;let Y;if(/^\d{4}-\d{2}-\d{2}$/.test(z)){const[te,ie,Te]=z.split("-").map(Number);Y=new Date(te,ie-1,Te,12,0,0).getTime()}else Y=new Date(z).getTime();if(Y<c||Y>g)return!1}return!0})},[ae,h]),ce=a.useMemo(()=>{const c=h.search.toLowerCase();return h.search?ee.filter(g=>{var Y,te;const s=g.name.toLowerCase().includes(c),E=(Y=g.email)==null?void 0:Y.toLowerCase().includes(c),z=(te=g.phone)==null?void 0:te.includes(c);return s||E||z}):ee},[ee,h.search]),Ne=a.useMemo(()=>{const c=[];return pe.length>0&&pe.forEach(g=>{g.lat&&g.lon&&c.push({id:g.id,type:"demand",lat:g.lat,lon:g.lon,title:g.title,status:g.status,priority:g.priority})}),ce.length>0&&ce.forEach(g=>{g.lat&&g.lon&&c.push({id:g.id,type:"citizen",lat:g.lat,lon:g.lon,name:g.name,bairro:g.bairro})}),c},[pe,ce]);a.useEffect(()=>{const c=g=>{var s;(s=g.detail)!=null&&s.demandId&&x("map")};return window.addEventListener("navigate-to-map",c),()=>window.removeEventListener("navigate-to-map",c)},[]),a.useEffect(()=>{Ie>0&&xe("success",`${Ie} itens sincronizados.`)},[Ie]),a.useEffect(()=>{N.current&&(N.current.scrollTo(0,0),n(!0))},[l]);const Oe=c=>{const g=c.currentTarget.scrollTop;Math.abs(g-b.current)>5&&(g>b.current&&g>50?n(!1):n(!0),b.current=g)};a.useEffect(()=>{const c=()=>{let s=!1;if(w==="dark")s=!0;else if(w==="light")s=!1;else{const E=new Date().getHours();s=E<6||E>=18}C(s),s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};c();const g=setInterval(c,6e4);return()=>clearInterval(g)},[w]);const xe=a.useCallback((c,g)=>{k({type:c,message:g}),setTimeout(()=>k(null),4e3)},[]),Re=c=>{o(c)},ve=()=>{o(null),localStorage.removeItem("geo_user"),W([])},Ae=()=>{const c=d?"light":"dark";j(c),localStorage.setItem("geo_theme_pref",c)},je=c=>{H(c),x("people")},u=()=>{const c=new Date,g=new Date;if(v!=="all"){const s=parseInt(v);s===365?(g.setMonth(0,1),g.setHours(0,0,0,0)):g.setDate(c.getDate()-s)}else g.setFullYear(1970);return g},_=a.useMemo(()=>{const c=u();return ae.filter(g=>{const E=new Date(g.createdAt)>=c,z=D==="all"||g.status===D,Y=J==="all"||g.priority===J;return E&&z&&Y})},[ae,D,J,v]),B=a.useMemo(()=>{const c=u();return ee.filter(g=>g.createdAt?new Date(g.createdAt)>=c:!0)},[ee,v]),R=a.useMemo(()=>{if(A==="demands"){const c=_.length;let g=0,s=0,E=0;for(const z of _)z.status===G.PENDING?g++:z.status===G.COMPLETED&&s++,z.priority===Q.HIGH&&E++;return{stat1:{label:"Filtradas",value:c,icon:Rt,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Pendentes",value:g,icon:ue,color:"bg-slate-500",text:"text-slate-600 dark:text-slate-400"},stat3:{label:"Concluídos",value:s,icon:$e,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat4:{label:"Alta Prioridade",value:E,icon:nt,color:"bg-red-500",text:"text-red-600 dark:text-red-400"}}}else{const c=ee.length,g=new Date().toDateString(),s=ee.filter(Y=>Y.createdAt&&new Date(Y.createdAt).toDateString()===g).length,E={};for(const Y of ee)Y.bairro&&(E[Y.bairro]=(E[Y.bairro]||0)+1);const z=Object.entries(E).sort((Y,te)=>te[1]-Y[1])[0];return{stat1:{label:"Total Cidadãos",value:c,icon:Pe,color:"bg-blue-500",text:"text-blue-600 dark:text-blue-400"},stat2:{label:"Novos Hoje",value:s,icon:zt,color:"bg-green-500",text:"text-green-600 dark:text-green-400"},stat3:{label:"Top Bairro",value:z?z[0]:"N/A",icon:ge,color:"bg-brand-500",text:"text-brand-600 dark:text-brand-400"},stat4:{label:"Cadastros (Bairro)",value:z?z[1]:0,icon:Lt,color:"bg-purple-500",text:"text-purple-600 dark:text-purple-400"}}}},[_,B,ee,A]),le=a.useMemo(()=>{if(A==="demands"){const c={[G.PENDING]:0,[G.IN_PROGRESS]:0,[G.COMPLETED]:0};return _.forEach(g=>{c[g.status]!==void 0&&c[g.status]++}),[{label:"Pendente",value:c[G.PENDING],color:"#64748b"},{label:"Em Andamento",value:c[G.IN_PROGRESS],color:"#f59e0b"},{label:"Concluído",value:c[G.COMPLETED],color:"#10b981"}].filter(g=>g.value>0)}else{const c={};B.forEach(Y=>{const te=Y.createdAt?new Date(Y.createdAt):new Date,ie=`${te.getFullYear()}-${String(te.getMonth()+1).padStart(2,"0")}`;c[ie]=(c[ie]||0)+1});const g=Object.keys(c).sort().reverse(),s=["#0ea5e9","#6366f1","#8b5cf6","#ec4899","#64748b"],E=g.slice(0,4).map((Y,te)=>{const[ie,Te]=Y.split("-"),ct=new Date(parseInt(ie),parseInt(Te)-1).toLocaleString("pt-BR",{month:"short",year:"2-digit"});return{label:ct.charAt(0).toUpperCase()+ct.slice(1),value:c[Y],color:s[te%s.length]}}),z=g.slice(4).reduce((Y,te)=>Y+c[te],0);return z>0&&E.push({label:"Antigos",value:z,color:"#94a3b8"}),E}},[_,B,A]),de=a.useMemo(()=>{const c={};return A==="demands"?_.forEach(g=>{const s=ee.find(E=>E.id===g.citizenId);s&&s.bairro&&(c[s.bairro]=(c[s.bairro]||0)+1)}):B.forEach(g=>{g.bairro&&(c[g.bairro]=(c[g.bairro]||0)+1)}),Object.entries(c).sort((g,s)=>s[1]-g[1]).slice(0,7).map(([g,s])=>({label:g,value:s}))},[_,B,ee,A]),be=a.useMemo(()=>[..._].sort((c,g)=>new Date(g.createdAt).getTime()-new Date(c.createdAt).getTime()).slice(0,5),[_]),ke=a.useMemo(()=>[...B].sort((c,g)=>new Date(g.createdAt||0).getTime()-new Date(c.createdAt||0).getTime()).slice(0,5),[B]),he=a.useMemo(()=>{const c=new Date;return c.setHours(0,0,0,0),_.filter(g=>g.deadline&&g.status!==G.COMPLETED).map(g=>({...g,date:new Date(g.deadline)})).filter(g=>g.date>=c).sort((g,s)=>g.date.getTime()-s.date.getTime()).slice(0,5)},[_]),Qe=t?q[t.role]||bt.assessor:bt.administrador,dt=()=>e.jsx("div",{className:"space-y-2",children:A==="demands"?be.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Ia,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):be.map(c=>e.jsxs("div",{onClick:()=>{t&&(r(c),x("edit-demand"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-brand-50 dark:bg-brand-500/10 flex flex-col items-center justify-center text-brand-600 dark:text-brand-400 font-bold shrink-0 border border-brand-100 dark:border-brand-500/20",children:[e.jsx("span",{className:"text-xs",children:new Date(c.createdAt).getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:new Date(c.createdAt).toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:c.title}),e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${c.status==="Concluído"?"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300":c.status==="Em Andamento"?"bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-300":"bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300"}`,children:c.status})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:c.description})]})]},c.id)):ke.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(Pe,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):ke.map(c=>e.jsxs("div",{onClick:()=>{je(c.id)},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-blue-50 dark:bg-blue-500/10 flex flex-col items-center justify-center text-blue-600 dark:text-blue-400 font-bold shrink-0 border border-blue-100 dark:border-blue-500/20",children:[e.jsx("span",{className:"text-xs",children:new Date(c.createdAt||Date.now()).getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:new Date(c.createdAt||Date.now()).toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:c.name}),e.jsx("span",{className:"shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md bg-slate-100 text-slate-600 dark:bg-white/10 dark:text-slate-300",children:c.phone?Le(c.phone):"Sem Tel"})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1 flex items-center gap-1",children:c.bairro&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-2.5 h-2.5"})," ",c.bairro]})})]})]},c.id))}),it=()=>e.jsx("div",{className:"space-y-2",children:A==="demands"?he.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx($e,{className:"w-6 h-6 mb-2 opacity-20"}),"Tudo em dia!"]}):he.map(c=>{const g=Math.ceil((c.date.getTime()-new Date().getTime())/864e5);return e.jsxs("div",{onClick:()=>{t&&(r(c),x("edit-demand"))},className:"flex gap-3 p-2.5 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 hover:border-brand-200 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-amber-50 dark:bg-amber-500/10 flex flex-col items-center justify-center text-amber-600 dark:text-amber-400 font-bold shrink-0 border border-amber-100 dark:border-amber-500/20",children:[e.jsx("span",{className:"text-xs",children:c.date.getDate()}),e.jsx("span",{className:"text-[8px] uppercase",children:c.date.toLocaleString("default",{month:"short"}).slice(0,3)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 dark:text-white truncate group-hover:text-brand-600",children:c.title}),e.jsx("span",{className:`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded-md ${g<=2?"bg-red-100 text-red-600 dark:bg-red-500/20":"bg-slate-100 text-slate-600 dark:bg-white/10"}`,children:g<0?"Exp.":`${g}d`})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5 line-clamp-1",children:c.description})]})]},c.id)}):de.length===0?e.jsxs("div",{className:"h-32 flex flex-col items-center justify-center text-slate-400 text-xs italic",children:[e.jsx(ge,{className:"w-6 h-6 mb-2 opacity-20"}),"Sem dados"]}):de.slice(0,5).map((c,g)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs font-bold text-slate-400 w-4",children:g+1}),e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-white",children:c.label})]}),e.jsx("span",{className:"text-[10px] font-bold bg-purple-100 text-purple-600 dark:bg-purple-500/20 dark:text-purple-300 px-2 py-1 rounded-full",children:c.value})]},g))});return e.jsxs("div",{className:`flex h-screen bg-slate-50 dark:bg-[#020617] transition-colors duration-500 overflow-hidden ${d?"dark":""}`,children:[!t&&e.jsx("div",{className:"absolute inset-0 z-[100]",children:e.jsx(Ba,{onLogin:Re})}),e.jsxs("div",{className:`dashboard-root flex h-full w-full transition-all duration-700 ease-in-out ${t?"filter-none scale-100 opacity-100":"blur-[5px] scale-[1.02] pointer-events-none grayscale-[0.2]"}`,children:[e.jsx(za,{currentView:l==="fast-track"?"demands":l,setView:x,user:t,onLogout:ve,toggleTheme:Ae,isDarkMode:d,systemConfig:q,showMobileDock:m}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 transition-all duration-300 relative lg:my-4 lg:mr-4 lg:ml-4",children:[!oe&&e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-[1000] bg-amber-500/90 backdrop-blur-sm text-white text-xs font-bold text-center py-1.5 flex items-center justify-center gap-2 lg:rounded-t-[2.5rem]",children:[e.jsx(Da,{className:"w-3 h-3"})," Modo Offline. As alterações serão salvas localmente."]}),e.jsxs("div",{className:`
                        flex-1 relative overflow-hidden flex flex-col glass-container
                        ${l==="map"?"rounded-none md:rounded-[2.5rem] lg:border-0":"rounded-[2.5rem]"}
                    `,children:[Z&&e.jsxs("div",{className:`fixed top-6 right-6 z-[1000] px-4 py-3 rounded-xl shadow-2xl border flex items-center gap-3 animate-in slide-in-from-right duration-300 ${Z.type==="success"?"bg-green-500 text-white border-green-600":"bg-red-500 text-white border-red-600"}`,children:[Z.type==="success"?e.jsx($e,{className:"w-5 h-5"}):e.jsx(Ot,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-sm",children:Z.message})]}),e.jsxs(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(me,{className:"w-8 h-8 animate-spin text-brand-500"})}),children:[["dashboard","new-demand","edit-demand","admin_panel","demands","people"].includes(l)&&e.jsxs("div",{className:"absolute inset-0 overflow-y-auto custom-scrollbar p-4 lg:p-6 pb-32 lg:pb-6",onScroll:Oe,ref:N,children:[e.jsx("div",{className:"lg:hidden h-2 w-full"}),l==="dashboard"&&e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 shrink-0",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white tracking-tight",children:["Olá, ",t?t.name.split(" ")[0]:"Bem-vindo"]})}),e.jsx(ds,{locations:F})]}),e.jsx(Jt,{status:D,setStatus:$,priority:J,setPriority:I,timeRange:v,setTimeRange:P,scope:A,setScope:V,className:"sticky top-0 z-30"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 shrink-0",children:[e.jsx(Ce,{title:R.stat1.label,value:typeof R.stat1.value=="string"?0:R.stat1.value,subValue:typeof R.stat1.value=="string"?R.stat1.value:void 0,icon:R.stat1.icon,colorClass:R.stat1.color,textClass:R.stat1.text}),e.jsx(Ce,{title:R.stat2.label,value:typeof R.stat2.value=="string"?0:R.stat2.value,subValue:typeof R.stat2.value=="string"?R.stat2.value:void 0,icon:R.stat2.icon,colorClass:R.stat2.color,textClass:R.stat2.text}),e.jsx(Ce,{title:R.stat3.label,value:typeof R.stat3.value=="string"?0:R.stat3.value,subValue:typeof R.stat3.value=="string"?R.stat3.value:void 0,icon:R.stat3.icon,colorClass:R.stat3.color,textClass:R.stat3.text}),e.jsx(Ce,{title:R.stat4.label,value:typeof R.stat4.value=="string"?0:R.stat4.value,subValue:typeof R.stat4.value=="string"?R.stat4.value:void 0,icon:R.stat4.icon,colorClass:R.stat4.color,textClass:R.stat4.text})]}),Qe.dashboardWidgets.showAnalytics&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-auto shrink-0",children:[e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(Ea,{className:"w-3 h-3"})," ",A==="demands"?"Distribuição por Status":"Cadastros por Mês"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(ms,{data:le,title:A==="demands"?"Demandas":"Cidadãos"})})]}),e.jsxs("div",{className:"glass-panel p-5 rounded-2xl flex flex-col min-h-[250px] border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(ge,{className:"w-3 h-3"})," ",A==="demands"?"Top Bairros (Demandas)":"Top Bairros (Residentes)"]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(bs,{data:de})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 min-h-0",children:[e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${L!=="activity"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(Me,{value:L,onChange:c=>K(c),options:[{value:"activity",label:"Atividade Recente",icon:tt},{value:"upcoming",label:"Próx. Prazos",icon:xt}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(tt,{className:"w-4 h-4"})," Atividades Recentes"]}),e.jsxs("button",{onClick:()=>x(A==="demands"?"demands":"people"),className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(Je,{className:"w-3 h-3"})]})]}),dt()]}),e.jsxs("div",{className:`glass-panel p-5 rounded-2xl flex flex-col h-full min-h-[300px] border border-slate-200 dark:border-white/10 ${L!=="upcoming"?"hidden lg:flex":"flex"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[e.jsx("div",{className:"w-full lg:hidden",children:e.jsx(Me,{value:L,onChange:c=>K(c),options:[{value:"activity",label:"Atividade Recente",icon:tt},{value:"upcoming",label:"Próx. Prazos",icon:xt}]})}),e.jsxs("h3",{className:"hidden lg:flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60",children:[e.jsx(xt,{className:"w-4 h-4"})," ",A==="demands"?"Próximos Prazos":"Top Bairros"]}),e.jsxs("button",{onClick:()=>{A==="demands"?(se("calendar"),x("demands")):x("map")},className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1",children:["Ver Todos ",e.jsx(Je,{className:"w-3 h-3"})]})]}),it()]})]})]}),l==="new-demand"&&e.jsx(Ga,{initialSearchTerm:S||void 0,onSuccess:c=>{we(),x("demands"),H(null)},onCancel:()=>{x("demands"),H(null)},onNotification:xe}),l==="edit-demand"&&i&&e.jsx(Ha,{demand:i,onSuccess:c=>{we(),x("demands"),r(null)},onCancel:()=>{x("demands"),r(null)},onNotification:xe}),l==="admin_panel"&&t&&e.jsx(hs,{currentUser:t,systemConfig:q,onUpdateConfig:U,onUpdateLocation:X,onNotification:xe,onLogout:ve,toggleTheme:Ae,isDarkMode:d}),l==="demands"&&e.jsx(Tt,{demands:pe,citizens:ee,interactions:f,users:ne,onViewDemand:()=>{},onEditDemand:c=>{r(c),x("edit-demand")},onCreateDemand:()=>x("new-demand"),onUpdateStatus:async(c,g)=>{W(s=>s.map(E=>E.id===c?{...E,status:g}:E)),re()&&M&&(await M.from("demands").update({status:g}).eq("id",c),xe("success","Status atualizado!"))},onInteractionUpdate:we,filters:h,setFilters:T,onNotification:xe,defaultLocation:F.length>0?F[0]:null,onViewCitizen:je,initialViewMode:O,mapMarkers:Ne}),l==="people"&&e.jsx(xs,{initialSearchTerm:S||void 0,onCreateDemand:c=>{H(c),x("new-demand")},onEditDemand:c=>{r(c),x("edit-demand")},onNotification:xe,onPersonUpdate:we,permissions:Qe,onModeChange:y})]}),l==="fast-track"&&e.jsx(is,{onBack:()=>x("demands"),onSuccess:c=>{H(c),x("new-demand")}}),l==="map"&&e.jsx("div",{className:"absolute inset-0 z-0 flex flex-col overflow-hidden pb-[76px] md:pb-0",children:e.jsx(Tt,{demands:pe,citizens:ee,interactions:f,users:ne,onViewDemand:()=>{},onEditDemand:c=>{r(c),x("edit-demand")},onCreateDemand:()=>x("new-demand"),onUpdateStatus:()=>{},onInteractionUpdate:we,filters:h,setFilters:T,onNotification:xe,initialViewMode:"map",defaultLocation:F.length>0?F[0]:null,onViewCitizen:je,mapMarkers:Ne})})]})]})]})]})]})},Wt=document.getElementById("root");if(!Wt)throw new Error("Could not find root element to mount to");const ps=Ma.createRoot(Wt);ps.render(e.jsx(De.StrictMode,{children:e.jsx(us,{})}));export{Ka as D,Qa as P,Ce as S,Ue as a,Me as b,Le as f,re as i,e as j,M as s};
