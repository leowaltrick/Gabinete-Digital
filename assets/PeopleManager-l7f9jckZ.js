import{i as D,s as m,j as e,S as V,f as L,P as rt,D as lt,a as ot,b as le}from"./index-BVbh-BIT.js";import{r as l,G as dt,U as oe,j as nt,X as it,a0 as ct,$ as xt,ai as He,a4 as mt,n as ht,m as de,x as qe,k as ne,w as Oe,q as bt,t as ut,o as ft}from"./vendor-CC2eIyRy.js";import"./db-DxBk-dGO.js";import"./maps-BiYucuft.js";const pt=(c,w,f)=>{if(!c||c.length===0){alert("Não há dados para exportar com os filtros atuais.");return}const $="data:text/csv;charset=utf-8,"+"\uFEFF"+[w.join(","),...c.map(n=>n.join(","))].join(`
`),B=encodeURI($),u=document.createElement("a"),j=new Date,G=j.toLocaleDateString("pt-BR").split("/").reverse().join("-"),k=j.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}).replace(":","-");u.setAttribute("href",B),u.setAttribute("download",`${f}_${G}_${k}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u)},yt=({isModalMode:c=!1,onSelectPerson:w,initialSearchTerm:f,initialMode:N="list",onCreateDemand:$,onEditDemand:B,onUpdateStatus:u,onModeChange:j,onInteractionUpdate:G,onPersonUpdate:k,onNotification:n,permissions:ie,onClearSelection:ce,demands:xe=[]})=>{var _e;const[i,p]=l.useState("list"),[s,z]=l.useState(null),[b,W]=l.useState([]),[v,K]=l.useState(""),[Re,me]=l.useState(!1),[X,he]=l.useState(1),P=10,[be,ue]=l.useState([]),[gt,fe]=l.useState(!1),[pe,A]=l.useState(null),[y,F]=l.useState(!1),[C,Ue]=l.useState(!1),[ge,J]=l.useState(""),[we,Q]=l.useState(""),[je,I]=l.useState(""),[ke,g]=l.useState([]),[T,Y]=l.useState(""),[Z,M]=l.useState(""),[Ve,ve]=l.useState(!1),[Ne,_]=l.useState(""),[ye,ee]=l.useState(""),[Ce,te]=l.useState(""),[Se,H]=l.useState(""),[Ee,q]=l.useState(""),[De,O]=l.useState(""),[wt,Le]=l.useState(!1),[$e,Be]=l.useState(!1),[S,se]=l.useState(null),[ae,re]=l.useState(null),R=ie?ie.canCreateCitizen:!0;l.useEffect(()=>{j&&j(i)},[i,j]),l.useEffect(()=>{N&&N!=="list"&&N==="form"&&i!=="form"&&Ae()},[N]),l.useEffect(()=>{f?(async()=>{const r=le(f);if(D()&&m){const{data:a}=await m.from("citizens").select("*").eq("telefone",r).maybeSingle();a?(W([a]),z(a),p("details")):(K(f),p("list"))}})():i==="list"&&ze()},[f]),l.useEffect(()=>{i==="list"&&!f&&b.length===0&&ze()},[i]),l.useEffect(()=>{i==="details"&&s&&Ge(s.id||"")},[i,s]);const ze=async()=>{me(!0);try{if(D()&&m){const{data:t,error:r}=await m.from("citizens").select("*").order("created_at",{ascending:!1}).limit(1e3);if(r)throw r;t&&W(t)}}catch(t){console.error("Erro ao buscar pessoas:",t)}finally{me(!1)}},Ge=async t=>{fe(!0);try{if(D()&&m){let r=m.from("demands").select("*").eq("citizen_id",t);const{data:a,error:d}=await r.order("created_at",{ascending:!1});if(d)throw d;if(a){const x=a.map(o=>({id:o.id,title:o.title,description:o.description,level:o.level,status:o.status,priority:o.priority,type:o.type,deadline:o.deadline,citizenId:o.citizen_id,createdAt:o.created_at,tags:o.tags}));ue(x)}}}catch(r){console.error("Erro ao buscar histórico:",r)}finally{fe(!1)}},Pe=()=>{J(""),Q(""),I(""),g([]),Y(""),M(""),_(""),ee(""),te(""),H(""),q(""),O(""),se(null),F(!1),re(null)},Ae=()=>{if(!R){n&&n("error","Sem permissão para criar cidadãos.");return}Pe(),F(!1),p("form")},Fe=()=>{Pe(),z(null),p("list"),ce&&ce()},Ie=t=>{if(c&&w){w(t);return}z(t),p("details")},We=()=>{if(s){if(!R){n&&n("error","Sem permissão para editar.");return}J(s.nome||""),Q(s.sobrenome||""),I(s.email||""),Y(L(s.telefone||"")),M(s.cep||""),_(s.logradouro||""),ee(s.numero||""),te(s.complemento||""),H(s.bairro||""),q(s.cidade||""),O(s.estado||""),se(s),F(!0),p("form")}},Ke=async()=>{if(y)return;const t=le(T);if(t){if(t.length<10){re("Telefone inválido");return}Le(!0);try{if(D()&&m){const{data:r}=await m.from("citizens").select("*").eq("telefone",t).maybeSingle();r&&(se(r),n&&n("error","Este telefone já possui cadastro."))}}catch(r){console.error(r)}finally{Le(!1)}}},Xe=async()=>{const t=Z.replace(/\D/g,"");if(t.length===8){ve(!0);try{const a=await(await fetch(`https://viacep.com.br/ws/${t}/json/`)).json();a.erro||(_(a.logradouro),H(a.bairro),q(a.localidade),O(a.uf))}catch(r){console.error(r)}finally{ve(!1)}}},Je=t=>{if(I(t),!t){g([]);return}const r=["gmail.com","hotmail.com","outlook.com","yahoo.com.br","icloud.com"];if(r.some(a=>t.endsWith("@"+a))){g([]);return}if(!t.includes("@"))g(r.map(a=>`${t}@${a}`));else{const[a,d]=t.split("@"),x=r.filter(o=>o.startsWith(d));x.length>0?g(x.map(o=>`${a}@${o}`)):g([])}},Qe=t=>{I(t),g([])},Ye=async t=>{t.preventDefault();const r=T?le(T):null;if(!r){re("É necessário informar o Telefone."),n&&n("error","Informe o Telefone.");return}Be(!0);const a={nome:ge,sobrenome:we,email:je||null,telefone:r,cep:Z.replace(/\D/g,""),logradouro:Ne,numero:ye,complemento:Ce||null,bairro:Se,cidade:Ee,estado:De.substring(0,2).toUpperCase()};try{if(D()&&m){let d;if(y&&(S!=null&&S.id)){const{data:o,error:h}=await m.from("citizens").update(a).eq("id",S.id).select().single();if(h)throw h;d=o,n&&n("success","Dados atualizados!")}else{const{data:o,error:h}=await m.from("citizens").insert(a).select().single();if(h)throw h;d=o,n&&n("success","Cidadão cadastrado!")}k&&k();const x=y?b.map(o=>o.id===d.id?d:o):[d,...b];W(x),c&&w?w(d):setTimeout(()=>{z(d),p("details"),F(!1)},1500)}else n&&n("error","Erro de conexão.")}catch(d){n&&n("error",`Erro: ${d.message}`)}finally{Be(!1)}},E=l.useMemo(()=>b.filter(t=>{const r=v.toLowerCase(),a=`${t.nome} ${t.sobrenome}`.toLowerCase(),d=t.telefone?t.telefone.replace(/\D/g,""):"",x=v.replace(/\D/g,""),o=a.includes(r)||x.length>3&&d.includes(x)||t.email&&t.email.toLowerCase().includes(r);let h=!0;return C&&(h=xe.some(at=>at.citizenId===t.id)),o&&h}),[b,v,C,xe]),U=l.useMemo(()=>{const t=b.length,r=new Date().toDateString(),a=b.filter(o=>o.created_at&&new Date(o.created_at).toDateString()===r).length,d={};b.forEach(o=>{o.bairro&&(d[o.bairro]=(d[o.bairro]||0)+1)});const x=Object.entries(d).sort((o,h)=>h[1]-o[1])[0];return{total:t,newToday:a,topBairro:x?x[0]:"N/A",topBairroCount:x?x[1]:0}},[b]);l.useEffect(()=>{he(1)},[v,C]);const Ze=Math.ceil(E.length/P),Te=E.slice((X-1)*P,X*P),Me=()=>{const t=["Nome","Sobrenome","Telefone","Email","Logradouro","Número","Bairro","Cidade","UF","CEP","Data Cadastro"],r=E.map(a=>[`"${a.nome}"`,`"${a.sobrenome}"`,a.telefone||"",a.email||"",`"${a.logradouro}"`,a.numero,`"${a.bairro}"`,`"${a.cidade}"`,a.estado,a.cep,a.created_at?new Date(a.created_at).toLocaleDateString():""]);pt(r,t,"Cidadaos")},et=t=>({id:t.id||"temp",cpf:t.cpf,name:`${t.nome} ${t.sobrenome}`,email:t.email||"",phone:t.telefone||"",createdAt:t.created_at,logradouro:t.logradouro,numero:t.numero,complemento:t.complemento||void 0,bairro:t.bairro,cep:t.cep,cidade:t.cidade,estado:t.estado}),tt=t=>{const r=new CustomEvent("navigate-to-map",{detail:{citizenId:t.id,lat:t.lat,lon:t.lon}});window.dispatchEvent(r)},st=t=>[t.logradouro,t.numero?`Nº ${t.numero}`:null,t.bairro,t.cidade&&t.estado?`${t.cidade} - ${t.estado}`:t.cidade].filter(Boolean).join(", ");return e.jsxs("div",{className:`flex flex-col gap-4 animate-in slide-in-from-right duration-500 ${c?"p-0":""} relative w-full min-w-0 pb-20 md:pb-0`,children:[e.jsx("div",{className:"shrink-0 flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i!=="list"&&!c&&e.jsxs("button",{onClick:Fe,className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-white/10 transition-colors mr-1",children:[" ",e.jsx(dt,{className:"w-6 h-6 text-slate-600 dark:text-white"})," "]}),!c&&e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-3",children:[e.jsx(oe,{className:"w-8 h-8 text-brand-600 dark:text-brand-400"}),i==="details"?`${s==null?void 0:s.nome} ${(_e=s==null?void 0:s.sobrenome)==null?void 0:_e.split(" ")[0]}`:"Gestão de Cidadãos"]}),e.jsx("p",{className:"text-slate-500 dark:text-blue-200/50 mt-1 font-medium hidden sm:block",children:i==="list"&&"Base de contatos unificada."})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:[i==="list"&&!c&&e.jsx("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:e.jsxs("div",{className:"relative w-full md:w-[280px] group",children:[e.jsx("input",{type:"text",value:v,onChange:t=>K(t.target.value),placeholder:"Buscar por nome ou telefone...",className:"w-full pl-11 pr-10 py-3 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl outline-none focus:border-brand-500 focus:bg-white dark:focus:bg-black/20 transition-all font-medium text-slate-700 dark:text-white placeholder:text-slate-400 h-11 text-sm"}),e.jsx(nt,{className:"w-5 h-5 text-slate-400 absolute left-3.5 top-3 group-focus-within:text-brand-500 transition-colors"}),v&&e.jsx("button",{onClick:()=>K(""),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600 dark:hover:text-white",children:e.jsx(it,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[i==="list"&&!c&&e.jsxs("button",{onClick:()=>Ue(!C),className:`w-auto px-4 py-2.5 rounded-xl font-bold border transition-all flex items-center justify-center gap-2 h-11 text-sm ${C?"bg-brand-50 border-brand-200 text-brand-700 dark:bg-brand-500/20 dark:border-brand-500/30 dark:text-brand-300":"bg-white dark:bg-white/5 text-slate-600 dark:text-white/70 border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10"}`,title:"Apenas com Demandas",children:[e.jsx(ct,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Com Demandas"})]}),i==="list"&&!c&&e.jsx("button",{onClick:Me,className:"w-auto px-4 py-2.5 rounded-xl font-bold bg-white dark:bg-white/5 text-slate-600 dark:text-white/70 border border-slate-200 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/10 transition-all flex items-center justify-center gap-2 h-11",title:"Exportar CSV",children:e.jsx(xt,{className:"w-5 h-5"})}),i==="list"&&R&&e.jsxs("button",{onClick:Ae,className:"w-full sm:w-auto px-5 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 transition-all flex items-center justify-center gap-2 active:scale-95 duration-200 h-11",children:[e.jsx(He,{className:"w-5 h-5"})," ",e.jsx("span",{className:"whitespace-nowrap",children:"Novo Cidadão"})]}),i==="details"&&s&&!c&&e.jsxs("div",{className:"flex gap-2",children:[R&&e.jsxs("button",{onClick:We,className:"px-4 py-2.5 bg-slate-100 dark:bg-white/10 text-slate-700 dark:text-white rounded-xl font-bold border border-slate-200 dark:border-white/5 flex items-center gap-2 hover:bg-slate-200 transition-colors active:scale-95 duration-200 h-11",children:[e.jsx(mt,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Editar"})]}),$&&e.jsxs("button",{onClick:()=>$(s.id||""),className:"px-4 py-2.5 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg transition-all flex items-center gap-2 active:scale-95 duration-200 h-11",children:[e.jsx(ht,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Nova Demanda"})]})]})]})]})]})}),e.jsxs("div",{className:"flex flex-col min-h-0 w-full relative",children:[i==="list"&&e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[!c&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 shrink-0",children:[" ",e.jsx(V,{title:"Total Cidadãos",value:U.total,icon:oe,colorClass:"bg-blue-500",textClass:"text-blue-600 dark:text-blue-400"})," ",e.jsx(V,{title:"Novos Hoje",value:U.newToday,icon:He,colorClass:"bg-green-500",textClass:"text-green-600 dark:text-green-400"})," ",e.jsx(V,{title:"Top Bairro",value:U.topBairro,icon:de,colorClass:"bg-brand-500",textClass:"text-brand-600 dark:text-brand-400"})," ",e.jsx(V,{title:"Cadastros (Bairro)",value:U.topBairroCount,icon:qe,colorClass:"bg-purple-500",textClass:"text-purple-600 dark:text-purple-400"})," "]}),e.jsx("div",{className:"flex flex-col min-h-0 glass-panel rounded-3xl border border-slate-200 dark:border-white/10 bg-white/50 dark:bg-slate-900/50 shadow-sm relative w-full",children:Re?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-400 dark:text-white/40 py-20",children:[e.jsx(ne,{className:"w-8 h-8 animate-spin mb-2 text-brand-500"}),e.jsx("p",{children:"Carregando..."})]}):E.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-400 dark:text-white/40 py-20",children:[e.jsx(oe,{className:"w-12 h-12 mb-2 opacity-20"}),e.jsx("p",{children:"Nenhum cidadão encontrado."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full relative",children:[e.jsxs("table",{className:"w-full text-left border-collapse hidden md:table",children:[e.jsxs("thead",{className:"bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-sm border-b border-slate-200 dark:border-white/10",children:[" ",e.jsxs("tr",{className:"text-xs font-bold text-slate-500 dark:text-blue-200/50 uppercase tracking-wider",children:[" ",e.jsx("th",{className:"p-4 first:pl-6 w-[45%] min-w-[200px]",children:"Cidadão"})," ",e.jsx("th",{className:"p-4 w-[20%] whitespace-nowrap",children:"Contato"})," ",e.jsx("th",{className:"p-4 w-[25%] min-w-[150px]",children:"Localização"})," ",e.jsx("th",{className:"p-4 text-right last:pr-6 w-[10%]",children:"Ação"})," "]})," "]}),e.jsxs("tbody",{className:"divide-y divide-slate-200 dark:divide-white/5 text-sm",children:[" ",Te.map((t,r)=>e.jsxs("tr",{onClick:()=>Ie(t),className:"hover:bg-white/60 dark:hover:bg-white/5 transition-colors cursor-pointer group",children:[" ",e.jsxs("td",{className:"p-4 first:pl-6",children:[" ",e.jsxs("div",{className:"flex items-center gap-3",children:[" ",e.jsx("div",{className:"w-9 h-9 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-white font-bold text-xs border border-slate-200 dark:border-white/10 shrink-0",children:t.nome.charAt(0)})," ",e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"font-bold text-slate-900 dark:text-white truncate",children:[t.nome," ",t.sobrenome]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-white/50 truncate",children:t.email||""})]})," "]})," "]})," ",e.jsx("td",{className:"p-4 text-slate-600 dark:text-white/80 whitespace-nowrap",children:t.telefone?L(t.telefone):"-"})," ",e.jsx("td",{className:"p-4 text-slate-600 dark:text-white/80",children:t.bairro?e.jsxs("span",{className:"flex flex-col",children:[e.jsx("span",{className:"truncate",children:t.bairro}),e.jsxs("span",{className:"text-[10px] text-slate-400 truncate",children:[t.cidade,"/",t.estado]})]}):"-"})," ",e.jsx("td",{className:"p-4 text-right last:pr-6",children:e.jsx("div",{className:"p-2 text-slate-400 group-hover:text-brand-600 transition-colors inline-flex bg-slate-100 dark:bg-white/5 rounded-lg group-hover:bg-brand-50 dark:group-hover:bg-brand-500/10",children:c?e.jsx("span",{className:"px-3 py-1 bg-brand-500 text-white text-xs font-bold rounded-lg shadow-sm",children:"Selecionar"}):e.jsx(Oe,{className:"w-4 h-4"})})})," "]},t.id||r))," "]})]}),e.jsx("div",{className:"md:hidden space-y-3 p-3",children:Te.map((t,r)=>e.jsxs("div",{onClick:()=>Ie(t),className:"glass-panel p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-sm active:scale-[0.98] transition-all cursor-pointer flex items-center justify-between min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 dark:bg-white/10 flex items-center justify-center font-bold text-lg text-slate-600 dark:text-white border border-slate-200 dark:border-white/10 shrink-0",children:t.nome.charAt(0)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"font-bold text-slate-900 dark:text-white truncate text-base",children:[t.nome," ",t.sobrenome]}),e.jsxs("div",{className:"flex flex-col gap-0.5 text-xs text-slate-500 dark:text-white/50 mt-0.5",children:[e.jsx("span",{className:"font-mono",children:t.telefone?L(t.telefone):"Sem Telefone"}),t.bairro&&e.jsxs("span",{className:"truncate flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"})," ",t.bairro]})]})]})]}),e.jsxs("div",{className:"text-slate-400 group-hover:text-brand-600 transition-colors shrink-0 ml-2",children:[" ",c?e.jsx("span",{className:"px-3 py-1 bg-brand-500 text-white text-xs font-bold rounded-lg shadow-sm",children:"OK"}):e.jsx(Oe,{className:"w-5 h-5"})," "]})]},t.id||r))})]}),e.jsxs("div",{className:"shrink-0 bg-slate-50/50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-white/5 z-20",children:[" ",e.jsx(rt,{currentPage:X,totalPages:Ze,onPageChange:he,totalItems:E.length,itemsPerPage:P})," "]})," "]})})]}),i==="details"&&s&&!c&&e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"space-y-6 md:space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500 pb-10",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-400 to-blue-600"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-center md:items-start text-center md:text-left",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-full bg-white dark:bg-slate-800 border-4 border-slate-100 dark:border-white/5 shadow-xl flex items-center justify-center shrink-0",children:e.jsx("span",{className:"text-3xl md:text-4xl font-bold text-brand-600 dark:text-brand-400",children:s.nome.charAt(0)})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-slate-900 dark:text-white",children:[s.nome," ",s.sobrenome]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4 justify-center md:justify-start",children:[s.telefone&&e.jsxs("div",{className:"px-3 py-1.5 rounded-lg bg-green-50 dark:bg-green-500/10 text-green-700 dark:text-green-300 text-sm font-medium flex items-center gap-2 border border-green-200 dark:border-green-500/20",children:[e.jsx(bt,{className:"w-3.5 h-3.5"})," ",L(s.telefone)]}),s.email&&e.jsxs("div",{className:"px-3 py-1.5 rounded-lg bg-blue-50 dark:bg-blue-500/10 text-blue-700 dark:text-blue-300 text-sm font-medium flex items-center gap-2 border border-blue-200 dark:border-blue-500/20",children:[e.jsx(ut,{className:"w-3.5 h-3.5"})," ",s.email]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 mb-4",children:[e.jsx(de,{className:"w-4 h-4"})," Endereço & Localização"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col gap-1.5 p-4 bg-slate-50 dark:bg-white/5 rounded-2xl border border-slate-100 dark:border-white/5",children:s.logradouro?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-bold text-slate-800 dark:text-white",children:[s.logradouro,", ",s.numero]}),s.complemento&&e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:s.complemento}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-white/70",children:s.bairro}),e.jsxs("p",{className:"text-xs text-slate-400 dark:text-white/40",children:[s.cidade," - ",s.estado," • ",s.cep]})]}):e.jsx("p",{className:"text-slate-400 dark:text-white/30 italic text-sm text-center",children:"Endereço não cadastrado."})}),e.jsx(lt,{entityId:s.id,tableName:"citizens",lat:s.lat,lon:s.lon,address:st(s),onClick:()=>tt(s),onLocationUpdate:()=>{k&&k()}})]})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border border-slate-200 dark:border-white/10 flex flex-col",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-white/60 mb-4",children:[e.jsx(qe,{className:"w-4 h-4"})," Histórico Recente"]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-[300px] custom-scrollbar",children:be.length>0?e.jsx("div",{className:"space-y-3",children:be.slice(0,5).map(t=>e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-white/5 rounded-xl border border-slate-100 dark:border-white/5 flex items-start justify-between cursor-pointer hover:bg-slate-100 dark:hover:bg-white/10 transition-colors",onClick:()=>A(t),children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-white text-sm line-clamp-1",children:t.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-white/50",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsx("span",{className:`text-[10px] px-2 py-1 rounded-md font-bold uppercase ${t.status==="Concluído"?"bg-green-100 text-green-700":"bg-slate-200 text-slate-600"}`,children:t.status})]},t.id))}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-slate-400 dark:text-white/30 py-8",children:e.jsx("p",{className:"text-sm italic",children:"Nenhuma demanda registrada."})})})]})]})]})}),i==="form"&&e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"glass-panel p-4 md:p-8 rounded-3xl border border-slate-200 dark:border-white/10 max-w-3xl mx-auto w-full animate-in fade-in slide-in-from-bottom-4 mb-20 md:mb-0",children:[e.jsxs("div",{className:"text-center mb-8",children:[" ",e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-2",children:y?"Editar Cadastro":"Novo Cidadão"})," ",e.jsx("p",{className:"text-slate-500 dark:text-white/50",children:"Preencha os dados do munícipe."})," "]}),e.jsxs("form",{onSubmit:Ye,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-200 dark:border-white/10 pb-2 mb-4",children:"Identificação"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"Nome"}),e.jsx("input",{type:"text",value:ge,onChange:t=>J(t.target.value),className:"w-full p-3 rounded-xl border border-slate-300 dark:border-white/10 glass-input outline-none focus:border-brand-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"Sobrenome"}),e.jsx("input",{type:"text",value:we,onChange:t=>Q(t.target.value),className:"w-full p-3 rounded-xl border border-slate-300 dark:border-white/10 glass-input outline-none focus:border-brand-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"Telefone (Obrigatório)"}),e.jsx("input",{type:"text",value:T,onChange:t=>Y(L(t.target.value)),onBlur:Ke,className:`w-full p-3 rounded-xl border ${ae?"border-red-500":"border-slate-300 dark:border-white/10"} glass-input outline-none focus:border-brand-500`,placeholder:"(00) 00000-0000"}),ae&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:ae})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"Email (Opcional)"}),e.jsx("input",{type:"email",value:je,onChange:t=>Je(t.target.value),className:"w-full p-3 rounded-xl border border-slate-300 dark:border-white/10 glass-input outline-none focus:border-brand-500",placeholder:"exemplo@email.com",autoComplete:"off"}),ke.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-xl shadow-lg z-50 overflow-hidden animate-in fade-in zoom-in-95",children:ke.map(t=>e.jsx("button",{type:"button",onClick:()=>Qe(t),className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-white hover:bg-slate-50 dark:hover:bg-white/10 transition-colors",children:t},t))})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-white/5",children:[e.jsx("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-400 dark:text-white/40 border-b border-slate-200 dark:border-white/10 pb-2 mb-4",children:"Endereço"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"CEP"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Z,onChange:t=>M(t.target.value),onBlur:Xe,className:"w-full p-3 rounded-xl border border-slate-300 dark:border-white/10 glass-input outline-none focus:border-brand-500",placeholder:"00000-000"}),Ve&&e.jsx(ne,{className:"absolute right-3 top-3 w-5 h-5 text-brand-500 animate-spin"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"Logradouro"}),e.jsx("input",{type:"text",value:Ne,onChange:t=>_(t.target.value),className:"w-full p-3 rounded-xl border border-slate-300 dark:border-white/10 glass-input outline-none focus:border-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"Número"}),e.jsx("input",{type:"text",value:ye,onChange:t=>ee(t.target.value),className:"w-full p-3 rounded-xl border border-slate-300 dark:border-white/10 glass-input outline-none focus:border-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:Ce,onChange:t=>te(t.target.value),className:"w-full p-3 rounded-xl border border-slate-300 dark:border-white/10 glass-input outline-none focus:border-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:Se,onChange:t=>H(t.target.value),className:"w-full p-3 rounded-xl border border-slate-300 dark:border-white/10 glass-input outline-none focus:border-brand-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"Cidade"}),e.jsx("input",{type:"text",value:Ee,onChange:t=>q(t.target.value),className:"w-full p-3 rounded-xl border border-slate-300 dark:border-white/10 glass-input outline-none focus:border-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 dark:text-white/50 mb-1",children:"UF"}),e.jsx("input",{type:"text",value:De,onChange:t=>O(t.target.value),className:"w-full p-3 rounded-xl border border-slate-300 dark:border-white/10 glass-input outline-none focus:border-brand-500 uppercase",maxLength:2})]})]})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/95 dark:bg-[#0b1121]/95 backdrop-blur-md border-t border-slate-200 dark:border-white/10 z-30 flex gap-3 md:static md:bg-transparent md:p-0 md:border-0 pb-6",children:[e.jsx("button",{type:"button",onClick:Fe,className:"px-6 py-3 rounded-xl border border-slate-200 dark:border-white/10 text-slate-500 dark:text-white/60 hover:bg-slate-50 dark:hover:bg-white/5 font-bold flex-1 active:scale-95 duration-200 transition-transform",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:$e||!!S&&!y,className:"px-6 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl font-bold shadow-lg shadow-brand-500/20 flex-1 flex items-center justify-center gap-2 disabled:opacity-50 active:scale-95 duration-200 transition-transform",children:[$e?e.jsx(ne,{className:"w-5 h-5 animate-spin"}):e.jsx(ft,{className:"w-5 h-5"})," Salvar"]})]})]})]})})]}),pe&&e.jsx(ot,{demand:pe,citizen:s?et(s):null,onClose:()=>A(null),onEdit:t=>{A(null),B&&B(t)},onUpdateStatus:(t,r)=>{u&&u(t,r),ue(a=>a.map(d=>d.id===t?{...d,status:r}:d)),A(a=>a?{...a,status:r}:null)},onInteractionUpdate:G,onNotification:n})]})};export{yt as default};
